{"version":3,"sources":["vr/ToasterManager.js","utils.js","common/GridEditorApp.js","SelectionManager.js","common/HSLUVColorPicker.js","vr/AuthModule.js","TreeItemProvider.js","common/StringEditor.js","common/EnumEditor.js","common/ArrayEditor.js","common/PropSheet.js","syncgraph/utils.js","common/TreeTable.js","metadoc/Dimension.js","metadoc/MetadocCanvas.js","syncgraph/UndoQueue.js","metadoc/EventCoalescer.js","syncgraph/PubnubSyncWrapper.js","syncgraph/MissingDocDialog.js","syncgraph/SyncGraphProvider.js","common/InputManager.js","metadoc/RectDef.js","metadoc/CircleDef.js","metadoc/TextDef.js","metadoc/ImageDef.js","metadoc/Common.js","vr/defs/ObjectDef.js","vr/defs/CubeDef.js","vr/defs/SphereDef.js","vr/defs/PlaneDef.js","vr/GLTFLoader.js","vr/defs/ModelDef.js","vr/defs/BG360Def.js","vr/defs/TextDef.js","vr/defs/Image2DDef.js","vr/defs/GroupDef.js","vr/defs/GPUParticles.js","vr/defs/ParticlesDef.js","vr/defs/ImageAnchorDef.js","vr/defs/GeoAnchorDef.js","vr/defs/HudAnchorDef.js","vr/Common.js","vr/GLTFAssetView.js","vr/GeoAssetView.js","metadoc/AssetView.js","vr/AssetActions.js","vr/dialogs/AddImageAssetDialog.js","metadoc/PageCanvasView.js","metadoc/PresentationApp.js","syncgraph/GraphAccessor.js","metadoc/Editor1.js","vr/TransformControls.js","vr/defs/SceneDef.js","vr/ToasterNotification.js","vr/ScriptManager.js","common/tween.js","vr/XRSupport.js","vr/OrbitControls.js","vr/VRCanvas.js","vr/TranslationArrow.js","vr/TranslateControl.js","vr/panel2d/panel2d.js","vr/panel2d/component2d.js","vr/panel2d/button2d.js","vr/panel2d/group2d.js","vr/3dof.js","vr/Actions.js","vr/ImmersiveVREditor.js","vr/dialogs/AddGLTFAssetDialog.js","vr/dialogs/AddGLBAssetDialog.js","vr/dialogs/AddAudioAssetDialog.js","vr/dialogs/UnsavedDocumentDialog.js","vr/dialogs/OpenFileDialog.js","vr/dialogs/OpenAssetDialog.js","vr/ScriptEditor.js","vr/dialogs/OpenScriptDialog.js","vr/Templates.js","common/QRCanvas.js","vr/dialogs/QRDialog.js","vr/dialogs/PasswordDialog.js","vr/dialogs/GithubAuthDialog.js","vr/ErrorCatcher.js","vr/VREditor.js","vr/ImmersivePlayer.js","App.js","index.js"],"names":["module","exports","adds","add","note","this","forEach","cb","onAdd","push","parseOptions","opts","loc","document","location","search","substring","split","part","keyval","on","elem","type","addEventListener","toFlatString","obj","JSON","stringify","makePoint","x","y","minus","pt","divide","v","multiply","idivide","Math","floor","distance","dx","dy","sqrt","equals","toString","concat","setQuery","oldOpts","final","Object","keys","key","query","map","join","window","history","pushState","toQueryString","GridLayout","props","clss","leftWidth","rightWidth","showLeft","showRight","style","gridTemplateColumns","react_default","a","createElement","className","children","Toolbar","cls","left","right","bottom","top","center","middle","scroll","Panel","transparent","Spacer","ToggleButton","selected","rest","objectWithoutProperties","assign","MenuPopup","es","actions","act","i","divider","onClick","PopupManager","hide","fun","icon","title","GridEditorApp","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","toggleLeftPane","e","setState","state","toggleRightPane","onMouseDownLeft","preventDefault","stopPropagation","dragSide","onMouseMove","onMouseUp","onMouseDownRight","cursor","clientX","clientY","innerWidth","removeEventListener","GridEditorApp_GridLayout","GridEditorApp_Toolbar","GridEditorApp_Spacer","bottomText","onMouseDown","Component","SELECTION_MANAGER","src_SelectionManager","SelectionManager","listeners","dropTarget","clip","index","indexOf","splice","value","node","fire","length","dropType","HSLUVColorPicker","mousePress","canvasToPoint","lightness","redraw","pressed","mouseMove","mouseUp","drawPicker","drawSlider","drawIndicator","livalToCanvas","l","mouseToCanvas","bounds","target","getBoundingClientRect","mousePressSlider","sliderPressed","hue","canvasToHue","setTimeout","mouseMoveSlider","mouseUpSlider","close","color","hsluv","hsluvToHex","onSelect","comps","hexToHsluv","console","log","canvasBounds","canvas","h","height","w","width","c","getContext","j","fillStyle","fillRect","g","cp","strokeStyle","strokeRect","lineWidth","slider","hueToCanvas","indicator","_this2","display","flexDirection","alignItems","ref","can","USER_CHANGE","AuthModule","AuthModuleSingleton","login","res","win","open","url","authCallback","focus","logout","localStorage","clear","doclistSupported","msg","setUserData","data","payload","ToasterMananager","supported","docDeleteSupported","assetUploadSupported","scriptEditingSupported","passwordSupported","connected","isLoggedIn","fetch","URLS","BASE","then","json","info","authentication","assetUpload","scriptEditing","getJSON","getUserURL","success","getItem","password","_this3","setItem","accessToken","getAccessToken","options","mode","cache","headers","method","Content-Type","TREE_ITEM_PROVIDER","EXPANDED_CHANGED","STRUCTURE_CHANGED","STRUCTURE_ADDED","STRUCTURE_REMOVED","PROPERTY_CHANGED","CLEAR_DIRTY","SAVED","DOCUMENT_SWAPPED","getDocsURL","getAssetsURL","getScriptsURL","TreeItemProvider","genID","prefix","random","save","getSceneRoot","payload_obj","doc","getDocType","id","getDocId","payload_string","docid","body","doctype","catch","hasChildren","item","getChildren","expanded_map","SERVER_URL","init","filter","list","current","isExpanded","def","Error","root","provider","setDocument","warn","makeEmptyRoot","spath","generateSelectionPath","Selection","getSelection","newsel","findNodeFromSelectionPath","setSelection","file","Promise","rej","FormData","append","size","name","xml","XMLHttpRequest","onreadystatechange","readyState","status","response","responseType","setRequestHeader","send","child","parent","sibling","StringEditor","_Component","_getPrototypeOf2","_len","arguments","args","Array","_key","apply","keypressed","charCode","onCommit","inherits","createClass","prop","hasHints","getHints","multiline","onChange","onBlur","onKeyPress","EnumPicker","Rend","renderer","items","values","val","DefaultEnumRenderer","EnumEditor","show","EnumEditor_EnumPicker","calculateValues","calculateRenderer","selectValue","renderValue","proxy","getRendererForEnum","getKey","vals","getValuesForEnum","ArrayEditor","addValue","showEditor","enumChanged","arr","slice","renderValues","renderEditor","Renderer","deleteItem","EnumEditor_EnumEditor","TYPES","STRING","NUMBER","BOOLEAN","ENUM","COLOR","GROUP","PropEditor","changed","isType","isLive","setValue","updateNum","checked","customChanged","colorChanged","commit","hasOwnProperty","min","max","isNaN","parseFloat","numberKeyDown","shiftKey","booleanChanged","arrayChanged","openColorEditor","HSLUVColorPicker_HSLUVColorPicker","getValue","nextProps","nextState","getType","selMan","isCustom","createCustomEditor","isLocked","StringEditor_StringEditor","step","hints","incrementValue","onKeyDown","backgroundColor","ArrayEditor_ArrayEditor","PropSheet","selection","h2","hand","s","off","_this4","calculateGroups","calculateProps","getName","renderIndeterminate","PropSheet_PropEditor","isIndeterminate","getFullSelection","first","prov","getProperties","A","B","pa","find","pb","multi","MultiPropProxy","match","addSubProxy","PropProxy","p","group_keys","getGroupKeys","subs","sub","same","custom","locked","live","setPropertyValue","group","listToArray","prototype","createGraphObjectFromObject","graph","createObject","fetchGraphObject","objid","getPropertiesForObject","getPropertyValue","propToArray","CH","len","getArrayLength","ch","getElementAt","insertAsFirstChild","setProperty","insertAfter","insertAsLastChild","prev","removeFromParent","n","array","findIndex","removeElement","error","ContextMenu","menu","TreeTableItem","addToSelection","onContextMenu","calculateContextMenu","TreeTable_ContextMenu","toggleItemCollapsed","onDragStart","onDragOver","onDragEnd","onDrop","isSelected","getDropTarget","getDropType","arrow","data-nodeid","depth","getRendererForItem","renderDragBars","canBeMoved","draggable","TreeTable","dataTransfer","effectAllowed","setData","parentNode","setDragImage","dropEffect","dragTarget","internalDrag","canAddExternalChild","setDropTarget","setDropType","canAddChild","canBeSibling","getDataGraph","src","dst","parent2","acceptDrop","generateChildren","chs","listener","other_listener","sel","newProps","TreeTable_TreeTableItem","UNITS","PIXEL","matches","short","MILLIMETER","DEFAULT_DPI","Dimension","unit","scale","dpi","px_per_in","MetadocCanvas","selectionChanged","getPageSize","getSelectedPage","as","getRawGraph","page","drawPage","hsnap","vsnap","restore","toCanvas","shape","findShape","mouseDown","pauseQueue","shapeid","shapeobj","initial","start","layer","getSelectedLayer","snap","process","cmd","unpauseQueue","onRawChange","rect","prevProps","drawLayer","drawShape","getShapeDef","draw","isInside","reverse","_this5","border","EDGES","LEFT","RIGHT","CENTER","TOP","MIDDLE","BOTTOM","NONE","snaps","SNAP_THRESHOLD","isNearH","abs","isNearV","getBounds","nearH","nearV","require","SET_PROPERTY","CREATE_PROPERTY","DELETE_PROPERTY","CREATE_OBJECT","DELETE_OBJECT","INSERT_ELEMENT","DELETE_ELEMENT","UndoQueue","op","last","host","getHostId","seq","nextSeq","timestamp","Date","now","entry","entryid","object","prevValue","makeGUID","EventCoalescer","rawlisteners","fireRaw","paused","buffer","bufferOp","settings","publishKey","subscribeKey","PubnubSyncWrapper","handleGraphChange","pubnub","PubNub","addListener","operation","category","sendHistoryRequest","message","m","handleMessage","subscribe","channels","calculateChannelName","calculateLoggerChannelName","sendMessage","unsubscribe","stop","str","uuid","publish","channel","hist","getHistory","count","chunk","evt","handleGetHistory","handleReceiveHistory","_console","publisher","getUUID","toConsumableArray","PubnubLogger","_console2","from","_console3","MissingDocDialog","cancel","DialogManager","okay","createNewDocument","visible","grow","DocGraph","CommandGenerator","SyncGraphProvider","getDocTitle","getDocHistory","getDocGraph","getObjectByProperty","DocGraphToObjectGraph","coalescer","syncdoc","hasPropertyValue","expanded","docLoaded","toggleConnected","unpause","pause","isConnected","performUndo","undoqueue","canUndo","undo","performRedo","canRedo","redo","datalisteners","setupDocFlow","loadDoc","propKey","oldValue","newValue","showMissingDocDialog","makeDocFromServerHistory","shutdown","submit","clearSelection","MissingDocDialog_MissingDocDialog","InputManager","keyDown","m2","bindings","b","keyCode","valid","modifiers","mod","MODIFIERS","COMMAND","metaKey","SHIFT","some","dispatchEvents","binding","bind","KEYS","S","Z","C","V","X","LEFT_ARROW","RIGHT_ARROW","RectDef","rx","ry","fillColor","c0","c1","c2","c3","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","newOrigin","CircleDef","radius","arc","PI","pow","TextDef","text","horizontalAlign","HORIZONTAL_ALIGNMENT","verticalAlign","VERTICAL_ALIGNMENT","BASELINE","autoFit","fontSize","fontFamily","STANDARD_FONTS","SANSSERIF","fontWeight","FONT_WEIGHTS","NORMAL","fontStyle","FONT_STYLES","_this$calculateLines","calculateLines","lines","size_px","total_height","total_width","line","lines_height","xoff","yoff","fillText","font","measureText","reduce","total","_this$calculateLines2","insideRect","_this$calculateLines3","ImageDef","asset","isImageCached","drawImage","getCachedImage","requestImageCache","PROP_DEFS","subtype","format","pageSize","SHAPE_DEFS","circle","image","ICONS","plane","model","cut","copy","paste","delete","SERIF","MONOSPACE","BOLD","ITALIC","OBLIQUE","isShapeType","ObjectDef","position","z","rotation","material","set","parseInt","tx","ty","tz","COUNTER","CubeDef","scene","OBJ_TYPES","cube","rz","sx","sy","sz","createArray","Mesh","BoxGeometry","MeshLambertMaterial","userData","clickable","accessObject","exists","attachAsset","get","geometry","ASSET_TYPES","IMAGE","tex","TextureLoader","load","side","DoubleSide","VIDEO","video","videocache","crossOrigin","VideoTexture","SphereDef","SphereBufferGeometry","PlaneDef","THREE","GLTFLoader","manager","undefined","DefaultLoadingManager","GLTFRegistry","objects","remove","removeAll","constructor","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setResponseType","parse","setCrossOrigin","setPath","content","extensions","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","version","extensionsUsed","KHR_LIGHTS","GLTFLightsExtension","KHR_MATERIALS_COMMON","GLTFMaterialsCommonExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","time","GLTFParser","scenes","cameras","animations","timeEnd","lights","lightId","lightNode","light","Color","fromArray","DirectionalLight","PointLight","SpotLight","AmbientLight","constantAttenuation","intensity","linearAttenuation","quadraticAttenuation","decay","fallOffAngle","angle","fallOffExponent","getMaterialType","MeshPhongMaterial","MeshBasicMaterial","extendParams","materialParams","parser","khrMaterial","pending","materialValues","diffuseFactor","opacity","diffuseTexture","assignTexture","specularFactor","specular","specularTexture","shininessFactor","shininess","all","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","BIN","headerView","DataView","header","magic","getUint32","chunkView","chunkIndex","byteLength","chunkLength","chunkType","contentArray","byteOffset","specularGlossinessParams","ShaderMaterial","params","pbrSpecularGlossiness","shader","ShaderLib","uniforms","UniformsUtils","clone","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","fragmentShader","replace","roughness","metalness","roughnessMap","metalnessMap","setHex","glossiness","specularMap","glossinessMap","vertexShader","defines","STANDARD","isArray","emissive","glossinessFactor","specularGlossinessTexture","specGlossIndex","createMaterial","fog","isGLTFSpecularGlossinessMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","derivatives","cloneMaterial","source","il","refreshUniforms","camera","uvScaleMap","offset","repeat","diffuse","multiplyScalar","isWebGLRenderTarget","texture","matrix","matrixAutoUpdate","setUvTransform","uvTransform","offsetRepeat","flipEnvMap","isCubeTexture","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","WEBGL_CONSTANTS","WEBGL_COMPONENT_TYPES","Number","Matrix3","Matrix4","Vector2","Vector3","Vector4","Texture","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipMapNearestFilter","9985","LinearMipMapNearestFilter","9986","NearestMipMapLinearFilter","9987","LinearMipMapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TEXTURE_FORMATS","6406","AlphaFormat","6407","RGBFormat","6408","RGBAFormat","6409","LuminanceFormat","6410","LuminanceAlphaFormat","WEBGL_TEXTURE_DATATYPES","UnsignedByteType","32819","UnsignedShort4444Type","32820","UnsignedShort5551Type","33635","UnsignedShort565Type","WEBGL_TYPE_SIZES","BackSide","FrontSide","NeverDepth","LessDepth","EqualDepth","LessEqualDepth","GreaterEqualDepth","NotEqualDepth","AlwaysDepth","AddEquation","SubtractEquation","ReverseSubtractEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateSmooth","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addMorphTargets","mesh","meshDef","primitiveDef","accessors","targets","morphAttributes","normal","morphTargets","positionAttribute","normalAttribute","attributeName","POSITION","attributes","jl","setXYZ","getX","getY","getZ","morphNormals","updateMorphTargets","morphTargetInfluences","isPrimitiveEqual","indices","attribA","attribB","keysA","keysB","getCachedGeometry","newPrimitive","cached","primitive","primitiveCache","textureLoader","fileLoader","markDefs","getMultiDependencies","dependencies","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","getDependency","cacheKey","dependency","charAt","toUpperCase","getDependencies","defs","types","results","pendings","loadBuffer","bufferIndex","bufferDef","buffers","uri","resolve","reject","loadBufferView","bufferViewIndex","bufferViewDef","bufferViews","loadAccessor","accessorIndex","accessorDef","pendingBufferViews","bufferView","sparse","bufferAttribute","itemSize","TypedArray","componentType","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","normalized","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setArray","setX","setY","setZ","setW","loadTexture","textureIndex","URL","webkitURL","textureDef","textures","images","sourceURI","isObjectURL","blob","Blob","mimeType","createObjectURL","Loader","Handlers","revokeObjectURL","flipY","internalFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","textureName","loadMaterial","materialIndex","materialType","materialDef","materials","materialExtensions","khcExtension","sgExtension","pbrMetallicRoughness","MeshStandardMaterial","metallicRoughness","baseColorFactor","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","extras","loadGeometries","primitives","geometries","BufferGeometry","attributeId","addAttribute","setIndex","loadMesh","meshIndex","Group","depthTest","uv2","uv","useVertexColors","useFlatShading","useSkinning","useMorphTargets","vertexColors","VertexColors","needsUpdate","flatShading","SkinnedMesh","skinning","drawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","Line","LineLoop","Points","onBeforeRender","loadCamera","cameraIndex","cameraDef","aspectRatio","xfov","yfov","PerspectiveCamera","radToDeg","znear","zfar","OrthographicCamera","xmag","ymag","loadSkin","skinDef","skinEntry","inverseBindMatrices","accessor","loadAnimation","animationIndex","animationDef","tracks","input","parameters","output","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","outputAccessorValues","getW","targetNames","traverse","isMesh","AnimationUtils","arraySlice","AnimationClip","loadNode","Bone","isGroup","Object3D","PropertyBinding","sanitizeNodeName","applyMatrix","quaternion","loadScene","buildNodeHierachy","nodeId","parentObject","allNodes","bones","boneInverses","jointId","jointNode","mat","Skeleton","matrixWorld","sceneIndex","sceneDef","Scene","nodeIds","ModelDef","clicker","gltf","computeBoundingSphere","bs","boundingSphere","customize","onBeforeCompile","imageOffsetAngle","imageCropStartAngle","imageCropEndAngle","matShader","BG360Def","bg360","cssStyle","div","innerHTML","classList","setAttribute","divLayer","WebLayer3D","pixelRatio","devicePixelRatio","onLayerCreate","graphid","refresh","previewUpdate","update","regenerateText","Image2DDef","img2d","ratio","GroupDef","GPUParticleShader","UPDATEABLE_ATTRIBUTES","GPUParticles","blending","NormalBlending","PARTICLE_COUNT","maxParticles","PARTICLE_CURSOR","DPR","particleUpdate","onTick","reverseTime","fadeIn","fadeOut","rand","sprite","particleSpriteTex","ctx","CanvasTexture","depthWrite","uTime","uScale","tSprite","defaultAttributeValues","particlePositionsStartTime","particleVelColSizeLife","setDynamic","particleSystem","frustumCulled","attr","getAttribute","updateRange","ttime","geometryUpdate","dispose","old","velocity","acceleration","endColor","positionStartAttribute","startTimeAttribute","velocityAttribute","accelerationAttribute","colorAttribute","endcolorAttribute","sizeAttribute","lifeTimeAttribute","lifetime","sizeRandomness","r","ParticlesDef","particles","pointSize","startColor","positionRandomness","baseVelocity","velocityRandomness","baseColor","colorRandomness","AdditiveBlending","system","spawnParticle","tick","attachTexture","updateSprite","ImageAnchorDef","imageanchor","reactivate","targetImage","imageRealworldWidth","recType","REC_TYPES","SCENE_START","preview","PlaneBufferGeometry","updateImagePreview","enter","getObjectById","callback","fireEvent","startImageRecognizer","exit","stopImageRecognizer","GeoAnchorDef","geoanchor","targetGeoLocation","startGeoRecognizer","stopGeoRecognizer","HudAnchorDef","_ObjectDef","hudanchor","logger","getCamera","getThreeObjectById","stdhints","description","defaultFloor","padding","borderWidth","borderRadius","textColor","borderColor","drawBackground","scriptBody","defaultScene","latitude","longitude","altitude","useAltitude","autoRecenter","SIMPLE_COLORS","sphere","TOTAL_OBJ_TYPES","SCENE","ASSET","BEHAVIOR","BEHAVIOR_SCRIPT","ASSETS_LIST","BEHAVIORS_LIST","ROOT","is3DObjectType","canHaveShape","canBeDeleted","get3DObjectDef","MIME_TYPES","PNG","JPEG","MP3","AAC","JAVASCRIPT","GLB","MP4","GLTF","AUDIO","GEOLOCATION","isImageType","toLowerCase","ITEM_ICONS","assets","behavior","behavior_script","audio","geolocation","parseBehaviorScript","contents","Function","GLTFAssetView","renderThree","render","initThreeJS","sceneContainer","background","innerHeight","antialias","setPixelRatio","setSize","gammaOutput","vr","enabled","appendChild","domElement","vrmanager","VRManager","aspect","updateProjectionMatrix","setAnimationLoop","normalize","GeoAssetView","context","loadCurrentLocation","navigator","getCurrentPosition","coords","quick_setPropertyValue","onMapClick","latlng","lat","lng","updateLocation","ll","latLng","lon","marker","setLatLng","mymap","panTo","d","setView","tileLayer","maxZoom","attribution","addTo","customIcon","divIcon","AssetView","renderAsset","alt","controls","GLTFAssetView_GLTFAssetView","GeoAssetView_GeoAssetView","addImageAssetFromExpandedURL","getAssetsObject","insertChildLast","img","addImageAssetFromFile","ToasterManager","uploadFile","ans","addGLBAssetFromFile","addAudioAssetFromURL","fileType","lastIndexOf","AddImageAssetDialog","view","fileInput","files","switchLocal","switchRemote","selectedFile","typedURL","React","createRef","GridEditorApp_ToggleButton","renderSelectedPanel","PageCanvasView","handleKeypress","onNext","onPrev","tabIndex","PresentationApp","docSwapped","pageIndex","pages","getPages","PageCanvasView_PageCanvasView","GraphAccessor","hasObject","o","insertFirstChild","id2","createProperty","EnumTitleRenderer","STANDARD_PAGE_SIZES","PageSizeRenderer","MetadocEditor","getApp","PresentationApp_PresentationApp","assertThisInitialized","Editor1_MetadocApp","getTitle","addShape","make","addRect","addCircle","addText","addImage","addImageAssetFromURL","deleteSelection","getSelectedShape","deleteSelectedAsset","cutSelection","setClipboard","copySelection","pasteSelection","obj1","getClipboard","obj2","cloneShape","exportSVG","svg","renderSVGWrapper","renderSVGChildren","link","href","encodeURIComponent","download","click","exportPNG","toDataURL","newView","openPresentationView","showAddImageAssetDialog","AddImageAssetDialog_AddImageAssetDialog","imagecache","rect1","out","copyPropDef","margin","rootobj","parts","trim","parseDimension","toSVGString","tgt","t","complete","Image","onload","MetadocApp","_this6","canvasSelected","showAddPopup","acts","addPage","addLayer","GridEditorApp_MenuPopup","getSelectedRoot","zoomIn","zoom","zoomOut","im","addKeyBinding","_this7","attachKeyEvents","GridEditorApp_GridEditorApp","GridEditorApp_Panel","TreeTable_TreeTable","renderCenterPane","PropSheet_PropSheet","MetadocCanvas_MetadocCanvas","AssetView_AssetView","TransformControls","_gizmo","TransformControlsGizmo","_plane","TransformControlsPlane","defineProperty","changeEvent","mouseDownEvent","mouseUpEvent","objectChangeEvent","ray","Raycaster","_tempVector","_tempVector2","_tempQuaternion","Quaternion","_unit","Y","_identityQuaternion","_alignVector","pointStart","pointEnd","rotationAxis","rotationAngle","cameraPosition","cameraQuaternion","cameraScale","parentPosition","parentQuaternion","parentScale","worldPositionStart","worldQuaternionStart","worldScaleStart","worldPosition","worldQuaternion","worldScale","eye","_positionStart","_quaternionStart","_scaleStart","propName","defaultValue","propValue","dispatchEvent","getPointer","event","pointer","changedTouches","button","onContext","onPointerHover","pointerHover","onPointerDown","onPointerMove","pointerDown","pointerMove","onPointerUp","pointerUp","attach","detach","axis","updateMatrixWorld","decompose","dragging","setFromCamera","intersect","intersectObjects","picker","planeIntersect","space","rotationSnap","round","point","applyQuaternion","inverse","translationSnap","setFromMatrixPosition","dot","ROTATION_SPEED","distanceTo","cross","angleTo","setFromAxisAngle","getMode","setMode","setTranslationSnap","setRotationSnap","setSpace","create","isTransformControls","gizmoMaterial","gizmoLineMaterial","LineBasicMaterial","linewidth","matInvisible","matHelper","matRed","matGreen","matBlue","matWhiteTransperent","matYellowTransparent","matCyanTransparent","matMagentaTransparent","matLineRed","matLineGreen","matLineBlue","matLineCyan","matLineMagenta","matLineYellow","matLineGray","matLineYellowTransparent","arrowGeometry","CylinderBufferGeometry","scaleHandleGeometry","BoxBufferGeometry","lineGeometry","Float32BufferAttribute","CircleGeometry","vertices","cos","sin","gizmoTranslate","XYZ","OctahedronBufferGeometry","XY","YZ","XZ","pickerTranslate","helperTranslate","START","END","DELTA","gizmoRotate","E","XYZE","helperRotate","AXIS","pickerRotate","TorusBufferGeometry","gizmoScale","XYZX","XYZY","XYZZ","pickerScale","helperScale","setupGizmo","gizmoMap","gizmo","tag","tempGeometry","tempVector","tempEuler","Euler","alignVector","zeroVector","lookAtMatrix","tempQuaternion","tempQuaternion2","identityQuaternion","unitX","unitY","unitZ","helper","handles","handle","eyeDistance","setFromRotationMatrix","lookAt","atan2","multiplyQuaternions","showX","showY","showZ","_opacity","_color","lerp","setFromEuler","isTransformControlsGizmo","wireframe","dirVector","tempMatrix","isTransformControlsPlane","SceneDef","setDefaultFloor","sceneAnchor","chNode","chObj","ToasterNotification","notification","SceneGraphProvider","beh","ScriptManager","sceneGraphProvider","sgp","running","storage","globals","getCurrentScene","getScene","getObject","getGraphObjectByName","getThreeObject","getAsset","AssetFacade","getGraphObjectById","navigateScene","fireSceneLifecycleEvent","playSound","playMediaAsset","setKeyValue","getKeyValue","hasKeyValue","isAR","graphTarget","fireMessageAtTarget","getTweenManager","fireEventFromTarget","makeSystemFacade","behaviors","getBehaviorsForObject","getParsedBehaviorAsset","stopRunning","getAllScenes","startTime","session","frame","err","fireLifecycleEvent","destroyListeners","onMessage","stopMediaAsset","Tween","WaitTween","dur","duration","ActionTween","fn","ForeverTween","diff","PROP_TYPES","SINGLE","COMPOUND","LERP_TYPES","ELASTIC","easeLinear","to","PropTween","property","propertyType","lerp_type","lerpType","loop","loopCount","reversed","autoReverse","easeOutElastic","ClipTween","speed","mixer","action","clipAction","findByName","setLoop","Infinity","play","setEffectiveTimeScale","prevTime","ParallelTween","isAlive","SequentialTween","_this8","_startNext","cur","TweenManager","Cesium","XRGeospatialAnchor","XRSupport","imageDetectorMap","_workingMatrix","mat4","_identity","_vec","vec3","device","xrCanvas","xrContext","_anchoredNodes","Map","that","xr","requestDevice","xrDevice","requestSession","outputContext","alignEUS","worldSensing","xrSession","useEstimatedElevation","nonStandard_setNumberOfTrackedImages","compatibleXRDevice","baseLayer","XRWebGLLayer","userAnimationCallback","requestFrameOfReference","frameOfReference","headFrameOfReference","eyeLevelFrameOfReference","__handleAnimationFrame","_handleAnimationFrame","requestAnimationFrame","ended","pose","getDevicePose","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","views","Symbol","iterator","next","done","getViewport","projectionMatrix","getViewMatrix","return","anchor","uid","modelMatrix","_handleAnchorUpdateCallback","_handleAnchorUpdate","_handleAnchorDeleteCallback","_handleAnchorDelete","_createSceneAnchor","asyncToGenerator","regenerator_default","mark","_callee","sceneNode","eyeLevel","newAnchor","wrap","_context","abrupt","sent","getTransformTo","addAnchor","addAnchoredNode","_x","_x2","_removeAnchorFromNode","removeAnchor","det","realWorldWidth","_fetchImage","idata","getImageData","documentURI","nonStandard_createDetectionImage","anchorName","nonStandard_activateDetectionImage","anchorStyle","nonStandard_deactivateDetectionImage","lla","Cartographic","createGeoAnchor","getDefaultElevation","getDeviceCartographic","cartographic","_removeAnchorForNode","details","anchoredNode","_mozillaXRViewer","OrbitControls","quat","quatInverse","lastPosition","lastQuaternion","minDistance","maxDistance","minZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","UP","mouseButtons","ORBIT","MOUSE","ZOOM","PAN","target0","position0","zoom0","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","reset","STATE","setFromUnitVectors","up","setFromVector3","rotateLeft","sphericalDelta","makeSafe","panOffset","setFromSpherical","zoomChanged","distanceToSquared","EPS","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","startEvent","endEvent","ROTATE","DOLLY","TOUCH_ROTATE","TOUCH_DOLLY","TOUCH_PAN","Spherical","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","rotateUp","panLeft","objectMatrix","setFromMatrixColumn","panUp","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","isOrthographicCamera","clientWidth","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","handleMouseDownDolly","handleMouseDownPan","subVectors","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","handleMouseWheel","handleKeyDown","touches","pageX","pageY","handleTouchStartRotate","handleTouchStartDolly","handleTouchStartPan","handleTouchMoveRotate","handleTouchMoveDolly","handleTouchMovePan","EventDispatcher","defineProperties","noZoom","noRotate","noPan","noKeys","staticMoving","dynamicDampingFactor","Adapter","getCachedBehaviorAsset","getSelectedSceneObject","findNode","sound","audioListener","setBuffer","setVolume","playing_audio","tweenManager","MOVE_SPEED","VRCanvas","moveCameraForward","moveCameraBackward","handleKeyPress","recenterOnSelection","orbitControls","transformChanged","transformDraggingChanged","sc","obj_node_map","rebuildNode","transformControls","setCurrentSceneWrapper","findSceneObjectParent","windowResized","cw","clickedCanvas","raycaster","getCurrentSceneWrapper","scriptManager","performClickAction","previewUpdateNodes","getLogger","inset","makeNode","insertNodeMapping","addSceneWrapper","supportsARKit","setupRenderer","animationLoopWithCamera","animationLoop","updateScene","checkAspectRatio","viewMatrix","matrixWorldNeedsUpdate","removeNodeMapping","updateProperty","populateNode","nextContext","resetSceneGraph","stopRecognizers","startRecognizers","startRunning","ToasterNotification_ToasterNotification","nodeid","obj3d","dump","_this9","graphObj","threeObj","toRad","degrees","TranslationArrow","control","startHover","endHover","beginDrag","startPoint","intersection","worldToLocal","oldFilter","intersectionFilter","startPosition","POINTER_MOVE","updateDrag","POINTER_RELEASE","endDrag","endPoint","finalPoint","end","makePlane","makeArrow","makeInputGrabber","POINTER_ENTER","POINTER_EXIT","POINTER_PRESS","TranslateControl","_THREE$Group","Panel2D","canvasTexture","redrawHandler","inside","fpt","contains","comp","findAt","POINTER_CLICK","startDrag","dragSphere","moveDrag","Component2D","Button2D","fsize","normalBg","hoverBg","bg","metrics","Group2D","layout","translate","childProps","deg","YAXIS","ThreeDOFController","stagePos","stageRot","states","touchpad","keystates","ArrowLeft","previous","ArrowRight","ArrowUp","ArrowDown","dir","rotateRight","moveForward","moveBackward","applyAxisAngle","_fire","scanGamepads","updateKeys","gamepads","getGamepads","gamepad","startsWith","buttons","axes","down","addScene","deleteObject","isEmpty","newDoc","switcher","editor","currentScene","swapScene","Audio","AudioLoader","ImmersiveVREditor","standardViewClickHandler","isRunning","disabled","wrapper","sceneWrappers","initScene","render3","stats","controller","$","querySelector","container","WebGLRenderer","AudioListener","initContent","VR_DETECTED","removeAttribute","innerText","enterVR","updateSceneOp","documentSwapped","selectedNode","VRStats","editable","Pointer","cameraFollowMouse","mouseSimulatesController","enableLaser","laserLength","stick","controller1","tools","panel2d","button2d","setAll","add3DObject","runButton","color_group","group2d","panel","setColor","defaults","nodeObj","AddGLTFAssetDialog","fileinput","multiple","webkitdirectory","AddGLBAssetDialog","AddAudioAssetDialog","addAudioAssetFromFile","UnsavedDocumentDialog","onAnyway","OpenFileDialog","refreshList","loadDocList","docs","docList","dismiss","removeDoc","maxHeight","generateDocUrl","renderDeleteButton","supportsDocDelete","deleteDoc","OpenAssetDialog","loadAssetList","assetList","isVideoType","addVideoAssetFromURL","isGLTFType","removeAssetSource","addAsset","supportsAssetUpload","deleteAsset","ScriptEditor","swap","changeText","updateBehaviorAssetContents","fetchBehaviorAssetContents","lib_default","theme","showGutter","OpenScriptDialog","loadScriptList","scripts","addBehaviorAssetFromURL","removeBehaviorAssetSource","addScript","supportsScriptEdit","deleteScript","CUSTOM_BEHAVIOR_SCRIPT","CUSTOM_SCENE_SCRIPT","QRCanvas","QRCode","QRDialog","wurl","QRCanvas_QRCanvas","PasswordDialog","doPasswordLogin","field","GithubAuthDialog","ErrorCatcher","errorInfo","VREditor","VREditor_VREditorApp","ImmersiveVREditor_ImmersiveVREditor","getBehaviorsObject","setCachedBehaviorAsset","editIn2D","protocol","pathname","QRDialog_QRDialog","editInVR","viewInVR","nodeName","showAddAudioAssetDialog","AddAudioAssetDialog_AddAudioAssetDialog","showAddGLTFAssetDialog","AddGLTFAssetDialog_AddGLTFAssetDialog","showAddGLBAssetDialog","AddGLBAssetDialog_AddGLBAssetDialog","showOpenDocumentDialog","OpenFileDialog_OpenFileDialog","showOpenAssetDialog","OpenAssetDialog_OpenAssetDialog","showAddServerImageDialog","showOpenBehaviorDialog","OpenScriptDialog_OpenScriptDialog","showAddGeoLocationAssetDialog","showPasswordDialog","PasswordDialog_PasswordDialog","showGithubDialog","GithubAuthDialog_GithubAuthDialog","addCustomBehaviorAsset","TEMPLATE","randi","fname","script","addSceneScript","addBehaviorToObject","properties","behaviorCache","scene1","behaviorProps","getCachedBehaviorPropDefs","pname","propdef","ndef","realobj","nodeType","acceptsImageAsset","acceptsVideoAsset","getFirstSceneObject","ov","cmds","canHaveBehavior","isGLTFFile","VREditor_ScaleEditor","VREditorApp","toggleRunning","dirty","UnsavedDocumentDialog_UnsavedDocumentDialog","user","getUsername","bot","ErrorCatcher_ErrorCatcher","showAddAssetPopup","showAddBehaviorPopup","VREditor_RunButton","active","renderLoginButton","ScriptEditor_ScriptEditor","VRCanvas_VRCanvas","supportsAuth","supportsPassword","supportsDocList","ScaleEditor","syncChanged","sync","newvals","_this10","RunButton","attachUtilFunctions","ImmersivePlayer","three_map","current_scene","inter","gobj","obj_map","renderThreeWithCamera","title_map","behavior_map","behavior_assets","pendingAssets","startScene","buildRoot","setCurrentScene","initAssets","initObject","initBehaviors","chnode","prom","player","_this11","_this12","sceneid","_this13","removeSceneAnchor","createSceneAnchor","updateAnchoredSceneNode","_this14","_this15","createDetectionImage","addGeoAnchoredNode","App","showProviderList","providers","openNewProvider","sw","ImmersivePlayer_ImmersivePlayer","zIndex","flex","ReactDOM","App_App","getElementById"],"mappings":"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","file":"static/js/main.200a4a3a.chunk.js","sourcesContent":["/**\n * Created by josh on 11/29/16.\n */\nmodule.exports = {\n    adds: [],\n    add: function add(note) {\n        this.adds.forEach(cb => cb(note))\n    },\n    onAdd: function onAdd(cb) {\n        this.adds.push(cb);\n    },\n}\n","export function parseOptions(opts) {\n    let loc = document.location\n    if (loc.search) {\n        const parts = loc.search.substring(1).split('&')\n        parts.forEach((part)=>{\n            const keyval = part.split('=')\n            opts[keyval[0]] = keyval[1]\n        })\n    }\n    // console.log(opts)\n    // if(typeof opts.switcher === 'string') {\n    //     console.log(\"parsing switcher\")\n    // }\n    return opts;\n}\n\n\nexport const on = (elem,type,cb) => elem.addEventListener(type,cb)\n\nexport function genID(prefix) {\n    return `${prefix}_${Math.floor(Math.random() * 10000)}`\n}\n\nexport function toFlatString(obj) {\n    return JSON.stringify(obj)\n}\n\n/*\nexport function GET_JSON(path, cb) {\n    return new Promise((res,rej) => {\n        console.log(\"fetching\",path);\n        const req = new XMLHttpRequest()\n        req.onreadystatechange = function() {\n            // console.log(\"got\",req.readyState, req.status)\n            if(req.readyState === 4) {\n                if(req.status === 200) return res(JSON.parse(req.responseText));\n                //if anything other than 200, reject it\n                rej(req)\n            }\n            if(req.status === 500) rej(req);\n            if(req.status === 404) rej(req);\n        };\n        req.open(\"GET\",path,true);\n        req.send();\n    });\n}\n\n\nexport function POST_JSON(path, payload) {\n    // console.log(\"POSTING\",path,payload);\n    return new Promise((res,rej)=>{\n        const req = new XMLHttpRequest();\n        req.onreadystatechange = function() {\n            if(req.readyState === 4 && req.status === 200) {\n                try {\n                    res(JSON.parse(req.responseText));\n                } catch(e) {\n                    rej(e);\n                }\n            }\n            if(req.status === 500) rej(req);\n            if(req.status === 404) rej(req);\n        };\n        req.onerror = (e) => rej(e);\n        req.open(\"POST\",path,true);\n        req.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n        if(typeof payload === 'string') {\n            req.send(payload)\n        } else {\n            req.send(JSON.stringify(payload));\n        }\n    })\n}\n */\n\n\nexport function makePoint(x,y) {\n    return {\n        x:x,\n        y:y,\n        minus: function(pt) {\n            return makePoint(this.x-pt.x, this.y-pt.y);\n        },\n        add: function(pt) {\n            return makePoint(this.x+pt.x, this.y+pt.y);\n        },\n        divide: function(v) {\n            return makePoint(this.x/v,this.y/v)\n        },\n        multiply: function(v) {\n            return makePoint(this.x*v,this.y*v)\n        },\n        idivide: function(v) {\n            return makePoint(\n                Math.floor(this.x/v),\n                Math.floor(this.y/v)\n            )\n        },\n        floor: function() {\n            return makePoint(\n                Math.floor(this.x),\n                Math.floor(this.y)\n            )\n        },\n        distance(pt) {\n            const dx = pt.x-this.x;\n            const dy = pt.y-this.y;\n            return Math.sqrt(dx*dx+dy*dy)\n        },\n        equals(pt) {\n            return pt.x === this.x && pt.y === this.y\n        },\n        toString() {\n            return `(${x},${y})`\n        }\n    }\n}\n\n//use only capital letters, 65->90\nexport function genAlphaID(count) {\n    let id = \"\"\n    for(let i=0; i<count; i++) {\n        id += String.fromCharCode(65 + Math.floor(Math.random() * (90 - 65)))\n    }\n    return id\n}\n\nexport function setQuery(obj) {\n    const oldOpts = parseOptions({})\n    const final = {}\n    Object.keys(oldOpts).forEach(key=> final[key] = oldOpts[key])\n    Object.keys(obj).forEach(key=> final[key] = obj[key])\n    const query = Object.keys(final).map((key)=>`${key}=${final[key]}`).join('&')\n    window.history.pushState(obj,'a title','?'+query)\n}\nexport function toQueryString(obj) {\n    return Object.keys(obj).map((key)=>`${key}=${obj[key]}`).join('&')\n}\n\n\nexport function shallowCopy(obj) {\n    const out = {};\n    Object.keys(obj).forEach((key) => out[key] = obj[key])\n    return out;\n}\n","import React, {Component} from 'react'\nimport {PopupManager, VBox} from 'appy-comps'\nimport {makePoint} from '../utils'\n\nconst GridLayout = (props) => {\n    let clss = \"grid fill\";\n    let leftWidth = props.leftWidth\n    let rightWidth = props.rightWidth\n    if (!props.showLeft) {\n        clss += ' hide-left'\n        leftWidth = 0\n    }\n    if (!props.showRight) {\n        clss += ' hide-right'\n        rightWidth = 0\n    }\n    const cols = `\n    [left] ${leftWidth}px\n    [left-resize] 2px\n    [center] auto\n    [right-resize] 2px\n    [right] ${rightWidth}px\n    `\n    const style = {gridTemplateColumns:cols}\n    return <div className={clss} style={style}>{props.children}</div>\n};\n\nexport const Toolbar = (props) => {\n    let cls = \"toolbar\";\n    if (props.left) cls += \" left\";\n    if (props.right) cls += \" right\";\n    if (props.bottom) cls += \" bottom\";\n    if (props.top) cls += \" top\";\n    if (props.center) cls += \" center\";\n    if (props.middle) cls += \" middle\";\n    if (props.scroll) cls += \" scroll\";\n    return <div className={cls}>{props.children}</div>\n};\nexport const Panel = (props) => {\n    let cls = 'panel';\n    if (props.left) cls += \" left\";\n    if (props.right) cls += \" right\";\n    if (props.bottom) cls += \" bottom\";\n    if (props.top) cls += \" top\";\n    if (props.center) cls += \" center\";\n    if (props.middle) cls += \" middle\";\n    if (props.scroll) cls += \" scroll\";\n    if(props.transparent) cls += \" transparent\"\n    return <div className={cls}>{props.children}</div>\n};\nexport const Spacer = (props) => {\n    return <span className='spacer'/>\n};\n\nexport const ToggleButton = (props) => {\n    const {selected, ...rest} = props\n    const clss = selected?\"selected\":\"\"\n    return <button className={clss} {...rest}></button>\n}\n\nexport const MenuPopup = (props) => {\n    return <VBox className={\"popup-menu\"}>\n        {props.actions.map((act,i)=>{\n            if(act.divider) return <div className=\"divider\" key={i}></div>\n            return <button  key={i} onClick={()=>{\n                PopupManager.hide();\n                if(act.fun) act.fun()\n            }}><i className={'fa fa-' + act.icon}/> {act.title}</button>\n        })}\n    </VBox>\n\n}\n\nexport default class GridEditorApp extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            showLeft: true,\n            showRight: true,\n            leftWidth:250,\n            rightWidth:250,\n            dragSide:'none'\n        }\n    }\n    toggleLeftPane = (e) => this.setState({showLeft: !this.state.showLeft})\n    toggleRightPane = (e) => this.setState({showRight: !this.state.showRight})\n    onMouseDownLeft = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.setState({dragSide:'left'})\n        window.addEventListener('mousemove',this.onMouseMove)\n        window.addEventListener('mouseup',this.onMouseUp)\n    }\n    onMouseDownRight = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.setState({dragSide:'right'})\n        window.addEventListener('mousemove',this.onMouseMove)\n        window.addEventListener('mouseup',this.onMouseUp)\n    }\n    onMouseMove = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        const cursor = makePoint(e.clientX, e.clientY)\n        if(this.state.dragSide === 'left')  this.setState({leftWidth:cursor.x})\n        if(this.state.dragSide === 'right') this.setState({rightWidth:window.innerWidth-cursor.x})\n    }\n    onMouseUp = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        window.removeEventListener('mousemove', this.onMouseMove)\n        window.removeEventListener('mouseup', this.onMouseUp)\n    }\n    render() {\n        return <GridLayout showLeft={this.state.showLeft}\n                           showRight={this.state.showRight}\n                           leftWidth={this.state.leftWidth}\n                           rightWidth={this.state.rightWidth}\n        >\n            <Toolbar center bottom>\n                <button className={'fa' + (this.state.showLeft ? ' fa-caret-left' : ' fa-caret-right')}\n                        onClick={this.toggleLeftPane}/>\n                <Spacer/>\n                {this.props.bottomText}\n                <Spacer/>\n                <button className={'fa' + (this.state.showRight ? ' fa-caret-right' : ' fa-caret-left')}\n                        onClick={this.toggleRightPane}/>\n            </Toolbar>\n\n            <div className={'left-resize'}  onMouseDown={this.onMouseDownLeft}/>\n            <div className={'right-resize'} onMouseDown={this.onMouseDownRight}/>\n\n            {this.props.children}\n        </GridLayout>\n    }\n}\n","\n\nexport const SELECTION_MANAGER = {\n    CHANGED:'CHANGED',\n    DROP_TARGET_CHANGED:'DROP_TARGET'\n}\n\nclass SelectionManager {\n    constructor(props) {\n        this.listeners = {};\n        this.selected = [];\n        this.dropTarget = null;\n        this.clip = null\n    }\n    on(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].push(cb);\n    }\n    off(type,cb) {\n        const index = this.listeners[type].indexOf(cb)\n        if(index>=0) this.listeners[type].splice(index,1)\n    }\n    fire(type, value) {\n        if(!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].forEach((cb) => cb(value));\n    }\n    setSelection(node) {\n        this.selected = [node]\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    addToSelection(node) {\n        this.selected.push(node)\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    clearSelection() {\n        this.selected = []\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    isSelected(node) {\n        return (this.selected.indexOf(node) >= 0)\n    }\n    getSelection() {\n        if(this.selected.length === 0) return null;\n        return this.selected[0];\n    }\n    isEmpty() {\n        return this.selected.length === 0\n    }\n    getFullSelection() {\n        return this.selected\n    }\n    setDropTarget(node) {\n        if(this.dropTarget !== node) {\n            this.dropTarget = node;\n            this.fire(SELECTION_MANAGER.DROP_TARGET_CHANGED, this.dropTarget)\n        }\n    }\n    getDropTarget() {\n        return this.dropTarget\n    }\n    setDropType(type) {\n        this.dropType = type\n    }\n    getDropType() {\n        return this.dropType\n    }\n\n    setClipboard(clip) {\n        this.clip = clip\n    }\n    getClipboard() {\n        return this.clip\n    }\n}\n\nexport default new SelectionManager();\n","import React, { Component } from 'react'\nimport {makePoint} from \"../utils\"\nimport hsluv from 'hsluv'\nimport {PopupManager} from \"appy-comps\"\n\nexport default class HSLUVColorPicker extends Component {\n    constructor(props) {\n        super(props)\n\n        const comps = hsluv.hexToHsluv(props.value)\n        this.state = {\n            hue:comps[0],\n            lightness:comps[1],\n            value:comps[2],\n        }\n        console.log(\"the current value is\",props.value, hsluv.hexToHsluv(props.value))\n    }\n    componentDidMount() {\n        this.redraw();\n    }\n    canvasToPoint(e) {\n        const canvasBounds = this.canvas.getBoundingClientRect()\n        const pt = makePoint(e.clientX, e.clientY).minus(makePoint(canvasBounds.x,canvasBounds.y))\n        const h = this.canvas.height;\n        const w = this.canvas.width;\n        const f = makePoint(pt.x/w*100, pt.y/h*100)\n        return f;\n    }\n    mousePress = (e) => {\n        const pt = this.canvasToPoint(e)\n        this.setState({lightness:pt.x, value:pt.y})\n        this.redraw()\n        this.pressed = true;\n    }\n    mouseMove = (e) => {\n        if(!this.pressed) return\n        const pt = this.canvasToPoint(e)\n        this.setState({lightness:pt.x, value:pt.y})\n        this.redraw()\n    }\n    mouseUp = (e) => {\n        this.pressed = false\n        this.redraw()\n    }\n    redraw = () => {\n        this.drawPicker()\n        this.drawSlider()\n        this.drawIndicator()\n    }\n    drawPicker() {\n        const canvas = this.canvas\n        if(!canvas) return\n        const c = this.canvas.getContext('2d')\n        let w = 100\n        let h = 100\n        const hue = Math.floor(this.state.hue)\n        for(let i=0; i<=4; i++) {\n            for(let j=0; j<=4; j++) {\n                let color = hsluv.hsluvToHex([hue,i*25,j*25])\n                if(color.length > 7) color = '#000000'\n                c.fillStyle = color\n                c.fillRect(i*20,j*20,20,20)\n            }\n        }\n        const g = 20\n        const cp = this.livalToCanvas(this.state.lightness, this.state.value)\n        c.strokeStyle = 'white'\n        c.strokeRect(Math.floor(cp.x/g)*g, Math.floor(cp.y/g)*g,g,g)\n        c.strokeStyle = 'black'\n        c.strokeRect(Math.floor(cp.x/g)*g+1, Math.floor(cp.y/g)*g+1,g-2,g-2)\n\n        c.strokeStyle = 'black';\n        c.lineWidth = 1.0\n        c.strokeRect(0,0,w,h)\n    }\n\n    livalToCanvas = (l,v) => {\n        return makePoint(l/100*100,v/100*100)\n    }\n\n    mouseToCanvas = (e) => {\n        const bounds = e.target.getBoundingClientRect()\n        return makePoint(e.clientX, e.clientY).minus(makePoint(bounds.x,bounds.y))\n    }\n\n    canvasToHue(pt) {\n        return Math.floor(pt.x/this.slider.width*360);\n    }\n    hueToCanvas(hue) {\n        return hue/360*this.slider.width\n    }\n    mousePressSlider = (e) => {\n        this.sliderPressed = true\n        const pt = this.mouseToCanvas(e)\n        const hue = this.canvasToHue(pt)\n        this.setState({hue:hue})\n        setTimeout(this.redraw,100)\n    }\n    mouseMoveSlider = (e) => {\n        if(!this.sliderPressed) return\n        const pt = this.mouseToCanvas(e)\n        const hue = this.canvasToHue(pt)\n        this.setState({hue:hue})\n        setTimeout(this.redraw,100)\n    }\n    mouseUpSlider = () => {\n        this.sliderPressed = false\n    }\n    drawSlider() {\n        const g = 10\n        const c = this.slider.getContext('2d')\n        const w = this.slider.width\n        const h = this.slider.height\n        c.fillStyle = 'red';\n        c.fillRect(0,0,w,h)\n        for(let x=0; x<w; x+=g) {\n            let hue = this.canvasToHue(makePoint(x,0))\n            let color = hsluv.hsluvToHex([hue,100,50])\n            if(color.length > 7) color = '#000000'\n            c.fillStyle = color\n            c.fillRect(x,0,g,h)\n        }\n        c.strokeStyle = 'black'\n        c.lineWidth = 1.0\n        const x = Math.floor(this.hueToCanvas(this.state.hue)/g)*g\n        c.strokeRect(x,0,g,h)\n        c.strokeRect(0,0,w,h)\n    }\n\n    drawIndicator() {\n        const c = this.indicator.getContext('2d')\n        const w = this.indicator.width\n        const h = this.indicator.height\n        let color = hsluv.hsluvToHex([Math.floor(this.state.hue),Math.floor(this.state.lightness),Math.floor(this.state.value)])\n        if(color.length > 7) color = '#000000'\n        c.fillStyle = color\n        c.fillRect(0,0,w,h)\n        c.strokeStyle = 'black'\n        c.lineWidth = 1.0\n        c.strokeRect(0,0,w,h)\n    }\n\n    close = () => {\n        let color = hsluv.hsluvToHex([Math.floor(this.state.hue),Math.floor(this.state.lightness),Math.floor(this.state.value)])\n        if(color.length > 7) color = '#000000'\n        this.props.onSelect(color)\n        PopupManager.hide()\n    }\n\n    render() {\n        return <div style={{\n            display:'flex',\n            flexDirection:'column',\n            alignItems:'center'\n        }}>\n            <canvas\n                ref={(can)=>this.canvas = can}\n                width={100} height={100}\n                onMouseDown={this.mousePress}\n                onMouseMove={this.mouseMove}\n                onMouseUp={this.mouseUp}\n            />\n            <canvas\n                ref={(can)=>this.slider = can}\n                width={100} height={30}\n                onMouseDown={this.mousePressSlider}\n                onMouseMove={this.mouseMoveSlider}\n                onMouseUp={this.mouseUpSlider}\n            />\n            <canvas\n                ref={(can)=>this.indicator = can}\n                width={32} height={32}\n                onClick={this.close}\n            />\n        </div>\n    }\n}","import {} from '../TreeItemProvider'\nimport {getInfoURL} from '../TreeItemProvider'\nimport {getUserURL} from '../TreeItemProvider'\nimport * as ToasterMananager from './ToasterManager'\n\nexport const USER_CHANGE = 'USER_CHANGE'\nexport const CONNECTED = \"CONNECTED\"\nclass AuthModuleSingleton {\n    constructor() {\n        this.listeners = {}\n        this.supported = false\n        this.doclistSupported = false\n        this.docDeleteSupported = false\n        this.assetUploadSupported = false\n        this.scriptEditingSupported = false\n        this.passwordSupported = false\n        this.connected = false\n    }\n    on(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n    }\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n    init() {\n        if(this.isLoggedIn()) this.doclistSupported = true\n        fetch(getInfoURL()).then(res => res.json())\n            .then(info => {\n                console.info(\"Server Info:\",info)\n                if(info.authentication === true)      this.supported = true\n                if(info.passwordSupported === true)   this.passwordSupported = true\n                if(info.assetUpload === true)         this.assetUploadSupported = true\n                if(info.scriptEditing === true)       this.scriptEditingSupported = true\n                if(info.docDeleteSupported === true)  this.docDeleteSupported = true\n\n                this.getJSON(getUserURL()).then(res=>{\n                    if(!res.success) {\n                        this.logout()\n                    } else {\n                        this.fire(USER_CHANGE)\n                        this.doclistSupported = true\n                    }\n                }).then(()=>{\n                    this.connected = true\n                    this.fire(CONNECTED)\n                })\n            })\n    }\n    isConnected() {\n        return this.connected\n    }\n\n    isLoggedIn() {\n        if(localStorage.getItem('access-token')) return true\n        return false\n    }\n    supportsPassword() {\n        return this.passwordSupported\n    }\n    supportsAuth() {\n        return this.supported\n    }\n    supportsDocList() {\n        return this.doclistSupported\n    }\n    supportsAssetUpload() {\n        return this.assetUploadSupported\n    }\n    supportsScriptEdit() {\n        return this.scriptEditingSupported\n    }\n    supportsDocDelete() {\n        return this.docDeleteSupported\n    }\n\n    login = (res) => {\n        this.win = window.open(res.url,'_blank')\n        window.addEventListener('message',this.authCallback)\n        if(this.win) this.win.focus()\n    }\n    logout = () => {\n        localStorage.clear()\n        this.doclistSupported = false\n        this.fire(USER_CHANGE)\n    }\n    doPasswordLogin (password) {\n        localStorage.setItem('access-token',password)\n        return this.getJSON(getUserURL()).then(res=>{\n            if(res.success === true) {\n                console.log(\"the logged in response is\", res)\n                this.doclistSupported = true\n                ToasterMananager.add(\"login succeeded\")\n                this.fire(USER_CHANGE)\n            } else {\n                ToasterMananager.add(\"login failed\")\n                this.fire(USER_CHANGE)\n            }\n        })\n\n    }\n    authCallback = (msg) => {\n        this.setUserData(msg.data.payload)\n        this.win.close()\n        window.removeEventListener('message',this.authCallback)\n        this.doclistSupported = true\n        this.fire(USER_CHANGE)\n        ToasterMananager.add(\"login succeeded\")\n    }\n    setUserData(data) {\n        localStorage.setItem('access-token',data.accessToken)\n    }\n    getAccessToken() {\n        return localStorage.getItem('access-token')\n    }\n\n    getUsername() {\n        return this.getAccessToken()\n    }\n\n    fetch(url, options) {\n        options.mode = 'cors'\n        options.cache = 'no-cache'\n        if(!options.headers) options.headers = {}\n        options.headers[\"access-key\"] =  AuthModule.getAccessToken()\n        console.log(\"fetching\",url,'with options',options)\n        return fetch(url,options)\n    }\n    getJSON(url) {\n        return this.fetch(url,{\n            method:'GET',\n            headers: {\n                \"Content-Type\": \"application/json\",\n            }\n        }).then(res => res.json())\n    }\n\n}\n\nexport const AuthModule = new AuthModuleSingleton()\n","import {setQuery} from './utils'\nimport Selection from './SelectionManager'\nimport {AuthModule} from './vr/AuthModule'\n\nexport const TREE_ITEM_PROVIDER = {\n    EXPANDED_CHANGED:'EXPANDED_CHANGED',\n    STRUCTURE_CHANGED:'STRUCTURE_CHANGED',\n    STRUCTURE_ADDED:'STRUCTURE_ADDED',\n    STRUCTURE_REMOVED:'STRUCTURE_REMOVED',\n    PROPERTY_CHANGED:'PROPERTY_CHANGED',\n    CLEAR_DIRTY:'CLEAR_DIRTY',\n    SAVED:'SAVED',\n    DOCUMENT_SWAPPED:'DOCUMENT_SWAPPED',\n}\n\nconst URLS = {\n    BASE:'https://vr.josh.earth/generaled/api/'\n    // BASE:'https://buttered-elk.glitch.me/'\n    // BASE:'http://localhost:1234/'\n}\nexport function getDocsURL() {\n    return URLS.BASE + 'doc/'\n}\nexport function getAssetsURL() {\n    return URLS.BASE + 'asset/'\n}\nexport function getScriptsURL() {\n    return URLS.BASE + 'scripts/'\n}\nexport function getLoginURL() {\n    return URLS.BASE + 'auth/github/login'\n}\nexport function getInfoURL() {\n    return URLS.BASE +'info'\n}\nexport function getUserURL() {\n    return URLS.BASE + 'userinfo'\n}\n\n// export const SERVER_URL = \"http://localhost:30065/doc/\"\n// export const SERVER_URL_ASSETS = \"http://localhost:30065/asset/\"\n// export const SERVER_URL = \"http://localhost:55555/doc/\"\n// export const SERVER_URL = \"https://vr.josh.earth/generaled/api/doc/\"\n// export const BASE_URL = \"http://localhost:55555/\"\n// export const BASE_URL = \"https://vr.josh.earth:55555/\"\n// export const SERVER_URL_ASSETS = \"http://localhost:55555/asset/\"\n// export const SERVER_URL_ASSETS = \"https://vr.josh.earth/generaled/api/asset/\"\n// export const SERVER_URL_ASSETS = \"http://josh.earth:30068/asset/\"\n// export const LOGIN_URL = \"http://localhost:55555/auth/github/login\"\n// export const LOGIN_URL = \"https://vr.josh.earth/generaled/api/auth/github/login\"\n\nclass TreeItemProviderInterface {\n    /** register a listener */\n    on(type, cb) {\n        throw new Error(`interface 'on' not implemented`)\n    }\n\n    /** un-register a listener */\n    off(type, cb) {\n        throw  new Error(\"interface 'off' not implemented\")\n    }\n\n    /** fire an event. internal use */\n    fire(type, value) {\n        throw  new Error(\"interface 'fire' not implemented\")\n    }\n\n    // ============== tree interface\n    /** returns the root of the tree structure */\n    getSceneRoot() {\n        throw new Error(\"interface 'getSceneRoot' not implemented\")\n    }\n    /** delete child node */\n    deleteChild(child) { throw new Error(\"deleteChild not implemented yet\")}\n    /** append child to the parent */\n    appendChild(parent,child) { throw new Error(\"appendChild not implemented yet\")}\n    /** insert child node before a particular other node */\n    insertNodeBefore(node,sibling) { throw new Error(\"insertNodeBefore() not implemented yet\")}\n    /** find a given node by ID */\n    findNodeById(id) { throw new Error(\"findNodeById() not implemented yet\")}\n    /** find the parent of the given node */\n    findParent(node) { throw new Error(\"findParent() not implemented yet\")}\n    /** return true if the given node has children */\n    hasChildren(node) { throw new Error(\"hasChildren() not implemented yet\")}\n    /** returns an array of children for the parent node */\n    getChildren(node) { throw new Error(\"getChildren() not implemented yet\")}\n\n    // ========= Tree View support =========\n\n    /** returns true if item is expanded */\n    isExpanded(item) {\n        throw  new Error(\"interface 'isExpanded' not implemented\")\n    }\n\n    /** return a react component for the context menu of the item in the tree view */\n    calculateContextMenu(item) {\n        throw new Error(\"calculateContextMenu() not implemented yet\")\n    }\n    /** toggles the collapsed state of the item */\n    toggleItemCollapsed(item) {\n        throw new Error(\"toggleItemCollapsed() not implemented yet\")\n    }\n    /** returns a react component to display the item in the tree view */\n    getRendererForItem(item) {\n        throw new Error(\"getRendererForItem() not implemented yet\")\n    }\n\n\n\n    // ================ properties ==================\n    /** set the property value using a prop def */\n    setPropertyValue(item, def, value) {\n        throw new Error(\"interface setPropertyValue not implemented\")\n    }\n    setPropertyValueByName(child,name,value) { throw new Error(`interface 'setPropertyValueByName() not implemented'`)}\n    /** return an array of property definitions for the specified tree item */\n    getProperties(item) { throw new Error(`interface 'getProperties()' not implemented`) }\n\n\n    // ================ doc def stuff\n    getDocId() {  throw new Error(\"getDocId() not implemented\")  }\n    getDocType() {  throw new Error(\"getDocType() not implemented\")  }\n    getApp() { throw new Error(\"getApp() not implemented\")  }\n    getTitle() { throw new Error(\"getTitle() not implemented\") }\n}\n\nexport default class TreeItemProvider extends TreeItemProviderInterface {\n    constructor(options) {\n        super()\n        this.listeners = {};\n        this.expanded_map = {};\n        this.docid = null\n        // URLS.BASE = SERVER_URL\n        if(options.SERVER_URL) {\n            URLS.BASE = `https://${options.SERVER_URL}/`\n        }\n        console.log(\"using server\",URLS.BASE)\n        AuthModule.init()\n    }\n\n    on(type, cb) {\n        if (!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].push(cb);\n    }\n\n    fire(type, value) {\n        if (!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].forEach((cb) => cb(value));\n    }\n\n    off(type, cb) {\n        if (this.listeners[type]) this.listeners[type] = this.listeners[type].filter(list => list !== cb)\n    }\n\n    isExpanded(item) {\n        if (!item.id) item.id = \"\" + Math.random();\n        if (typeof this.expanded_map[item.id] === 'undefined') this.expanded_map[item.id] = true;\n        return this.expanded_map[item.id];\n    }\n    toggleItemCollapsed(item) {\n        const current = this.isExpanded(item);\n        this.expanded_map[item.id] = !current;\n        this.fire(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,item);\n    }\n\n\n    setPropertyValue(item, def, value) {\n        throw new Error(\"subclass of TreeItemProvider must implement setPropertyValue\")\n    }\n\n    genID = (prefix) => {\n        return `${prefix}_${Math.floor(Math.random() * 1000*1000*1000)}`\n    }\n\n    setDocument(doc, docid) {\n        this.root = doc\n        this.docid = docid\n        this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, {\n            provider:this\n        });\n    }\n\n    getDocId() {\n        return this.docid\n    }\n\n    save = () => {\n        console.info(\"saving\",this.getSceneRoot())\n        const payload_obj = {\n            doc:this.getSceneRoot(),\n            type:this.getDocType(),\n            id:this.getDocId()\n        }\n        const payload_string = JSON.stringify(payload_obj,(key,value)=>{\n            if(key === 'parent') return undefined\n            return value\n        })\n        console.info(\"doc is\",payload_string)\n        return AuthModule.fetch(getDocsURL()+this.docid, {\n            method:'POST',\n            body: payload_string,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n        })\n            .then(res => res.json())\n            .then((res)=>{\n            console.log(\"Success result is\",res)\n            setQuery({mode:'edit',doc:this.docid, doctype:this.getDocType()})\n            this.fire(TREE_ITEM_PROVIDER.SAVED,true)\n        }).catch((e)=> console.log(\"error\",e))\n    }\n    loadDoc(docid) {\n        console.log(\"need to load the doc\",docid)\n        AuthModule.getJSON(getDocsURL()+docid).then((payload)=>{\n            console.log(\"got the doc\",payload)\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            this.setDocument(payload.doc,payload.id)\n        }).catch((e)=>{\n            console.warn(\"missing doc\",e)\n            this.setDocument(this.makeEmptyRoot(),this.genID('doc'))\n            setQuery({mode:'edit',doc:this.docid, doctype:this.getDocType()})\n        })\n    }\n    reloadDocument() {\n        const spath = this.generateSelectionPath(Selection.getSelection());\n        console.log(\"got the path\",spath)\n        AuthModule.getJSON(getDocsURL()+this.docid).then((payload)=>{\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            this.setDocument(payload.doc,payload.id)\n            this.fire(TREE_ITEM_PROVIDER.CLEAR_DIRTY,true)\n            const newsel = this.findNodeFromSelectionPath(this.getSceneRoot(),spath)\n            console.log(\"set new selection to \", newsel)\n            Selection.setSelection(newsel)\n        }).catch((e)=>{\n            console.warn(\"couldn't reload the doc\",e)\n        })\n\n    }\n\n    /* required functions for subclasses */\n\n    generateSelectionPath() {\n        throw new Error(\"generateSelectionPath not implemented\")\n    }\n    findNodeFromSelectionPath() {\n        throw new Error(\"findNodeFromSelectionPath not implemented\")\n    }\n    makeEmptyRoot() {\n        throw new Error(\"makeEmptyRoot() not implemented\")\n    }\n\n    getSceneRoot() {\n        return this.root;\n    }\n\n    uploadFile(file) {\n        return new Promise((res,rej)=>{\n            const fd = new FormData()\n            fd.append('file',file)\n            console.info(\"filesize is\",file.size, file.name);\n            const xml = new XMLHttpRequest()\n            xml.onreadystatechange = () => console.log(`ready state = ${xml.readyState} status ${xml.status}`)\n            xml.addEventListener('progress',(e)=>console.log(`progress`))\n            xml.addEventListener('load',(e)=> res(xml.response))\n            xml.addEventListener('error',(e)=>console.log(`error`))\n            xml.addEventListener('abort',(e)=>console.log(`abort`))\n            const url = getAssetsURL()+file.name;\n            console.info(\"uploading to \", url)\n            xml.responseType = 'json'\n            xml.open('POST',url)\n            xml.setRequestHeader('access-key',AuthModule.getAccessToken())\n            xml.send(file)\n        })\n    }\n\n\n    hasChildren = (item) => item && item.children && item.children.length\n    getChildren = (item) => item.children\n\n}\n","import React, {Component} from \"react\";\n\nexport class StringEditor extends Component {\n    keypressed = (e) => {\n        if(e.charCode === 13) this.props.onCommit();\n    }\n\n    render() {\n        const prop = this.props.def;\n        if (prop.hasHints()) {\n            const hints = prop.getHints()\n            if (hints.multiline) {\n                return <textarea value={this.props.value}\n                                 onChange={this.props.onChange}\n                                 onBlur={this.props.onBlur}\n                />\n            }\n        }\n        return <input type='string'\n                      value={this.props.value}\n                      onChange={this.props.onChange}\n                      onKeyPress={this.keypressed}\n                      onBlur={this.props.onBlur}\n        />\n    }\n}","import React, {Component} from \"react\";\nimport {HBox, PopupManager, VBox} from \"appy-comps\";\n\nconst EnumPicker = (props) => {\n    const Rend = props.renderer\n    const items = props.values.map(val=>\n        <HBox\n            key={val}\n            onClick={(e)=>props.onSelect(val)}>\n            <Rend value={val} def={props.def} obj={props.obj} provider={props.provider}/>\n        </HBox>\n    )\n    return <VBox className=\"popup-menu\">{items}</VBox>\n}\n\nconst DefaultEnumRenderer = (props) => {\n    let value = \"\"\n    if(typeof props.value !== 'undefined' && props.value !== null) {\n        value = props.value.toString()\n    }\n    return <span>{value}</span>\n}\n\nexport class EnumEditor extends Component {\n    calculateRenderer() {\n        const proxy = this.props.def\n        const obj = this.props.obj\n        if (!this.props.provider.getRendererForEnum) return DefaultEnumRenderer\n        const renderer = this.props.provider.getRendererForEnum(proxy.getKey(), obj)\n        if (!renderer) return DefaultEnumRenderer\n        return renderer\n    }\n\n    calculateValues() {\n        const vals = this.props.provider.getValuesForEnum(this.props.def.getKey(), this.props.obj, this.props.def)\n        if (!vals) {\n            console.log(`no values for enum ${this.props.def.getKey()}`);\n            return []\n        }\n        return vals\n    }\n\n    open = (e) => {\n        PopupManager.show(<EnumPicker\n            values={this.calculateValues()}\n            renderer={this.calculateRenderer()}\n            onSelect={this.selectValue}\n            provider={this.props.provider}\n        />, e.target)\n    }\n    selectValue = (value) => {\n        PopupManager.hide()\n        this.props.onChange(value)\n    }\n    renderValue = (value) => {\n        const def = this.props.def\n        const obj = this.props.obj\n        const Rend = this.calculateRenderer()\n        return <Rend value={value} def={def} obj={obj} provider={this.props.provider}/>\n    }\n\n    render() {\n        return <button onClick={this.open}>{this.renderValue(this.props.value)}</button>\n    }\n}","import React, {Component} from \"react\";\nimport {VBox} from \"appy-comps\";\nimport {EnumEditor} from \"./EnumEditor\";\n\nconst DefaultEnumRenderer = (props) => {\n    let value = \"\"\n    if(typeof props.value !== 'undefined') {\n        value = props.value.toString()\n    }\n    return <span>{value}</span>\n}\n\nexport class ArrayEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            showEditor: false,\n            value: \"\"\n        }\n\n    }\n\n    calculateRenderer() {\n        const def = this.props.def\n        const obj = this.props.obj\n        if (!this.props.provider.getRendererForEnum) return DefaultEnumRenderer\n        const renderer = this.props.provider.getRendererForEnum(def.key, obj)\n        if (!renderer) return DefaultEnumRenderer\n        return renderer\n    }\n\n    addValue = () => {\n        this.setState({showEditor: true})\n    }\n    enumChanged = (value) => {\n        const arr = this.props.value.slice();\n        arr.push(value)\n        this.props.onChange(arr)\n    }\n\n    render() {\n        // const def = this.props.def\n        // const obj = this.props.obj\n        let value = this.props.value\n        if (!value) value = []\n        return <div>\n            {this.renderValues()}\n            <button onClick={this.addValue} className=\"fa fa-plus\"/>\n            {this.renderEditor()}\n        </div>\n    }\n\n    deleteItem(val) {\n        let arr = this.props.value.slice()\n        arr = arr.filter((v) => v !== val)\n        this.props.onChange(arr)\n    }\n\n    renderValues() {\n        const Renderer = this.calculateRenderer()\n        return <VBox>{this.props.value.map((val, i) => {\n            return <div key={i}>\n                <button className=\"fa fa-minus\" onClick={() => this.deleteItem(val)}/>\n                <Renderer value={val} provider={this.props.provider}/>\n            </div>\n        })}</VBox>\n    }\n\n    renderEditor() {\n        if (!this.state.showEditor) return \"\"\n        const def = this.props.def\n        const obj = this.props.obj\n        return <EnumEditor value={this.state.value}\n                           onChange={this.enumChanged}\n                           def={def}\n                           obj={obj}\n                           provider={this.props.provider}/>\n\n    }\n}\n","import React, {Component} from 'react';\nimport {PopupManager} from 'appy-comps'\n\nimport selMan, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport HSLUVColorPicker from \"./HSLUVColorPicker\";\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {StringEditor} from \"./StringEditor\";\nimport {EnumEditor} from \"./EnumEditor\";\nimport {ArrayEditor} from \"./ArrayEditor\";\n\nexport const TYPES = {\n    STRING:'string',\n    NUMBER:'number',\n    BOOLEAN:'boolean',\n    ENUM:'enum',\n    COLOR:'color',\n    GROUP:'group',\n}\n\nclass PropEditor extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            value:props.def.getValue()\n        }\n    }\n    componentWillReceiveProps(nextProps) {\n        if(this.props.def !== nextProps.def) {\n            this.setState({value:nextProps.def.getValue()})\n        }\n    }\n    shouldComponentUpdate(nextProps, nextState) {\n        if(nextProps.def.getType() === 'group') return true\n        if(this.state.value !== nextState.value) return true\n        if(this.props.def.getKey() === nextProps.def.getKey()) {\n            if(this.props.def.getValue() === nextProps.def.getValue()) {\n                return false\n            }\n        }\n        return true\n    }\n    changed = (e) => {\n        if(this.props.def.isType(TYPES.STRING)) {\n            this.setState({value:e.target.value})\n            if(this.props.def.isLive()) {\n                this.props.def.setValue(e.target.value)\n            }\n        }\n        if(this.props.def.isType(TYPES.NUMBER)) this.updateNum(e.target.value)\n        if(this.props.def.isType(TYPES.BOOLEAN)) this.setState({value:e.target.checked})\n    }\n    customChanged = value => {\n        if(this.props.def.isType(TYPES.COLOR)) return this.colorChanged(value)\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    keypressed = (e) => {\n        if(e.charCode === 13) this.commit();\n    }\n    updateNum = (v) => {\n        const def = this.props.def;\n        if(def.hasHints()) {\n            if(def.getHints().hasOwnProperty('min')) {\n                if(v < def.getHints().min) v = def.getHints().min\n            }\n            if(def.getHints().hasOwnProperty('max')) {\n                if (v > def.getHints().max) v = def.getHints().max\n            }\n        }\n        this.setState({value:v})\n        if(!isNaN(parseFloat(v))) {\n            def.setValue(parseFloat(v))\n        }\n    }\n    numberKeyDown = (e) => {\n        if(e.key === 'ArrowUp' && e.shiftKey) {\n            e.preventDefault()\n            this.updateNum(this.state.value+10)\n        }\n        if(e.key === 'ArrowDown' && e.shiftKey) {\n            e.preventDefault()\n            this.updateNum(this.state.value-10)\n        }\n    }\n    booleanChanged = (e) => {\n        this.setState({value:e.target.checked});\n        this.props.def.setValue(e.target.checked)\n    }\n    enumChanged = (value) => {\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    arrayChanged = (value) => {\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    colorChanged = (color) => {\n        this.setState({value:color});\n        this.props.def.setValue(color)\n    }\n    commit = () => {\n        this.props.def.setValue(this.state.value)\n    }\n    openColorEditor = (e) => {\n        PopupManager.show(<HSLUVColorPicker onSelect={this.colorChanged} value={this.state.value}/>, e.target)\n    }\n    render() {\n        const prop = this.props.def;\n        const obj = selMan.getSelection();\n        const provider = this.props.provider\n        if (prop.isCustom()) return this.props.provider.createCustomEditor(this.props.item, prop, provider, this.state.value, this.customChanged)\n        if (prop.isLocked()) return <i>{prop.getValue()}</i>\n        if (prop.isType(TYPES.STRING))  return <StringEditor value={this.state.value}\n                                 onChange={this.changed}\n                                 onBlur={this.commit} onCommit={this.commit}\n                                 def={prop} obj={obj}\n                                 provider={this.props.provider}/>\n        if (prop.isType(TYPES.NUMBER))  {\n            let step = 1\n            if(prop.hasHints()) {\n                const hints = prop.getHints()\n                if (hints.incrementValue) {\n                    step = hints.incrementValue\n                }\n            }\n            return <input type='number'\n                          value={this.state.value}\n                          onChange={this.changed}\n                          onKeyPress={this.keypressed}\n                          onKeyDown={this.numberKeyDown}\n                          onBlur={this.commit}\n                          step={step}/>\n        }\n        if (prop.isType(TYPES.BOOLEAN)) return <input type='checkbox'\n                                                  checked={this.state.value}\n                                                  onChange={this.booleanChanged}/>\n        if (prop.isType(TYPES.ENUM)) return <EnumEditor value={this.state.value} onChange={this.enumChanged} def={prop} obj={obj} provider={this.props.provider}/>\n        if (prop.isType(TYPES.COLOR)) return <button style={{ backgroundColor:this.state.value}} onClick={this.openColorEditor}>{this.state.value}</button>\n        if (prop.isType('array')) return <ArrayEditor value={this.state.value} onChange={this.arrayChanged} def={prop} obj={obj} provider={this.props.provider}/>\n        return <b>{prop.getType()}:{prop.getValue()}</b>\n    }\n}\n\n/*class PaletteColorPicker extends Component {\n    chooseColor(c) {\n        this.props.onSelect(c);\n    }\n    render() {\n        const style = {\n            display:'flex',\n            flexDirection:'row',\n            flexWrap:'wrap'\n        }\n        return <div style={style}>\n            {Object.keys(COLORS2).map((key,i) => {\n                let color = COLORS2[key];\n                let scolor = color.toString(16);\n                while(scolor.length < 6) scolor = \"0\"+scolor\n                scolor = '#' +scolor\n                let style = {\n                    backgroundColor:scolor,\n                    color:'red'\n                }\n                return <button key={key}\n                               style={style}\n                               onClick={this.chooseColor.bind(this, scolor)}\n                >&nbsp;</button>\n            })}\n        </div>\n    }\n}\n*/\nexport default class PropSheet extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            selection:null\n        }\n    }\n    componentDidMount() {\n        this.h2 = () => this.setState({selection:selMan.getSelection()})\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.h2)\n        this.hand = (s) => this.setState({selection:selMan.getSelection()})\n        selMan.on(SELECTION_MANAGER.CHANGED, this.hand)\n    }\n    componentWillUnmount() {\n        selMan.off(SELECTION_MANAGER.CHANGED, this.hand);\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.h2)\n    }\n    render() {\n        const props = this.calculateGroups(this.calculateProps())\n        const item = selMan.getSelection()\n        return <ul className=\"prop-sheet\">{props.map((prop, i) => {\n            return [\n                <label key={prop.getKey()+'-label'}>{prop.getName()}</label>,\n                this.renderIndeterminate(prop,i),\n                <PropEditor key={prop.getKey()+'-editor'} def={prop} provider={this.props.provider} item={item}/>\n            ]\n        })}</ul>\n    }\n    renderIndeterminate(prop, i) {\n        if(prop.isIndeterminate()) {\n            return <i key={prop.getKey()+'-indeterminate'} className=\"icon fa fa-exclamation-circle\"/>\n        } else {\n            return \"\"\n        }\n    }\n    calculateProps() {\n        const items = selMan.getFullSelection()\n        const first = items[0]\n        const prov = this.props.provider\n        let props = prov.getProperties(first)\n        items.forEach((item)=>{\n            props = calculateIntersection(props, prov.getProperties(item))\n        })\n        return props.map((prop)=>{\n            const multi = new MultiPropProxy(prov, prop.key)\n            items.forEach((item)=>{\n                const p2 = prov.getProperties(item)\n                const match = p2.find(def=>def.key === prop.key)\n                multi.addSubProxy(new PropProxy(prov,item,match))\n            })\n            return multi\n        });\n    }\n\n    calculateGroups(props) {\n        const group_defs = props.filter(p => p.getType() === TYPES.GROUP)\n        group_defs.forEach(def => {\n            const group_keys = def.getGroupKeys()\n            //remove any groups in the group keys of a group def\n            props = props.filter(p => group_keys.indexOf(p.getKey())<0)\n        })\n        return props\n    }\n}\n\n//return items from A that are also in B\nfunction calculateIntersection(A,B) {\n    return  A.filter((pa)=> B.find((pb)=>pa.key===pb.key))\n}\n\n\nclass MultiPropProxy {\n    constructor(provider,key) {\n        this.provider = provider\n        this.key = key\n        this.subs = []\n    }\n    addSubProxy(sub) {\n        this.subs.push(sub)\n    }\n    first() {\n        return this.subs[0]\n    }\n    getName()  { return this.first().getName()  }\n    getValue() { return this.first().getValue() }\n    isCustom() { return this.first().isCustom() }\n    hasHints() { return this.first().hasHints() }\n    getHints() { return this.first().getHints() }\n    isLocked() { return this.first().isLocked() }\n    getType()  { return this.first().getType()  }\n    isType(s)  { return this.first().isType(s)  }\n    isLive()   { return this.first().isLive()   }\n    getKey()   { return this.key                }\n    getGroupKeys() { return this.first().getGroupKeys() }\n    setValue(v) {\n        this.subs.forEach((s)=> s.setValue(v))\n    }\n    isIndeterminate() {\n        let same = true\n        let value = this.first().getValue()\n        this.subs.forEach((s)=>{\n            if(s.getValue() !== value) same = false\n        })\n        return !same;\n    }\n}\n\n\nclass PropProxy {\n    constructor(provider, item, def) {\n        this.provider = provider\n        this.item = item\n        this.def = def\n    }\n    getKey() {\n        return this.def.key\n    }\n    getName() {\n        return this.def.name\n    }\n    isCustom() {\n        return this.def.custom\n    }\n    isLocked() {\n        return this.def.locked\n    }\n    getType() {\n        return this.def.type\n    }\n    getValue() {\n        return this.def.value\n    }\n    isLive() {\n        return this.def.live\n    }\n    isType(type) {\n        return this.def.type === type\n    }\n    setValue(value) {\n        return this.provider.setPropertyValue(this.item,this.def,value)\n    }\n    hasHints() {\n        return this.def.hints\n    }\n    getHints() {\n        return this.def.hints\n    }\n    getGroupKeys() {\n        return this.def.group\n    }\n    isIndeterminate() { return false; }\n}\n","export function listToArray(list) {\n    return Array.prototype.slice.call(list)\n}\nexport function createGraphObjectFromObject(graph, json) {\n    return graph.createObject(json)\n}\n\nexport function fetchGraphObject(graph, objid) {\n    const obj = {}\n    graph.getPropertiesForObject(objid).forEach(key => {\n        obj[key] = graph.getPropertyValue(objid, key)\n    })\n    obj.id = objid\n    return obj\n}\n\nexport function propToArray(doc, CH) {\n    const len = doc.getArrayLength(CH)\n    const ch = []\n    for (let i = 0; i < len; i++) {\n        ch.push(doc.getElementAt(CH, i))\n    }\n    return ch\n}\n\nexport function indexOf(graph, array, target) {\n    const arr = propToArray(graph,array)\n    return arr.findIndex(e => e === target)\n}\n\nexport function insertAsFirstChild(graph, parent, child) {\n    graph.setProperty(child.id,'parent',parent.id)\n    const ch = graph.getPropertyValue(parent.id,'children')\n    graph.insertAfter(ch,null,child.id)\n}\n\nexport function insertAsLastChild(graph, parent, child) {\n    graph.setProperty(child.id,'parent',parent.id)\n    const ch = graph.getPropertyValue(parent.id,'children')\n    const len = graph.getArrayLength(ch)\n    const prev = graph.getElementAt(ch,len-1)\n    graph.insertAfter(ch,prev,child.id)\n}\n\nexport function removeFromParent(graph, obj) {\n    const parent = fetchGraphObject(graph, obj.parent)\n    const n = indexOf(graph, parent.children, obj.id)\n    if (n >= 0) {\n        graph.removeElement(parent.children, n)\n    } else {\n        console.error(\"could not find index for child\", obj, 'in children', parent.children)\n    }\n}\n\n\nexport function cloneShape(graph,shape) {\n    const id = shape.id\n    const id2 = graph.createObject()\n    const props = graph.getPropertiesForObject(id)\n    props.forEach(key => {\n        graph.createProperty(id2,key,graph.getPropertyValue(id,key))\n    })\n    const shape2 = fetchGraphObject(graph,id2)\n    return shape2\n}\n","import React, { Component } from 'react';\nimport selMan, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider';\nimport {PopupManager, VBox} from \"appy-comps\";\nimport {fetchGraphObject, removeFromParent} from \"../syncgraph/utils\";\nimport {Spacer} from './GridEditorApp'\n\n\nconst ContextMenu = (props) => {\n    return <VBox className={\"popup-menu\"}>\n        {props.menu.map((item,i)=>{\n            if(item.divider) return <div className=\"divider\" key={i}></div>\n            return <button key={i} onClick={()=>{\n                PopupManager.hide()\n                if(item.fun) item.fun()\n            }}\n            ><i className={'fa fa-'+item.icon}/> {item.title}</button>\n        })}\n    </VBox>\n}\n\nclass TreeTableItem extends Component {\n    onSelect = (e)=>  {\n        if(e.shiftKey) {\n            selMan.addToSelection(this.props.node)\n        } else {\n            selMan.setSelection(this.props.node)\n        }\n    }\n    onContextMenu = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        selMan.setSelection(this.props.node)\n        if(this.props.provider.calculateContextMenu) {\n            const menu = this.props.provider.calculateContextMenu(this.props.node)\n            PopupManager.show(<ContextMenu menu={menu}/>,e.target)\n        }\n    }\n    toggleItemCollapsed = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.props.provider.toggleItemCollapsed(this.props.node);\n    }\n    onDragStart = (e) => {\n        this.props.onDragStart(e,this.props.node)\n    }\n    onDragOver = (e) => {\n        this.props.onDragOver(e,this.props.node)\n    }\n    onDragEnd = (e) => {\n        this.props.onDragEnd(e,this.props.node)\n    }\n    onDrop = (e) => {\n        this.props.onDrop(e,this.props.node)\n    }\n    render() {\n        let cls = \"tree-node\";\n        const node = this.props.node\n        if (selMan.isSelected(node)) cls += \" selected\"\n        if (selMan.getDropTarget() === node) {\n            cls += \" drop-target\"\n            if(selMan.getDropType() === 'parent') cls += \" drop-parent\"\n        }\n        let arrow = \"\";\n        const prov = this.props.provider\n        if (prov.hasChildren(node)) {\n            const expanded = prov.isExpanded(node)\n            if (expanded) {\n                arrow = <button className=\"fa fa-caret-down fa-fw borderless\" onClick={this.toggleItemCollapsed}/>;\n            } else {\n                arrow = <button className=\"fa fa-caret-right fa-fw borderless\" onClick={this.toggleItemCollapsed}/>;\n            }\n        } else {\n            arrow = <span className=\"fa fa-fw borderless\"/>\n        }\n\n        return <div className={cls}\n                    onClick={this.onSelect}\n                    onContextMenu={this.onContextMenu}\n                    data-nodeid={node.id}\n                    onDragOver={this.onDragOver}\n                    onDrop={this.onDrop}\n        >\n            <span style={{\n                width:this.props.depth*1.5+'em'\n            }}></span>\n            {arrow}\n            {prov.getRendererForItem(node)}\n            <Spacer/>\n            {this.renderDragBars()}\n        </div>\n    }\n\n    renderDragBars() {\n        if(this.props.provider.canBeMoved && !this.props.provider.canBeMoved(this.props.node))  return \"\"\n        return <span className={\"drag fa fa-bars\"}\n              draggable\n              onDragStart={this.onDragStart}\n              onDragEnd={this.onDragEnd}\n        />\n\n    }\n}\n\n\n\nexport default class TreeTable extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            root:this.props.root,\n            dropTarget:null,\n            selection:null,\n            dragTarget:null,\n            internalDrag:false,\n        }\n    }\n    componentDidMount() {\n        this.listener = this.props.provider.on(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n        this.props.provider.on(TREE_ITEM_PROVIDER.STRUCTURE_ADDED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n        this.props.provider.on(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n\n        this.other_listener = selMan.on(SELECTION_MANAGER.CHANGED, (sel)=> this.setState({selection:sel}))\n        selMan.on(SELECTION_MANAGER.DROP_TARGET_CHANGED, (sel) => this.setState({dropTarget:selMan.getDropTarget()}))\n    }\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.EXPANDED_CHANGED, this.listener)\n        selMan.off(SELECTION_MANAGER.CHANGED,this.other_listener)\n    }\n    componentWillReceiveProps(newProps) {\n        if(newProps.root) this.setState({root:newProps.root})\n    }\n\n    onDragStart = (e,item) => {\n        console.log('starting to drag the item',item)\n        e.dataTransfer.effectAllowed = \"move\";\n        e.dataTransfer.setData(\"text/html\", e.target.parentNode);\n        e.dataTransfer.setDragImage(e.target.parentNode, 20, 20);\n        e.dataTransfer.dropEffect = 'move'\n        this.setState({dragTarget:item, internalDrag:true})\n    }\n    onDragOver = (e,item) => {\n        if(!this.state.internalDrag) {\n            e.preventDefault()\n            if(this.props.provider.canAddExternalChild(item,e.dataTransfer)) {\n                selMan.setDropTarget(item)\n                selMan.setDropType('parent')\n            } else {\n                selMan.setDropType(null)\n                selMan.setDropTarget(null)\n            }\n            return\n        }\n        const prov = this.props.provider\n        if(prov.canAddChild(item,this.state.dragTarget)) {\n            //use the rop target as a parent\n            selMan.setDropTarget(item)\n            selMan.setDropType('parent')\n            return\n        } else if(prov.canBeSibling(item,this.state.dragTarget)) {\n            //use the drop target as a sibling\n            selMan.setDropType('sibling')\n            selMan.setDropTarget(item)\n        } else {\n            //no valid target\n            selMan.setDropType(null)\n            selMan.setDropTarget(null)\n        }\n    }\n    onDragEnd = (e,item) => {\n        //handle external case\n        if(!this.state.internalDrag){\n            this.setState({dragTarget:null, internalDrag:false})\n            e.preventDefault()\n            e.stopPropagation()\n            return\n        }\n\n        const graph = this.props.provider.getDataGraph()\n        const src = fetchGraphObject(graph,this.state.dragTarget)\n        const dst = fetchGraphObject(graph,this.state.dropTarget)\n\n\n        //can't drop onto self\n        if(dst.id === src.id) {\n            this.setState({dragTarget:null, internalDrag:false})\n            selMan.setDropTarget(null)\n            return\n        }\n\n\n        //remove from old location\n        removeFromParent(graph,src)\n\n        const dt = selMan.getDropType()\n        if(dt === 'parent') {\n            graph.setProperty(src.id,'parent',dst.id)\n            graph.insertAfter(dst.children,null,src.id)\n        } else {\n            const parent2 = fetchGraphObject(graph,dst.parent)\n            graph.setProperty(src.id, 'parent', parent2.id)\n            graph.insertAfter(parent2.children, dst.id, src.id)\n        }\n        this.setState({dragTarget:null})\n        selMan.setDropTarget(null)\n    }\n    onDrop = (e,item) => {\n        if(!this.state.internalDrag) {\n            e.stopPropagation()\n            e.preventDefault()\n            this.props.provider.acceptDrop(e,item)\n            this.setState({internalDrag:false, dragTarget:null})\n        }\n        // var data = e.dataTransfer.getData(\"text/html\");\n        // console.log('the dropped data is',data)\n    }\n    render() {\n        if(!this.state.root) return <ul>no root yet</ul>\n        const children = [];\n        this.generateChildren(this.state.root,children,0)\n        return <ul className='tree-table'>\n            {children.map((info,i)=>{\n                return <TreeTableItem key={i}\n                                      node={info.node}\n                                      depth={info.depth}\n                                      provider={this.props.provider}\n                                      selection={this.state.selection}\n                                      onDragStart={this.onDragStart}\n                                      onDragOver={this.onDragOver}\n                                      onDragEnd={this.onDragEnd}\n                                      onDrop={this.onDrop}\n                />\n            })}\n        </ul>\n    }\n\n    generateChildren = (root, chs,depth) => {\n        const prov = this.props.provider\n        chs.push({node:root, depth:depth})\n        if(!prov.hasChildren(root)) return\n        if(!prov.isExpanded(root)) return;\n        prov.getChildren(root).forEach((child)=>{\n            this.generateChildren(child,chs,depth+1)\n        })\n    }\n}\n\n","export const UNITS = {\n    PIXEL:{\n        name:'pixel',\n        matches:['pixel','pixels','px'],\n        short:'px'\n    },\n    MILLIMETER: {\n        name:'millimeter',\n        matches:['mm'],\n        short:'mm'\n    }\n}\nexport const DEFAULT_DPI = 72\n\nexport function parseDimension(str) {\n    if(str.value) str = str.value\n    // console.log(\"parsing dimension\",str)\n\n    const parts = str.trim().match(/(\\d+)\\s*x\\s*(\\d+)\\s*(px|mm)/)\n    // console.log(\"parsed parts\",parts)\n    if(parts[3] === 'px') {\n        return new Dimension(parseInt(parts[1]),parseInt(parts[2]),UNITS.PIXEL)\n    }\n    if(parts[3] === 'mm') {\n        return new Dimension(parseInt(parts[1]),parseInt(parts[2]),UNITS.MILLIMETER)\n    }\n    return new Dimension(100,100,UNITS.PIXEL)\n}\nexport class Dimension {\n    constructor(width,height,unit) {\n        this.width = width\n        this.height = height\n        this.unit = unit\n    }\n\n    as(unit, scale, dpi) {\n        if(this.unit.name === UNITS.MILLIMETER.name && unit.name===UNITS.PIXEL.name) {\n            const in_per_mm = 0.0393701\n            const px_per_in = dpi\n            return new Dimension(\n                this.width*in_per_mm*px_per_in*scale*1,  // 100mm at dpi of 76 is 76 px/in * mm/in 0.0393701\n                this.height*in_per_mm*px_per_in*scale*1,  // 100mm at dpi of 76 is 76 px/in * mm/in 0.0393701\n                unit\n            )\n        }\n        return new Dimension(\n            this.width*scale,\n            this.height*scale,\n            unit,\n        )\n    }\n}","import React, {Component} from \"react\";\nimport SelectionManager, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport {TREE_ITEM_PROVIDER} from \"../TreeItemProvider\";\nimport {fetchGraphObject, propToArray} from \"../syncgraph/utils\";\nimport {makePoint} from '../utils'\nimport {UNITS, DEFAULT_DPI} from \"./Dimension\"\n\n\nexport class MetadocCanvas extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            pressed: false,\n            selection: null,\n            shape:null,\n            hsnap:null,\n            vsnap:null,\n        }\n        props.prov.onRawChange(e => {\n            if (this.props.list === -1) return\n            this.redraw()\n        })\n    }\n\n    selectionChanged = (sel) => this.setState({selection: sel})\n    componentDidMount() {\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n        this.props.prov.on(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, this.redraw)\n    }\n    componentWillUnmount() {\n        SelectionManager.off(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n        this.props.prov.off(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, this.redraw)\n    }\n\n    toCanvas(e) {\n        const rect = e.target.getBoundingClientRect()\n        return makePoint(\n            Math.floor((e.clientX - rect.left) / this.props.scale),\n            Math.floor((e.clientY - rect.top) / this.props.scale))\n    }\n\n\n    componentDidUpdate(prevProps) {\n        this.redraw()\n    }\n\n    redraw = () => {\n        if(!this.canvas) return\n        const c = this.canvas.getContext('2d')\n        const size = this.props.prov.getPageSize(this.props.prov.getSelectedPage()).as(UNITS.PIXEL,this.props.scale,DEFAULT_DPI)\n        this.canvas.width = size.width\n        this.canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, this.canvas.width, this.canvas.height)\n        c.save()\n        c.scale(this.props.scale, this.props.scale)\n        const graph = this.props.prov.getRawGraph()\n        const page = this.props.prov.getSelectedPage()\n        if(page) this.drawPage(c,graph,page)\n        c.fillStyle = \"rgba(0,255,255,0.5)\"\n        if(this.state.hsnap) c.fillRect(this.state.hsnap.value - 1,0,2,this.canvas.height)\n        if(this.state.vsnap) c.fillRect(0, this.state.vsnap.value - 1,this.canvas.width,2)\n        c.restore()\n    }\n\n    drawPage(c,g,page) {\n        propToArray(g,page.children).forEach(id => this.drawLayer(c,g,fetchGraphObject(g,id)))\n    }\n\n    drawLayer(c,g,layer) {\n        propToArray(g,layer.children).forEach(id => this.drawShape(c,g,fetchGraphObject(g,id)))\n    }\n\n    drawShape(c,g,shape) {\n        const def = this.props.prov.getShapeDef(shape.type)\n        if(def) def.draw(c,g,shape,SelectionManager.getSelection() === shape.id,this.props.prov)\n    }\n\n    isInside(pt, objid) {\n        const graph = this.props.prov.getRawGraph()\n        const shape = fetchGraphObject(graph,objid)\n        const def = this.props.prov.getShapeDef(shape.type)\n        if(def) return def.isInside(pt,shape,this.canvas)\n        return false\n    }\n\n    onClick = (e) => {\n        const pt = this.toCanvas(e)\n        const shape = this.findShape(pt)\n        if (shape) this.props.onSelect(shape)\n    }\n\n    findShape(pt) {\n        const prov = this.props.prov\n        const layer = prov.getSelectedLayer()\n        if (!layer) return null\n        const graph = prov.getRawGraph()\n        const arr = propToArray(graph,layer.children)\n        arr.reverse()\n        return arr.find((ch)=> this.isInside(pt,ch))\n    }\n\n    mouseDown = (e) => {\n        this.props.prov.pauseQueue()\n        const pt = this.toCanvas(e)\n        const shapeid = this.findShape(pt)\n        if (shapeid) {\n            const shapeobj = fetchGraphObject(this.props.prov.getRawGraph(),shapeid)\n            this.setState({\n                pressed: true,\n                initial: makePoint(shapeobj.x,shapeobj.y).minus(pt),\n                start: pt,\n                shape: shapeid,\n            })\n        } else {\n            const layer = this.props.prov.getSelectedLayer()\n            if(layer) SelectionManager.setSelection(layer.id)\n        }\n    }\n    mouseMove = (e) => {\n        if (!this.state.pressed) return\n        let pt = this.toCanvas(e).add(this.state.initial)\n        pt = this.snap(pt)\n        const graph = this.props.prov.getRawGraph()\n        graph.process(this.props.prov.cmd.setProperty(this.state.shape, 'x', pt.x))\n        graph.process(this.props.prov.cmd.setProperty(this.state.shape, 'y', pt.y))\n    }\n    mouseUp = (e) => {\n        this.setState({pressed: false, hsnap:null, vsnap:null})\n        this.props.prov.unpauseQueue()\n    }\n\n    render() {\n        return <div className=\"panel\">\n            <canvas style={{border: '0px solid red'}}\n                    width={100} height={100} ref={(e) => this.canvas = e}\n                    onClick={this.onClick}\n                    onMouseDown={this.mouseDown}\n                    onMouseUp={this.mouseUp}\n                    onMouseMove={this.mouseMove}\n            ></canvas>\n        </div>\n    }\n\n    snap(pt) {\n        const EDGES = {\n            LEFT:'LEFT',\n            RIGHT:'RIGHT',\n            CENTER:'CENTER',\n            TOP:'TOP',\n            MIDDLE:'MIDDLE',\n            BOTTOM:'BOTTOM',\n            NONE:'NONE',\n        }\n\n        const snaps = [\n            {value:0,type:EDGES.LEFT},\n            {value:320,type:EDGES.CENTER},\n            {value:640,type:EDGES.RIGHT},\n            {value:0, type:EDGES.TOP},\n            {value:240, type:EDGES.MIDDLE},\n            {value:480, type:EDGES.BOTTOM},\n        ]\n        const SNAP_THRESHOLD = 20\n        function isNearH(pt,snap) {\n            if(snap.type === EDGES.LEFT && Math.abs(pt.x-snap.value) < SNAP_THRESHOLD) return EDGES.LEFT\n            if(snap.type === EDGES.CENTER && Math.abs(pt.x + pt.width/2 - snap.value) < SNAP_THRESHOLD) return EDGES.CENTER\n            if(snap.type === EDGES.RIGHT && Math.abs(pt.x + pt.width - snap.value) < SNAP_THRESHOLD) return EDGES.RIGHT\n            return EDGES.NONE\n        }\n        function isNearV(pt,snap) {\n            if(snap.type === EDGES.TOP && Math.abs(pt.y-snap.value) < SNAP_THRESHOLD) return EDGES.TOP\n            if(snap.type === EDGES.MIDDLE && Math.abs(pt.y + pt.height/2 -snap.value) < SNAP_THRESHOLD) return EDGES.MIDDLE\n            if(snap.type === EDGES.BOTTOM && Math.abs(pt.y + pt.height -snap.value) < SNAP_THRESHOLD) return EDGES.BOTTOM\n            return EDGES.NONE\n        }\n\n        const graph = this.props.prov.getRawGraph()\n        const shape = fetchGraphObject(graph,this.state.shape)\n        const def = this.props.prov.getShapeDef(shape.type)\n        let hsnap = null\n        let vsnap = null\n        if(def) {\n            const bounds = def.getBounds(pt,shape,this.canvas)\n            for(let i=0; i<snaps.length; i++)  {\n                const snap = snaps[i]\n                const nearH = isNearH(bounds,snap)\n                if(nearH === EDGES.LEFT)   pt.x = snap.value\n                if(nearH === EDGES.CENTER) pt.x = snap.value-bounds.width/2\n                if(nearH === EDGES.RIGHT)  pt.x = snap.value-bounds.width\n\n                const nearV = isNearV(bounds,snap)\n                if(nearV === EDGES.TOP)    pt.y = snap.value\n                if(nearV === EDGES.MIDDLE) pt.y = snap.value-bounds.height/2\n                if(nearV === EDGES.BOTTOM) pt.y = snap.value-bounds.height\n\n                if(nearH !== EDGES.NONE) hsnap = snap\n                if(nearV !== EDGES.NONE) vsnap = snap\n            }\n        }\n        this.setState({hsnap:hsnap, vsnap:vsnap})\n\n        return pt\n    }\n}\n","const {SET_PROPERTY, CREATE_PROPERTY, DELETE_PROPERTY,\n    CREATE_OBJECT, DELETE_OBJECT,\n    INSERT_ELEMENT, DELETE_ELEMENT\n} = require(\"syncing_protocol\");\n\nexport class UndoQueue {\n    constructor(graph) {\n        this.graph = graph\n        this.history = []\n        this.current = -1\n    }\n\n    submit(op) {\n        // console.log(\"UNDOREDO: submit\",op)\n        this.history.push(op)\n        this.current = this.history.length - 1\n    }\n\n    canUndo() {\n        return this.current >= 0\n    }\n\n    canRedo() {\n        return this.current < this.history.length - 1\n    }\n\n    undo() {\n        const last = this.history[this.current]\n        this.current--\n        // console.log(\"undoing\",last)\n        // this.history.forEach(op => console.log(short(op)))\n        if (last.type === SET_PROPERTY) {\n            if (!last.prevValue) {\n                console.warn(\"undoing set property without a previous value!\", last)\n                return\n            }\n            const op = {\n                type: SET_PROPERTY,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.prevValue,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_PROPERTY) {\n            const op = {\n                type: DELETE_PROPERTY,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_OBJECT) {\n            const op = {\n                type: DELETE_OBJECT,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                id: last.id,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === INSERT_ELEMENT) {\n            const op = {\n                type: DELETE_ELEMENT,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                array: last.array,\n                entry: last.entryid\n            }\n            this.graph.process(op)\n            return\n        }\n        throw new Error(`undo for type not supported: ${last.type}`)\n    }\n\n    redo() {\n        this.current++\n        const last = this.history[this.current]\n        // console.log(\"redoin\",this.current,last.type,last.name,'=',last.value)\n        if (last.type === SET_PROPERTY) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.value\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_PROPERTY) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.value\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_OBJECT) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                id: last.id,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === INSERT_ELEMENT) {\n            console.log(\"redoing\", last)\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                array: last.array,\n                value: last.value,\n                entryid: this.graph.makeGUID(),\n                prev: -1,\n            }\n            this.graph.process(op)\n            return\n        }\n        throw new Error(`redo for type not supported: ${last.type}`)\n    }\n\n    dump() {\n        return this.history.map((op, i) => i + \" \" + op.type + \" \" + op.name + \" => \" + op.value)\n    }\n}\n","const {SET_PROPERTY} = require(\"syncing_protocol\");\n\n\nexport class EventCoalescer {\n    constructor(graph) {\n        this.graph = graph\n        this.listeners = []\n        this.rawlisteners = []\n        this.paused = false\n        this.buffer = []\n        this.first = {}\n        this.last = {}\n    }\n\n    pause() {\n        this.paused = true\n    }\n\n    unpause() {\n        this.paused = false\n        this.buffer = []\n        // console.log(\"need to send out set property updates\",this.last)\n        // console.log('the originals are',this.first)\n        Object.keys(this.last).forEach((key) => {\n            Object.keys(this.last[key]).forEach(name => {\n                const op = this.last[key][name]\n                // console.log(\"sending\",short(op))\n                op.prevValue = this.first[key][name].value\n                this.fire(op)\n                this.graph.process(op)\n            })\n        })\n\n        this.first = {}\n        this.last = {}\n\n        // console.log(this.graph.dumpGraph())\n        // this.graph.getHistory().forEach(h => console.log(h.type,h.name,h.value))\n    }\n\n    onChange = cb => this.listeners.push(cb)\n    onRawChange = cb => this.rawlisteners.push(cb)\n    fire = op => this.listeners.forEach(cb => cb(op))\n    fireRaw = op => this.rawlisteners.forEach(cb => cb(op))\n    getPropertiesForObject = (obj) => this.graph.getPropertiesForObject(obj)\n    getArrayLength = (obj) => this.graph.getArrayLength(obj)\n    getElementAt = (obj, index) => this.graph.getElementAt(obj, index)\n    getHostId = () => this.graph.getHostId()\n\n\n    getPropertyValue(obj, key) {\n        // console.log(\"checking\",this.paused,obj,key)\n        if (this.paused && this.last[obj] && this.last[obj][key]) {\n            // console.log(\"returning the raw property values\",this.last[obj][key])\n            return this.last[obj][key].value\n        } else {\n            return this.graph.getPropertyValue(obj, key)\n        }\n    }\n\n    bufferOp(op) {\n        if (!this.first[op.object]) this.first[op.object] = {}\n        if (!this.first[op.object][op.name]) this.first[op.object][op.name] = op\n        if (!this.last[op.object]) this.last[op.object] = {}\n        this.last[op.object][op.name] = op\n        this.buffer.push(op)\n        this.fireRaw(op)\n    }\n\n    process(op) {\n        if (op.type === SET_PROPERTY && this.paused) {\n            this.bufferOp(op)\n        } else {\n            this.fire(op)\n            this.graph.process(op)\n        }\n    }\n}\n","import PubNub from \"pubnub\";\nfunction short(op) {\n    let str = `${op.type} ${op.uuid} |  `\n    if(op.name) {\n        str += `${op.name} = ${op.value}  prev = ${op.prevValue}`\n    }\n    return str\n}\nconst settings = {\n    publishKey: 'pub-c-1cba58da-c59a-4b8b-b756-09e9b33b1edd',\n    subscribeKey: 'sub-c-39263f3a-f6fb-11e7-847e-5ef6eb1f4733',\n}\n\nexport class PubnubSyncWrapper {\n    constructor(provider, graph) {\n        if(!provider) throw new Error('created PubnubSyncWrapper without a provider')\n        if(!graph) throw new Error('created PubnubSyncWrapper without a graph')\n        this.paused = false\n        this.buffer = []\n        this.provider = provider\n\n        graph.onChange((e)=>this.handleGraphChange(e))\n\n        this.pubnub = new PubNub(settings)\n    }\n\n    calculateChannelName() {\n        return \"metadoc-docupdate-\" + this.provider.getDocId()\n    }\n    calculateLoggerChannelName() {\n        return \"metadoc-log-\" + this.provider.getDocId()\n    }\n\n    start() {\n        this.pubnub.addListener({\n            status: (e) => {\n                // console.log(e)\n                if (e.operation === 'PNSubscribeOperation' && e.category === 'PNConnectedCategory') {\n                    this.sendHistoryRequest()\n                }\n            },\n            message: (m)=>this.handleMessage(m),\n        })\n\n        this.pubnub.subscribe({channels: [this.calculateChannelName(),this.calculateLoggerChannelName()]})\n    }\n\n    pause() {\n        this.paused = true\n    }\n\n    unpause() {\n        this.paused = false\n        // console.log(\"we need to send the waiting messages\", this.buffer)\n        this.buffer.forEach(op => this.sendMessage(op))\n        this.buffer = []\n        //now request history from the network for anything we missed\n        // this.sendHistoryRequest()\n    }\n\n    shutdown() {\n        this.pubnub.unsubscribe({channels: [this.calculateChannelName()]})\n        this.pubnub.stop()\n    }\n\n    sendMessage(e) {\n        console.log(\"PN_SEND:\", short(e))\n        this.pubnub.publish({\n            channel: this.calculateChannelName(),\n            message: e\n        }, (status, response) => {\n            // console.log(\"published\",status,response)\n        })\n\n    }\n\n    handleGraphChange (e) {\n        // console.log(\"graph changed\",e)\n        const host = this.provider.getDataGraph().getHostId()\n        if (e.host !== host) return\n        if (this.paused) return this.buffer.push(e)\n        this.sendMessage(e)\n    }\n\n    sendHistoryRequest() {\n        // console.log(\"sending a history request\")\n        this.pubnub.publish({\n            channel: this.calculateChannelName(),\n            message: {\n                type: 'GET_HISTORY',\n                host: this.provider.getDataGraph().getHostId()\n            }\n        })\n    }\n\n    handleGetHistory() {\n        // console.log(\"need to send out the history\")\n        const graph = this.provider.getDataGraph()\n        const hist = graph.getHistory().slice()\n        console.log(hist)\n        const chunkSize = 30\n        let count = 0\n        while (hist.length > 0) {\n            if (count > 100) {\n                console.log(\"breaking out. possible infinite loop\")\n                break\n            }\n            count++\n            const chunk = hist.splice(0, chunkSize)\n            console.log(\"sending\", chunk.length, chunk)\n            this.pubnub.publish({\n                channel: this.calculateChannelName(),\n                message: {\n                    type: 'SEND_HISTORY',\n                    host: graph.getHostId(),\n                    history: chunk\n                }\n            }, (status, response) => {\n                console.log(\"published\", status, response)\n            })\n        }\n\n    }\n\n    handleReceiveHistory(msg) {\n        // console.log(\"got some history\", msg.history.length)\n        msg.history.forEach(op => this.provider.getDataGraph().process(op))\n    }\n\n\n    handleMessage (evt) {\n        if (this.paused) return\n//        console.log(\"channel is\",evt.channel)\n        if(evt.channel === this.calculateLoggerChannelName()) {\n            if(evt.publisher !== this.pubnub.getUUID()) {\n                if(evt.message.length) {\n                    console.log(\"REMOTE LOGGER\",...evt.message)\n                } else {\n                    console.log(\"REMOTE LOGGER\", evt.message)\n                }\n            }\n            return\n        }\n        const graph = this.provider.getDataGraph()\n        // console.log('PN_REMOTE',evt)\n        if (evt.message.type === 'GET_HISTORY') {\n            // console.log(\"got a history request\",evt.message.host, graph.getHostId())\n            if (evt.message.host !== graph.getHostId()) {\n                return this.handleGetHistory()\n            }\n            return\n        }\n        if (evt.message.type === 'SEND_HISTORY') {\n            if (evt.message.host !== graph.getHostId()) {\n                return this.handleReceiveHistory(evt.message)\n            }\n            return\n        }\n        const op = evt.message\n        if (!op.host) return console.log(\"received a message without a host\", op)\n        if (!op.timestamp) return console.error(\"received a message without a timestamp\", op)\n        if (op.host && op.host === graph.getHostId()) {\n            // console.log(\"SKIP: my own message came in. ignoring it\")\n            return\n        }\n        console.log(\"REMOTE\", op)\n        graph.process(op)\n    }\n\n    getLogger() {\n        return new PubnubLogger(this.provider.getDocId(),this.pubnub)\n    }\n}\n\n\nexport class PubnubLogger {\n    constructor(docid, pubnub) {\n        this.count = 0\n        this.docid = docid\n        if(!pubnub) {\n            this.pubnub = new PubNub(settings)\n        } else {\n            this.pubnub = pubnub\n        }\n    }\n    calculateLoggerChannelName() {\n        return \"metadoc-log-\" + this.docid\n    }\n    log() {\n        console.log(\"LOGGER\",...arguments)\n        this.pubnub.publish({\n            channel:this.calculateLoggerChannelName(),\n            message:Array.from(arguments).concat(this.count++)\n        })\n    }\n    error () {\n        console.log(\"LOGGER ERROR\",...arguments)\n        this.pubnub.publish({\n            channel:this.calculateLoggerChannelName(),\n            message:Array.from(arguments).concat(this.count++)\n        })\n    }\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\n\nexport class MissingDocDialog extends Component {\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n\n    okay = () => {\n        DialogManager.hide()\n        this.props.provider.createNewDocument(this.props.docid)\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Document \"<b>{this.props.docid}</b>\" not found</h3>\n                <VBox grow>\n                    Create a new document?\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}","import TreeItemProvider, {getDocsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {setQuery, toQueryString} from '../utils'\nimport {UndoQueue} from './UndoQueue'\nimport {EventCoalescer} from '../metadoc/EventCoalescer'\nimport SelectionManager from '../SelectionManager'\nimport {PubnubSyncWrapper} from './PubnubSyncWrapper'\nimport {propToArray} from \"./utils\";\nimport * as ToasterMananager from '../vr/ToasterManager'\nimport {DialogManager} from 'appy-comps'\nimport {MissingDocDialog} from './MissingDocDialog'\nimport React from 'react'\nimport {AuthModule} from '../vr/AuthModule'\n\nconst {DocGraph, CommandGenerator} = require(\"syncing_protocol\");\n\n\nfunction DocGraphToObjectGraph(doc, id) {\n    const props = doc.getPropertiesForObject(id)\n    const obj = {}\n    props.forEach(name => {\n        obj[name] = doc.getPropertyValue(id,name)\n        if(name === 'children') {\n            obj.children = propToArray(doc,obj[name]).map(child => {\n                return DocGraphToObjectGraph(doc,child)\n            })\n        }\n    })\n    obj.id = id\n    return obj\n}\n\n\nexport default class SyncGraphProvider extends TreeItemProvider {\n    constructor(options) {\n        super(options)\n        this.options = options || {}\n        this.mode = options.mode || 'edit'\n        this.datalisteners = []\n        this.rawlisteners = []\n        this.expanded = {}\n\n        const doc = new DocGraph()\n        this.makeEmptyRoot(doc)\n        this.setupDocFlow(doc,this.genID('doc'))\n        if(options.doc) this.loadDoc(options.doc)\n    }\n    getDocTitle = () => \"untitled\"\n    getDocHistory = () => this.getDataGraph().getHistory()\n    getDocGraph = () => {\n        const root = this.getDataGraph().getObjectByProperty('type','root')\n        return DocGraphToObjectGraph(this.getDataGraph(),root)\n    }\n    onRawChange = cb => this.rawlisteners.push(cb)\n    getRawGraph = () => this.coalescer\n    getDataGraph = () => this.syncdoc\n    getSceneRoot = () => this.getDataGraph().getObjectByProperty('type','root')\n    hasChildren = (item) => item && this.getDataGraph().hasPropertyValue(item,'children')\n    getChildren = (item) => {\n        const doc = this.getDataGraph()\n        return propToArray(doc,doc.getPropertyValue(item,'children'))\n    }\n    isExpanded = (item) => {\n        if (typeof this.expanded[item] === 'undefined') this.expanded[item] = true;\n        return this.expanded[item]\n    }\n    toggleItemCollapsed(item) {\n        const current = this.isExpanded(item);\n        this.expanded[item] = !current;\n        this.fire(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,item);\n    }\n\n    setPropertyValue(item, def, value) {\n        const op = this.cmd.setProperty(item,def.key,value)\n        op.prevValue = def.value\n        this.getRawGraph().process(op)\n        this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,{\n            provider: this,\n            child:item,\n            propKey:def.key,\n            oldValue:def.value,\n            newValue:value\n        })\n    }\n\n    save = (e) => {\n        if(e) e.preventDefault()\n        const payload_obj = {\n            history:this.getDocHistory(),\n            type:this.getDocType(),\n            id:this.getDocId(),\n            graph:this.getDocGraph(),\n            title:this.getDocTitle(),\n        }\n        const payload_string = JSON.stringify(payload_obj)\n        ToasterMananager.add('saving')\n        const opts = {\n            type:this.getDocType(),\n            title:this.getDocTitle(),\n        }\n        const url = getDocsURL()+this.getDocId()+'?'+toQueryString(opts)\n        console.log(`saving ${payload_string.length} chars to ${url}`, payload_obj)\n        return AuthModule.fetch(url,{\n            method:'POST',\n            body:payload_string,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n        })\n            .then(res=>res.json())\n            .then(res => {\n                console.log(\"got back result\",res)\n                setQuery({mode:this.mode,doc:this.getDocId(), doctype:this.getDocType()})\n                ToasterMananager.add(res.message)\n                this.fire(TREE_ITEM_PROVIDER.SAVED,true)\n            }).catch((e)=> console.log(\"error\",e))\n    }\n\n    loadDoc(docid) {\n        return AuthModule.getJSON(getDocsURL()+docid)\n            .then((payload)=>{\n                console.log(\"got the payload\",payload)\n                if(!payload.id) return this.showMissingDocDialog(docid)\n                const doc = this.makeDocFromServerHistory(payload.history)\n                this.setupDocFlow(doc,docid)\n            })\n            .catch((e)=> {\n                console.error(\"there was an error loading doc\",docid,e)\n                // this.showMissingDocDialog(docid)\n            })\n    }\n\n    createNewDocument(docid) {\n        const doc = new DocGraph()\n        this.makeEmptyRoot(doc)\n        this.setupDocFlow(doc,docid)\n    }\n\n    setupDocFlow(doc,docid) {\n        //shut down old network connection\n        if(this.pubnub) this.pubnub.shutdown()\n        this.pubnub = null\n\n        this.syncdoc = doc\n        this.cmd = new CommandGenerator(this.syncdoc)\n        this.root = this.getSceneRoot()\n        this.docid = docid\n        this.undoqueue = new UndoQueue(doc)\n        this.coalescer = new EventCoalescer(this.syncdoc) //sends calls on to sync doc, and fires change event\n        this.coalescer.onChange((op) => this.undoqueue.submit(op))\n\n        this.coalescer.onRawChange(op =>this.rawlisteners.forEach(cb => cb(op)))\n        this.syncdoc.onChange(op => this.rawlisteners.forEach(cb => cb(op)))\n        this.syncdoc.onChange((op)=>{\n            this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, { provider:this });\n            this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, { provider:this });\n        })\n        this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, { provider:this });\n        this.fire(TREE_ITEM_PROVIDER.CLEAR_DIRTY,true)\n        SelectionManager.clearSelection()\n        this.pubnub = new PubnubSyncWrapper(this,this.syncdoc)\n        this.pubnub.unpause()\n        this.pubnub.start()\n        this.connected = true\n        this.fire(\"CONNECTED\",this.connected)\n        this.fire(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED,{provider:this})\n        setQuery({mode:this.mode,doc:this.getDocId(), doctype:this.getDocType()})\n        this.docLoaded()\n    }\n\n    reloadDocument() {\n        return AuthModule.getJSON(getDocsURL()+this.docid).then((payload)=>{\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            const doc = this.makeDocFromServerHistory(payload.history)\n            this.setupDocFlow(doc,this.docid)\n        }).catch((e)=>{\n            console.log(\"couldn't reload the doc\",e)\n        })\n\n    }\n\n    docLoaded = () => {\n    }\n\n    toggleConnected = () => {\n        this.connected = !this.connected\n        if(this.pubnub) {\n            if(this.connected) {\n                this.pubnub.unpause()\n            } else {\n                this.pubnub.pause()\n            }\n        }\n        this.fire(\"CONNECTED\",this.connected)\n    }\n\n    isConnected = () => this.connected\n\n    pauseQueue = () => this.coalescer.pause()\n    unpauseQueue = () => this.coalescer.unpause()\n\n    performUndo = (e) => {\n        if(e && e.preventDefault) e.preventDefault()\n\n        if(this.undoqueue.canUndo()) {\n            this.undoqueue.undo()\n        } else {\n            console.warn(\"at beginnning of the undo queue\")\n        }\n    }\n    performRedo = (e) => {\n        if(e && e.preventDefault) e.preventDefault()\n        if(this.undoqueue.canRedo()) this.undoqueue.redo()\n    }\n\n    makeDocFromServerHistory(history) {\n        const doc = new DocGraph()\n        history.forEach(op => doc.process(op))\n        return doc\n    }\n\n\n    showMissingDocDialog(docid) {\n        DialogManager.show(<MissingDocDialog docid={docid} provider={this}/>)\n    }\n}\n","\nexport default class InputManager {\n    static KEYS = {\n        S:83,\n        Z:90,\n        C:67,\n        V:86,\n        X:88,\n        LEFT_ARROW:37,\n        RIGHT_ARROW:39,\n    }\n    static MODIFIERS = {\n        COMMAND:'COMMAND',\n        SHIFT:'SHIFT'\n    }\n\n    constructor() {\n        this.bindings = []\n        this.listeners = {}\n    }\n\n    addKeyBinding(binding) {\n        this.bindings.push(binding)\n    }\n    addListener(name,cb) {\n        if(!this.listeners[name]) {\n            this.listeners[name] = []\n        }\n        this.listeners[name].push(cb)\n    }\n\n    attachKeyEvents(document) {\n        document.addEventListener('keydown',this.keyDown)\n    }\n\n    keyDown = (e)=>{\n        // console.log(\"-------------\")\n        // console.log(\"got a key press\",e.shiftKey, e.metaKey, e.key, e.keyCode)\n        const matches = this.bindings.filter((b)=>b.key === e.keyCode)\n        // console.log(\"got the bindings\",matches)\n        const m2 = matches.filter((b)=>{\n            let valid = true\n            b.modifiers.forEach((mod)=>{\n                if(mod === InputManager.MODIFIERS.COMMAND && !e.metaKey) {\n                    // console.log(\"missing the meta key\");\n                    valid = false\n                }\n                if(mod === InputManager.MODIFIERS.SHIFT && !e.shiftKey) {\n                    // console.log(\"missing the shift key\");\n                    valid = false\n                }\n            })\n            if(e.shiftKey && !b.modifiers.some(mod=>mod === InputManager.MODIFIERS.SHIFT)) {\n                // console.log(\"shift is down, but missing shift in the def\")\n                valid = false\n            }\n            // console.log(\"still valid\",valid)\n            return valid\n        })\n        // console.log(\"final list is\",m2.length)\n        if(m2.length > 0) {\n            // console.log(\"something matched\")\n            // e.preventDefault()\n            this.dispatchEvents(m2,e)\n        }\n    }\n    dispatchEvents(matches,e) {\n        matches.forEach((bind)=>{\n            if(this.listeners[bind.id]) this.listeners[bind.id].forEach((cb)=>cb?cb(e):null)\n        })\n    }\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class RectDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,graph.createObject({\n            type:'rect',\n            title:'second rect',\n            x: 100,\n            y: 100,\n            rx:20,\n            ry:20,\n            width: 100,\n            height: 100,\n            fillColor: '#ff00ff',\n            parent:layer.id,\n        }))\n    }\n\n    draw(c,g,shape,selected) {\n        c.fillStyle = 'gray'\n        c.fillStyle = shape.fillColor\n        if(shape.rx > 0 || shape.ry > 0) {\n            const c0 = {x:shape.x,y:shape.y}\n            const c1 = {x:shape.x+shape.width, y:shape.y}\n            const c2 = {x:shape.x+shape.width, y:shape.y+shape.height}\n            const c3 = {x:shape.x, y:shape.y+shape.height}\n            c.beginPath()\n            c.moveTo(c0.x+shape.rx,c0.y)\n            c.lineTo(c1.x-shape.rx,c1.y)\n            c.quadraticCurveTo(c1.x,c1.y, c1.x,c1.y+shape.ry)\n            c.lineTo(c2.x,c2.y-shape.ry)\n            c.quadraticCurveTo(c2.x,c2.y, c2.x-shape.rx,c2.y)\n            c.lineTo(c3.x+shape.rx,c3.y)\n            c.quadraticCurveTo(c3.x,c3.y, c3.x,c3.y-shape.ry)\n            c.lineTo(c0.x,c0.y+shape.ry)\n            c.quadraticCurveTo(c0.x,c0.y, c0.x+shape.rx,c0.y)\n            c.closePath()\n            c.fill()\n        } else {\n            c.fillRect(shape.x, shape.y, shape.width, shape.height)\n        }\n\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x+0.5,shape.y+0.5,shape.width, shape.height)\n        }\n\n    }\n\n    isInside(pt,shape) {\n        if (pt.x < shape.x) return false\n        if (pt.x > shape.x + shape.width) return false\n        if (pt.y < shape.y) return false\n        if (pt.y > shape.y + shape.height) return false\n        return true\n    }\n\n    getBounds(newOrigin,shape) {\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:shape.width,\n            height:shape.height,\n        }\n    }\n\n    toSVGString(obj) {\n        return `<rect x=\"${obj.x}\" y=\"${obj.y}\" width=\"${obj.width}\" height=\"${obj.height}\" fill=\"${obj.fillColor}\"/>`\n    }\n\n}\n","import {createGraphObjectFromObject, fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class CircleDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,createGraphObjectFromObject(graph, {\n            type: 'circle',\n            title: 'circle',\n            x: 100,\n            y: 100,\n            radius: 50,\n            fillColor: '#ffff00',\n            parent: layer.id,\n        }))\n    }\n\n\n    draw(c,g,shape,selected) {\n        c.fillStyle = 'gray'\n        c.fillStyle = shape.fillColor\n        c.beginPath()\n        c.arc(shape.x, shape.y, shape.radius, 0, Math.PI*2)\n        c.fill()\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x-shape.radius+0.5,shape.y-shape.radius+0.5,shape.radius*2, shape.radius*2)\n        }\n    }\n\n    isInside(pt,shape) {\n        if(Math.pow(shape.x-pt.x,2) + Math.pow(shape.y - pt.y,2) < Math.pow(shape.radius,2)) return true\n        return false\n    }\n\n    getBounds(newOrigin,shape, canvas) {\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:shape.radius*2,\n            height:shape.radius*2,\n        }\n    }\n\n    toSVGString(obj) {\n        return `<circle cx=\"${obj.x}\" cy=\"${obj.y}\" r=\"${obj.radius}\" fill=\"${obj.fillColor}\"/>`\n    }\n\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\nimport {FONT_STYLES, FONT_WEIGHTS, HORIZONTAL_ALIGNMENT, STANDARD_FONTS, VERTICAL_ALIGNMENT} from \"./Common\";\n\nexport default class TextDef {\n    make(graph,layer) {\n        const text = fetchGraphObject(graph,graph.createObject({\n            type:'text',\n            title:'text',\n\n            text:'title text',\n\n            horizontalAlign:HORIZONTAL_ALIGNMENT.CENTER,\n            verticalAlign:VERTICAL_ALIGNMENT.BASELINE,\n            autoFit:true,\n            fontSize:30,\n            fontFamily:STANDARD_FONTS.SANSSERIF,\n            fontWeight:FONT_WEIGHTS.NORMAL,\n            fontStyle:FONT_STYLES.NORMAL,\n\n            x: 100,\n            y: 100,\n            width: 200,\n            height: 120,\n            fillColor: '#ff00ff',\n            parent:layer.id,\n        }))\n        return text\n    }\n\n    draw(c,g,shape,selected) {\n        //calculate the general line metrics\n        const {lines, size_px, total_height, total_width} = this.calculateLines(shape,c)\n        //add offsets for alignment\n        lines.forEach((line,i) => {\n            const lines_height = lines.length*size_px\n            line.xoff = 0\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.LEFT)   line.xoff = 0\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.CENTER) line.xoff = (total_width - line.width)/2\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.RIGHT)  line.xoff = total_width  - line.width\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.TOP)        line.yoff = 0\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.CENTER)     line.yoff = (total_height- lines_height)/2\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.BASELINE)   line.yoff = total_height - lines_height\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.BOTTOM)     line.yoff = total_height - lines_height\n            line.yoff += (i+1)*line.height\n        })\n\n        //draw text\n        c.fillStyle = shape.fillColor\n        lines.forEach((line,i) => c.fillText(line.text,shape.x+line.xoff,shape.y+ line.yoff))\n        //draw outline\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x + 0.5, shape.y + 0.5, total_width, total_height)\n        }\n    }\n\n    calculateLines(shape,c) {\n        const size_px = parseFloat(shape.fontSize)\n        c.font = `normal ${size_px}px sans-serif`\n        const lines = shape.text.split(\"\\n\").map(text => {\n            return {\n                text:text,\n                width: c.measureText(text).width,\n                height: size_px\n            }\n        })\n\n        let total_width = 0\n        let total_height = 0\n        if(shape.autoFit) {\n            total_width = lines.reduce((max, line) => Math.max(max,line.width),0)\n            total_height = lines.reduce((total,line) => total + line.height,0)\n        } else {\n            total_width = shape.width\n            total_height = shape.height\n        }\n        return {\n            total_width:total_width,\n            total_height: total_height,\n            lines:lines,\n            size_px:size_px\n        }\n    }\n\n    insideRect(pt,x,y,w,h) {\n        if (pt.x < x) return false\n        if (pt.x > x + w) return false\n        if (pt.y < y) return false\n        if (pt.y > y + h) return false\n        return true\n    }\n\n    isInside(pt,shape, canvas) {\n        const c = canvas.getContext('2d')\n        const {total_width, total_height} = this.calculateLines(shape,c)\n        return this.insideRect(pt,shape.x,shape.y,total_width,total_height)\n    }\n\n    getBounds(newOrigin,shape, canvas) {\n        const c = canvas.getContext('2d')\n        const {total_width, total_height} = this.calculateLines(shape,c)\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:total_width,\n            height:total_height,\n        }\n    }\n\n\n    toSVGString(obj) {\n        return `<text x=\"${obj.x}\" y=\"${obj.y}\"\n                     fill=\"${obj.fillColor}\" fontSize=\"${obj.fontSize}\"\n                     fontFamily=\"${obj.fontFamily}\"\n                >${obj.text}</text>`\n    }\n\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class ImageDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,graph.createObject({\n            type:'image',\n            title:'image',\n            x: 100,\n            y: 100,\n            width: 50,\n            height: 50,\n            asset:0,\n            parent:layer.id,\n        }))\n    }\n\n    draw(c,g,shape,selected, provider) {\n        if(shape.asset) {\n            const src = g.getPropertyValue(shape.asset,'src')\n            if(provider.isImageCached(src)) {\n                c.drawImage(provider.getCachedImage(src),shape.x,shape.y,shape.width,shape.height)\n            } else {\n                provider.requestImageCache(src)\n                c.fillStyle = 'aqua'\n                c.fillRect(shape.x,shape.y,shape.width,shape.height)\n            }\n        } else {\n            c.fillStyle = 'aqua'\n            c.fillRect(shape.x,shape.y,shape.width,shape.height)\n        }\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x+0.5,shape.y+0.5,shape.width, shape.height)\n        }\n    }\n\n    isInside(pt,shape) {\n        if (pt.x < shape.x) return false\n        if (pt.x > shape.x + shape.width) return false\n        if (pt.y < shape.y) return false\n        if (pt.y > shape.y + shape.height) return false\n        return true\n    }\n    toSVGString(obj,prov) {\n        console.log('serializing',obj,prov)\n        const asset = fetchGraphObject(prov.getDataGraph(),obj.asset)\n        console.log('asset is',asset)\n        // return `<rect x=\"${obj.x}\" y=\"${obj.y}\" width=\"${obj.width}\" height=\"${obj.height}\" fill=\"${obj.fillColor}\"/>`\n        return `<image xlinkHref=\"${asset.src}\"\n                      width=\"${obj.width}\" height=\"${obj.height}\"\n        />`\n\n    }\n}\n","import {TYPES} from \"../common/PropSheet\";\nimport RectDef from \"./RectDef\";\nimport CircleDef from \"./CircleDef\";\nimport TextDef from \"./TextDef\";\nimport ImageDef from \"./ImageDef\";\n\nexport const PROP_DEFS = {\n    title: {\n        key:'title',\n        name:'Title',\n        type:TYPES.STRING\n    },\n    x: {\n        key:'x',\n        name:'X',\n        type:TYPES.NUMBER\n    },\n    y: {\n        key:'y',\n        name:'Y',\n        type:TYPES.NUMBER\n    },\n    rx: {\n        key:'rx',\n        name:'RX',\n        type:TYPES.NUMBER\n    },\n    ry: {\n        key:'ry',\n        name:'RY',\n        type:TYPES.NUMBER\n    },\n    fillColor: {\n        key:'fillColor',\n        name:'color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    width: {\n        key:'width',\n        name:'Width',\n        type:TYPES.NUMBER\n    },\n    height: {\n        key:'height',\n        name:'Height',\n        type:TYPES.NUMBER\n    },\n    radius: {\n        key:'radius',\n        name:'Radius',\n        type:TYPES.NUMBER\n    },\n    text: {\n        key:'text',\n        name:'text',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    src: {\n        key:'src',\n        name:'src',\n        type:TYPES.STRING,\n    },\n    asset: {\n        key:'asset',\n        name:'asset',\n        type:TYPES.ENUM,\n    },\n    subtype: {\n        key:'subtype',\n        name:'kind',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    format: {\n        key:'format',\n        name:'format',\n        type:TYPES.STRING,\n        locked:true,\n    },\n\n    autoFit: {\n        key:'autoFit',\n        name:'Size to Fit',\n        type:TYPES.BOOLEAN,\n        locked:false,\n    },\n    fontSize: {\n        key:'fontSize',\n        name:'Font Size',\n        type:TYPES.STRING,\n        locked:false,\n    },\n    fontFamily: {\n        key:'fontFamily',\n        name:'Font Family',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    fontWeight: {\n        key:'fontWeight',\n        name:'Font Weight',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    fontStyle: {\n        key:'fontStyle',\n        name:'Font Style',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    horizontalAlign: {\n        key:'horizontalAlign',\n        name:'H Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    verticalAlign: {\n        key:'verticalAlign',\n        name:'V Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    pageSize: {\n        key:'pageSize',\n        name:'Size',\n        type:TYPES.STRING,\n        locked:false,\n        custom:true,\n    }\n}\n\nexport const SHAPE_DEFS = {\n    rect: new RectDef(),\n    circle: new CircleDef(),\n    text: new TextDef(),\n    image: new ImageDef(),\n}\n\nexport const ICONS = {\n    page:'file',\n    layer:'sticky-note',\n    rect:'square',\n    circle:'circle',\n    text:'font',\n    plane:'plane',\n    image:'image',\n    model:'cube',\n    cut:'cut',\n    copy:'copy',\n    paste:'paste',\n    delete:'close'\n}\n\nexport const VERTICAL_ALIGNMENT = {\n    TOP:'TOP',\n    BASELINE:'BASELINE',\n    CENTER:'CENTER',\n    BOTTOM:'BOTTOM',\n}\nexport const HORIZONTAL_ALIGNMENT = {\n    LEFT:'LEFT',\n    CENTER:'CENTER',\n    RIGHT:'RIGHT',\n}\n\nexport const STANDARD_FONTS = {\n    SERIF:'serif',\n    SANSSERIF:'sans-serif',\n    MONOSPACE:'monospace',\n}\n\nexport const FONT_WEIGHTS = {\n    NORMAL:'normal',\n    BOLD:'bold'\n}\n\nexport const FONT_STYLES = {\n    NORMAL:'normal',\n    ITALIC:'italic',\n    OBLIQUE:'oblique'\n}\n\n\n\nexport function isShapeType(type) {\n    if(type === 'rect') return true\n    if(type === 'circle') return true\n    if(type === 'text') return true\n    if(type === 'image') return true\n    return false\n}\n","export default class ObjectDef {\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'tx') node.position.x = parseFloat(op.value)\n        if (op.name === 'ty') node.position.y = parseFloat(op.value)\n        if (op.name === 'tz') node.position.z = parseFloat(op.value)\n        if (op.name === 'rx') node.rotation.x = parseFloat(op.value)\n        if (op.name === 'ry') node.rotation.y = parseFloat(op.value)\n        if (op.name === 'rz') node.rotation.z = parseFloat(op.value)\n        if (op.name === 'sx') node.scale.x = parseFloat(op.value)\n        if (op.name === 'sy') node.scale.y = parseFloat(op.value)\n        if (op.name === 'sz') node.scale.z = parseFloat(op.value)\n        if (op.name === 'visible') node.visible = op.value\n\n        if (op.name === 'color') {\n            let color = op.value\n            if(color.indexOf('#') === 0) color = color.substring(1)\n            node.material.color.set(parseInt(color,16))\n            return\n        }\n\n    }\n    reset(node, obj) {\n        node.position.set(obj.tx,obj.ty,obj.tz)\n        node.visible = obj.visible\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {BoxGeometry, Mesh, MeshLambertMaterial, TextureLoader, DoubleSide, VideoTexture} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, OBJ_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport default class CubeDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.cube,\n            title:'cube '+COUNTER++,\n            visible:true,\n            width:0.3, height:0.3, depth:0.3,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            asset:0,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Mesh(\n            new BoxGeometry(obj.width, obj.height, obj.depth),\n            new MeshLambertMaterial({color: obj.color})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        const asset = provider.accessObject(obj.asset)\n        if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        return node\n    }\n\n\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'width' || op.name === 'height' || op.name === 'depth') {\n            node.geometry = new BoxGeometry(obj.width, obj.height, obj.depth)\n            return\n        }\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(obj.asset)\n            if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(asset, obj, node, provider) {\n        if(asset.subtype === ASSET_TYPES.IMAGE) {\n            const tex = new TextureLoader().load(asset.src)\n            node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            let video\n            if(!provider.videocache[asset.src]) {\n                video = document.createElement('video')\n                video.crossOrigin = 'anonymous'\n                video.src = asset.src\n                provider.videocache[asset.src] = video\n            } else {\n                video = provider.videocache[asset.src]\n            }\n            const tex = new VideoTexture(video)\n            node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n        }\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, PROP_DEFS} from '../Common'\nimport {TextureLoader, MeshLambertMaterial, DoubleSide, VideoTexture, Mesh, SphereBufferGeometry} from 'three'\n\nexport default class SphereDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'sphere',\n            title:'a sphere',\n            visible:true,\n            radius: 0.3/2,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#0000ff',\n            children:graph.createArray(),\n            asset:0,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Mesh(\n            new SphereBufferGeometry(obj.radius),\n            new MeshLambertMaterial({color: obj.color})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        const asset = provider.accessObject(obj.asset)\n        if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'radius') node.geometry = new SphereBufferGeometry(op.value)\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(obj.asset)\n            if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(asset, obj, node, provider) {\n        if(asset.subtype === ASSET_TYPES.IMAGE) {\n            const tex = new TextureLoader().load(asset.src)\n            node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            let video\n            if(!provider.videocache[asset.src]) {\n                video = document.createElement('video')\n                video.crossOrigin = 'anonymous'\n                video.src = asset.src\n                provider.videocache[asset.src] = video\n            } else {\n                video = provider.videocache[asset.src]\n            }\n            const tex = new VideoTexture(video)\n            node.material = new MeshLambertMaterial({color: obj.color, side: DoubleSide, map: tex})\n        }\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {ASSET_TYPES, PROP_DEFS} from '../Common'\nimport ObjectDef from './ObjectDef'\n\nexport default class PlaneDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create plane w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'plane',\n            title:'a plane',\n            visible:true,\n            width: 0.5,\n            height: 0.5,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#ffffff',\n            children:graph.createArray(),\n            asset:0,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(obj.width,obj.height),\n            new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide})\n        )\n        const asset = provider.accessObject(obj.asset)\n        if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'width') node.geometry = new THREE.PlaneBufferGeometry(op.value,obj.height)\n        if (op.name === 'height') node.geometry = new THREE.PlaneBufferGeometry(obj.width,op.value)\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(obj.asset)\n            if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(asset, obj, node, provider) {\n        if(asset.subtype === ASSET_TYPES.IMAGE) {\n            const tex = new THREE.TextureLoader().load(asset.src)\n            node.material = new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide, map: tex})\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            let video\n            if(!provider.videocache[asset.src]) {\n                video = document.createElement('video')\n                video.crossOrigin = 'anonymous'\n                video.src = asset.src\n                provider.videocache[asset.src] = video\n            } else {\n                video = provider.videocache[asset.src]\n            }\n            const tex = new THREE.VideoTexture(video)\n            node.material = new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide, map: tex})\n        }\n    }\n\n}\n","/* eslint-disable */\nconst THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author Rich Tibbett / https://github.com/richtr\n * @author mrdoob / http://mrdoob.com/\n * @author Tony Parisi / http://www.tonyparisi.com/\n * @author Takahiro / https://github.com/takahirox\n * @author Don McCurdy / https://www.donmccurdy.com\n */\n\nconst GLTFLoader = ( function () {\n\n    function GLTFLoader( manager ) {\n\n        this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\n\n    }\n\n    GLTFLoader.prototype = {\n\n        constructor: GLTFLoader,\n\n        crossOrigin: 'Anonymous',\n\n        load: function ( url, onLoad, onProgress, onError ) {\n\n            var scope = this;\n\n            var path = this.path !== undefined ? this.path : THREE.LoaderUtils.extractUrlBase( url );\n\n            var loader = new THREE.FileLoader( scope.manager );\n\n            loader.setResponseType( 'arraybuffer' );\n\n            loader.load( url, function ( data ) {\n\n                try {\n\n                    scope.parse( data, path, onLoad, onError );\n\n                } catch ( e ) {\n\n                    if ( onError !== undefined ) {\n\n                        onError( e );\n\n                    } else {\n\n                        throw e;\n\n                    }\n\n                }\n\n            }, onProgress, onError );\n\n        },\n\n        setCrossOrigin: function ( value ) {\n\n            this.crossOrigin = value;\n            return this;\n\n        },\n\n        setPath: function ( value ) {\n\n            this.path = value;\n            return this;\n\n        },\n\n        parse: function ( data, path, onLoad, onError ) {\n\n            var content;\n            var extensions = {};\n\n            if ( typeof data === 'string' ) {\n\n                content = data;\n\n            } else {\n\n                var magic = THREE.LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n                if ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n                    try {\n\n                        extensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n                    } catch ( error ) {\n\n                        if ( onError ) onError( error );\n                        return;\n\n                    }\n\n                    content = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n                } else {\n\n                    content = THREE.LoaderUtils.decodeText( new Uint8Array( data ) );\n\n                }\n\n            }\n\n            var json = JSON.parse( content );\n\n            if ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n                if ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.' ) );\n                return;\n\n            }\n\n            if ( json.extensionsUsed ) {\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_LIGHTS ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_LIGHTS ] = new GLTFLightsExtension( json );\n\n                }\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_COMMON ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] = new GLTFMaterialsCommonExtension( json );\n\n                }\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\n\n                }\n\n            }\n\n            console.time( 'GLTFLoader' );\n\n            var parser = new GLTFParser( json, extensions, {\n\n                path: path || this.path || '',\n                crossOrigin: this.crossOrigin,\n                manager: this.manager\n\n            } );\n\n            parser.parse( function ( scene, scenes, cameras, animations, asset ) {\n\n                console.timeEnd( 'GLTFLoader' );\n\n                var glTF = {\n                    scene: scene,\n                    scenes: scenes,\n                    cameras: cameras,\n                    animations: animations,\n                    asset: asset\n                };\n\n                onLoad( glTF );\n\n            }, onError );\n\n        }\n\n    };\n\n    /* GLTFREGISTRY */\n\n    function GLTFRegistry() {\n\n        var objects = {};\n\n        return\t{\n\n            get: function ( key ) {\n\n                return objects[ key ];\n\n            },\n\n            add: function ( key, object ) {\n\n                objects[ key ] = object;\n\n            },\n\n            remove: function ( key ) {\n\n                delete objects[ key ];\n\n            },\n\n            removeAll: function () {\n\n                objects = {};\n\n            }\n\n        };\n\n    }\n\n    /*********************************/\n    /********** EXTENSIONS ***********/\n    /*********************************/\n\n    var EXTENSIONS = {\n        KHR_BINARY_GLTF: 'KHR_binary_glTF',\n        KHR_LIGHTS: 'KHR_lights',\n        KHR_MATERIALS_COMMON: 'KHR_materials_common',\n        KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness'\n    };\n\n    /**\n     * Lights Extension\n     *\n     * Specification: PENDING\n     */\n    function GLTFLightsExtension( json ) {\n\n        this.name = EXTENSIONS.KHR_LIGHTS;\n\n        this.lights = {};\n\n        var extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_LIGHTS ] ) || {};\n        var lights = extension.lights || {};\n\n        for ( var lightId in lights ) {\n\n            var light = lights[ lightId ];\n            var lightNode;\n\n            var color = new THREE.Color().fromArray( light.color );\n\n            switch ( light.type ) {\n\n                case 'directional':\n                    lightNode = new THREE.DirectionalLight( color );\n                    lightNode.position.set( 0, 0, 1 );\n                    break;\n\n                case 'point':\n                    lightNode = new THREE.PointLight( color );\n                    break;\n\n                case 'spot':\n                    lightNode = new THREE.SpotLight( color );\n                    lightNode.position.set( 0, 0, 1 );\n                    break;\n\n                case 'ambient':\n                    lightNode = new THREE.AmbientLight( color );\n                    break;\n\n            }\n\n            if ( lightNode ) {\n\n                if ( light.constantAttenuation !== undefined ) {\n\n                    lightNode.intensity = light.constantAttenuation;\n\n                }\n\n                if ( light.linearAttenuation !== undefined ) {\n\n                    lightNode.distance = 1 / light.linearAttenuation;\n\n                }\n\n                if ( light.quadraticAttenuation !== undefined ) {\n\n                    lightNode.decay = light.quadraticAttenuation;\n\n                }\n\n                if ( light.fallOffAngle !== undefined ) {\n\n                    lightNode.angle = light.fallOffAngle;\n\n                }\n\n                if ( light.fallOffExponent !== undefined ) {\n\n                    console.warn( 'THREE.GLTFLoader:: light.fallOffExponent not currently supported.' );\n\n                }\n\n                lightNode.name = light.name || ( 'light_' + lightId );\n                this.lights[ lightId ] = lightNode;\n\n            }\n\n        }\n\n    }\n\n    /**\n     * Common Materials Extension\n     *\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_common\n     */\n    function GLTFMaterialsCommonExtension( json ) {\n\n        this.name = EXTENSIONS.KHR_MATERIALS_COMMON;\n\n    }\n\n    GLTFMaterialsCommonExtension.prototype.getMaterialType = function ( material ) {\n\n        var khrMaterial = material.extensions[ this.name ];\n\n        switch ( khrMaterial.type ) {\n\n            case 'commonBlinn' :\n            case 'commonPhong' :\n                return THREE.MeshPhongMaterial;\n\n            case 'commonLambert' :\n                return THREE.MeshLambertMaterial;\n\n            case 'commonConstant' :\n            default :\n                return THREE.MeshBasicMaterial;\n\n        }\n\n    };\n\n    GLTFMaterialsCommonExtension.prototype.extendParams = function ( materialParams, material, parser ) {\n\n        var khrMaterial = material.extensions[ this.name ];\n\n        var pending = [];\n\n        var keys = [];\n\n        // TODO: Currently ignored: 'ambientFactor', 'ambientTexture'\n        switch ( khrMaterial.type ) {\n\n            case 'commonBlinn' :\n            case 'commonPhong' :\n                keys.push( 'diffuseFactor', 'diffuseTexture', 'specularFactor', 'specularTexture', 'shininessFactor' );\n                break;\n\n            case 'commonLambert' :\n                keys.push( 'diffuseFactor', 'diffuseTexture' );\n                break;\n\n            case 'commonConstant' :\n            default :\n                break;\n\n        }\n\n        var materialValues = {};\n\n        keys.forEach( function ( v ) {\n\n            if ( khrMaterial[ v ] !== undefined ) materialValues[ v ] = khrMaterial[ v ];\n\n        } );\n\n        if ( materialValues.diffuseFactor !== undefined ) {\n\n            materialParams.color = new THREE.Color().fromArray( materialValues.diffuseFactor );\n            materialParams.opacity = materialValues.diffuseFactor[ 3 ];\n\n        }\n\n        if ( materialValues.diffuseTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'map', materialValues.diffuseTexture.index ) );\n\n        }\n\n        if ( materialValues.specularFactor !== undefined ) {\n\n            materialParams.specular = new THREE.Color().fromArray( materialValues.specularFactor );\n\n        }\n\n        if ( materialValues.specularTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'specularMap', materialValues.specularTexture.index ) );\n\n        }\n\n        if ( materialValues.shininessFactor !== undefined ) {\n\n            materialParams.shininess = materialValues.shininessFactor;\n\n        }\n\n        return Promise.all( pending );\n\n    };\n\n    /* BINARY EXTENSION */\n\n    var BINARY_EXTENSION_BUFFER_NAME = 'binary_glTF';\n    var BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\n    var BINARY_EXTENSION_HEADER_LENGTH = 12;\n    var BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\n    function GLTFBinaryExtension( data ) {\n\n        this.name = EXTENSIONS.KHR_BINARY_GLTF;\n        this.content = null;\n        this.body = null;\n\n        var headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n        this.header = {\n            magic: THREE.LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n            version: headerView.getUint32( 4, true ),\n            length: headerView.getUint32( 8, true )\n        };\n\n        if ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n            throw new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n        } else if ( this.header.version < 2.0 ) {\n\n            throw new Error( 'THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.' );\n\n        }\n\n        var chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n        var chunkIndex = 0;\n\n        while ( chunkIndex < chunkView.byteLength ) {\n\n            var chunkLength = chunkView.getUint32( chunkIndex, true );\n            chunkIndex += 4;\n\n            var chunkType = chunkView.getUint32( chunkIndex, true );\n            chunkIndex += 4;\n\n            if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n                var contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n                this.content = THREE.LoaderUtils.decodeText( contentArray );\n\n            } else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n                var byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n                this.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n            }\n\n            // Clients must ignore chunks with unknown types.\n\n            chunkIndex += chunkLength;\n\n        }\n\n        if ( this.content === null ) {\n\n            throw new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n        }\n\n    }\n\n    /**\n     * Specular-Glossiness Extension\n     *\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_pbrSpecularGlossiness\n     */\n    function GLTFMaterialsPbrSpecularGlossinessExtension() {\n\n        return {\n\n            name: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\n\n            specularGlossinessParams: [\n                'color',\n                'map',\n                'lightMap',\n                'lightMapIntensity',\n                'aoMap',\n                'aoMapIntensity',\n                'emissive',\n                'emissiveIntensity',\n                'emissiveMap',\n                'bumpMap',\n                'bumpScale',\n                'normalMap',\n                'displacementMap',\n                'displacementScale',\n                'displacementBias',\n                'specularMap',\n                'specular',\n                'glossinessMap',\n                'glossiness',\n                'alphaMap',\n                'envMap',\n                'envMapIntensity',\n                'refractionRatio',\n            ],\n\n            getMaterialType: function () {\n\n                return THREE.ShaderMaterial;\n\n            },\n\n            extendParams: function ( params, material, parser ) {\n\n                var pbrSpecularGlossiness = material.extensions[ this.name ];\n\n                var shader = THREE.ShaderLib[ 'standard' ];\n\n                var uniforms = THREE.UniformsUtils.clone( shader.uniforms );\n\n                var specularMapParsFragmentChunk = [\n                    '#ifdef USE_SPECULARMAP',\n                    '\tuniform sampler2D specularMap;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var glossinessMapParsFragmentChunk = [\n                    '#ifdef USE_GLOSSINESSMAP',\n                    '\tuniform sampler2D glossinessMap;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var specularMapFragmentChunk = [\n                    'vec3 specularFactor = specular;',\n                    '#ifdef USE_SPECULARMAP',\n                    '\tvec4 texelSpecular = texture2D( specularMap, vUv );',\n                    '\ttexelSpecular = sRGBToLinear( texelSpecular );',\n                    '\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\n                    '\tspecularFactor *= texelSpecular.rgb;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var glossinessMapFragmentChunk = [\n                    'float glossinessFactor = glossiness;',\n                    '#ifdef USE_GLOSSINESSMAP',\n                    '\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\n                    '\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\n                    '\tglossinessFactor *= texelGlossiness.a;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var lightPhysicalFragmentChunk = [\n                    'PhysicalMaterial material;',\n                    'material.diffuseColor = diffuseColor.rgb;',\n                    'material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );',\n                    'material.specularColor = specularFactor.rgb;',\n                ].join( '\\n' );\n\n                var fragmentShader = shader.fragmentShader\n                    .replace( '#include <specularmap_fragment>', '' )\n                    .replace( 'uniform float roughness;', 'uniform vec3 specular;' )\n                    .replace( 'uniform float metalness;', 'uniform float glossiness;' )\n                    .replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\n                    .replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\n                    .replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\n                    .replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\n                    .replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\n\n                delete uniforms.roughness;\n                delete uniforms.metalness;\n                delete uniforms.roughnessMap;\n                delete uniforms.metalnessMap;\n\n                uniforms.specular = { value: new THREE.Color().setHex( 0x111111 ) };\n                uniforms.glossiness = { value: 0.5 };\n                uniforms.specularMap = { value: null };\n                uniforms.glossinessMap = { value: null };\n\n                params.vertexShader = shader.vertexShader;\n                params.fragmentShader = fragmentShader;\n                params.uniforms = uniforms;\n                params.defines = { 'STANDARD': '' };\n\n                params.color = new THREE.Color( 1.0, 1.0, 1.0 );\n                params.opacity = 1.0;\n\n                var pending = [];\n\n                if ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\n\n                    var array = pbrSpecularGlossiness.diffuseFactor;\n\n                    params.color.fromArray( array );\n                    params.opacity = array[ 3 ];\n\n                }\n\n                if ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\n\n                    pending.push( parser.assignTexture( params, 'map', pbrSpecularGlossiness.diffuseTexture.index ) );\n\n                }\n\n                params.emissive = new THREE.Color( 0.0, 0.0, 0.0 );\n                params.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\n                params.specular = new THREE.Color( 1.0, 1.0, 1.0 );\n\n                if ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\n\n                    params.specular.fromArray( pbrSpecularGlossiness.specularFactor );\n\n                }\n\n                if ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\n\n                    var specGlossIndex = pbrSpecularGlossiness.specularGlossinessTexture.index;\n                    pending.push( parser.assignTexture( params, 'glossinessMap', specGlossIndex ) );\n                    pending.push( parser.assignTexture( params, 'specularMap', specGlossIndex ) );\n\n                }\n\n                return Promise.all( pending );\n\n            },\n\n            createMaterial: function ( params ) {\n\n                // setup material properties based on MeshStandardMaterial for Specular-Glossiness\n\n                var material = new THREE.ShaderMaterial( {\n                    defines: params.defines,\n                    vertexShader: params.vertexShader,\n                    fragmentShader: params.fragmentShader,\n                    uniforms: params.uniforms,\n                    fog: true,\n                    lights: true,\n                    opacity: params.opacity,\n                    transparent: params.transparent\n                } );\n\n                material.isGLTFSpecularGlossinessMaterial = true;\n\n                material.color = params.color;\n\n                material.map = params.map === undefined ? null : params.map;\n\n                material.lightMap = null;\n                material.lightMapIntensity = 1.0;\n\n                material.aoMap = params.aoMap === undefined ? null : params.aoMap;\n                material.aoMapIntensity = 1.0;\n\n                material.emissive = params.emissive;\n                material.emissiveIntensity = 1.0;\n                material.emissiveMap = params.emissiveMap === undefined ? null : params.emissiveMap;\n\n                material.bumpMap = params.bumpMap === undefined ? null : params.bumpMap;\n                material.bumpScale = 1;\n\n                material.normalMap = params.normalMap === undefined ? null : params.normalMap;\n                if ( params.normalScale ) material.normalScale = params.normalScale;\n\n                material.displacementMap = null;\n                material.displacementScale = 1;\n                material.displacementBias = 0;\n\n                material.specularMap = params.specularMap === undefined ? null : params.specularMap;\n                material.specular = params.specular;\n\n                material.glossinessMap = params.glossinessMap === undefined ? null : params.glossinessMap;\n                material.glossiness = params.glossiness;\n\n                material.alphaMap = null;\n\n                material.envMap = params.envMap === undefined ? null : params.envMap;\n                material.envMapIntensity = 1.0;\n\n                material.refractionRatio = 0.98;\n\n                material.extensions.derivatives = true;\n\n                return material;\n\n            },\n\n            /**\n             * Clones a GLTFSpecularGlossinessMaterial instance. The ShaderMaterial.copy() method can\n             * copy only properties it knows about or inherits, and misses many properties that would\n             * normally be defined by MeshStandardMaterial.\n             *\n             * This method allows GLTFSpecularGlossinessMaterials to be cloned in the process of\n             * loading a glTF model, but cloning later (e.g. by the user) would require these changes\n             * AND also updating `.onBeforeRender` on the parent mesh.\n             *\n             * @param  {THREE.ShaderMaterial} source\n             * @return {THREE.ShaderMaterial}\n             */\n            cloneMaterial: function ( source ) {\n\n                var target = source.clone();\n\n                target.isGLTFSpecularGlossinessMaterial = true;\n\n                var params = this.specularGlossinessParams;\n\n                for ( var i = 0, il = params.length; i < il; i ++ ) {\n\n                    target[ params[ i ] ] = source[ params[ i ] ];\n\n                }\n\n                return target;\n\n            },\n\n            // Here's based on refreshUniformsCommon() and refreshUniformsStandard() in WebGLRenderer.\n            refreshUniforms: function ( renderer, scene, camera, geometry, material, group ) {\n\n                var uniforms = material.uniforms;\n                var defines = material.defines;\n\n                uniforms.opacity.value = material.opacity;\n\n                uniforms.diffuse.value.copy( material.color );\n                uniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\n\n                uniforms.map.value = material.map;\n                uniforms.specularMap.value = material.specularMap;\n                uniforms.alphaMap.value = material.alphaMap;\n\n                uniforms.lightMap.value = material.lightMap;\n                uniforms.lightMapIntensity.value = material.lightMapIntensity;\n\n                uniforms.aoMap.value = material.aoMap;\n                uniforms.aoMapIntensity.value = material.aoMapIntensity;\n\n                // uv repeat and offset setting priorities\n                // 1. color map\n                // 2. specular map\n                // 3. normal map\n                // 4. bump map\n                // 5. alpha map\n                // 6. emissive map\n\n                var uvScaleMap;\n\n                if ( material.map ) {\n\n                    uvScaleMap = material.map;\n\n                } else if ( material.specularMap ) {\n\n                    uvScaleMap = material.specularMap;\n\n                } else if ( material.displacementMap ) {\n\n                    uvScaleMap = material.displacementMap;\n\n                } else if ( material.normalMap ) {\n\n                    uvScaleMap = material.normalMap;\n\n                } else if ( material.bumpMap ) {\n\n                    uvScaleMap = material.bumpMap;\n\n                } else if ( material.glossinessMap ) {\n\n                    uvScaleMap = material.glossinessMap;\n\n                } else if ( material.alphaMap ) {\n\n                    uvScaleMap = material.alphaMap;\n\n                } else if ( material.emissiveMap ) {\n\n                    uvScaleMap = material.emissiveMap;\n\n                }\n\n                if ( uvScaleMap !== undefined ) {\n\n                    // backwards compatibility\n                    if ( uvScaleMap.isWebGLRenderTarget ) {\n\n                        uvScaleMap = uvScaleMap.texture;\n\n                    }\n\n                    var offset;\n                    var repeat;\n\n                    if ( uvScaleMap.matrix !== undefined ) {\n\n                        // > r88.\n\n                        if ( uvScaleMap.matrixAutoUpdate === true ) {\n\n                            offset = uvScaleMap.offset;\n                            repeat = uvScaleMap.repeat;\n                            var rotation = uvScaleMap.rotation;\n                            var center = uvScaleMap.center;\n\n                            uvScaleMap.matrix.setUvTransform( offset.x, offset.y, repeat.x, repeat.y, rotation, center.x, center.y );\n\n                        }\n\n                        uniforms.uvTransform.value.copy( uvScaleMap.matrix );\n\n                    } else {\n\n                        // <= r87. Remove when reasonable.\n\n                        offset = uvScaleMap.offset;\n                        repeat = uvScaleMap.repeat;\n\n                        uniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\n\n                    }\n\n                }\n\n                uniforms.envMap.value = material.envMap;\n                uniforms.envMapIntensity.value = material.envMapIntensity;\n                uniforms.flipEnvMap.value = ( material.envMap && material.envMap.isCubeTexture ) ? - 1 : 1;\n\n                uniforms.refractionRatio.value = material.refractionRatio;\n\n                uniforms.specular.value.copy( material.specular );\n                uniforms.glossiness.value = material.glossiness;\n\n                uniforms.glossinessMap.value = material.glossinessMap;\n\n                uniforms.emissiveMap.value = material.emissiveMap;\n                uniforms.bumpMap.value = material.bumpMap;\n                uniforms.normalMap.value = material.normalMap;\n\n                uniforms.displacementMap.value = material.displacementMap;\n                uniforms.displacementScale.value = material.displacementScale;\n                uniforms.displacementBias.value = material.displacementBias;\n\n                if ( uniforms.glossinessMap.value !== null && defines.USE_GLOSSINESSMAP === undefined ) {\n\n                    defines.USE_GLOSSINESSMAP = '';\n                    // set USE_ROUGHNESSMAP to enable vUv\n                    defines.USE_ROUGHNESSMAP = '';\n\n                }\n\n                if ( uniforms.glossinessMap.value === null && defines.USE_GLOSSINESSMAP !== undefined ) {\n\n                    delete defines.USE_GLOSSINESSMAP;\n                    delete defines.USE_ROUGHNESSMAP;\n\n                }\n\n            }\n\n        };\n\n    }\n\n    /*********************************/\n    /********** INTERNALS ************/\n    /*********************************/\n\n    /* CONSTANTS */\n\n    var WEBGL_CONSTANTS = {\n        FLOAT: 5126,\n        //FLOAT_MAT2: 35674,\n        FLOAT_MAT3: 35675,\n        FLOAT_MAT4: 35676,\n        FLOAT_VEC2: 35664,\n        FLOAT_VEC3: 35665,\n        FLOAT_VEC4: 35666,\n        LINEAR: 9729,\n        REPEAT: 10497,\n        SAMPLER_2D: 35678,\n        POINTS: 0,\n        LINES: 1,\n        LINE_LOOP: 2,\n        LINE_STRIP: 3,\n        TRIANGLES: 4,\n        TRIANGLE_STRIP: 5,\n        TRIANGLE_FAN: 6,\n        UNSIGNED_BYTE: 5121,\n        UNSIGNED_SHORT: 5123\n    };\n\n    var WEBGL_TYPE = {\n        5126: Number,\n        //35674: THREE.Matrix2,\n        35675: THREE.Matrix3,\n        35676: THREE.Matrix4,\n        35664: THREE.Vector2,\n        35665: THREE.Vector3,\n        35666: THREE.Vector4,\n        35678: THREE.Texture\n    };\n\n    var WEBGL_COMPONENT_TYPES = {\n        5120: Int8Array,\n        5121: Uint8Array,\n        5122: Int16Array,\n        5123: Uint16Array,\n        5125: Uint32Array,\n        5126: Float32Array\n    };\n\n    var WEBGL_FILTERS = {\n        9728: THREE.NearestFilter,\n        9729: THREE.LinearFilter,\n        9984: THREE.NearestMipMapNearestFilter,\n        9985: THREE.LinearMipMapNearestFilter,\n        9986: THREE.NearestMipMapLinearFilter,\n        9987: THREE.LinearMipMapLinearFilter\n    };\n\n    var WEBGL_WRAPPINGS = {\n        33071: THREE.ClampToEdgeWrapping,\n        33648: THREE.MirroredRepeatWrapping,\n        10497: THREE.RepeatWrapping\n    };\n\n    var WEBGL_TEXTURE_FORMATS = {\n        6406: THREE.AlphaFormat,\n        6407: THREE.RGBFormat,\n        6408: THREE.RGBAFormat,\n        6409: THREE.LuminanceFormat,\n        6410: THREE.LuminanceAlphaFormat\n    };\n\n    var WEBGL_TEXTURE_DATATYPES = {\n        5121: THREE.UnsignedByteType,\n        32819: THREE.UnsignedShort4444Type,\n        32820: THREE.UnsignedShort5551Type,\n        33635: THREE.UnsignedShort565Type\n    };\n\n    var WEBGL_SIDES = {\n        1028: THREE.BackSide, // Culling front\n        1029: THREE.FrontSide // Culling back\n        //1032: THREE.NoSide   // Culling front and back, what to do?\n    };\n\n    var WEBGL_DEPTH_FUNCS = {\n        512: THREE.NeverDepth,\n        513: THREE.LessDepth,\n        514: THREE.EqualDepth,\n        515: THREE.LessEqualDepth,\n        516: THREE.GreaterEqualDepth,\n        517: THREE.NotEqualDepth,\n        518: THREE.GreaterEqualDepth,\n        519: THREE.AlwaysDepth\n    };\n\n    var WEBGL_BLEND_EQUATIONS = {\n        32774: THREE.AddEquation,\n        32778: THREE.SubtractEquation,\n        32779: THREE.ReverseSubtractEquation\n    };\n\n    var WEBGL_BLEND_FUNCS = {\n        0: THREE.ZeroFactor,\n        1: THREE.OneFactor,\n        768: THREE.SrcColorFactor,\n        769: THREE.OneMinusSrcColorFactor,\n        770: THREE.SrcAlphaFactor,\n        771: THREE.OneMinusSrcAlphaFactor,\n        772: THREE.DstAlphaFactor,\n        773: THREE.OneMinusDstAlphaFactor,\n        774: THREE.DstColorFactor,\n        775: THREE.OneMinusDstColorFactor,\n        776: THREE.SrcAlphaSaturateFactor\n        // The followings are not supported by Three.js yet\n        //32769: CONSTANT_COLOR,\n        //32770: ONE_MINUS_CONSTANT_COLOR,\n        //32771: CONSTANT_ALPHA,\n        //32772: ONE_MINUS_CONSTANT_COLOR\n    };\n\n    var WEBGL_TYPE_SIZES = {\n        'SCALAR': 1,\n        'VEC2': 2,\n        'VEC3': 3,\n        'VEC4': 4,\n        'MAT2': 4,\n        'MAT3': 9,\n        'MAT4': 16\n    };\n\n    var PATH_PROPERTIES = {\n        scale: 'scale',\n        translation: 'position',\n        rotation: 'quaternion',\n        weights: 'morphTargetInfluences'\n    };\n\n    var INTERPOLATION = {\n        CUBICSPLINE: THREE.InterpolateSmooth,\n        LINEAR: THREE.InterpolateLinear,\n        STEP: THREE.InterpolateDiscrete\n    };\n\n    var STATES_ENABLES = {\n        2884: 'CULL_FACE',\n        2929: 'DEPTH_TEST',\n        3042: 'BLEND',\n        3089: 'SCISSOR_TEST',\n        32823: 'POLYGON_OFFSET_FILL',\n        32926: 'SAMPLE_ALPHA_TO_COVERAGE'\n    };\n\n    var ALPHA_MODES = {\n        OPAQUE: 'OPAQUE',\n        MASK: 'MASK',\n        BLEND: 'BLEND'\n    };\n\n    /* UTILITY FUNCTIONS */\n\n    function resolveURL( url, path ) {\n\n        // Invalid URL\n        if ( typeof url !== 'string' || url === '' ) return '';\n\n        // Absolute URL http://,https://,//\n        if ( /^(https?:)?\\/\\//i.test( url ) ) return url;\n\n        // Data URI\n        if ( /^data:.*,.*$/i.test( url ) ) return url;\n\n        // Blob URL\n        if ( /^blob:.*$/i.test( url ) ) return url;\n\n        // Relative URL\n        return path + url;\n\n    }\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n     */\n    function createDefaultMaterial() {\n\n        return new THREE.MeshStandardMaterial( {\n            color: 0xFFFFFF,\n            emissive: 0x000000,\n            metalness: 1,\n            roughness: 1,\n            transparent: false,\n            depthTest: true,\n            side: THREE.FrontSide\n        } );\n\n    }\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n     *\n     * TODO: Implement support for morph targets on TANGENT attribute.\n     *\n     * @param {THREE.Mesh} mesh\n     * @param {GLTF.Mesh} meshDef\n     * @param {GLTF.Primitive} primitiveDef\n     * @param {Array<THREE.BufferAttribute>} accessors\n     */\n    function addMorphTargets( mesh, meshDef, primitiveDef, accessors ) {\n\n        var geometry = mesh.geometry;\n        var material = mesh.material;\n\n        var targets = primitiveDef.targets;\n        var morphAttributes = geometry.morphAttributes;\n\n        morphAttributes.position = [];\n        morphAttributes.normal = [];\n\n        material.morphTargets = true;\n\n        for ( var i = 0, il = targets.length; i < il; i ++ ) {\n\n            var target = targets[ i ];\n            var attributeName = 'morphTarget' + i;\n\n            var positionAttribute, normalAttribute;\n\n            if ( target.POSITION !== undefined ) {\n\n                // Three.js morph formula is\n                //   position\n                //     + weight0 * ( morphTarget0 - position )\n                //     + weight1 * ( morphTarget1 - position )\n                //     ...\n                // while the glTF one is\n                //   position\n                //     + weight0 * morphTarget0\n                //     + weight1 * morphTarget1\n                //     ...\n                // then adding position to morphTarget.\n                // So morphTarget value will depend on mesh's position, then cloning attribute\n                // for the case if attribute is shared among two or more meshes.\n\n                positionAttribute = accessors[ target.POSITION ].clone();\n                var position = geometry.attributes.position;\n\n                for ( var j = 0, jl = positionAttribute.count; j < jl; j ++ ) {\n\n                    positionAttribute.setXYZ(\n                        j,\n                        positionAttribute.getX( j ) + position.getX( j ),\n                        positionAttribute.getY( j ) + position.getY( j ),\n                        positionAttribute.getZ( j ) + position.getZ( j )\n                    );\n\n                }\n\n            } else if ( geometry.attributes.position ) {\n\n                // Copying the original position not to affect the final position.\n                // See the formula above.\n                positionAttribute = geometry.attributes.position.clone();\n\n            }\n\n            if ( positionAttribute !== undefined ) {\n\n                positionAttribute.name = attributeName;\n                morphAttributes.position.push( positionAttribute );\n\n            }\n\n            if ( target.NORMAL !== undefined ) {\n\n                material.morphNormals = true;\n\n                // see target.POSITION's comment\n\n                normalAttribute = accessors[ target.NORMAL ].clone();\n                var normal = geometry.attributes.normal;\n\n                for ( var j = 0, jl = normalAttribute.count; j < jl; j ++ ) {\n\n                    normalAttribute.setXYZ(\n                        j,\n                        normalAttribute.getX( j ) + normal.getX( j ),\n                        normalAttribute.getY( j ) + normal.getY( j ),\n                        normalAttribute.getZ( j ) + normal.getZ( j )\n                    );\n\n                }\n\n            } else if ( geometry.attributes.normal !== undefined ) {\n\n                normalAttribute = geometry.attributes.normal.clone();\n\n            }\n\n            if ( normalAttribute !== undefined ) {\n\n                normalAttribute.name = attributeName;\n                morphAttributes.normal.push( normalAttribute );\n\n            }\n\n        }\n\n        mesh.updateMorphTargets();\n\n        if ( meshDef.weights !== undefined ) {\n\n            for ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n                mesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n            }\n\n        }\n\n    }\n\n    function isPrimitiveEqual( a, b ) {\n\n        if ( a.indices !== b.indices ) {\n\n            return false;\n\n        }\n\n        var attribA = a.attributes || {};\n        var attribB = b.attributes || {};\n        var keysA = Object.keys( attribA );\n        var keysB = Object.keys( attribB );\n\n        if ( keysA.length !== keysB.length ) {\n\n            return false;\n\n        }\n\n        for ( var i = 0, il = keysA.length; i < il; i ++ ) {\n\n            var key = keysA[ i ];\n\n            if ( attribA[ key ] !== attribB[ key ] ) {\n\n                return false;\n\n            }\n\n        }\n\n        return true;\n\n    }\n\n    function getCachedGeometry( cache, newPrimitive ) {\n\n        for ( var i = 0, il = cache.length; i < il; i ++ ) {\n\n            var cached = cache[ i ];\n\n            if ( isPrimitiveEqual( cached.primitive, newPrimitive ) ) {\n\n                return cached.geometry;\n\n            }\n\n        }\n\n        return null;\n\n    }\n\n    /* GLTF PARSER */\n\n    function GLTFParser( json, extensions, options ) {\n\n        this.json = json || {};\n        this.extensions = extensions || {};\n        this.options = options || {};\n\n        // loader object cache\n        this.cache = new GLTFRegistry();\n\n        // BufferGeometry caching\n        this.primitiveCache = [];\n\n        this.textureLoader = new THREE.TextureLoader( this.options.manager );\n        this.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\n        this.fileLoader = new THREE.FileLoader( this.options.manager );\n        this.fileLoader.setResponseType( 'arraybuffer' );\n\n    }\n\n    GLTFParser.prototype.parse = function ( onLoad, onError ) {\n\n        var json = this.json;\n        var parser = this;\n\n        // Clear the loader cache\n        this.cache.removeAll();\n\n        // Mark the special nodes/meshes in json for efficient parse\n        this.markDefs();\n\n        // Fire the callback on complete\n        this.getMultiDependencies( [\n\n            'scene',\n            'animation',\n            'camera'\n\n        ] ).then( function ( dependencies ) {\n\n            var scenes = dependencies.scenes || [];\n            var scene = scenes[ json.scene || 0 ];\n            var animations = dependencies.animations || [];\n            var asset = json.asset;\n            var cameras = dependencies.cameras || [];\n\n            onLoad( scene, scenes, cameras, animations, asset );\n\n        } ).catch( onError );\n\n    };\n\n    /**\n     * Marks the special nodes/meshes in json for efficient parse.\n     */\n    GLTFParser.prototype.markDefs = function () {\n\n        var nodeDefs = this.json.nodes || [];\n        var skinDefs = this.json.skins || [];\n        var meshDefs = this.json.meshes || [];\n\n        var meshReferences = {};\n        var meshUses = {};\n\n        // Nothing in the node definition indicates whether it is a Bone or an\n        // Object3D. Use the skins' joint references to mark bones.\n        for ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n            var joints = skinDefs[ skinIndex ].joints;\n\n            for ( var i = 0, il = joints.length; i < il; i ++ ) {\n\n                nodeDefs[ joints[ i ] ].isBone = true;\n\n            }\n\n        }\n\n        // Meshes can (and should) be reused by multiple nodes in a glTF asset. To\n        // avoid having more than one THREE.Mesh with the same name, count\n        // references and rename instances below.\n        //\n        // Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n        for ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n            var nodeDef = nodeDefs[ nodeIndex ];\n\n            if ( nodeDef.mesh !== undefined ) {\n\n                if ( meshReferences[ nodeDef.mesh ] === undefined ) {\n\n                    meshReferences[ nodeDef.mesh ] = meshUses[ nodeDef.mesh ] = 0;\n\n                }\n\n                meshReferences[ nodeDef.mesh ] ++;\n\n                // Nothing in the mesh definition indicates whether it is\n                // a SkinnedMesh or Mesh. Use the node's mesh reference\n                // to mark SkinnedMesh if node has skin.\n                if ( nodeDef.skin !== undefined ) {\n\n                    meshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n                }\n\n            }\n\n        }\n\n        this.json.meshReferences = meshReferences;\n        this.json.meshUses = meshUses;\n\n    };\n\n    /**\n     * Requests the specified dependency asynchronously, with caching.\n     * @param {string} type\n     * @param {number} index\n     * @return {Promise<Object>}\n     */\n    GLTFParser.prototype.getDependency = function ( type, index ) {\n\n        var cacheKey = type + ':' + index;\n        var dependency = this.cache.get( cacheKey );\n\n        if ( ! dependency ) {\n\n            var fnName = 'load' + type.charAt( 0 ).toUpperCase() + type.slice( 1 );\n            dependency = this[ fnName ]( index );\n            this.cache.add( cacheKey, dependency );\n\n        }\n\n        return dependency;\n\n    };\n\n    /**\n     * Requests all dependencies of the specified type asynchronously, with caching.\n     * @param {string} type\n     * @return {Promise<Array<Object>>}\n     */\n    GLTFParser.prototype.getDependencies = function ( type ) {\n\n        var dependencies = this.cache.get( type );\n\n        if ( ! dependencies ) {\n\n            var parser = this;\n            var defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n            dependencies = Promise.all( defs.map( function ( def, index ) {\n\n                return parser.getDependency( type, index );\n\n            } ) );\n\n            this.cache.add( type, dependencies );\n\n        }\n\n        return dependencies;\n\n    };\n\n    /**\n     * Requests all multiple dependencies of the specified types asynchronously, with caching.\n     * @param {Array<string>} types\n     * @return {Promise<Object<Array<Object>>>}\n     */\n    GLTFParser.prototype.getMultiDependencies = function ( types ) {\n\n        var results = {};\n        var pendings = [];\n\n        for ( var i = 0, il = types.length; i < il; i ++ ) {\n\n            var type = types[ i ];\n            var value = this.getDependencies( type );\n\n            value = value.then( function ( key, value ) {\n\n                results[ key ] = value;\n\n            }.bind( this, type + ( type === 'mesh' ? 'es' : 's' ) ) );\n\n            pendings.push( value );\n\n        }\n\n        return Promise.all( pendings ).then( function () {\n\n            return results;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n     * @param {number} bufferIndex\n     * @return {Promise<ArrayBuffer>}\n     */\n    GLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\n\n        var bufferDef = this.json.buffers[ bufferIndex ];\n        var loader = this.fileLoader;\n\n        if ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n            throw new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n        }\n\n        // If present, GLB container is required to be the first buffer.\n        if ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n            return Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n        }\n\n        var options = this.options;\n\n        return new Promise( function ( resolve, reject ) {\n\n            loader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n                reject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n            } );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n     * @param {number} bufferViewIndex\n     * @return {Promise<ArrayBuffer>}\n     */\n    GLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\n\n        var bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n        return this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n            var byteLength = bufferViewDef.byteLength || 0;\n            var byteOffset = bufferViewDef.byteOffset || 0;\n            return buffer.slice( byteOffset, byteOffset + byteLength );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n     * @param {number} accessorIndex\n     * @return {Promise<THREE.BufferAttribute|THREE.InterleavedBufferAttribute>}\n     */\n    GLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\n\n        var json = this.json;\n\n        var accessorDef = this.json.accessors[ accessorIndex ];\n\n        var pendingBufferViews = [];\n\n        if ( accessorDef.bufferView !== undefined ) {\n\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n        } else {\n\n            pendingBufferViews.push( null );\n\n        }\n\n        if ( accessorDef.sparse !== undefined ) {\n\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n        }\n\n        return Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n            var bufferView = bufferViews[ 0 ];\n\n            var itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n            var TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n            // For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n            var elementBytes = TypedArray.BYTES_PER_ELEMENT;\n            var itemBytes = elementBytes * itemSize;\n            var byteStride = json.bufferViews[ accessorDef.bufferView ].byteStride;\n            var normalized = accessorDef.normalized === true;\n            var array, bufferAttribute;\n\n            // The buffer is not interleaved if the stride is the item size in bytes.\n            if ( byteStride && byteStride !== itemBytes ) {\n\n                // Use the full buffer if it's interleaved.\n                array = new TypedArray( bufferView );\n\n                // Integer parameters to IB/IBA are in array elements, not bytes.\n                var ib = new THREE.InterleavedBuffer( array, byteStride / elementBytes );\n\n                bufferAttribute = new THREE.InterleavedBufferAttribute( ib, itemSize, accessorDef.byteOffset / elementBytes, normalized );\n\n            } else {\n\n                if ( bufferView === null ) {\n\n                    array = new TypedArray( accessorDef.count * itemSize );\n\n                } else {\n\n                    array = new TypedArray( bufferView, accessorDef.byteOffset, accessorDef.count * itemSize );\n\n                }\n\n                bufferAttribute = new THREE.BufferAttribute( array, itemSize, normalized );\n\n            }\n\n            // https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n            if ( accessorDef.sparse !== undefined ) {\n\n                var itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n                var TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n                var byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n                var byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n                var sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n                var sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n                if ( bufferView !== null ) {\n\n                    // Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n                    bufferAttribute.setArray( bufferAttribute.array.slice() );\n\n                }\n\n                for ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n                    var index = sparseIndices[ i ];\n\n                    bufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n                    if ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n                    if ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n                    if ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n                    if ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n                }\n\n            }\n\n            return bufferAttribute;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n     * @param {number} textureIndex\n     * @return {Promise<THREE.Texture>}\n     */\n    GLTFParser.prototype.loadTexture = function ( textureIndex ) {\n\n        var parser = this;\n        var json = this.json;\n        var options = this.options;\n        var textureLoader = this.textureLoader;\n\n        var URL = window.URL || window.webkitURL;\n\n        var textureDef = json.textures[ textureIndex ];\n        var source = json.images[ textureDef.source ];\n        var sourceURI = source.uri;\n        var isObjectURL = false;\n\n        if ( source.bufferView !== undefined ) {\n\n            // Load binary image data from bufferView, if provided.\n\n            sourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\n\n                isObjectURL = true;\n                var blob = new Blob( [ bufferView ], { type: source.mimeType } );\n                sourceURI = URL.createObjectURL( blob );\n                return sourceURI;\n\n            } );\n\n        }\n\n        return Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n            // Load Texture resource.\n\n            var loader = THREE.Loader.Handlers.get( sourceURI ) || textureLoader;\n\n            return new Promise( function ( resolve, reject ) {\n\n                loader.load( resolveURL( sourceURI, options.path ), resolve, undefined, reject );\n\n            } );\n\n        } ).then( function ( texture ) {\n\n            // Clean up resources and configure Texture.\n\n            if ( isObjectURL === true ) {\n\n                URL.revokeObjectURL( sourceURI );\n\n            }\n\n            texture.flipY = false;\n\n            if ( textureDef.name !== undefined ) texture.name = textureDef.name;\n\n            texture.format = textureDef.format !== undefined ? WEBGL_TEXTURE_FORMATS[ textureDef.format ] : THREE.RGBAFormat;\n\n            if ( textureDef.internalFormat !== undefined && texture.format !== WEBGL_TEXTURE_FORMATS[ textureDef.internalFormat ] ) {\n\n                console.warn( 'THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. ' +\n                    'internalFormat will be forced to be the same value as format.' );\n\n            }\n\n            texture.type = textureDef.type !== undefined ? WEBGL_TEXTURE_DATATYPES[ textureDef.type ] : THREE.UnsignedByteType;\n\n            var samplers = json.samplers || {};\n            var sampler = samplers[ textureDef.sampler ] || {};\n\n            texture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || THREE.LinearFilter;\n            texture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || THREE.LinearMipMapLinearFilter;\n            texture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || THREE.RepeatWrapping;\n            texture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || THREE.RepeatWrapping;\n\n            return texture;\n\n        } );\n\n    };\n\n    /**\n     * Asynchronously assigns a texture to the given material parameters.\n     * @param {Object} materialParams\n     * @param {string} textureName\n     * @param {number} textureIndex\n     * @return {Promise}\n     */\n    GLTFParser.prototype.assignTexture = function ( materialParams, textureName, textureIndex ) {\n\n        return this.getDependency( 'texture', textureIndex ).then( function ( texture ) {\n\n            materialParams[ textureName ] = texture;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n     * @param {number} materialIndex\n     * @return {Promise<THREE.Material>}\n     */\n    GLTFParser.prototype.loadMaterial = function ( materialIndex ) {\n\n        var parser = this;\n        var json = this.json;\n        var extensions = this.extensions;\n        var materialDef = this.json.materials[ materialIndex ];\n\n        var materialType;\n        var materialParams = {};\n        var materialExtensions = materialDef.extensions || {};\n\n        var pending = [];\n\n        if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) {\n\n            var khcExtension = extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ];\n            materialType = khcExtension.getMaterialType( materialDef );\n            pending.push( khcExtension.extendParams( materialParams, materialDef, parser ) );\n\n        } else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\n\n            var sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n            materialType = sgExtension.getMaterialType( materialDef );\n            pending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\n\n        } else if ( materialDef.pbrMetallicRoughness !== undefined ) {\n\n            // Specification:\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n            materialType = THREE.MeshStandardMaterial;\n\n            var metallicRoughness = materialDef.pbrMetallicRoughness;\n\n            materialParams.color = new THREE.Color( 1.0, 1.0, 1.0 );\n            materialParams.opacity = 1.0;\n\n            if ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n                var array = metallicRoughness.baseColorFactor;\n\n                materialParams.color.fromArray( array );\n                materialParams.opacity = array[ 3 ];\n\n            }\n\n            if ( metallicRoughness.baseColorTexture !== undefined ) {\n\n                pending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture.index ) );\n\n            }\n\n            materialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n            materialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n            if ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n                var textureIndex = metallicRoughness.metallicRoughnessTexture.index;\n                pending.push( parser.assignTexture( materialParams, 'metalnessMap', textureIndex ) );\n                pending.push( parser.assignTexture( materialParams, 'roughnessMap', textureIndex ) );\n\n            }\n\n        } else {\n\n            materialType = THREE.MeshPhongMaterial;\n\n        }\n\n        if ( materialDef.doubleSided === true ) {\n\n            materialParams.side = THREE.DoubleSide;\n\n        }\n\n        var alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n        if ( alphaMode === ALPHA_MODES.BLEND ) {\n\n            materialParams.transparent = true;\n\n        } else {\n\n            materialParams.transparent = false;\n\n            if ( alphaMode === ALPHA_MODES.MASK ) {\n\n                materialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n            }\n\n        }\n\n        if ( materialDef.normalTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture.index ) );\n\n            materialParams.normalScale = new THREE.Vector2( 1, 1 );\n\n            if ( materialDef.normalTexture.scale !== undefined ) {\n\n                materialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\n\n            }\n\n        }\n\n        if ( materialDef.occlusionTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture.index ) );\n\n            if ( materialDef.occlusionTexture.strength !== undefined ) {\n\n                materialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n            }\n\n        }\n\n        if ( materialDef.emissiveFactor !== undefined ) {\n\n            if ( materialType === THREE.MeshBasicMaterial ) {\n\n                materialParams.color = new THREE.Color().fromArray( materialDef.emissiveFactor );\n\n            } else {\n\n                materialParams.emissive = new THREE.Color().fromArray( materialDef.emissiveFactor );\n\n            }\n\n        }\n\n        if ( materialDef.emissiveTexture !== undefined ) {\n\n            if ( materialType === THREE.MeshBasicMaterial ) {\n\n                pending.push( parser.assignTexture( materialParams, 'map', materialDef.emissiveTexture.index ) );\n\n            } else {\n\n                pending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture.index ) );\n\n            }\n\n        }\n\n        return Promise.all( pending ).then( function () {\n\n            var material;\n\n            if ( materialType === THREE.ShaderMaterial ) {\n\n                material = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\n\n            } else {\n\n                material = new materialType( materialParams );\n\n            }\n\n            if ( materialDef.name !== undefined ) material.name = materialDef.name;\n\n            // Normal map textures use OpenGL conventions:\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materialnormaltexture\n            if ( material.normalScale ) {\n\n                material.normalScale.x = - material.normalScale.x;\n\n            }\n\n            // emissiveTexture and baseColorTexture use sRGB encoding.\n            if ( material.map ) material.map.encoding = THREE.sRGBEncoding;\n            if ( material.emissiveMap ) material.emissiveMap.encoding = THREE.sRGBEncoding;\n\n            if ( materialDef.extras ) material.userData = materialDef.extras;\n\n            return material;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n     * @param {Array<Object>} primitives\n     * @return {Promise<Array<THREE.BufferGeometry>>}\n     */\n    GLTFParser.prototype.loadGeometries = function ( primitives ) {\n\n        var cache = this.primitiveCache;\n\n        return this.getDependencies( 'accessor' ).then( function ( accessors ) {\n\n            var geometries = [];\n\n            for ( var i = 0, il = primitives.length; i < il; i ++ ) {\n\n                var primitive = primitives[ i ];\n\n                // See if we've already created this geometry\n                var cached = getCachedGeometry( cache, primitive );\n\n                if ( cached ) {\n\n                    // Use the cached geometry if it exists\n                    geometries.push( cached );\n\n                } else {\n\n                    // Otherwise create a new geometry\n                    var geometry = new THREE.BufferGeometry();\n\n                    var attributes = primitive.attributes;\n\n                    for ( var attributeId in attributes ) {\n\n                        var attributeEntry = attributes[ attributeId ];\n\n                        var bufferAttribute = accessors[ attributeEntry ];\n\n                        switch ( attributeId ) {\n\n                            case 'POSITION':\n\n                                geometry.addAttribute( 'position', bufferAttribute );\n                                break;\n\n                            case 'NORMAL':\n\n                                geometry.addAttribute( 'normal', bufferAttribute );\n                                break;\n\n                            case 'TEXCOORD_0':\n                            case 'TEXCOORD0':\n                            case 'TEXCOORD':\n\n                                geometry.addAttribute( 'uv', bufferAttribute );\n                                break;\n\n                            case 'TEXCOORD_1':\n\n                                geometry.addAttribute( 'uv2', bufferAttribute );\n                                break;\n\n                            case 'COLOR_0':\n                            case 'COLOR0':\n                            case 'COLOR':\n\n                                geometry.addAttribute( 'color', bufferAttribute );\n                                break;\n\n                            case 'WEIGHTS_0':\n                            case 'WEIGHT': // WEIGHT semantic deprecated.\n\n                                geometry.addAttribute( 'skinWeight', bufferAttribute );\n                                break;\n\n                            case 'JOINTS_0':\n                            case 'JOINT': // JOINT semantic deprecated.\n\n                                geometry.addAttribute( 'skinIndex', bufferAttribute );\n                                break;\n\n                        }\n\n                    }\n\n                    if ( primitive.indices !== undefined ) {\n\n                        geometry.setIndex( accessors[ primitive.indices ] );\n\n                    }\n\n                    // Cache this geometry\n                    cache.push( {\n\n                        primitive: primitive,\n                        geometry: geometry\n\n                    } );\n\n                    geometries.push( geometry );\n\n                }\n\n            }\n\n            return geometries;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n     * @param {number} meshIndex\n     * @return {Promise<THREE.Group|THREE.Mesh|THREE.SkinnedMesh>}\n     */\n    GLTFParser.prototype.loadMesh = function ( meshIndex ) {\n\n        var scope = this;\n        var json = this.json;\n        var extensions = this.extensions;\n\n        var meshDef = this.json.meshes[ meshIndex ];\n\n        return this.getMultiDependencies( [\n\n            'accessor',\n            'material'\n\n        ] ).then( function ( dependencies ) {\n\n            var group = new THREE.Group();\n\n            var primitives = meshDef.primitives;\n\n            return scope.loadGeometries( primitives ).then( function ( geometries ) {\n\n                for ( var i = 0, il = primitives.length; i < il; i ++ ) {\n\n                    var primitive = primitives[ i ];\n                    var geometry = geometries[ i ];\n\n                    var material = primitive.material === undefined\n                        ? createDefaultMaterial()\n                        : dependencies.materials[ primitive.material ];\n\n                    if ( material.aoMap\n                        && geometry.attributes.uv2 === undefined\n                        && geometry.attributes.uv !== undefined ) {\n\n                        console.log( 'THREE.GLTFLoader: Duplicating UVs to support aoMap.' );\n                        geometry.addAttribute( 'uv2', new THREE.BufferAttribute( geometry.attributes.uv.array, 2 ) );\n\n                    }\n\n                    // If the material will be modified later on, clone it now.\n                    var useVertexColors = geometry.attributes.color !== undefined;\n                    var useFlatShading = geometry.attributes.normal === undefined;\n                    var useSkinning = meshDef.isSkinnedMesh === true;\n                    var useMorphTargets = primitive.targets !== undefined;\n\n                    if ( useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\n\n                        if ( material.isGLTFSpecularGlossinessMaterial ) {\n\n                            var specGlossExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n                            material = specGlossExtension.cloneMaterial( material );\n\n                        } else {\n\n                            material = material.clone();\n\n                        }\n\n                    }\n\n                    if ( useVertexColors ) {\n\n                        material.vertexColors = THREE.VertexColors;\n                        material.needsUpdate = true;\n\n                    }\n\n                    if ( useFlatShading ) {\n\n                        material.flatShading = true;\n\n                    }\n\n                    var mesh;\n\n                    if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n                        primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n                        primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n                        primitive.mode === undefined ) {\n\n                        if ( useSkinning ) {\n\n                            mesh = new THREE.SkinnedMesh( geometry, material );\n                            material.skinning = true;\n\n                        } else {\n\n                            mesh = new THREE.Mesh( geometry, material );\n\n                        }\n\n                        if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n                            mesh.drawMode = THREE.TriangleStripDrawMode;\n\n                        } else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n                            mesh.drawMode = THREE.TriangleFanDrawMode;\n\n                        }\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n                        mesh = new THREE.LineSegments( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n                        mesh = new THREE.Line( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n                        mesh = new THREE.LineLoop( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n                        mesh = new THREE.Points( geometry, material );\n\n                    } else {\n\n                        throw new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n                    }\n\n                    mesh.name = meshDef.name || ( 'mesh_' + meshIndex );\n\n                    if ( useMorphTargets ) {\n\n                        addMorphTargets( mesh, meshDef, primitive, dependencies.accessors );\n\n                    }\n\n                    if ( meshDef.extras !== undefined ) mesh.userData = meshDef.extras;\n                    if ( primitive.extras !== undefined ) mesh.geometry.userData = primitive.extras;\n\n                    // for Specular-Glossiness.\n                    if ( material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                        mesh.onBeforeRender = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].refreshUniforms;\n\n                    }\n\n                    if ( primitives.length > 1 ) {\n\n                        mesh.name += '_' + i;\n\n                        group.add( mesh );\n\n                    } else {\n\n                        return mesh;\n\n                    }\n\n                }\n\n                return group;\n\n            } );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n     * @param {number} cameraIndex\n     * @return {Promise<THREE.Camera>}\n     */\n    GLTFParser.prototype.loadCamera = function ( cameraIndex ) {\n\n        var camera;\n        var cameraDef = this.json.cameras[ cameraIndex ];\n        var params = cameraDef[ cameraDef.type ];\n\n        if ( ! params ) {\n\n            console.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n            return;\n\n        }\n\n        if ( cameraDef.type === 'perspective' ) {\n\n            var aspectRatio = params.aspectRatio || 1;\n            var xfov = params.yfov * aspectRatio;\n\n            camera = new THREE.PerspectiveCamera( THREE.Math.radToDeg( xfov ), aspectRatio, params.znear || 1, params.zfar || 2e6 );\n\n        } else if ( cameraDef.type === 'orthographic' ) {\n\n            camera = new THREE.OrthographicCamera( params.xmag / - 2, params.xmag / 2, params.ymag / 2, params.ymag / - 2, params.znear, params.zfar );\n\n        }\n\n        if ( cameraDef.name !== undefined ) camera.name = cameraDef.name;\n        if ( cameraDef.extras ) camera.userData = cameraDef.extras;\n\n        return Promise.resolve( camera );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n     * @param {number} skinIndex\n     * @return {Promise<Object>}\n     */\n    GLTFParser.prototype.loadSkin = function ( skinIndex ) {\n\n        var skinDef = this.json.skins[ skinIndex ];\n\n        var skinEntry = { joints: skinDef.joints };\n\n        if ( skinDef.inverseBindMatrices === undefined ) {\n\n            return Promise.resolve( skinEntry );\n\n        }\n\n        return this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\n\n            skinEntry.inverseBindMatrices = accessor;\n\n            return skinEntry;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n     * @param {number} animationIndex\n     * @return {Promise<THREE.AnimationClip>}\n     */\n    GLTFParser.prototype.loadAnimation = function ( animationIndex ) {\n\n        var json = this.json;\n\n        var animationDef = this.json.animations[ animationIndex ];\n\n        return this.getMultiDependencies( [\n\n            'accessor',\n            'node'\n\n        ] ).then( function ( dependencies ) {\n\n            var tracks = [];\n\n            for ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n                var channel = animationDef.channels[ i ];\n                var sampler = animationDef.samplers[ channel.sampler ];\n\n                if ( sampler ) {\n\n                    var target = channel.target;\n                    var name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\n                    var input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n                    var output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n                    var inputAccessor = dependencies.accessors[ input ];\n                    var outputAccessor = dependencies.accessors[ output ];\n\n                    var node = dependencies.nodes[ name ];\n\n                    if ( node ) {\n\n                        node.updateMatrix();\n                        node.matrixAutoUpdate = true;\n\n                        var TypedKeyframeTrack;\n\n                        switch ( PATH_PROPERTIES[ target.path ] ) {\n\n                            case PATH_PROPERTIES.weights:\n\n                                TypedKeyframeTrack = THREE.NumberKeyframeTrack;\n                                break;\n\n                            case PATH_PROPERTIES.rotation:\n\n                                TypedKeyframeTrack = THREE.QuaternionKeyframeTrack;\n                                break;\n\n                            case PATH_PROPERTIES.position:\n                            case PATH_PROPERTIES.scale:\n                            default:\n\n                                TypedKeyframeTrack = THREE.VectorKeyframeTrack;\n                                break;\n\n                        }\n\n                        var targetName = node.name ? node.name : node.uuid;\n\n                        if ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n                            var itemSize = outputAccessor.itemSize;\n                            var TypedArray = outputAccessor.array.constructor;\n                            var outputAccessorValues = new TypedArray( outputAccessor.count * itemSize / 3 );\n\n                            // Layout of keyframe output values for CUBICSPLINE animations:\n                            //\n                            //   [ inTangent1, splineVertex1, outTangent1, inTangent2, splineVertex2, ... ]\n                            //\n                            // THREE.KeyframeTrack infers tangents from the spline vertices when interpolating:\n                            // those values are extracted below. This still guarantees smooth curves, but does\n                            // throw away more precise information in the tangents. In the future, consider\n                            // re-sampling at a higher framerate using the tangents provided.\n                            //\n                            // See: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\n\n                            for ( var j = 0, jl = outputAccessor.count; j < jl; j += 3 ) {\n\n                                outputAccessorValues[ j * itemSize / 3 ] = outputAccessor.getX( j + 1 );\n                                if ( itemSize > 1 ) outputAccessorValues[ j * itemSize / 3 + 1 ] = outputAccessor.getY( j + 1 );\n                                if ( itemSize > 2 ) outputAccessorValues[ j * itemSize / 3 + 2 ] = outputAccessor.getZ( j + 1 );\n                                if ( itemSize > 3 ) outputAccessorValues[ j * itemSize / 3 + 3 ] = outputAccessor.getW( j + 1 );\n\n                            }\n\n                            outputAccessor = new THREE.BufferAttribute( outputAccessorValues, itemSize / 3, outputAccessor.normalized );\n\n                        }\n\n                        var interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : THREE.InterpolateLinear;\n\n                        var targetNames = [];\n\n                        if ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n                            // node should be THREE.Group here but\n                            // PATH_PROPERTIES.weights(morphTargetInfluences) should be\n                            // the property of a mesh object under node.\n                            // So finding targets here.\n\n                            node.traverse( function ( object ) {\n\n                                if ( object.isMesh === true && object.material.morphTargets === true ) {\n\n                                    targetNames.push( object.name ? object.name : object.uuid );\n\n                                }\n\n                            } );\n\n                        } else {\n\n                            targetNames.push( targetName );\n\n                        }\n\n                        // KeyframeTrack.optimize() will modify given 'times' and 'values'\n                        // buffers before creating a truncated copy to keep. Because buffers may\n                        // be reused by other tracks, make copies here.\n                        for ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n                            tracks.push( new TypedKeyframeTrack(\n                                targetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n                                THREE.AnimationUtils.arraySlice( inputAccessor.array, 0 ),\n                                THREE.AnimationUtils.arraySlice( outputAccessor.array, 0 ),\n                                interpolation\n                            ) );\n\n                        }\n\n                    }\n\n                }\n\n            }\n\n            var name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\n\n            return new THREE.AnimationClip( name, undefined, tracks );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n     * @param {number} nodeIndex\n     * @return {Promise<THREE.Object3D>}\n     */\n    GLTFParser.prototype.loadNode = function ( nodeIndex ) {\n\n        var json = this.json;\n        var extensions = this.extensions;\n\n        var meshReferences = this.json.meshReferences;\n        var meshUses = this.json.meshUses;\n\n        var nodeDef = this.json.nodes[ nodeIndex ];\n\n        return this.getMultiDependencies( [\n\n            'mesh',\n            'skin',\n            'camera'\n\n        ] ).then( function ( dependencies ) {\n\n            var node;\n\n            if ( nodeDef.isBone === true ) {\n\n                node = new THREE.Bone();\n\n            } else if ( nodeDef.mesh !== undefined ) {\n\n                var mesh = dependencies.meshes[ nodeDef.mesh ];\n\n                node = mesh.clone();\n\n                // for Specular-Glossiness\n                if ( mesh.isGroup === true ) {\n\n                    for ( var i = 0, il = mesh.children.length; i < il; i ++ ) {\n\n                        var child = mesh.children[ i ];\n\n                        if ( child.material && child.material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                            node.children[ i ].onBeforeRender = child.onBeforeRender;\n\n                        }\n\n                    }\n\n                } else {\n\n                    if ( mesh.material && mesh.material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                        node.onBeforeRender = mesh.onBeforeRender;\n\n                    }\n\n                }\n\n                if ( meshReferences[ nodeDef.mesh ] > 1 ) {\n\n                    node.name += '_instance_' + meshUses[ nodeDef.mesh ] ++;\n\n                }\n\n            } else if ( nodeDef.camera !== undefined ) {\n\n                node = dependencies.cameras[ nodeDef.camera ];\n\n            } else if ( nodeDef.extensions\n                && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\n                && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\n\n                var lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\n                node = lights[ nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ];\n\n            } else {\n\n                node = new THREE.Object3D();\n\n            }\n\n            if ( nodeDef.name !== undefined ) {\n\n                node.name = THREE.PropertyBinding.sanitizeNodeName( nodeDef.name );\n\n            }\n\n            if ( nodeDef.extras ) node.userData = nodeDef.extras;\n\n            if ( nodeDef.matrix !== undefined ) {\n\n                var matrix = new THREE.Matrix4();\n                matrix.fromArray( nodeDef.matrix );\n                node.applyMatrix( matrix );\n\n            } else {\n\n                if ( nodeDef.translation !== undefined ) {\n\n                    node.position.fromArray( nodeDef.translation );\n\n                }\n\n                if ( nodeDef.rotation !== undefined ) {\n\n                    node.quaternion.fromArray( nodeDef.rotation );\n\n                }\n\n                if ( nodeDef.scale !== undefined ) {\n\n                    node.scale.fromArray( nodeDef.scale );\n\n                }\n\n            }\n\n            return node;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n     * @param {number} sceneIndex\n     * @return {Promise<THREE.Scene>}\n     */\n    GLTFParser.prototype.loadScene = function () {\n\n        // scene node hierachy builder\n\n        function buildNodeHierachy( nodeId, parentObject, json, allNodes, skins ) {\n\n            var node = allNodes[ nodeId ];\n            var nodeDef = json.nodes[ nodeId ];\n\n            // build skeleton here as well\n\n            if ( nodeDef.skin !== undefined ) {\n\n                var meshes = node.isGroup === true ? node.children : [ node ];\n\n                for ( var i = 0, il = meshes.length; i < il; i ++ ) {\n\n                    var mesh = meshes[ i ];\n                    var skinEntry = skins[ nodeDef.skin ];\n\n                    var bones = [];\n                    var boneInverses = [];\n\n                    for ( var j = 0, jl = skinEntry.joints.length; j < jl; j ++ ) {\n\n                        var jointId = skinEntry.joints[ j ];\n                        var jointNode = allNodes[ jointId ];\n\n                        if ( jointNode ) {\n\n                            bones.push( jointNode );\n\n                            var mat = new THREE.Matrix4();\n\n                            if ( skinEntry.inverseBindMatrices !== undefined ) {\n\n                                mat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\n\n                            }\n\n                            boneInverses.push( mat );\n\n                        } else {\n\n                            console.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', jointId );\n\n                        }\n\n                    }\n\n                    mesh.bind( new THREE.Skeleton( bones, boneInverses ), mesh.matrixWorld );\n\n                }\n\n            }\n\n            // build node hierachy\n\n            parentObject.add( node );\n\n            if ( nodeDef.children ) {\n\n                var children = nodeDef.children;\n\n                for ( var i = 0, il = children.length; i < il; i ++ ) {\n\n                    var child = children[ i ];\n                    buildNodeHierachy( child, node, json, allNodes, skins );\n\n                }\n\n            }\n\n        }\n\n        return function loadScene( sceneIndex ) {\n\n            var json = this.json;\n            var extensions = this.extensions;\n            var sceneDef = this.json.scenes[ sceneIndex ];\n\n            return this.getMultiDependencies( [\n\n                'node',\n                'skin'\n\n            ] ).then( function ( dependencies ) {\n\n                var scene = new THREE.Scene();\n                if ( sceneDef.name !== undefined ) scene.name = sceneDef.name;\n\n                if ( sceneDef.extras ) scene.userData = sceneDef.extras;\n\n                var nodeIds = sceneDef.nodes || [];\n\n                for ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n                    buildNodeHierachy( nodeIds[ i ], scene, json, dependencies.nodes, dependencies.skins );\n\n                }\n\n                // Ambient lighting, if present, is always attached to the scene root.\n                if ( sceneDef.extensions\n                    && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\n                    && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\n\n                    var lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\n                    scene.add( lights[ sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ] );\n\n                }\n\n                return scene;\n\n            } );\n\n        };\n\n    }();\n\n    return GLTFLoader;\n\n} )();\n\nexport default GLTFLoader","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {PROP_DEFS} from '../Common'\nimport GLTFLoader from '../GLTFLoader'\nimport {MeshLambertMaterial} from 'three'\nimport ObjectDef from './ObjectDef'\n\nexport default class ModelDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create model w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'model',\n            title:'a model',\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#ffffff',\n            children:graph.createArray(),\n            asset:0,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new THREE.Group()\n        node.name = obj.title\n        const clicker =  new THREE.Mesh(\n            new THREE.SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        // on(clicker,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n\n        const asset = provider.accessObject(obj.asset)\n        if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(op.value)\n            if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachAsset(asset,obj,node,provider) {\n        const loader = new GLTFLoader()\n        console.log(\"loading the url\",asset.src)\n        loader.load(asset.src, (gltf)=> {\n            console.log(\"loaded\", gltf)\n            //swap the model\n            if(node.userData.model) node.remove(node.userData.model)\n            node.userData.model = gltf.scene.clone()\n            node.add(node.userData.model)\n\n            //calculate the size of the model\n            if(node.userData.model.geometry) {\n                node.userData.model.geometry.computeBoundingSphere()\n                const bs = node.userData.model.geometry.boundingSphere\n                const model = node.userData.model\n                model.position.x = -bs.center.x\n                model.position.y = -bs.center.y\n                model.position.z = -bs.center.z\n                node.userData.clicker.geometry = new THREE.SphereBufferGeometry(bs.radius)\n            }\n        })\n    }\n\n}\n","import {fetchGraphObject} from '../../syncgraph/utils'\nimport {ASSET_TYPES, OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\n\nfunction customize(node,mat,obj) {\n    mat.onBeforeCompile = (shader) => {\n        //add uniform\n        shader.uniforms.imageOffsetAngle    = { value: obj.imageOffsetAngle }\n        shader.uniforms.imageCropStartAngle = { value: obj.imageCropStartAngle }\n        shader.uniforms.imageCropEndAngle   = { value: obj.imageCropEndAngle }\n        //prepend to the shader the defs\n        shader.vertexShader = `\n            uniform float imageOffsetAngle;\n            varying float vImageOffsetAngle;\n            uniform float imageCropStartAngle;            \n            varying float vImageCropStartAngle;            \n            uniform float imageCropEndAngle;            \n            varying float vImageCropEndAngle;            \n        ` + shader.vertexShader\n\n        //copy into fragment shader\n        shader.vertexShader = shader.vertexShader.replace('#include <begin_vertex>',`\n            #include <begin_vertex>\n            vImageOffsetAngle = imageOffsetAngle;\n            vImageCropStartAngle = imageCropStartAngle;\n            vImageCropEndAngle = imageCropEndAngle;\n        `)\n\n        //prepend to the fragment shader the defs\n        shader.fragmentShader = `\n                varying float vImageOffsetAngle;\n                varying float vImageCropStartAngle;\n                varying float vImageCropEndAngle;\n            `+shader.fragmentShader\n        //use in the shader\n        shader.fragmentShader = shader.fragmentShader.replace('#include <dithering_fragment>',`\n            if(vUv.x < vImageCropStartAngle) discard;\n            if(vUv.x > vImageCropEndAngle)  discard;\n            // gl_FragColor.r = vUv.x;\n            // vec3 jv = vec3(cos(gl_FragCoord.x/50.0)); \n            // vec3 empty = vec3(0.0,0.0,0.0);//vec3(jv,jv,jv)\n            // gl_FragColor.rgb = mix(empty,diffuseColor.rgb,jv);\n        `)\n        node.userData.matShader = shader\n    }\n}\n\nexport default class BG360Def {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.bg360,\n            title:'background',\n            visible:true,\n            asset:0,\n            parent:scene.id,\n            imageOffsetAngle:0.0, //offset in UV coords, 0 to 1\n            imageCropStartAngle:0.0, //crop left edge of image\n            imageCropEndAngle:1.0, //crop right edge of image\n        }))\n    }\n    makeNode(obj, provider) {\n        const mat = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide})\n        const node = new THREE.Mesh(new THREE.SphereBufferGeometry(20.0, 50,50),mat)\n        customize(node,mat,obj)\n        node.name = obj.title\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        const asset = provider.accessObject(obj.asset)\n        if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        return node\n    }\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(obj.asset)\n            if(asset.exists()) this.attachAsset(asset, obj, node, provider)\n        }\n        if(node.userData.matShader) {\n            if (op.name === 'imageOffsetAngle') node.userData.matShader.uniforms.imageOffsetAngle.value = op.value\n            if (op.name === 'imageCropStartAngle') node.userData.matShader.uniforms.imageCropStartAngle.value = op.value\n            if (op.name === 'imageCropEndAngle') node.userData.matShader.uniforms.imageCropEndAngle.value = op.value\n        } else {\n            console.warn(\"BG360: no shader reference?!\")\n        }\n    }\n\n    attachAsset(asset, obj, node, provider) {\n        if(asset.subtype === ASSET_TYPES.IMAGE) {\n            const tex = new THREE.TextureLoader().load(asset.src)\n            node.material = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide, map: tex})\n            customize(node, node.material, obj)\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            const video = document.createElement('video')\n            video.crossOrigin = 'anonymous'\n            video.src = asset.src\n            const tex = new THREE.VideoTexture(video)\n            node.material = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide, map: tex})\n        }\n    }\n}\n","import ObjectDef from './ObjectDef'\nimport {fetchGraphObject} from '../../syncgraph/utils'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport WebLayer3D from 'three-web-layer'\n\nexport default class TextDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.text,\n            title:'some text',\n            visible:true,\n            text:'cool <b>formatted</b> <i>text</i>',\n            cssStyle:\n`color:black; \nbackground-color:white;\nwidth: 10em;\nfont-size: 200%;\n`,\n\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n\n    makeNode(obj) {\n        const div = document.createElement('div')\n        div.innerHTML = obj.text\n        div.id = `div_${obj.id}`\n        div.classList.add('weblayer-div')\n        if(obj.cssStyle) div.setAttribute('style',obj.cssStyle)\n        const divLayer = new WebLayer3D(div,{\n            pixelRatio: window.devicePixelRatio,\n            onLayerCreate(layer) {\n                layer.mesh.material.side = THREE.DoubleSide\n                layer.mesh.userData.graphid = obj.id\n                layer.mesh.userData.clickable = true\n            }\n        })\n\n        divLayer.refresh(true)\n        divLayer.userData.clickable = true\n        const node = new THREE.Object3D()\n        node.previewUpdate = function() {\n            divLayer.update()\n        }\n        node.add(divLayer)\n        node.userData.divLayer = divLayer\n        node.userData.div = div\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        this.regenerateText(node,obj)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(    op.name === PROP_DEFS.text.key) this.regenerateText(node,obj)\n        if(    op.name === PROP_DEFS.cssStyle.key) this.regenerateText(node,obj)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n\n    regenerateText(node, obj) {\n        node.userData.div.innerHTML = obj.text\n        if(obj.cssStyle) node.userData.div.setAttribute('style',obj.cssStyle)\n        node.userData.divLayer.refresh(true)\n    }\n}\n\n\n\n","import {fetchGraphObject} from '../../syncgraph/utils'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport ObjectDef from './ObjectDef'\n\nexport default class Image2DDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create Image2D with missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.img2d,\n            title:'image',\n            visible:true,\n            width:0.5,\n            ratio:1,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            asset:0,\n            parent:scene.id,\n        }))\n    }\n    makeNode(obj) {\n        const node = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(obj.width, obj.width*obj.ratio),\n            new THREE.MeshLambertMaterial({color: 'white', side: THREE.DoubleSide})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(op.value)\n            if(asset.exists()) {\n                const tex = new THREE.TextureLoader().load(asset.src)\n                node.material = new THREE.MeshLambertMaterial({color:'white', side: THREE.DoubleSide, map:tex})\n                asset.set('ratio',asset.width/asset.height)\n            }\n            return\n        }\n        if( op.name === PROP_DEFS.width.key || op.name === 'ratio') {\n            node.geometry = new THREE.PlaneBufferGeometry(obj.width, obj.width*(1/obj.ratio))\n            return\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES} from '../Common'\n\nlet COUNTER = 0\n\nexport default class GroupDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.group,\n            title:'group '+COUNTER++,\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {\n    BufferAttribute,\n    BufferGeometry,\n    CanvasTexture,\n    Color,\n    NormalBlending,\n    Object3D,\n    Points,\n    RepeatWrapping,\n    ShaderMaterial,\n    Vector3\n} from 'three'\n\n/*\n* modified from the version from the ThreeJS examples repo\n */\n\nconst GPUParticleShader = {\n\n    vertexShader:\n        `\n                uniform float uTime;\n                uniform float uScale;\n                uniform bool reverseTime;\n                uniform float fadeIn;\n                uniform float fadeOut;\n    \n                attribute vec3 positionStart;\n                attribute float startTime;\n                attribute vec3 velocity;\n                attribute vec3 acceleration;\n                attribute vec3 color;\n                attribute vec3 endColor;\n                attribute float size;\n                attribute float lifeTime;\n    \n                varying vec4 vColor;\n                varying vec4 vEndColor;\n                varying float lifeLeft;\n                varying float alpha;\n    \n                void main() {\n                    vColor = vec4( color, 1.0 );\n                    vEndColor = vec4( endColor, 1.0);\n                    vec3 newPosition;\n                    float timeElapsed = uTime - startTime;\n                    if(reverseTime) timeElapsed = lifeTime - timeElapsed;\n                    if(timeElapsed < fadeIn) {\n                        alpha = timeElapsed/fadeIn;\n                    }\n                    if(timeElapsed >= fadeIn && timeElapsed <= (lifeTime - fadeOut)) {\n                        alpha = 1.0;\n                    }\n                    if(timeElapsed > (lifeTime - fadeOut)) {\n                        alpha = 1.0 - (timeElapsed - (lifeTime-fadeOut))/fadeOut;\n                    }\n                    \n                    lifeLeft = 1.0 - ( timeElapsed / lifeTime );\n                    gl_PointSize = ( uScale * size );// * lifeLeft;\n                    newPosition = positionStart \n                        + (velocity * timeElapsed)\n                        + (acceleration * 0.5 * timeElapsed * timeElapsed)\n                        ;\n                    if (lifeLeft < 0.0) { \n                        lifeLeft = 0.0; \n                        gl_PointSize = 0.;\n                    }\n                    //while active use the new position\n                    if( timeElapsed > 0.0 ) {\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                    } else {\n                        //if dead use the initial position and set point size to 0\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                        lifeLeft = 0.0;\n                        gl_PointSize = 0.;\n                    }\n                }\n                `\n    ,\n\n    fragmentShader: `\n                varying vec4 vColor;\n                varying vec4 vEndColor;\n                varying float lifeLeft;\n                varying float alpha;\n                uniform sampler2D tSprite;\n                void main() {\n                    // color based on particle texture and the lifeLeft. \n                    // if lifeLeft is 0 then make invisible\n                    vec4 tex = texture2D( tSprite, gl_PointCoord );\n                    vec4 color = mix(vColor, vEndColor, 1.0-lifeLeft);\n                    gl_FragColor = vec4( color.rgb*tex.rgb, alpha * tex.a);\n                }\n    \n            `\n};\n\nconst UPDATEABLE_ATTRIBUTES = [\n    'positionStart', 'startTime',\n    'velocity', 'acceleration',\n    'color', 'endColor',\n    'size', 'lifeTime']\n\nexport default class GPUParticles extends Object3D {\n    constructor(options) {\n        super()\n        options = options || {};\n\n\n        this.blending = options.blending? options.blending : NormalBlending\n        this.PARTICLE_COUNT = options.maxParticles || 1000000;\n        this.PARTICLE_CURSOR = 0;\n        this.time = 0;\n        this.offset = 0;\n        this.count = 0;\n        this.DPR = window.devicePixelRatio;\n        this.particleUpdate = false;\n        this.onTick = options.onTick\n\n        this.reverseTime = options.reverseTime\n        this.fadeIn = options.fadeIn || 1\n        if(this.fadeIn === 0) this.fadeIn = 0.001\n        this.fadeOut = options.fadeOut || 1\n        if(this.fadeOut === 0) this.fadeOut = 0.001\n\n        // preload a 10_000 random numbers from -0.5 to 0.5\n        this.rand = [];\n        let i;\n        for (i = 1e5; i>0; i--) {\n            this.rand.push( Math.random() - 0.5 );\n        }\n        this.i = i\n\n        //setup the texture\n        this.sprite = options.particleSpriteTex || null;\n        if(!this.sprite) {\n            const can = document.createElement('canvas')\n            can.width = 16\n            can.height = 16\n            const ctx = can.getContext('2d')\n            ctx.fillStyle = 'black'\n            ctx.fillRect(0,0,can.width,can.height)\n            ctx.fillStyle = 'rgba(255,255,255,0.5)'\n            ctx.beginPath()\n            ctx.arc(8,8,8,0,Math.PI*2)\n            ctx.fill()\n            this.sprite = new CanvasTexture(can)\n        }\n        this.sprite.wrapS = this.sprite.wrapT = RepeatWrapping;\n\n        //setup the shader material\n        this.material = new ShaderMaterial( {\n            transparent: true,\n            depthWrite: false,\n            uniforms: {\n                'uTime': {\n                    value: 0.0\n                },\n                'uScale': {\n                    value: 1.0\n                },\n                'tSprite': {\n                    value: this.sprite\n                },\n                reverseTime: {\n                    value: this.reverseTime\n                },\n                fadeIn: {\n                    value: this.fadeIn\n                },\n                fadeOut: {\n                    value: this.fadeOut,\n                }\n            },\n            blending: this.blending,\n            vertexShader: GPUParticleShader.vertexShader,\n            fragmentShader: GPUParticleShader.fragmentShader\n        } );\n\n        // define defaults for all values\n        this.material.defaultAttributeValues.particlePositionsStartTime = [ 0, 0, 0, 0 ];\n        this.material.defaultAttributeValues.particleVelColSizeLife = [ 0, 0, 0, 0 ];\n\n\n        // geometry\n        this.geometry = new BufferGeometry();\n\n        //vec3 attributes\n        this.geometry.addAttribute('position',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('positionStart', new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('velocity',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('acceleration',  new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('color',         new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('endColor',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n\n        //scalar attributes\n        this.geometry.addAttribute('startTime',     new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n        this.geometry.addAttribute('size',          new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n        this.geometry.addAttribute('lifeTime',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n\n\n        this.particleSystem = new Points(this.geometry, this.material);\n        this.particleSystem.frustumCulled = false;\n        this.add(this.particleSystem);\n    }\n\n    /*\n      This updates the geometry on the shader if at least one particle has been spawned.\n      It uses the offset and the count to determine which part of the data needs to actually\n      be sent to the GPU. This ensures no more data than necessary is sent.\n     */\n    geometryUpdate () {\n        if (this.particleUpdate === true) {\n            this.particleUpdate = false;\n            UPDATEABLE_ATTRIBUTES.forEach(name => {\n                const attr = this.geometry.getAttribute(name)\n                if (this.offset + this.count < this.PARTICLE_COUNT) {\n                    attr.updateRange.offset = this.offset * attr.itemSize\n                    attr.updateRange.count = this.count * attr.itemSize\n                } else {\n                    attr.updateRange.offset = 0\n                    attr.updateRange.count = -1\n                }\n                attr.needsUpdate = true\n            })\n            this.offset = 0;\n            this.count = 0;\n        }\n    }\n\n\n    //use one of the random numbers\n    random () {\n        return ++ this.i >= this.rand.length ? this.rand[ this.i = 1 ] : this.rand[ this.i ];\n    }\n\n    update ( ttime ) {\n        this.time = ttime/1000\n        this.material.uniforms.uTime.value = this.time;\n        if(this.onTick) this.onTick(this,this.time)\n        this.geometryUpdate();\n    }\n\n    dispose () {\n        this.material.dispose();\n        this.sprite.dispose();\n        this.geometry.dispose();\n    }\n\n    updateSprite(sprite) {\n        if(sprite) {\n            const old = this.sprite\n            this.sprite = sprite\n            this.sprite.wrapS = this.sprite.wrapT = RepeatWrapping;\n            this.material.uniforms.tSprite.value = sprite\n            if(old) old.dispose()\n        }\n    }\n\n    /* spawn a particle\n\n    This works by updating values inside of\n    the attribute arrays, then updates the count and the PARTICLE_CURSOR and\n    sets particleUpdate to true.\n\n    This if spawnParticle is called three times in a row before rendering,\n    then count will be 3 and the cursor will have moved by three.\n     */\n    spawnParticle ( options ) {\n        // console.log('spawnparticle')\n        let position = new Vector3()\n        let velocity = new Vector3()\n        let acceleration = new Vector3()\n        let color = new Color()\n        let endColor = new Color()\n\n        const positionStartAttribute = this.geometry.getAttribute('positionStart')\n        const startTimeAttribute = this.geometry.getAttribute('startTime')\n        const velocityAttribute = this.geometry.getAttribute('velocity')\n        const accelerationAttribute = this.geometry.getAttribute('acceleration')\n        const colorAttribute = this.geometry.getAttribute('color')\n        const endcolorAttribute = this.geometry.getAttribute('endColor')\n        const sizeAttribute = this.geometry.getAttribute('size')\n        const lifeTimeAttribute = this.geometry.getAttribute('lifeTime')\n\n        options = options || {};\n\n        // setup reasonable default values for all arguments\n\n        position = options.position !== undefined ? position.copy(options.position) : position.set(0, 0, 0);\n        velocity = options.velocity !== undefined ? velocity.copy(options.velocity) : velocity.set(0, 0, 0);\n        acceleration = options.acceleration !== undefined ? acceleration.copy(options.acceleration) : acceleration.set(0, 0, 0);\n        color = options.color !== undefined ? color.copy(options.color) : color.set(0xffffff);\n        endColor = options.endColor !== undefined ? endColor.copy(options.endColor) : endColor.copy(color)\n\n        const lifetime = options.lifetime !== undefined ? options.lifetime : 5\n        let size = options.size !== undefined ? options.size : 10\n        const sizeRandomness = options.sizeRandomness !== undefined ? options.sizeRandomness : 0\n\n        if (this.DPR !== undefined) size *= this.DPR;\n\n        const i = this.PARTICLE_CURSOR\n\n        // position\n        positionStartAttribute.array[i * 3 + 0] = position.x\n        positionStartAttribute.array[i * 3 + 1] = position.y\n        positionStartAttribute.array[i * 3 + 2] = position.z\n\n        velocityAttribute.array[i * 3 + 0] = velocity.x;\n        velocityAttribute.array[i * 3 + 1] = velocity.y;\n        velocityAttribute.array[i * 3 + 2] = velocity.z;\n\n        accelerationAttribute.array[i * 3 + 0] = acceleration.x;\n        accelerationAttribute.array[i * 3 + 1] = acceleration.y;\n        accelerationAttribute.array[i * 3 + 2] = acceleration.z;\n\n        colorAttribute.array[i * 3 + 0] = color.r;\n        colorAttribute.array[i * 3 + 1] = color.g;\n        colorAttribute.array[i * 3 + 2] = color.b;\n\n        endcolorAttribute.array[i * 3 + 0] = endColor.r;\n        endcolorAttribute.array[i * 3 + 1] = endColor.g;\n        endcolorAttribute.array[i * 3 + 2] = endColor.b;\n\n        //size, lifetime and starttime\n        sizeAttribute.array[i] = size + this.random() * sizeRandomness;\n        lifeTimeAttribute.array[i] = lifetime;\n        startTimeAttribute.array[i] = this.time + this.random() * 2e-2;\n\n        // offset\n        if (this.offset === 0) this.offset = this.PARTICLE_CURSOR;\n        // counter and cursor\n        this.count++;\n        this.PARTICLE_CURSOR++;\n        //wrap the cursor around\n        if (this.PARTICLE_CURSOR >= this.PARTICLE_COUNT) this.PARTICLE_CURSOR = 0;\n        this.particleUpdate = true;\n    };\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {AdditiveBlending, Color, TextureLoader, Vector3} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport GPUParticles from './GPUParticles'\n\nexport const rand = (min,max) => Math.random()*(max-min) + min\n\nlet COUNTER = 0\n\nexport default class ParticlesDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.particles,\n            title:'particles '+COUNTER++,\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            children:graph.createArray(),\n            pointSize:10.0,\n            lifetime:3.0,\n            startColor:'#ff0000',\n            endColor:'#0000ff',\n            parent:scene.id,\n            texture:null,\n        }))\n    }\n    makeNode(obj, provider) {\n        let tex = null\n        if(obj.texture) tex = new TextureLoader().load(obj.texture)\n        const options = {\n            velocity: new Vector3(0,1,0),\n            position: new Vector3(0,0,0),\n            size:obj.pointSize,\n            lifetime:obj.lifetime,\n            color: new Color(1.0,0.0,1.0),\n            endColor: new Color(0,1,1),\n        }\n\n        const node = new GPUParticles({\n            maxParticles: 10000,\n            position: new Vector3(0,0,0),\n            positionRandomness: 0.0,\n            baseVelocity: new Vector3(0.0, 0.0, -1),\n            velocity: new Vector3(0.0, 0.0, 0.0),\n            velocityRandomness: 1.0,\n            acceleration: new Vector3(0,0.0,0),\n            baseColor: new Color(1.0,1.0,0.5),\n            color: new Color(1.0,0,0),\n            colorRandomness: 0.5,\n            lifetime: 3,\n            size: 10,\n            sizeRandomness: 1.0,\n            particleSpriteTex: tex,\n            blending: AdditiveBlending,\n            onTick: (system, time) => {\n                options.velocity.set(rand(-1,1),1,rand(-1,1))\n                system.spawnParticle(options);\n            }\n        })\n        node.tick = function(evt) {\n            node.update(evt.time)\n        }\n        const texture = provider.accessObject(obj.texture)\n        if(texture.exists()) this.attachTexture(texture, obj, node, provider)\n        node.userData.options = options\n        node.name = obj.title\n        node.userData.clickable = false\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(op.name === PROP_DEFS.pointSize.key) return node.userData.options.size = obj.pointSize\n        if(op.name === PROP_DEFS.lifetime.key) return node.userData.options.lifetime = obj.lifetime\n        if(op.name === PROP_DEFS.startColor.key) return node.userData.options.color.set(obj.startColor)\n        if(op.name === PROP_DEFS.endColor.key) return node.userData.options.endColor.set(obj.endColor)\n        if(op.name === PROP_DEFS.texture.key) {\n            const texture = provider.accessObject(obj.texture)\n            if(texture.exists()) this.attachTexture(texture, obj, node, provider)\n            return\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    attachTexture(texture, obj, node, provider) {\n        const tex = new TextureLoader().load(texture.src)\n        node.updateSprite(tex)\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry, PlaneBufferGeometry, TextureLoader, DoubleSide} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, OBJ_TYPES, REC_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport default class ImageAnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't imageanchor w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.imageanchor,\n            title:'image anchor '+COUNTER++,\n            visible:true,\n            reactivate: false,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            targetImage:null,\n            imageRealworldWidth:1,\n            recType:REC_TYPES.SCENE_START,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n\n        const preview = new Mesh(\n            new PlaneBufferGeometry(2,2),\n            new MeshLambertMaterial({color:'white',transparent:true, opacity: 0.5, side: DoubleSide})\n        )\n        node.add(preview)\n        node.userData.preview = preview\n        this.updateImagePreview(node,obj,provider)\n\n        node.enter = (evt) => {\n            clicker.visible = false\n            node.visible = false\n            preview.visible = false\n            node.userData.info = {\n                image: evt.system.getObjectById(obj.targetImage),\n                imageRealworldWidth: obj.imageRealworldWidth,\n                reactivate: obj.reactivate,\n                recType: obj.recType,\n                object: obj,\n                node: node,\n                callback: (info) => {\n                    evt.system.fireEvent(obj, 'recognized', info)\n                    node.visible = true\n                }\n            }\n            evt.system.startImageRecognizer(node.userData.info)\n        }\n        node.exit = (evt) => {\n            clicker.visible = true\n            preview.visible = true\n            evt.system.stopImageRecognizer(node.userData.info)\n        }\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(op.name === PROP_DEFS.targetImage.key) {\n            return this.updateImagePreview(node,obj,provider)\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n    updateImagePreview(node,obj,provider) {\n        const targetImage = provider.accessObject(obj.targetImage)\n        if(targetImage.exists()) {\n            const tex = new TextureLoader().load(targetImage.src)\n            node.userData.preview.material = new MeshLambertMaterial({color:'white',transparent:true, opacity:0.5, side:DoubleSide, map:tex})\n            let height = (targetImage.height / targetImage.width) * 2\n            node.userData.preview.geometry = new PlaneBufferGeometry(2,height)\n        }\n        if(provider.accessObject(obj.targetImage).exists()) {\n            node.userData.preview.visible = true\n            node.userData.clicker.visible = false\n        } else {\n            node.userData.preview.visible = false\n            node.userData.clicker.visible = true\n        }\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, REC_TYPES} from '../Common'\nlet COUNTER = 0\n\nexport default class GeoAnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if (!scene.id) throw new Error(\"can't create geo anchor w/ missing parent\")\n        return fetchGraphObject(graph, graph.createObject({\n            type: OBJ_TYPES.geoanchor,\n            title: 'geo anchor ' + COUNTER++,\n            visible: true,\n            tx: 0, ty: 0, tz: 0,\n            rx: 0, ry: 0, rz: 0,\n            sx: 1, sy: 1, sz: 1,\n            color: '#00ff00',\n            children: graph.createArray(),\n            targetGeoLocation: null,\n            recType: REC_TYPES.SCENE_START,\n            parent: scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        node.enter = (evt) => {\n            clicker.visible = false\n            node.visible = false\n            node.userData.info = {\n                location:evt.system.getObjectById(obj.targetGeoLocation),\n                recType:obj.recType,\n                object:obj,\n                node:node,\n                callback:(info) => {\n                    evt.system.fireEvent(obj, 'recognized', info)\n                    node.visible = true\n                }\n            }\n            evt.system.startGeoRecognizer(node.userData.info)\n        }\n        node.exit = (evt) => {\n            clicker.visible = true\n            evt.system.stopGeoRecognizer(node.userData.info)\n        }\n        return node\n    }\n}","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry, PlaneBufferGeometry, TextureLoader, DoubleSide} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {ASSET_TYPES, OBJ_TYPES, REC_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport class HudAnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't add hudanchor w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.hudanchor,\n            title:'hud anchor '+COUNTER++,\n            visible:true,\n            tx:0, ty:0, tz:0,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj, provider) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n\n        node.start = (evt) => {\n            node.parent.remove(node)\n            node.position.z = 0\n            clicker.visible = false\n            evt.system.logger().log(\"getting the camera\")\n            evt.system.logger().log(evt.system.getCamera())\n            evt.system.getCamera().add(node)\n        }\n        node.stop = (evt) => {\n            evt.system.getCamera().remove(node)\n            clicker.visible = true\n            const scene = evt.system.getThreeObjectById(obj.parent)\n            scene.add(node)\n            node.position.set(obj.tx, obj.ty, obj.tz)\n            node.rotation.set(obj.rx,obj.ry,obj.rz)\n            node.scale.set(obj.sx,obj.sy,obj.sz)\n        }\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        return super.updateProperty(node,obj,op,provider)\n    }\n}\n","import {TYPES} from '../common/PropSheet'\nimport CubeDef from './defs/CubeDef'\nimport SphereDef from './defs/SphereDef'\nimport PlaneDef from './defs/PlaneDef'\nimport ModelDef from './defs/ModelDef'\nimport BG360Def from './defs/BG360Def'\nimport TextDef from './defs/TextDef'\nimport Image2DDef from './defs/Image2DDef'\nimport GroupDef from './defs/GroupDef'\nimport ParticlesDef from './defs/ParticlesDef'\nimport ImageAnchorDef from './defs/ImageAnchorDef'\nimport GeoAnchorDef from './defs/GeoAnchorDef'\nimport {HudAnchorDef} from './defs/HudAnchorDef'\n\nconst stdhints = {\n    incrementValue:0.1,\n}\nexport const PROP_DEFS = {\n    title: {\n        key:'title',\n        name:'Title',\n        type:TYPES.STRING\n    },\n    description: {\n        key:'description',\n        name:'Description',\n        type:TYPES.STRING\n    },\n    width: {\n        key:'width',\n        name:'Width',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    height: {\n        key:'height',\n        name:'Height',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    depth: {\n        key:'depth',\n        name:'Depth',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    radius: {\n        key:'radius',\n        name:'Radius',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    tx: {\n        key:'tx',\n        name:'TX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    ty: {\n        key:'ty',\n        name:'TY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    tz: {\n        key:'tz',\n        name:'TZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    rx: {\n        key:'rx',\n        name:'RX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    ry: {\n        key:'ry',\n        name:'RY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    rz: {\n        key:'rz',\n        name:'RZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sx: {\n        key:'sx',\n        name:'SX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sy: {\n        key:'sy',\n        name:'SY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sz: {\n        key:'sz',\n        name:'SZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    color: {\n        key:'color',\n        name:'Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    defaultFloor: {\n        key:'defaultFloor',\n        name:'Default Floor',\n        type:TYPES.BOOLEAN\n    },\n    src: {\n        key:'src',\n        name:'src',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    asset: {\n        key:'asset',\n        name:'asset',\n        type:TYPES.ENUM,\n    },\n    subtype: {\n        key:'subtype',\n        name:'kind',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    format: {\n        key:'format',\n        name:'format',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    imageOffsetAngle: {\n        key:'imageOffsetAngle',\n        name:'Image Offset Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageCropStartAngle: {\n        key:'imageCropStartAngle',\n        name:'Image Crop Start Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageCropEndAngle: {\n        key:'imageCropEndAngle',\n        name:'Image Crop End Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageRealworldWidth: {\n        key:'imageRealworldWidth',\n        name:'Image width in meters',\n        type: TYPES.NUMBER,\n        hints: {\n            incrementValue:0.01\n        }\n    },\n    recType: {\n        key:'recType',\n        name:'Recognition Type',\n        type: TYPES.ENUM,\n    },\n\n    targetImage: {\n        key:'targetImage',\n        name:'Image to Recognize',\n        type: TYPES.ENUM,\n    },\n\n    targetGeoLocation: {\n        key:'targetGeoLocation',\n        name:'Target Location',\n        type: TYPES.ENUM,\n    },\n\n    text: {\n        key:'text',\n        name:'Text',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    fontSize: {\n        key:'fontSize',\n        name:'Font Size',\n        type:TYPES.NUMBER,\n    },\n    padding: {\n        key:'padding',\n        name:'Padding',\n        type:TYPES.NUMBER,\n    },\n    borderWidth: {\n        key:'borderWidth',\n        name:'Border width',\n        type:TYPES.NUMBER,\n    },\n    borderRadius: {\n        key:'borderRadius',\n        name:'Corner Size',\n        type:TYPES.NUMBER,\n    },\n    horizontalAlign: {\n        key:'horizontalAlign',\n        name:'H Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    textColor: {\n        key:'textColor',\n        name:'Text Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    backgroundColor: {\n        key:'backgroundColor',\n        name:'BG Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    borderColor: {\n        key:'borderColor',\n        name:'Border Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    startColor: {\n        key:'startColor',\n        name:'Start',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    endColor: {\n        key:'endColor',\n        name:'End',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    drawBackground: {\n        key:'drawBackground',\n        name:'BG?',\n        type:TYPES.BOOLEAN,\n    },\n    scriptBody: {\n        key:'scriptBody',\n        name:'code',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    defaultScene: {\n        key:'defaultScene',\n        name:'Start Scene',\n        type:TYPES.ENUM,\n    },\n    visible: {\n        key:'visible',\n        name:'Visible',\n        type:TYPES.BOOLEAN\n    },\n\n    reactivate: {\n        key: 'reactivate',\n        name: \"Reactivate Image Search\",\n        type: TYPES.BOOLEAN\n    },\n\n    pointSize: {\n        key:'pointSize',\n        name:'Point Size',\n        type:TYPES.NUMBER,\n    },\n    lifetime: {\n        key:'lifetime',\n        name:'Lifetime',\n        type:TYPES.NUMBER,\n        hints: stdhints,\n    },\n    texture: {\n        key:'texture',\n        name:'texture',\n        type:TYPES.ENUM,\n    },\n    cssStyle: {\n        key:'cssStyle',\n        name:'Style',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    latitude: {\n        key:'latitude',\n        name:\"Latitude\",\n        type:TYPES.NUMBER, //value in degrees\n    },\n    longitude: {\n        key:'longitude',\n        name:\"Longitude\",\n        type:TYPES.NUMBER, //value in degrees\n    },\n    altitude: {\n        key:'altitude',\n        name:\"altitude\",\n        type:TYPES.NUMBER, //value in meters\n    },\n    useAltitude: {\n        key:'useAltitude',\n        name:\"use altitude?\",\n        type:TYPES.BOOLEAN,\n    },\n    autoRecenter: {\n        key:'autoRecenter',\n        name:\"Recenter on Load\",\n        type:TYPES.BOOLEAN\n    }\n}\n\nexport const SIMPLE_COLORS = [\"#ffffff\",\"#ff0000\",\"#ffff00\",\"#00ff00\",\"#00ffff\",\"#0000ff\",\"#ff00ff\",\"#000000\"]\n\nexport const OBJ_TYPES = {\n    cube:'cube',\n    sphere:'sphere',\n    plane:'plane',\n    model:'model',\n    bg360:'bg360',\n    text:'text',\n    img2d:'img2d',\n    group:'group',\n    particles:'particles',\n    imageanchor:'imageanchor',\n    geoanchor:'geoanchor',\n    hudanchor:'hudanchor',\n}\n\nexport const TOTAL_OBJ_TYPES = {\n    SCENE:'scene',\n    ASSET:'asset',\n    BEHAVIOR:'behavior',\n    BEHAVIOR_SCRIPT:'behavior_script',\n    ASSETS_LIST: 'assets',\n    BEHAVIORS_LIST: 'behaviors',\n    ROOT: 'root'\n}\nexport const HORIZONTAL_ALIGNMENT = {\n    LEFT:'LEFT',\n    CENTER:'CENTER',\n    RIGHT:'RIGHT',\n}\n\n\nexport function is3DObjectType(type) {\n    if(type === OBJ_TYPES.cube) return true\n    if(type === OBJ_TYPES.sphere) return true\n    if(type === OBJ_TYPES.plane) return true\n    if(type === OBJ_TYPES.model) return true\n    if(type === OBJ_TYPES.text) return true\n    if(type === OBJ_TYPES.bg360) return true\n    if(type === OBJ_TYPES.img2d) return true\n    if(type === OBJ_TYPES.group) return true\n    if(type === OBJ_TYPES.particles) return true\n    if(type === OBJ_TYPES.imageanchor) return true\n    if(type === OBJ_TYPES.geoanchor) return true\n    if(type === OBJ_TYPES.hudanchor) return true\n    return false\n}\n\nexport function canHaveShape(type) {\n    if(type === OBJ_TYPES.group) return true\n    if(type === OBJ_TYPES.imageanchor) return true\n    if(type === OBJ_TYPES.geoanchor) return true\n    if(type === OBJ_TYPES.hudanchor) return true\n    if(type === TOTAL_OBJ_TYPES.SCENE) return true\n    return false\n}\n\nexport function canHaveBehavior(type) {\n    if(is3DObjectType(type)) return true\n    if(type === TOTAL_OBJ_TYPES.SCENE) return true\n    return false\n}\n\nexport function canHaveScene(type) {\n    if(type === TOTAL_OBJ_TYPES.ROOT) return true\n    return false\n}\n\nexport function canBeDeleted(type) {\n    if(type === TOTAL_OBJ_TYPES.ROOT) return false\n    if(type === TOTAL_OBJ_TYPES.ASSETS_LIST) return false\n    if(type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return false\n    return true\n}\n\nexport function get3DObjectDef(type) {\n    if(type === OBJ_TYPES.cube) return new CubeDef()\n    if(type === OBJ_TYPES.sphere) return new SphereDef()\n    if(type === OBJ_TYPES.plane) return new PlaneDef()\n    if(type === OBJ_TYPES.model) return new ModelDef()\n    if(type === OBJ_TYPES.bg360) return new BG360Def()\n    if(type === OBJ_TYPES.text) return new TextDef()\n    if(type === OBJ_TYPES.img2d) return new Image2DDef()\n    if(type === OBJ_TYPES.group) return new GroupDef()\n    if(type === OBJ_TYPES.particles) return new ParticlesDef()\n    if(type === OBJ_TYPES.imageanchor) return new ImageAnchorDef()\n    if(type === OBJ_TYPES.geoanchor) return new GeoAnchorDef()\n    if(type === OBJ_TYPES.hudanchor) return new HudAnchorDef()\n    throw new Error(`unknown 3d object type ${type}`)\n}\n\nexport const toRad = (degrees) => degrees*Math.PI/180\n\nexport const MIME_TYPES = { PNG:'image/png', JPEG:'image/jpeg', MP3: 'audio/mpeg', AAC: 'audio/aac', JAVASCRIPT: 'text/javascript', GLB: 'model/gltf-binary', MP4:'video/mp4' }\nexport const ASSET_TYPES = {\n    BEHAVIOR:'behavior',\n    IMAGE:'image',\n    GLTF: 'gltf',\n    AUDIO:'audio',\n    VIDEO:'video',\n    GEOLOCATION: 'geolocation'\n}\nexport function isImageType(type) {\n    if (!type) return false\n    if (type.toLowerCase() === MIME_TYPES.PNG) return true\n    if (type.toLowerCase() === MIME_TYPES.JPEG) return true\n    return false;\n}\nexport function isAudioType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.MP3) return true\n    if(type.toLowerCase() === MIME_TYPES.AAC) return true\n    return false\n}\n\nexport function isVideoType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.MP4) return true\n    return false\n}\nexport function isGLTFType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.GLB) return true\n    return false\n}\n\n\nexport function isGLTFFile(file) {\n    if (!file) return false\n    console.log(\"looking at the file\", file, 'type', file.type, 'type')\n    if (!file.type || file.type === '' || file.type.length === 0) {\n        console.log(\"no mimetype. check extension\")\n        if (file.name.toLowerCase().indexOf(\".gltf\") > 0) return true\n        if (file.name.toLowerCase().indexOf(\".glb\") > 0) return true\n    }\n    if (file.type.toLowerCase() === 'image/gltf') return true\n    return false;\n}\n\nexport const ITEM_ICONS = {\n    plane: 'plane',\n    cube: 'square',\n    sphere: 'circle',\n    model: 'cube',\n    asset: 'file',\n    assets: 'archive',\n    behavior:'superpowers',\n    behavior_script:'superpowers',\n    scene: 'globe',\n    bg360:'image',\n    img2d:'image',\n    image:'image',\n    text:'font',\n    audio:'music',\n    video:'video-camera',\n    group:'object-group',\n    particles:'certificate',\n    gltf:'cube',\n    imageanchor:'anchor',\n    geoanchor:'globe',\n    geolocation:'globe',\n\n    cut:'cut',\n    copy:'copy',\n    paste:'paste',\n    delete:'close'\n}\n\n\nexport function parseBehaviorScript(contents) {\n    return Function(`\"use strict\";\n    const toRadians = (deg) => Math.PI/180*deg; \n    return(${contents})`)();\n}\n\nexport const REC_TYPES = {\n    SCENE_START:'SCENE_START'\n}","import * as THREE from 'three'\nimport React, {Component} from \"react\"\nimport {VRManager} from 'webxr-boilerplate'\nimport GLTFLoader from './GLTFLoader'\n\nexport default class GLTFAssetView extends Component {\n    componentDidMount() {\n        this.initThreeJS()\n    }\n    render() {\n        return <div>GLTF viewer\n            <div ref={c => this.sceneContainer = c}></div>\n        </div>\n    }\n    initThreeJS() {\n        const asset = this.props.asset\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color( 0x000000 );\n        this.camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new THREE.WebGLRenderer( { antialias: true } );\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.renderer.gammaOutput = true\n        this.renderer.vr.enabled = true;\n        this.sceneContainer.appendChild( this.renderer.domElement );\n        this.vrmanager = new VRManager(this.renderer)\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n        this.renderer.setAnimationLoop(this.renderThree)\n        const light = new THREE.DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.2))\n        console.log(\"rendering the asset\",asset)\n\n        const loader = new GLTFLoader()\n        console.log(\"loading the url\",asset.src)\n        loader.load(asset.src, (gltf)=> {\n            console.log(\"loaded\", gltf)\n            //swap the model\n            this.scene.add(gltf.scene.clone())\n        })\n\n    }\n    renderThree = (time) => {\n        this.renderer.render( this.scene, this.camera );\n    }\n\n}\n","import React, {Component} from \"react\"\nimport {map, tileLayer, marker, Icon, divIcon, latLng} from \"leaflet/dist/leaflet-src.esm\"\nimport \"leaflet/dist/leaflet.css\"\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {HBox} from 'appy-comps'\n\nexport default class GeoAssetView extends Component {\n\n\n    constructor(props, context) {\n        super(props, context)\n        this.updateLocation = (e) => {\n            const obj = this.props.provider.accessObject(this.props.asset.id)\n            const ll = latLng({\n                lat: obj.latitude,\n                lon: obj.longitude\n            })\n            this.marker.setLatLng(ll)\n            this.mymap.panTo(ll)\n        }\n    }\n\n    loadCurrentLocation = () => {\n        navigator.geolocation.getCurrentPosition((success)=>{\n            console.log(\"success\",success)\n            const coords = success.coords\n            this.props.provider.quick_setPropertyValue(this.props.asset.id,'latitude',coords.latitude)\n            this.props.provider.quick_setPropertyValue(this.props.asset.id,'longitude',coords.longitude)\n        },(error)=>{\n            console.log(\"error\",error)\n        })\n    }\n\n    onMapClick = (e) => {\n        this.props.provider.quick_setPropertyValue(this.props.asset.id,'latitude',e.latlng.lat)\n        this.props.provider.quick_setPropertyValue(this.props.asset.id,'longitude',e.latlng.lng)\n    }\n\n    render() {\n        const style = {\n            width: '400px',\n            height: '400px',\n            border: '1px solid black',\n        }\n        return <div>\n            <HBox>\n                <button onClick={this.loadCurrentLocation}>set to current location</button>\n            </HBox>\n            <div id=\"mapid\" ref={d => this.div = d} style={style}></div>\n        </div>\n    }\n    componentDidMount() {\n        this.mymap = map('mapid').setView([this.props.asset.longitude, this.props.asset.latitude], 3);\n        tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {\n            maxZoom: 18,\n            attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\n                '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\n                'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n            id: 'mapbox.streets'\n        }).addTo(this.mymap);\n        this.mymap.on('click',this.onMapClick)\n\n        const customIcon = divIcon({className:'map-icon'})\n        this.marker = marker([this.props.asset.longitude, this.props.asset.latitude],{\n            title:'this is the geo location',\n            icon: customIcon\n        }).addTo(this.mymap)\n\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, this.updateLocation)\n        this.updateLocation()\n    }\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, this.updateLocation)\n    }\n}\n\n\n\n","import React, {Component} from \"react\"\nimport {fetchGraphObject} from '../syncgraph/utils'\nimport {ASSET_TYPES} from '../vr/Common'\nimport GLTFAssetView from '../vr/GLTFAssetView'\nimport GeoAssetView from '../vr/GeoAssetView'\n\nexport default class AssetView extends Component {\n    render() {\n        const prov = this.props.provider\n        const asset = fetchGraphObject(prov.getDataGraph(),this.props.asset)\n        return <div>asset view\n            <h3>{asset.type} : <b>{asset.title}</b></h3>\n            {this.renderAsset(asset)}\n        </div>\n    }\n\n    renderAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.IMAGE) return <img src={asset.src} alt={asset.title}/>\n        if(asset.subtype === ASSET_TYPES.AUDIO) return <audio src={asset.src} controls/>\n        if(asset.subtype === ASSET_TYPES.VIDEO) return <video src={asset.src} controls crossOrigin=\"anonymous\"/>\n        if(asset.subtype === ASSET_TYPES.BEHAVIOR) return <div>{asset.src}</div>\n        if(asset.subtype === ASSET_TYPES.GLTF) return <GLTFAssetView asset={asset}/>\n        if(asset.subtype === ASSET_TYPES.GEOLOCATION) return <GeoAssetView asset={asset} provider={this.props.provider}/>\n        return <div>unknown type</div>\n    }\n}\n","import * as ToasterManager from './ToasterManager'\nimport {getAssetsURL} from '../TreeItemProvider'\nimport {ASSET_TYPES, MIME_TYPES, TOTAL_OBJ_TYPES} from './Common'\nimport {fetchGraphObject} from '../syncgraph/utils'\n\nexport function addImageAssetFromExpandedURL(url,format,title, prov) {\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type:TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.IMAGE,\n        format:format,\n        src:url,\n        width:100,\n        height:100,\n        title:title,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    prov.requestImageCache(url).then(img => {\n        asset.set('width',img.width)\n        asset.set('height',img.height)\n    })\n}\n\nexport function addGeoAnchorAsset(info,title,prov) {\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type:TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.GEOLOCATION,\n        title:title,\n        latitude:info.latitude,\n        longitude:info.longitude,\n        altitude:info.altitude,\n        useAltitude:info.useAltitude,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\nexport function addImageAssetFromFile (file, prov) {\n    ToasterManager.add('uploading ' + file.name)\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        return addImageAssetFromExpandedURL(getAssetsURL()+ans.asset.id, ans.asset.mimeType, file.name, prov)\n    })\n}\nexport function addImageAssetFromURL  (url, prov) {\n    //TODO: make this format detection code more robust\n    const name = url.substring(url.lastIndexOf('/') + 1)\n    const type = name.substring(name.lastIndexOf(\".\") + 1)\n    let fileType = \"image/unknown\"\n    if (type.toLowerCase() === 'png') fileType = MIME_TYPES.PNG\n    if (type.toLowerCase() === 'jpg') fileType = MIME_TYPES.JPEG\n    if (type.toLowerCase() === 'jpeg') fileType = MIME_TYPES.JPEG\n    return addImageAssetFromExpandedURL(url, fileType, name, prov)\n}\nexport function addGLBAssetFromFile (file, prov) {\n    ToasterManager.add('uploading '+ file.name)\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        const url = getAssetsURL()+ans.asset.id\n        const graph = prov.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.ASSET,\n            subtype:ASSET_TYPES.GLTF,\n            format:MIME_TYPES.GLB,\n            src:url,\n            title:file.name,\n            parent:0\n        }))\n        prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    })\n}\n\nexport function addAudioAssetFromFile (file, prov) {\n    ToasterManager.add('uploading')\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        console.log(\"uploaded file with answer\",ans)\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        const url = getAssetsURL()+ans.asset.id\n        const graph = prov.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.ASSET,\n            subtype:ASSET_TYPES.AUDIO,\n            format:ans.asset.mimeType,\n            src:url,\n            title:file.name,\n            parent:0\n        }))\n        prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    })\n}\nexport function addAudioAssetFromURL (url, fileType, name, prov) {\n    //TODO: make this format detection code more robust\n    if(!name) {\n        name = url.substring(url.lastIndexOf('/') + 1)\n    }\n    if(!fileType) {\n        const type = name.substring(name.lastIndexOf(\".\") + 1)\n        fileType = \"audio/unknown\"\n        if(type.toLowerCase() === 'mp3') fileType = MIME_TYPES.MP3\n        if(type.toLowerCase() === 'aac') fileType = MIME_TYPES.AAC\n    }\n\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph,graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.AUDIO,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\nexport function addVideoAssetFromURL (url, fileType, name, prov) {\n    //TODO: make this format detection code more robust\n    if(!name) {\n        name = url.substring(url.lastIndexOf('/') + 1)\n    }\n    /*\n    if(!fileType) {\n        const type = name.substring(name.lastIndexOf(\".\") + 1)\n        fileType = \"audio/unknown\"\n        if(type.toLowerCase() === 'mp3') fileType = MIME_TYPES.MP3\n        if(type.toLowerCase() === 'aac') fileType = MIME_TYPES.AAC\n    }\n    */\n\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph,graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.VIDEO,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\n\nexport function addGLBAssetFromURL(url, fileType, name, prov) {\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph, graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.GLTF,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {ToggleButton, Toolbar} from '../../common/GridEditorApp'\nimport {addImageAssetFromFile, addImageAssetFromURL} from '../AssetActions'\n\nexport class AddImageAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            view:'local',\n            url:\"\",\n        }\n        this.fileInput = React.createRef();\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        if(this.state.view === 'remote') {\n            console.log(\"adding the url\",this.state.url)\n            addImageAssetFromURL(this.state.url, this.props.provider)\n        } else {\n            console.log(\"the file input is\",this.fileInput)\n            listToArray(this.fileInput.current.files).forEach(file => {\n                addImageAssetFromFile(file, this.props.provider)\n            })\n        }\n    }\n    switchLocal = () => this.setState({view:'local'})\n    switchRemote = () => this.setState({view:'remote'})\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>add image to assets</h3>\n                <VBox grow>\n                    <Toolbar>\n                        <ToggleButton onClick={this.switchLocal} selected={this.state.view==='local'}>local</ToggleButton>\n                        <ToggleButton onClick={this.switchRemote} selected={this.state.view==='remote'}>remote</ToggleButton>\n                    </Toolbar>\n                    {this.renderSelectedPanel()}\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        this.setState({fileInput:e.target.value})\n    }\n\n    typedURL = (e) => {\n        this.setState({url:e.target.value})\n    }\n\n    renderSelectedPanel() {\n        if(this.state.view === 'local') {\n            return <HBox>\n                <label>File\n                    <input key=\"f1\" type=\"file\" onChange={this.selectedFile} ref={this.fileInput}/>\n                </label>\n            </HBox>\n        } else {\n            return <HBox>\n                <label>URL\n                    <input key=\"f2\" value={this.state.url} type=\"input\" onChange={this.typedURL}/>\n                </label>\n            </HBox>\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport {DEFAULT_DPI, UNITS} from './Dimension'\nimport {fetchGraphObject, propToArray} from '../syncgraph/utils'\nimport SelectionManager from '../SelectionManager'\n\nexport class PageCanvasView extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            scale: 1.0,\n        }\n    }\n\n    componentDidMount() {\n        this.canvas.focus()\n        this.redraw()\n    }\n\n    componentDidUpdate(prevProps) {\n        this.redraw()\n    }\n\n    redraw = () => {\n        if (!this.canvas) return\n        const c = this.canvas.getContext('2d')\n        const size = this.props.provider.getPageSize(this.props.page).as(UNITS.PIXEL, 1, DEFAULT_DPI)\n        this.canvas.width = size.width\n        this.canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, this.canvas.width, this.canvas.height)\n        c.save()\n        c.scale(this.state.scale, this.state.scale)\n        const graph = this.props.provider.getRawGraph()\n        const page = this.props.page\n        if (page) this.drawPage(c, graph, page)\n        c.restore()\n    }\n\n    drawPage(c, g, page) {\n        propToArray(g, page.children).forEach(id => this.drawLayer(c, g, fetchGraphObject(g, id)))\n    }\n\n    drawLayer(c, g, layer) {\n        propToArray(g, layer.children).forEach(id => this.drawShape(c, g, fetchGraphObject(g, id)))\n    }\n\n    drawShape(c, g, shape) {\n        const def = this.props.provider.getShapeDef(shape.type)\n        if (def) def.draw(c, g, shape, SelectionManager.getSelection() === shape.id, this.props.provider)\n    }\n\n    render() {\n        return <canvas\n            tabIndex={-1}\n            width={100} height={100} ref={(e) => this.canvas = e}\n            style={{\n                width: '100vw',\n            }}\n            onClick={this.props.onNext}\n            onKeyDown={this.handleKeypress}\n        ></canvas>\n    }\n\n    handleKeypress = (e) => {\n        if (e.key === 'ArrowRight') this.props.onNext()\n        if (e.key === 'ArrowLeft') this.props.onPrev()\n    }\n}","import React, {Component} from 'react'\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {PageCanvasView} from './PageCanvasView'\n\n\nexport default class PresentationApp extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            pageIndex:-1\n        }\n    }\n\n    componentDidMount() {\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.docSwapped)\n    }\n\n    docSwapped = () => this.setState({pageIndex:0})\n\n    getPages() {\n        const provider = this.props.provider\n        const root = provider.accessObject(provider.getSceneRoot())\n        return root.array('children').map(ch => provider.accessObject(ch) ).filter(ch => ch.type === 'page')\n    }\n\n    render() {\n        const provider = this.props.provider\n        const pages = this.getPages()\n        if(this.state.pageIndex < 0) return <div>no pages loaded</div>\n        const page = pages[this.state.pageIndex]\n        return <PageCanvasView page={page} provider={provider} onNext={this.onNext} onPrev={this.onPrev}/>\n    }\n\n    onNext = () => {\n        const pages = this.getPages()\n        if(this.state.pageIndex === pages.length-1) this.state.pageIndex = -1\n        this.setState({pageIndex:this.state.pageIndex+1})\n    }\n\n    onPrev = () => {\n        const pages = this.getPages()\n        if(this.state.pageIndex === 0) this.state.pageIndex = pages.length\n        this.setState({pageIndex:this.state.pageIndex-1})\n    }\n}\n\n","export default class GraphAccessor {\n    constructor(graph) {\n        this.graph = graph\n    }\n    object(id) {\n        // console.log('accessing',id)\n        if(this.graph.hasObject(id)) {\n            const obj = {}\n            this.graph.getPropertiesForObject(id).forEach(key => {\n                obj[key] = this.graph.getPropertyValue(id, key)\n            })\n            obj.id = id\n            obj.exists = function() { return true }\n            obj.set = (key, value) => {\n                this.graph.setProperty(id,key,value)\n                return obj\n            }\n            obj.props = () => {\n                const o = {}\n                this.graph.getPropertiesForObject(id).forEach(key => {\n                    o[key] = this.graph.getPropertyValue(id, key)\n                })\n                return o\n            }\n            obj.array = (key) => {\n                // console.log(\"looking at key\",key)\n                // console.log(\"self is\",obj)\n                const CH = obj[key]\n                // console.log(\"children id is\",CH)\n                const len = this.graph.getArrayLength(CH)\n                const ch = []\n                for (let i = 0; i < len; i++) {\n                    ch.push(this.graph.getElementAt(CH, i))\n                }\n                return ch\n            }\n            obj.getChildren = () => {\n                if(obj.children) return obj.array('children').map(id => this.object(id))\n                return []\n            }\n            obj.insertChildLast = (child) => {\n                this.graph.setProperty(child.id,'parent',obj.id)\n                const CH = this.graph.getPropertyValue(obj.id,'children')\n                const len = this.graph.getArrayLength(CH)\n                const prev = this.graph.getElementAt(CH,len-1)\n                this.graph.insertAfter(CH,prev,child.id)\n            }\n            obj.insertFirstChild = (child) => {\n                this.graph.setProperty(child.id,'parent',obj.id)\n                const ch = this.graph.getPropertyValue(obj.id,'children')\n                this.graph.insertAfter(ch,null,child.id)\n            }\n            obj.child = (index) => this.object(obj.array('children')[index])\n            obj.removeFromParent = () => {\n                const parent = this.object(obj.parent)\n                const n = parent.array('children').findIndex(ch => ch === obj.id)\n                // const n = indexOf(graph, parent.children, obj.id)\n                if (n >= 0) {\n                    this.graph.removeElement(parent.children, n)\n                } else {\n                    console.error(\"could not find index for child\", obj, 'in children', parent.children)\n                }\n            }\n            obj.clone = () => {\n                const shape = obj;\n                const id = shape.id\n                const id2 = this.graph.createObject()\n                const props = this.graph.getPropertiesForObject(id)\n                props.forEach(key => {\n                    this.graph.createProperty(id2,key,this.graph.getPropertyValue(id,key))\n                })\n                return this.object(id2)\n            }\n            obj.find = (match,list) => {\n                if(!list) list = []\n                if(match(obj)) list.push(obj)\n                if(obj.children) obj.getChildren().forEach(ch => {\n                    ch.find(match,list)\n                })\n                return list\n            }\n            return obj\n        } else {\n            return {\n                exists: function() { return false }\n            }\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport GridEditorApp, {MenuPopup, Panel, Spacer, Toolbar} from '../common/GridEditorApp'\nimport PropSheet from '../common/PropSheet'\nimport TreeTable from '../common/TreeTable'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {MetadocCanvas} from \"./MetadocCanvas\";\nimport SyncGraphProvider from '../syncgraph/SyncGraphProvider'\nimport {\n    cloneShape,\n    createGraphObjectFromObject,\n    fetchGraphObject,\n    insertAsFirstChild, insertAsLastChild, listToArray,\n    propToArray,\n    removeFromParent\n} from \"../syncgraph/utils\";\nimport {DialogManager, HBox, PopupManager} from \"appy-comps\";\nimport InputManager from \"../common/InputManager\";\nimport {getAssetsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {\n    HORIZONTAL_ALIGNMENT,\n    ICONS,\n    isShapeType,\n    PROP_DEFS,\n    SHAPE_DEFS,\n    STANDARD_FONTS,\n    VERTICAL_ALIGNMENT\n} from \"./Common\";\nimport AssetView from './AssetView'\nimport {AddImageAssetDialog} from '../vr/dialogs/AddImageAssetDialog'\nimport {DEFAULT_DPI, parseDimension, UNITS} from \"./Dimension\"\nimport {EnumEditor} from \"../common/EnumEditor\";\nimport PresentationApp from './PresentationApp'\nimport GraphAccessor from '../syncgraph/GraphAccessor'\n\n\nconst EnumTitleRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        const graph = props.provider.getDataGraph()\n        value = graph.getPropertyValue(props.value,'title')\n    }\n    return <b>{value}</b>\n}\n\nconst STANDARD_PAGE_SIZES = [\n    {\n        name:\"1024 x 768 pixels\",\n        value:'1024x768px',\n    },\n    {\n        name:\"VGA (640x480)\",\n        value:\"640x480px\"\n    },\n    {\n        name:\"A4 paper\",\n        value:\"210x297mm\"\n    },\n    {\n        name:\"16:9\",\n        value:\"300x169mm\"\n    },\n    {\n        name:\"4:3\",\n        value:\"225x169mm\"\n    },\n]\nconst PageSizeRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        const size = STANDARD_PAGE_SIZES.find(s => s.value === props.value)\n        if(size) {\n            value = size.name\n        } else {\n            value = props.value\n        }\n    }\n    return <b>{value}</b>\n}\n\nexport default class MetadocEditor extends  SyncGraphProvider {\n    constructor(options) {\n        super(options)\n        this.imagecache = {}\n    }\n    getDocType() { return \"metadoc\" }\n    getApp = () => {\n        if(this.mode === 'view') return <PresentationApp provider={this}/>\n        return <MetadocApp provider={this}/>\n    }\n    getTitle = () => \"MetaDoc\"\n\n    makeEmptyRoot(doc) {\n        //create root and children\n        const root = fetchGraphObject(doc,doc.createObject({ type:'root', title:'root', pageSize:'640 x 480 px', children: doc.createArray(), parent:0}))\n        //create page and children\n        const page = fetchGraphObject(doc,doc.createObject({ type:'page', title:'page 1', children: doc.createArray(),parent:0}))\n        //create layer and children\n        const layer = fetchGraphObject(doc,doc.createObject({type:'layer',title:'layer 1', children: doc.createArray(),parent:0}))\n        //create rect\n        const rect1 = SHAPE_DEFS.rect.make(doc,layer)\n        // create assets\n        const assets = fetchGraphObject(doc,doc.createObject({type:'assets',title:'Assets', children: doc.createArray(), parent:0}))\n        //connect it all together\n        insertAsFirstChild(doc,layer,rect1)\n        insertAsFirstChild(doc,page,layer)\n        insertAsFirstChild(doc,root,page)\n        insertAsLastChild(doc,root,assets)\n    }\n\n    getRendererForItem = (item) => {\n        if(!this.getDataGraph().getObjectById(item)) return <div>???</div>\n        const type = this.getDataGraph().getPropertyValue(item,'type')\n        const title = this.getDataGraph().getPropertyValue(item,'title')\n        if(ICONS[type]) return <div><i className={`fa fa-${ICONS[type]}`}/> {title}</div>\n        return <div>{title}</div>\n    }\n\n    setPropertyValue(item, def, value) {\n        super.setPropertyValue(item,def,value)\n        if(def.key === PROP_DEFS.asset.key) {\n            const asset = fetchGraphObject(this.getDataGraph(),value)\n            super.setPropertyValue(item,{key:'width'},asset.width)\n            super.setPropertyValue(item,{key:'height'},asset.height)\n        }\n    }\n\n\n    getProperties(item) {\n        function copyPropDef(def,value) {\n            const out = {};\n            Object.keys(def).forEach((key) => out[key] = def[key])\n            out.value = value\n            return out;\n        }\n        let defs = []\n        if(!item) return defs\n\n        const props = this.syncdoc.getPropertiesForObject(item)\n        if(props) {\n            props.forEach(key => {\n                if(key === 'type') return\n                if(key === 'children') return\n                if(key === 'parent') return\n                const value = this.syncdoc.getPropertyValue(item,key)\n                if(PROP_DEFS[key]) return defs.push(copyPropDef(PROP_DEFS[key],value))\n                console.log(\"unknown property\",key)\n            })\n        }\n\n        return defs\n    }\n\n    createCustomEditor(item,def,provider, value, onChange) {\n        if(def.key === PROP_DEFS.fillColor.key) return <HBox>\n            {\n                [\"#ffffff\",\"#ff0000\",\"#ffff00\",\"#00ff00\",\"#00ffff\",\"#0000ff\",\"#ff00ff\",\"#000000\"]\n                    .map(c => <button\n                        key={c}\n                        onClick={()=>onChange(c)}\n                        style={{color:c, padding:'1px', margin:0, borderWidth:0,}}\n                        className={\"fa fa-square\"}/> )\n            }\n        </HBox>\n        if(def.key === PROP_DEFS.pageSize.key) {\n            const obj = fetchGraphObject(this.getDataGraph(),item)\n            return <EnumEditor def={def} provider={this} obj={item} value={obj.pageSize} onChange={onChange}/>\n        }\n        return <i>no custom editor for {def.key}</i>\n    }\n\n    getValuesForEnum(key,obj) {\n        if(key === PROP_DEFS.asset.key) {\n            const children = this.getDataGraph().getPropertyValue(this.getAssetsObject(),'children')\n            return propToArray(this.getDataGraph(),children)\n        }\n        if(key === PROP_DEFS.fontFamily.key) {\n            return Object.keys(STANDARD_FONTS).map(key => STANDARD_FONTS[key])\n        }\n        if(key === PROP_DEFS.verticalAlign.key) {\n            return Object.keys(VERTICAL_ALIGNMENT).map(key => VERTICAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.horizontalAlign.key) {\n            return Object.keys(HORIZONTAL_ALIGNMENT).map(key => HORIZONTAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.pageSize.key) {\n            return STANDARD_PAGE_SIZES.map(s => s.value)\n        }\n    }\n    getRendererForEnum(key,obj) {\n        if(key === PROP_DEFS.asset.key) return EnumTitleRenderer\n        if(key === PROP_DEFS.pageSize.key) return PageSizeRenderer\n    }\n\n\n    getPageSize(page) {\n        const root = this.getSceneRoot()\n        const rootobj = fetchGraphObject(this.getDataGraph(),root)\n        console.log(\"parsing\",rootobj)\n        return parseDimension(rootobj.pageSize)\n    }\n\n\n\n    getShapeDef(type) {\n        return SHAPE_DEFS[type]\n    }\n    getSelectedRoot() {\n        return fetchGraphObject(this.getDataGraph(),this.getSceneRoot())\n    }\n    getSelectedPage() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        while(true) {\n            const type = this.getDataGraph().getPropertyValue(sel, 'type')\n            if(type === 'root') return null\n            if(type === 'page') return fetchGraphObject(this.getDataGraph(),sel)\n            sel = this.getDataGraph().getPropertyValue(sel,'parent')\n            if(!sel) break\n        }\n    }\n\n    getSelectedLayer() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        while(true) {\n            const type = this.getDataGraph().getPropertyValue(sel, 'type')\n            if(type === 'root') return null\n            if(type === 'layer') return fetchGraphObject(this.getDataGraph(),sel)\n            sel = this.getDataGraph().getPropertyValue(sel,'parent')\n            if(!sel) break\n        }\n        console.log(fetchGraphObject(this.getDataGraph(),sel))\n    }\n\n    getSelectedShape() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        const type = this.getDataGraph().getPropertyValue(sel, 'type')\n        if(SHAPE_DEFS[type]) return fetchGraphObject(this.getDataGraph(),sel)\n        return null\n    }\n\n    calculateContextMenu(item) {\n        const obj = fetchGraphObject(this.getDataGraph(),item)\n        if(obj.type === 'assets') {\n            return [{\n                title:'Add Image',\n                icon:'image',\n                fun:this.showAddImageAssetDialog\n            }]\n        }\n        if(obj.type === 'asset') {\n            return [{\n                title:'delete',\n                icon:'close',\n                fun: this.deleteSelectedAsset\n            }]\n        }\n        const cmds =  [\n            {\n                title:'delete',\n                icon:'close',\n                fun: this.deleteSelection\n            },\n            {\n                title:'rect',\n                icon:ICONS.rect,\n                fun: this.addRect\n            },\n            {\n                title:'circle',\n                icon:ICONS.circle,\n                fun: this.addCircle\n            },\n            {\n                title:'text',\n                icon:ICONS.text,\n                fun: this.addText\n            },\n            {\n                title:'image',\n                icon: ICONS.image,\n                fun: this.addImage\n            },\n            {\n                title:'cut',\n                icon: ICONS.cut,\n                fun:this.cutSelection\n            },\n            {\n                title:'copy',\n                icon: ICONS.copy,\n                fun:this.copySelection\n            },\n            {\n                title:'paste',\n                icon: ICONS.paste,\n                fun:this.pasteSelection\n            },\n        ]\n        return cmds\n    }\n\n    addShape = (def) => {\n        const graph = this.getDataGraph()\n        const layer = this.getSelectedLayer()\n        if(!layer) return console.error(\"no layer!\")\n        const shape = def.make(graph,layer)\n        insertAsFirstChild(graph,layer,shape)\n    }\n    addRect   = () => this.addShape(this.getShapeDef('rect'))\n    addCircle = () => this.addShape(this.getShapeDef('circle'))\n    addText   = () => this.addShape(this.getShapeDef('text'))\n    addImage   = () => this.addShape(this.getShapeDef('image'))\n\n    addImageAssetFromFile = (file) => {\n        this.uploadFile(file).then((ans)=>{\n            console.log(\"uploaded file with answer\",ans)\n            const url = getAssetsURL()+ans.id\n            const graph = this.getDataGraph()\n            const asset = fetchGraphObject(graph,graph.createObject({\n                type:'asset',\n                subtype:'image',\n                format:file.type,\n                src:url,\n                width:100,\n                height:100,\n                title:file.name,\n                parent:0\n            }))\n            const assets = fetchGraphObject(graph,this.getAssetsObject())\n            insertAsLastChild(graph,assets,asset)\n            this.requestImageCache(url).then(img => {\n                graph.setProperty(asset.id,'width',img.width)\n                graph.setProperty(asset.id,'height',img.height)\n            })\n        })\n    }\n\n    addImageAssetFromURL = (url) => {\n        //TODO: make this format detection code more robust\n        const name = url.substring(url.lastIndexOf('/')+1)\n        const type = name.substring(name.lastIndexOf(\".\")+1)\n        let fileType = \"image/unknown\"\n        if(type.toLowerCase() === 'png') fileType = 'image/png'\n        if(type.toLowerCase() === 'jpg') fileType = 'image/jpeg'\n        if(type.toLowerCase() === 'jpeg') fileType = 'image/jpeg'\n\n        const graph = this.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:'asset',\n            subtype:'image',\n            format:fileType,\n            src:url,\n            width:100,\n            height:100,\n            title:name,\n            parent:0\n        }))\n        const assets = fetchGraphObject(graph,this.getAssetsObject())\n        insertAsLastChild(graph,assets,asset)\n        this.requestImageCache(url).then(img => {\n            graph.setProperty(asset.id,'width',img.width)\n            graph.setProperty(asset.id,'height',img.height)\n        })\n    }\n    deleteSelection = () => {\n        const graph = this.getDataGraph()\n        // const layer = this.getSelectedLayer()\n        const shape = this.getSelectedShape()\n        if(!shape) return\n        removeFromParent(graph,shape)\n        SelectionManager.clearSelection()\n    }\n    deleteSelectedAsset = () => {\n        const graph = this.getDataGraph()\n        const sel = SelectionManager.getSelection()\n        const obj = fetchGraphObject(graph,sel)\n        removeFromParent(graph,obj)\n        SelectionManager.clearSelection()\n    }\n    cutSelection = () => {\n        const graph = this.getDataGraph()\n        let sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = fetchGraphObject(graph,sel)\n        SelectionManager.setClipboard(obj.id)\n        removeFromParent(graph,obj)\n        SelectionManager.clearSelection()\n    }\n    copySelection = () => {\n        const graph = this.getDataGraph()\n        let sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = fetchGraphObject(graph,sel)\n        SelectionManager.setClipboard(obj.id)\n    }\n    pasteSelection = (e) => {\n        if(e.target && e.target.getAttribute('type') === 'input') return console.log(\"pasting into an input field. don't intercept\")\n        const graph = this.getDataGraph()\n        const shapeid = SelectionManager.getClipboard()\n        const obj1 = fetchGraphObject(graph,shapeid)\n\n        let parent = null\n        if(isShapeType(obj1.type)) parent = this.getSelectedLayer()\n        if(obj1.type === 'layer') parent = this.getSelectedPage()\n        if(obj1.type === 'page') parent = fetchGraphObject(graph,this.getSceneRoot())\n        if (!parent) return console.error(\"no parent to ad too! bad obj type?\",obj1.type)\n\n        const obj2 = cloneShape(graph,obj1)\n        graph.setProperty(obj2.id, 'parent', parent.id)\n        insertAsFirstChild(graph, parent, obj2)\n        return\n    }\n\n    exportSVG = () => {\n        const page = this.getSelectedPage()\n\n        const svg = this.renderSVGWrapper(this.renderSVGChildren(page))\n        const link = document.createElement('a');\n        link.href = 'data:image/svg+xml,'+encodeURIComponent(svg)\n        link.download = 'test.svg'\n        document.body.appendChild(link)\n        link.click()\n    }\n    renderSVGWrapper(str) {\n        return `<svg id=\"svg-canvas\" viewBox=\"0 0 1000 1000\" \n                xmlns=\"http://www.w3.org/2000/svg\" \n                xmlnsXlink=\"http://www.w3.org/1999/xlink\">\n                ${str}</svg>`\n    }\n    renderSVGChildren(obj) {\n        if(obj.type === 'page') return propToArray(this.getDataGraph(),obj.children)\n            .map((layer) => `<g>${this.renderSVGChildren(fetchGraphObject(this.getDataGraph(),layer))}</g>`).join(\"\")\n        if(obj.type === 'layer') return propToArray(this.getDataGraph(),obj.children)\n            .map(shape => this.renderSVGChildren(fetchGraphObject(this.getDataGraph(),shape))).join(\"\")\n        if(SHAPE_DEFS[obj.type]) return SHAPE_DEFS[obj.type].toSVGString(obj,this)\n        return \"\";\n    }\n\n    exportPNG = () => {\n        const page = this.getSelectedPage()\n        const canvas = document.createElement('canvas')\n        const c = canvas.getContext('2d')\n        const g = this.getRawGraph()\n        const size = this.getPageSize(page).as(UNITS.PIXEL, 1, DEFAULT_DPI)\n        canvas.width = size.width\n        canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, canvas.width, canvas.height)\n        if(page) {\n            this.accessObject(page.id).getChildren().forEach(layer => {\n                layer.getChildren().forEach(shape => {\n                    const def = this.getShapeDef(shape.type)\n                    if (def) def.draw(c, g, shape, false, this)\n                })\n            })\n        }\n\n        const link = document.createElement('a');\n        link.href = canvas.toDataURL('image/png')\n        link.download = 'test.png'\n        document.body.appendChild(link)\n        link.click()\n    }\n\n\n    canAddChild(parent,child) {\n        const p = fetchGraphObject(this.getDataGraph(),parent)\n        const c = fetchGraphObject(this.getDataGraph(),child)\n        if(p.type === 'layer' && isShapeType(c.type)) return true\n        if(p.type === 'page' && c.type === 'layer') return true\n        if(p.type === 'root' && c.type === 'page') return true\n        return false\n    }\n    canBeSibling(src,tgt) {\n        const s = fetchGraphObject(this.getDataGraph(),src)\n        const t = fetchGraphObject(this.getDataGraph(),tgt)\n        if(s.type === 'layer' && t.type === 'layer') return true\n        if(s.type === 'page' && t.type === 'page') return true\n        if(isShapeType(s.type) && isShapeType(t.type)) return true\n        return false\n    }\n    canAddExternalChild(parent,child) {\n        const pobj = fetchGraphObject(this.getDataGraph(),parent)\n        // console.log('parent is',pobj)\n        if(pobj.type === 'assets') return true\n        return false\n    }\n    acceptDrop(e,tgt) {\n        const obj = fetchGraphObject(this.getDataGraph(),tgt)\n        if(obj.type === 'assets') {\n            listToArray(e.dataTransfer.files).forEach(file => this.addImageAssetFromFile(file))\n        }\n    }\n\n\n    newView = () => window.open( `./?mode=metadoc&doctype=${this.getDocType()}&doc=${this.getDocId()}`)\n    openPresentationView = () => window.open( `./?mode=view&doctype=${this.getDocType()}&doc=${this.getDocId()}`)\n\n\n    isImageCached(src) {\n        if(this.imagecache[src]) return this.imagecache[src].complete\n        return false\n    }\n    requestImageCache(src) {\n        const img = new Image()\n        this.imagecache[src] = img\n        return new Promise((res,rej) => {\n            img.src = src\n            img.onload = () => {\n                this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,{ provider: this })\n                res(img)\n            }\n        })\n    }\n    getCachedImage(src) {\n        return this.imagecache[src]\n    }\n\n    getAssetsObject = () => this.getDataGraph().getObjectByProperty('type','assets')\n\n    showAddImageAssetDialog = () => DialogManager.show(<AddImageAssetDialog provider={this}/>)\n\n    accessObject = (id) => {\n        return new GraphAccessor(this.getDataGraph()).object(id)\n    }\n\n}\n\n\n\nclass MetadocApp extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            connected:false,\n            zoom: 0,\n            mode:'canvas'\n        }\n\n        this.im = new InputManager()\n        this.im.addKeyBinding({ id:'save',  key:InputManager.KEYS.S, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({ id:'undo', key:InputManager.KEYS.Z,  modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({ id:'redo', key:InputManager.KEYS.Z,  modifiers:[InputManager.MODIFIERS.COMMAND, InputManager.MODIFIERS.SHIFT]})\n        this.im.addListener('save',this.props.provider.save)\n        this.im.addListener('undo',this.props.provider.performUndo)\n        this.im.addListener('redo',this.props.provider.performRedo)\n\n        this.im.addKeyBinding({id:'cut', key:InputManager.KEYS.X, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id:'copy', key:InputManager.KEYS.C, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id:'paste', key:InputManager.KEYS.V, modifiers:[InputManager.MODIFIERS.COMMAND]})\n\n        this.im.addListener('cut',this.props.provider.cutSelection)\n        this.im.addListener('copy',this.props.provider.copySelection)\n        this.im.addListener('paste',this.props.provider.pasteSelection)\n    }\n\n    componentDidMount() {\n        this.im.attachKeyEvents(document)\n        this.props.provider.on('CONNECTED',()=> this.setState({connected: this.props.provider.isConnected()}))\n        SelectionManager.on(SELECTION_MANAGER.CHANGED,()=>{\n            const sel = SelectionManager.getSelection()\n            if(sel) {\n                const item = fetchGraphObject(this.props.provider.getDataGraph(),sel)\n                if(item.type === PROP_DEFS.asset.key) {\n                    this.setState({mode:'asset'})\n                    return\n                }\n            }\n            this.setState({mode:'canvas'})\n        })\n    }\n\n    canvasSelected = (rect) => SelectionManager.setSelection(rect)\n\n\n    showAddPopup = (e) => {\n        const acts = [\n            {\n                title: 'page',\n                icon: ICONS.page,\n                fun: () => this.addPage()\n            },\n            {\n                title: 'layer',\n                icon: ICONS.layer,\n                fun: () => this.addLayer()\n            },\n            {\n                title: 'rect',\n                icon: ICONS.rect,\n                fun: () => this.props.provider.addRect()\n            },\n            {\n                title: 'circle',\n                icon: ICONS.circle,\n                fun: () => this.props.provider.addCircle()\n            },\n            {\n                title: 'text',\n                icon: ICONS.text,\n                fun: () => this.props.provider.addText()\n            },\n            {\n                title:'image',\n                icon: ICONS.image,\n                fun: () => this.props.provider.addImage()\n            },\n        ]\n        PopupManager.show(<MenuPopup actions={acts}/>,e.target)\n    }\n    addPage = () => {\n        const graph = this.props.provider.getDataGraph()\n        const root = this.props.provider.getSelectedRoot()\n        const page = fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'page',\n            title:'new page',\n            parent:root.id,\n            children: graph.createArray()\n        }))\n        insertAsFirstChild(graph,root,page)\n    }\n    addLayer = () => {\n        const graph = this.props.provider.getDataGraph()\n        const page = this.props.provider.getSelectedPage()\n        const layer = fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'layer',\n            title:'new layer',\n            parent:page.id,\n            children:graph.createArray()\n        }))\n        insertAsFirstChild(graph,page,layer)\n    }\n\n    zoomIn  = () => this.setState({zoom:this.state.zoom+1})\n    zoomOut = () => this.setState({zoom:this.state.zoom-1})\n\n    render() {\n        const prov = this.props.provider\n        return <GridEditorApp>\n            <Toolbar left top><label>{prov.getTitle()}</label></Toolbar>\n            <Panel scroll left middle>\n                <TreeTable root={prov.getSceneRoot()} provider={prov}/>\n            </Panel>\n\n            <Toolbar left bottom>\n                <button className=\"fa fa-plus\" onClick={this.showAddPopup}/>\n                <button className=\"fa fa-close\" onClick={prov.deleteSelection}/>\n                <button className=\"fa fa-file-image-o\" onClick={prov.showAddImageAssetDialog}/>\n            </Toolbar>\n\n            <Toolbar center top>\n                <button className=\"fa fa-save\" onClick={prov.save}/>\n                <button className=\"fa fa-download\" onClick={prov.exportSVG}> SVG</button>\n                <button className=\"fa fa-download\" onClick={prov.exportPNG}> PNG</button>\n                <button className=\"fa fa-undo\" onClick={prov.performUndo}/>\n                <button className=\"fa fa-repeat\" onClick={prov.performRedo}/>\n                <button className=\"fa fa-search-plus\" onClick={this.zoomIn}/>\n                <button className=\"fa fa-search-minus\" onClick={this.zoomOut}/>\n                <Spacer/>\n                <button className=\"fa fa-cut\" onClick={prov.cutSelection}/>\n                <button className=\"fa fa-copy\" onClick={prov.copySelection}/>\n                <button className=\"fa fa-paste\" onClick={prov.pasteSelection}/>\n                <Spacer/>\n                <button className=\"fa fa-play\" onClick={prov.openPresentationView}/>\n                <button className=\"fa fa-plus\" onClick={prov.newView}> view</button>\n                <button className=\"fa fa-superpowers\" onClick={prov.toggleConnected}>{this.state.connected?\"disconnect\":\"connect\"}</button>\n            </Toolbar>\n\n            <Panel center middle scroll>\n                {this.renderCenterPane(this.state.mode)}\n            </Panel>\n\n            <Panel scroll right><PropSheet provider={prov}/></Panel>\n\n            <Toolbar right top/>\n            <Toolbar right bottom/>\n\n        </GridEditorApp>\n    }\n\n    renderCenterPane(mode) {\n        if (mode === 'canvas') {\n            return <MetadocCanvas prov={this.props.provider} onSelect={this.canvasSelected} scale={Math.pow(2, this.state.zoom)}/>\n        } else {\n            const sel = SelectionManager.getSelection()\n            return <AssetView provider={this.props.provider} asset={sel}/>\n        }\n    }\n}\n\n\n","/* eslint-disable */\nconst THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author arodic / https://github.com/arodic\n */\n\nconst TransformControls = function ( camera, domElement ) {\n\n    THREE.Object3D.call( this );\n\n    domElement = ( domElement !== undefined ) ? domElement : document;\n\n    this.visible = false;\n\n    var _gizmo = new TransformControlsGizmo();\n    this.add( _gizmo );\n\n    var _plane = new TransformControlsPlane();\n    this.add( _plane );\n\n    var scope = this;\n\n    // Define properties with getters/setter\n    // Setting the defined property will automatically trigger change event\n    // Defined properties are passed down to gizmo and plane\n\n    defineProperty( \"camera\", camera );\n    defineProperty( \"object\", undefined );\n    defineProperty( \"enabled\", true );\n    defineProperty( \"axis\", null );\n    defineProperty( \"mode\", \"translate\" );\n    defineProperty( \"translationSnap\", null );\n    defineProperty( \"rotationSnap\", null );\n    defineProperty( \"space\", \"world\" );\n    defineProperty( \"size\", 1 );\n    defineProperty( \"dragging\", false );\n    defineProperty( \"showX\", true );\n    defineProperty( \"showY\", true );\n    defineProperty( \"showZ\", true );\n\n    var changeEvent = { type: \"change\" };\n    var mouseDownEvent = { type: \"mouseDown\" };\n    var mouseUpEvent = { type: \"mouseUp\", mode: scope.mode };\n    var objectChangeEvent = { type: \"objectChange\" };\n\n    // Reusable utility variables\n\n    var ray = new THREE.Raycaster();\n\n    var _tempVector = new THREE.Vector3();\n    var _tempVector2 = new THREE.Vector3();\n    var _tempQuaternion = new THREE.Quaternion();\n    var _unit = {\n        X: new THREE.Vector3( 1, 0, 0 ),\n        Y: new THREE.Vector3( 0, 1, 0 ),\n        Z: new THREE.Vector3( 0, 0, 1 )\n    };\n    var _identityQuaternion = new THREE.Quaternion();\n    var _alignVector = new THREE.Vector3();\n\n    var pointStart = new THREE.Vector3();\n    var pointEnd = new THREE.Vector3();\n    var rotationAxis = new THREE.Vector3();\n    var rotationAngle = 0;\n\n    var cameraPosition = new THREE.Vector3();\n    var cameraQuaternion = new THREE.Quaternion();\n    var cameraScale = new THREE.Vector3();\n\n    var parentPosition = new THREE.Vector3();\n    var parentQuaternion = new THREE.Quaternion();\n    var parentScale = new THREE.Vector3();\n\n    var worldPositionStart = new THREE.Vector3();\n    var worldQuaternionStart = new THREE.Quaternion();\n    var worldScaleStart = new THREE.Vector3();\n\n    var worldPosition = new THREE.Vector3();\n    var worldQuaternion = new THREE.Quaternion();\n    var worldScale = new THREE.Vector3();\n\n    var eye = new THREE.Vector3();\n\n    var _positionStart = new THREE.Vector3();\n    var _quaternionStart = new THREE.Quaternion();\n    var _scaleStart = new THREE.Vector3();\n\n    // TODO: remove properties unused in plane and gizmo\n\n    defineProperty( \"parentQuaternion\", parentQuaternion );\n    defineProperty( \"worldPosition\", worldPosition );\n    defineProperty( \"worldPositionStart\", worldPositionStart );\n    defineProperty( \"worldQuaternion\", worldQuaternion );\n    defineProperty( \"worldQuaternionStart\", worldQuaternionStart );\n    defineProperty( \"cameraPosition\", cameraPosition );\n    defineProperty( \"cameraQuaternion\", cameraQuaternion );\n    defineProperty( \"pointStart\", pointStart );\n    defineProperty( \"pointEnd\", pointEnd );\n    defineProperty( \"rotationAxis\", rotationAxis );\n    defineProperty( \"rotationAngle\", rotationAngle );\n    defineProperty( \"eye\", eye );\n\n\n\n        domElement.addEventListener( \"mousedown\", onPointerDown, false );\n        domElement.addEventListener( \"touchstart\", onPointerDown, false );\n        domElement.addEventListener( \"mousemove\", onPointerHover, false );\n        domElement.addEventListener( \"touchmove\", onPointerHover, false );\n        domElement.addEventListener( \"touchmove\", onPointerMove, false );\n        document.addEventListener( \"mouseup\", onPointerUp, false );\n        domElement.addEventListener( \"touchend\", onPointerUp, false );\n        domElement.addEventListener( \"touchcancel\", onPointerUp, false );\n        domElement.addEventListener( \"touchleave\", onPointerUp, false );\n        domElement.addEventListener( \"contextmenu\", onContext, false );\n\n\n\n    this.dispose = function () {\n\n        domElement.removeEventListener( \"mousedown\", onPointerDown );\n        domElement.removeEventListener( \"touchstart\", onPointerDown );\n        domElement.removeEventListener( \"mousemove\", onPointerHover );\n        domElement.removeEventListener( \"touchmove\", onPointerHover );\n        domElement.removeEventListener( \"touchmove\", onPointerMove );\n        document.removeEventListener( \"mouseup\", onPointerUp );\n        domElement.removeEventListener( \"touchend\", onPointerUp );\n        domElement.removeEventListener( \"touchcancel\", onPointerUp );\n        domElement.removeEventListener( \"touchleave\", onPointerUp );\n        domElement.removeEventListener( \"contextmenu\", onContext );\n\n    };\n\n    // Set current object\n    this.attach = function ( object ) {\n\n        this.object = object;\n        this.visible = true;\n\n    };\n\n    // Detatch from object\n    this.detach = function () {\n\n        this.object = undefined;\n        this.visible = false;\n        this.axis = null;\n\n    };\n\n    // Defined getter, setter and store for a property\n    function defineProperty( propName, defaultValue ) {\n\n        var propValue = defaultValue;\n\n        Object.defineProperty( scope, propName, {\n\n            get: function() {\n\n                return propValue !== undefined ? propValue : defaultValue;\n\n            },\n\n            set: function( value ) {\n\n                if ( propValue !== value ) {\n\n                    propValue = value;\n                    _plane[ propName ] = value;\n                    _gizmo[ propName ] = value;\n\n                    scope.dispatchEvent( { type: propName + \"-changed\", value: value } );\n                    scope.dispatchEvent( changeEvent );\n\n                }\n\n            }\n\n        });\n\n        scope[ propName ] = defaultValue;\n        _plane[ propName ] = defaultValue;\n        _gizmo[ propName ] = defaultValue;\n\n    }\n\n    // updateMatrixWorld  updates key transformation variables\n    this.updateMatrixWorld = function () {\n\n        if ( this.object !== undefined ) {\n\n            this.object.updateMatrixWorld();\n            this.object.parent.matrixWorld.decompose( parentPosition, parentQuaternion, parentScale );\n            this.object.matrixWorld.decompose( worldPosition, worldQuaternion, worldScale );\n\n        }\n\n        this.camera.updateMatrixWorld();\n        this.camera.matrixWorld.decompose( cameraPosition, cameraQuaternion, cameraScale );\n\n        if ( this.camera instanceof THREE.PerspectiveCamera ) {\n\n            eye.copy( cameraPosition ).sub( worldPosition ).normalize();\n\n        } else if ( this.camera instanceof THREE.OrthographicCamera ) {\n\n            eye.copy( cameraPosition ).normalize();\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n    this.pointerHover = function( pointer ) {\n\n        if ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        ray.setFromCamera( pointer, this.camera );\n\n        var intersect = ray.intersectObjects( _gizmo.picker[ this.mode ].children, true )[ 0 ] || false;\n\n        if ( intersect ) {\n\n            this.axis = intersect.object.name;\n\n        } else {\n\n            this.axis = null;\n\n        }\n\n    };\n\n    this.pointerDown = function( pointer ) {\n\n        if ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        if ( ( pointer.button === 0 || pointer.button === undefined ) && this.axis !== null ) {\n\n            ray.setFromCamera( pointer, this.camera );\n\n            var planeIntersect = ray.intersectObjects( [ _plane ], true )[ 0 ] || false;\n\n            if ( planeIntersect ) {\n\n                var space = this.space;\n\n                if ( this.mode === 'scale') {\n\n                    space = 'local';\n\n                } else if ( this.axis === 'E' ||  this.axis === 'XYZE' ||  this.axis === 'XYZ' ) {\n\n                    space = 'world';\n\n                }\n\n                if ( space === 'local' && this.mode === 'rotate' ) {\n\n                    var snap = this.rotationSnap;\n\n                    if ( this.axis === 'X' && snap ) this.object.rotation.x = Math.round( this.object.rotation.x / snap ) * snap;\n                    if ( this.axis === 'Y' && snap ) this.object.rotation.y = Math.round( this.object.rotation.y / snap ) * snap;\n                    if ( this.axis === 'Z' && snap ) this.object.rotation.z = Math.round( this.object.rotation.z / snap ) * snap;\n\n                }\n\n                this.object.updateMatrixWorld();\n                this.object.parent.updateMatrixWorld();\n\n                _positionStart.copy( this.object.position );\n                _quaternionStart.copy( this.object.quaternion );\n                _scaleStart.copy( this.object.scale );\n\n                this.object.matrixWorld.decompose( worldPositionStart, worldQuaternionStart, worldScaleStart );\n\n                pointStart.copy( planeIntersect.point ).sub( worldPositionStart );\n\n                if ( space === 'local' ) pointStart.applyQuaternion( worldQuaternionStart.clone().inverse() );\n\n            }\n\n            this.dragging = true;\n            mouseDownEvent.mode = this.mode;\n            this.dispatchEvent( mouseDownEvent );\n\n        }\n\n    };\n\n    this.pointerMove = function( pointer ) {\n\n        var axis = this.axis;\n        var mode = this.mode;\n        var object = this.object;\n        var space = this.space;\n\n        if ( mode === 'scale') {\n\n            space = 'local';\n\n        } else if ( axis === 'E' ||  axis === 'XYZE' ||  axis === 'XYZ' ) {\n\n            space = 'world';\n\n        }\n\n        if ( object === undefined || axis === null || this.dragging === false || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        ray.setFromCamera( pointer, this.camera );\n\n        var planeIntersect = ray.intersectObjects( [ _plane ], true )[ 0 ] || false;\n\n        if ( planeIntersect === false ) return;\n\n        pointEnd.copy( planeIntersect.point ).sub( worldPositionStart );\n\n        if ( space === 'local' ) pointEnd.applyQuaternion( worldQuaternionStart.clone().inverse() );\n\n        if ( mode === 'translate' ) {\n\n            if ( axis.search( 'X' ) === -1 ) {\n                pointEnd.x = pointStart.x;\n            }\n            if ( axis.search( 'Y' ) === -1 ) {\n                pointEnd.y = pointStart.y;\n            }\n            if ( axis.search( 'Z' ) === -1 ) {\n                pointEnd.z = pointStart.z;\n            }\n\n            // Apply translate\n\n            if ( space === 'local' ) {\n                object.position.copy( pointEnd ).sub( pointStart ).applyQuaternion( _quaternionStart );\n            } else {\n                object.position.copy( pointEnd ).sub( pointStart );\n            }\n\n            object.position.add( _positionStart );\n\n            // Apply translation snap\n\n            if ( this.translationSnap ) {\n\n                if ( space === 'local' ) {\n\n                    object.position.applyQuaternion(_tempQuaternion.copy( _quaternionStart ).inverse() );\n\n                    if ( axis.search( 'X' ) !== -1 ) {\n                        object.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Y' ) !== -1 ) {\n                        object.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Z' ) !== -1 ) {\n                        object.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    object.position.applyQuaternion( _quaternionStart );\n\n                }\n\n                if ( space === 'world' ) {\n\n                    if ( object.parent ) {\n                        object.position.add( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n                    }\n\n                    if ( axis.search( 'X' ) !== -1 ) {\n                        object.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Y' ) !== -1 ) {\n                        object.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Z' ) !== -1 ) {\n                        object.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( object.parent ) {\n                        object.position.sub( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n                    }\n\n                }\n\n            }\n\n        } else if ( mode === 'scale' ) {\n\n            if ( axis.search( 'XYZ' ) !== -1 ) {\n\n                var d = pointEnd.length() / pointStart.length();\n\n                if ( pointEnd.dot( pointStart ) < 0 ) d *= -1;\n\n                _tempVector.set( d, d, d );\n\n            } else {\n\n                _tempVector.copy( pointEnd ).divide( pointStart );\n\n                if ( axis.search( 'X' ) === -1 ) {\n                    _tempVector.x = 1;\n                }\n                if ( axis.search( 'Y' ) === -1 ) {\n                    _tempVector.y = 1;\n                }\n                if ( axis.search( 'Z' ) === -1 ) {\n                    _tempVector.z = 1;\n                }\n\n            }\n\n            // Apply scale\n\n            object.scale.copy( _scaleStart ).multiply( _tempVector );\n\n        } else if ( mode === 'rotate' ) {\n\n            var ROTATION_SPEED = 20 / worldPosition.distanceTo( _tempVector.setFromMatrixPosition( this.camera.matrixWorld ) );\n\n            var quaternion = this.space === \"local\" ? worldQuaternion : _identityQuaternion;\n\n            var unit = _unit[ axis ];\n\n            if ( axis === 'E' ) {\n\n                _tempVector.copy( pointEnd ).cross( pointStart );\n                rotationAxis.copy( eye );\n                rotationAngle = pointEnd.angleTo( pointStart ) * ( _tempVector.dot( eye ) < 0 ? 1 : -1 );\n\n            } else if ( axis === 'XYZE' ) {\n\n                _tempVector.copy( pointEnd ).sub( pointStart ).cross( eye ).normalize();\n                rotationAxis.copy( _tempVector );\n                rotationAngle = pointEnd.sub( pointStart ).dot( _tempVector.cross( eye ) ) * ROTATION_SPEED;\n\n            } else if ( axis === 'X' || axis === 'Y' || axis === 'Z' ) {\n\n                _alignVector.copy( unit ).applyQuaternion( quaternion );\n\n                rotationAxis.copy( unit );\n\n                _tempVector = unit.clone();\n                _tempVector2 = pointEnd.clone().sub( pointStart );\n                if ( space === 'local' ) {\n                    _tempVector.applyQuaternion( quaternion );\n                    _tempVector2.applyQuaternion( worldQuaternionStart );\n                }\n                rotationAngle = _tempVector2.dot( _tempVector.cross( eye ).normalize() ) * ROTATION_SPEED;\n\n            }\n\n            // Apply rotation snap\n\n            if ( this.rotationSnap ) rotationAngle = Math.round( rotationAngle / this.rotationSnap ) * this.rotationSnap;\n\n            this.rotationAngle = rotationAngle;\n\n            // Apply rotate\n\n            if ( space === 'local' ) {\n\n                object.quaternion.copy( _quaternionStart );\n                object.quaternion.multiply( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n\n            } else {\n\n                object.quaternion.copy( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n                object.quaternion.multiply( _quaternionStart );\n\n            }\n\n        }\n\n        this.dispatchEvent( changeEvent );\n        this.dispatchEvent( objectChangeEvent );\n\n    };\n\n    this.pointerUp = function( pointer ) {\n\n        if ( pointer.button !== undefined && pointer.button !== 0 ) return;\n\n        if ( this.dragging && ( this.axis !== null ) ) {\n\n            mouseUpEvent.mode = this.mode;\n            this.dispatchEvent( mouseUpEvent );\n\n        }\n\n        this.dragging = false;\n\n        if ( pointer.button === undefined ) this.axis = null;\n\n    };\n\n    // normalize mouse / touch pointer and remap {x,y} to view space.\n\n    function getPointer( event ) {\n\n        var pointer = event.changedTouches ? event.changedTouches[ 0 ] : event;\n\n        var rect = domElement.getBoundingClientRect();\n\n        return {\n            x: ( pointer.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( pointer.clientY - rect.top ) / rect.height * 2 + 1,\n            button: event.button\n        };\n\n    }\n\n    // mouse / touch event handlers\n\n    function onContext( event ) {\n\n        event.preventDefault();\n\n    }\n\n    function onPointerHover( event ) {\n\n        if ( !scope.enabled ) return;\n\n        scope.pointerHover( getPointer( event ) );\n\n    }\n\n    function onPointerDown( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault();\n\n        document.addEventListener( \"mousemove\", onPointerMove, false );\n\n        scope.pointerHover( getPointer( event ) );\n        scope.pointerDown( getPointer( event ) );\n\n    }\n\n    function onPointerMove( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault();\n\n        scope.pointerMove( getPointer( event ) );\n\n    }\n\n    function onPointerUp( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault(); // Prevent MouseEvent on mobile\n\n        document.removeEventListener( \"mousemove\", onPointerMove, false );\n\n        scope.pointerUp( getPointer( event ) );\n\n    }\n\n    // TODO: depricate\n\n    this.getMode = function () {\n\n        return scope.mode;\n\n    };\n\n    this.setMode = function ( mode ) {\n\n        scope.mode = mode;\n\n    };\n\n    this.setTranslationSnap = function ( translationSnap ) {\n\n        scope.translationSnap = translationSnap;\n\n    };\n\n    this.setRotationSnap = function ( rotationSnap ) {\n\n        scope.rotationSnap = rotationSnap;\n\n    };\n\n    this.setSize = function ( size ) {\n\n        scope.size = size;\n\n    };\n\n    this.setSpace = function ( space ) {\n\n        scope.space = space;\n\n    };\n\n    this.update = function () {\n\n        console.warn( 'TransformControls: update function has been depricated.' );\n\n    };\n\n};\n\nTransformControls.prototype = Object.assign( Object.create( THREE.Object3D.prototype ), {\n\n    constructor: TransformControls,\n\n    isTransformControls: true\n\n} );\n\n\nconst TransformControlsGizmo = function () {\n\n\n    THREE.Object3D.call( this );\n\n    this.type = 'TransformControlsGizmo';\n\n    // shared materials\n\n    var gizmoMaterial = new THREE.MeshBasicMaterial({\n        depthTest: false,\n        depthWrite: false,\n        transparent: true,\n        side: THREE.DoubleSide,\n        fog: false\n    });\n\n    var gizmoLineMaterial = new THREE.LineBasicMaterial({\n        depthTest: false,\n        depthWrite: false,\n        transparent: true,\n        linewidth: 1,\n        fog: false\n    });\n\n    // Make unique material for each axis/color\n\n    var matInvisible = gizmoMaterial.clone();\n    matInvisible.opacity = 0.15;\n\n    var matHelper = gizmoMaterial.clone();\n    matHelper.opacity = 0.33;\n\n    var matRed = gizmoMaterial.clone();\n    matRed.color.set( 0xff0000 );\n\n    var matGreen = gizmoMaterial.clone();\n    matGreen.color.set( 0x00ff00 );\n\n    var matBlue = gizmoMaterial.clone();\n    matBlue.color.set( 0x0000ff );\n\n    var matWhiteTransperent = gizmoMaterial.clone();\n    matWhiteTransperent.opacity = 0.25;\n\n    var matYellowTransparent = matWhiteTransperent.clone();\n    matYellowTransparent.color.set( 0xffff00 );\n\n    var matCyanTransparent = matWhiteTransperent.clone();\n    matCyanTransparent.color.set( 0x00ffff );\n\n    var matMagentaTransparent = matWhiteTransperent.clone();\n    matMagentaTransparent.color.set( 0xff00ff );\n\n    var matYellow = gizmoMaterial.clone();\n    matYellow.color.set( 0xffff00 );\n\n    var matLineRed = gizmoLineMaterial.clone();\n    matLineRed.color.set( 0xff0000 );\n\n    var matLineGreen = gizmoLineMaterial.clone();\n    matLineGreen.color.set( 0x00ff00 );\n\n    var matLineBlue = gizmoLineMaterial.clone();\n    matLineBlue.color.set( 0x0000ff );\n\n    var matLineCyan = gizmoLineMaterial.clone();\n    matLineCyan.color.set( 0x00ffff );\n\n    var matLineMagenta = gizmoLineMaterial.clone();\n    matLineMagenta.color.set( 0xff00ff );\n\n    var matLineYellow = gizmoLineMaterial.clone();\n    matLineYellow.color.set( 0xffff00 );\n\n    var matLineGray = gizmoLineMaterial.clone();\n    matLineGray.color.set( 0x787878);\n\n    var matLineYellowTransparent = matLineYellow.clone();\n    matLineYellowTransparent.opacity = 0.25;\n\n    // reusable geometry\n\n    var arrowGeometry = new THREE.CylinderBufferGeometry( 0, 0.05, 0.2, 12, 1, false);\n\n    var scaleHandleGeometry = new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125);\n\n    var lineGeometry = new THREE.BufferGeometry( );\n    lineGeometry.addAttribute('position', new THREE.Float32BufferAttribute( [ 0, 0, 0,\t1, 0, 0 ], 3 ) );\n\n    var CircleGeometry = function( radius, arc ) {\n\n        var geometry = new THREE.BufferGeometry( );\n        var vertices = [];\n\n        for ( var i = 0; i <= 64 * arc; ++i ) {\n\n            vertices.push( 0, Math.cos( i / 32 * Math.PI ) * radius, Math.sin( i / 32 * Math.PI ) * radius );\n\n        }\n\n        geometry.addAttribute('position', new THREE.Float32BufferAttribute( vertices, 3 ) );\n\n        return geometry;\n\n    };\n\n    // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n    var TranslateHelperGeometry = function( radius, arc ) {\n\n        var geometry = new THREE.BufferGeometry()\n\n        geometry.addAttribute('position', new THREE.Float32BufferAttribute( [ 0, 0, 0, 1, 1, 1 ], 3 ) );\n\n        return geometry;\n\n    };\n\n    // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n    var gizmoTranslate = {\n        X: [\n            [ new THREE.Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, -Math.PI / 2 ], null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, Math.PI / 2 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineRed ) ]\n        ],\n        Y: [\n            [ new THREE.Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], null, null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], [ Math.PI, 0, 0 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ Math.PI / 2, 0, 0 ], null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ -Math.PI / 2, 0, 0 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineBlue ), null, [ 0, -Math.PI / 2, 0 ] ]\n        ],\n        XYZ: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.1, 0 ), matWhiteTransperent ), [ 0, 0, 0 ], [ 0, 0, 0 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matYellowTransparent ), [ 0.15, 0.15, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.18, 0.3, 0 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.3, 0.18, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matCyanTransparent ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.18, 0.3 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.3, 0.18 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matMagentaTransparent ), [ 0.15, 0, 0.15 ], [ -Math.PI / 2, 0, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.18, 0, 0.3 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.3, 0, 0.18 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ]\n    };\n\n    var pickerTranslate = {\n        X: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0.6, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0.6, 0 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0, 0.6 ], [ Math.PI / 2, 0, 0 ] ]\n        ],\n        XYZ: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.2, 0 ), matInvisible ) ]\n        ],\n        XY: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0.2, 0 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0, 0.2, 0.2 ], [ 0, Math.PI / 2, 0 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0, 0.2 ], [ -Math.PI / 2, 0, 0 ] ]\n        ]\n    };\n\n    var helperTranslate = {\n        START: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n        ],\n        END: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n        ],\n        DELTA: [\n            [ new THREE.Line( TranslateHelperGeometry(), matHelper ), null, null, null, 'helper' ]\n        ],\n        X: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Y: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, -1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Z: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, 0, -1e3 ], [ 0, -Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    var gizmoRotate = {\n        X: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineRed ) ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matRed ), [ 0, 0, 0.99 ], null, [ 1, 3, 1 ] ],\n        ],\n        Y: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineGreen ), null, [ 0, 0, -Math.PI / 2 ] ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matGreen ), [ 0, 0, 0.99 ], null, [ 3, 1, 1 ] ],\n        ],\n        Z: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineBlue ), null, [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matBlue ), [ 0.99, 0, 0 ], null, [ 1, 3, 1 ] ],\n        ],\n        E: [\n            [ new THREE.Line( CircleGeometry( 1.25, 1 ), matLineYellowTransparent ), null, [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 1.17, 0, 0 ], [ 0, 0, -Math.PI / 2 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ -1.17, 0, 0 ], [ 0, 0, Math.PI / 2 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, -1.17, 0 ], [ Math.PI, 0, 0 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, 1.17, 0 ], [ 0, 0, 0 ], [ 1, 1, 0.001 ]],\n        ],\n        XYZE: [\n            [ new THREE.Line( CircleGeometry( 1, 1 ), matLineGray ), null, [ 0, Math.PI / 2, 0 ] ]\n        ]\n    };\n\n    var helperRotate = {\n        AXIS: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    var pickerRotate = {\n        X: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, -Math.PI / 2, -Math.PI / 2 ] ],\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ] ],\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ],\n        ],\n        E: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1.25, 0.1, 2, 24 ), matInvisible ) ]\n        ],\n        XYZE: [\n            [ new THREE.Mesh( new THREE.SphereBufferGeometry( 0.7, 10, 8 ), matInvisible ) ]\n        ]\n    };\n\n    var gizmoScale = {\n        X: [\n            [ new THREE.Mesh( scaleHandleGeometry, matRed ), [ 0.8, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineRed ), null, null, [ 0.8, 1, 1 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( scaleHandleGeometry, matGreen ), [ 0, 0.8, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ], [ 0.8, 1, 1 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, 0.8 ], [ Math.PI / 2, 0, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineBlue ), null, [ 0, -Math.PI / 2, 0 ], [ 0.8, 1, 1 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( scaleHandleGeometry, matYellowTransparent ), [ 0.85, 0.85, 0 ], null, [ 2, 2, 0.2 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.855, 0.98, 0 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.98, 0.855, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matCyanTransparent ), [ 0, 0.85, 0.85 ], null, [ 0.2, 2, 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.855, 0.98 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.98, 0.855 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matMagentaTransparent ), [ 0.85, 0, 0.85 ], null, [ 2, 0.2, 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.855, 0, 0.98 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.98, 0, 0.855 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XYZX: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 1.1, 0, 0 ] ],\n        ],\n        XYZY: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 0, 1.1, 0 ] ],\n        ],\n        XYZZ: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 0, 0, 1.1 ] ],\n        ]\n    };\n\n    var pickerScale = {\n        X: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0.5, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0.5, 0 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0.85, 0 ], null, [ 3, 3, 0.2 ] ],\n        ],\n        YZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0, 0.85, 0.85 ], null, [ 0.2, 3, 3 ] ],\n        ],\n        XZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0, 0.85 ], null, [ 3, 0.2, 3 ] ],\n        ],\n        XYZX: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 1.1, 0, 0 ] ],\n        ],\n        XYZY: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 1.1, 0 ] ],\n        ],\n        XYZZ: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 0, 1.1 ] ],\n        ]\n    };\n\n    var helperScale = {\n        X: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Y: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, -1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Z: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, 0, -1e3 ], [ 0, -Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    // Creates an Object3D with gizmos described in custom hierarchy definition.\n\n    var setupGizmo = function( gizmoMap ) {\n\n        var gizmo = new THREE.Object3D();\n\n        for ( var name in gizmoMap ) {\n\n            for ( var i = gizmoMap[ name ].length; i --; ) {\n\n                var object = gizmoMap[ name ][ i ][ 0 ].clone();\n                var position = gizmoMap[ name ][ i ][ 1 ];\n                var rotation = gizmoMap[ name ][ i ][ 2 ];\n                var scale = gizmoMap[ name ][ i ][ 3 ];\n                var tag = gizmoMap[ name ][ i ][ 4 ];\n\n                // name and tag properties are essential for picking and updating logic.\n                object.name = name;\n                object.tag = tag;\n\n                if (position) {\n                    object.position.set(position[ 0 ], position[ 1 ], position[ 2 ]);\n                }\n                if (rotation) {\n                    object.rotation.set(rotation[ 0 ], rotation[ 1 ], rotation[ 2 ]);\n                }\n                if (scale) {\n                    object.scale.set(scale[ 0 ], scale[ 1 ], scale[ 2 ]);\n                }\n\n                object.updateMatrix();\n\n                var tempGeometry = object.geometry.clone();\n                tempGeometry.applyMatrix(object.matrix);\n                object.geometry = tempGeometry;\n\n                object.position.set( 0, 0, 0 );\n                object.rotation.set( 0, 0, 0 );\n                object.scale.set(1, 1, 1);\n\n                gizmo.add(object);\n\n            }\n\n        }\n\n        return gizmo;\n\n    };\n\n    // Reusable utility variables\n\n    var tempVector = new THREE.Vector3( 0, 0, 0 );\n    var tempEuler = new THREE.Euler();\n    var alignVector = new THREE.Vector3( 0, 1, 0 );\n    var zeroVector = new THREE.Vector3( 0, 0, 0 );\n    var lookAtMatrix = new THREE.Matrix4();\n    var tempQuaternion = new THREE.Quaternion();\n    var tempQuaternion2 = new THREE.Quaternion();\n    var identityQuaternion = new THREE.Quaternion();\n\n    var unitX = new THREE.Vector3( 1, 0, 0 );\n    var unitY = new THREE.Vector3( 0, 1, 0 );\n    var unitZ = new THREE.Vector3( 0, 0, 1 );\n\n    // Gizmo creation\n\n    this.gizmo = {};\n    this.picker = {};\n    this.helper = {};\n\n    this.add( this.gizmo[ \"translate\" ] = setupGizmo( gizmoTranslate ) );\n    this.add( this.gizmo[ \"rotate\" ] = setupGizmo( gizmoRotate ) );\n    this.add( this.gizmo[ \"scale\" ] = setupGizmo( gizmoScale ) );\n    this.add( this.picker[ \"translate\" ] = setupGizmo( pickerTranslate ) );\n    this.add( this.picker[ \"rotate\" ] = setupGizmo( pickerRotate ) );\n    this.add( this.picker[ \"scale\" ] = setupGizmo( pickerScale ) );\n    this.add( this.helper[ \"translate\" ] = setupGizmo( helperTranslate ) );\n    this.add( this.helper[ \"rotate\" ] = setupGizmo( helperRotate ) );\n    this.add( this.helper[ \"scale\" ] = setupGizmo( helperScale ) );\n\n    // Pickers should be hidden always\n\n    this.picker[ \"translate\" ].visible = false;\n    this.picker[ \"rotate\" ].visible = false;\n    this.picker[ \"scale\" ].visible = false;\n\n    // updateMatrixWorld will update transformations and appearance of individual handles\n\n    this.updateMatrixWorld = function () {\n\n        var space = this.space;\n\n        if ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n        var quaternion = space === \"local\" ? this.worldQuaternion : identityQuaternion;\n\n        // Show only gizmos for current transform mode\n\n        this.gizmo[ \"translate\" ].visible = this.mode === \"translate\";\n        this.gizmo[ \"rotate\" ].visible = this.mode === \"rotate\";\n        this.gizmo[ \"scale\" ].visible = this.mode === \"scale\";\n\n        this.helper[ \"translate\" ].visible = this.mode === \"translate\";\n        this.helper[ \"rotate\" ].visible = this.mode === \"rotate\";\n        this.helper[ \"scale\" ].visible = this.mode === \"scale\";\n\n\n        var handles = [];\n        handles = handles.concat( this.picker[ this.mode ].children );\n        handles = handles.concat( this.gizmo[ this.mode ].children );\n        handles = handles.concat( this.helper[ this.mode ].children );\n\n        for ( var i = 0; i < handles.length; i++ ) {\n\n            var handle = handles[i];\n\n            // hide aligned to camera\n\n            handle.visible = true;\n            handle.rotation.set( 0, 0, 0 );\n            handle.position.copy( this.worldPosition );\n\n            var eyeDistance = this.worldPosition.distanceTo( this.cameraPosition);\n            handle.scale.set( 1, 1, 1 ).multiplyScalar( eyeDistance * this.size / 7 );\n\n            // TODO: simplify helpers and consider decoupling from gizmo\n\n            if ( handle.tag === 'helper' ) {\n\n                handle.visible = false;\n\n                if ( handle.name === 'AXIS' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.visible = !!this.axis;\n\n                    if ( this.axis === 'X' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, 0, 0 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'Y' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, 0, Math.PI / 2 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'Z' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'XYZE' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n                        alignVector.copy( this.rotationAxis );\n                        handle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( zeroVector, alignVector, unitY ) );\n                        handle.quaternion.multiply( tempQuaternion );\n                        handle.visible = this.dragging;\n\n                    }\n\n                    if ( this.axis === 'E' ) {\n\n                        handle.visible = false;\n\n                    }\n\n\n                } else if ( handle.name === 'START' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.visible = this.dragging;\n\n                } else if ( handle.name === 'END' ) {\n\n                    handle.position.copy( this.worldPosition );\n                    handle.visible = this.dragging;\n\n                } else if ( handle.name === 'DELTA' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.quaternion.copy( this.worldQuaternionStart );\n                    tempVector.set( 1e-10, 1e-10, 1e-10 ).add( this.worldPositionStart ).sub( this.worldPosition ).multiplyScalar( -1 );\n                    tempVector.applyQuaternion( this.worldQuaternionStart.clone().inverse() );\n                    handle.scale.copy( tempVector );\n                    handle.visible = this.dragging;\n\n                } else {\n\n                    handle.quaternion.copy( quaternion );\n\n                    if ( this.dragging ) {\n\n                        handle.position.copy( this.worldPositionStart );\n\n                    } else {\n\n                        handle.position.copy( this.worldPosition );\n\n                    }\n\n                    if ( this.axis ) {\n\n                        handle.visible = this.axis.search( handle.name ) !== -1;\n\n                    }\n\n                }\n\n                // If updating helper, skip rest of the loop\n                continue;\n\n            }\n\n            // Align handles to current local or world rotation\n\n            handle.quaternion.copy( quaternion );\n\n            if ( this.mode === 'translate' || this.mode === 'scale' ) {\n\n                // Hide translate and scale axis facing the camera\n\n                var AXIS_HIDE_TRESHOLD = 0.99;\n                var PLANE_HIDE_TRESHOLD = 0.2;\n                var AXIS_FLIP_TRESHOLD = -0.4;\n\n\n                if ( handle.name === 'X' || handle.name === 'XYZX' ) {\n                    if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'Y' || handle.name === 'XYZY' ) {\n                    if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'Z' || handle.name === 'XYZZ' ) {\n                    if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'XY' ) {\n                    if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'YZ' ) {\n                    if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'XZ' ) {\n                    if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n\n                // Flip translate and scale axis ocluded behind another axis\n\n                if ( handle.name.search( 'X' ) !== -1 ) {\n                    if ( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.x *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n                if ( handle.name.search( 'Y' ) !== -1 ) {\n                    if ( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.y *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n                if ( handle.name.search( 'Z' ) !== -1 ) {\n                    if ( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.z *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n            } else if ( this.mode === 'rotate' ) {\n\n                // Align handles to current local or world rotation\n\n                tempQuaternion2.copy( quaternion );\n                alignVector.copy( this.eye ).applyQuaternion( tempQuaternion.copy( quaternion ).inverse() );\n\n                if ( handle.name.search( \"E\" ) !== - 1 ) {\n\n                    handle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( this.eye, zeroVector, unitY ) );\n\n                }\n\n                if ( handle.name === 'X' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitX, Math.atan2( -alignVector.y, alignVector.z ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n                if ( handle.name === 'Y' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitY, Math.atan2( alignVector.x, alignVector.z ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n                if ( handle.name === 'Z' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitZ, Math.atan2( alignVector.y, alignVector.x ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n            }\n\n            // Hide disabled axes\n            handle.visible = handle.visible && ( handle.name.indexOf( \"X\" ) === -1 || this.showX );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"Y\" ) === -1 || this.showY );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"Z\" ) === -1 || this.showZ );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"E\" ) === -1 || ( this.showX && this.showY && this.showZ ) );\n\n            // highlight selected axis\n\n            handle.material._opacity = handle.material._opacity || handle.material.opacity;\n            handle.material._color = handle.material._color || handle.material.color.clone();\n\n            handle.material.color.copy( handle.material._color );\n            handle.material.opacity = handle.material._opacity;\n\n            if ( !this.enabled ) {\n\n                handle.material.opacity *= 0.5;\n                handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n            } else if ( this.axis ) {\n\n                if ( handle.name === this.axis ) {\n\n                    handle.material.opacity = 1.0;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                } else if ( this.axis.split('').some( function( a ) { return handle.name === a; } ) ) {\n\n                    handle.material.opacity = 1.0;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                } else {\n\n                    handle.material.opacity *= 0.25;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                }\n\n            }\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n};\n\nTransformControlsGizmo.prototype = Object.assign( Object.create( THREE.Object3D.prototype ), {\n\n    constructor: TransformControlsGizmo,\n\n    isTransformControlsGizmo: true\n\n} );\n\n\nconst TransformControlsPlane = function () {\n\n\n    THREE.Mesh.call( this,\n        new THREE.PlaneBufferGeometry( 100000, 100000, 2, 2 ),\n        new THREE.MeshBasicMaterial( { visible: false, wireframe: true, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } )\n    );\n\n    this.type = 'TransformControlsPlane';\n\n    var unitX = new THREE.Vector3( 1, 0, 0 );\n    var unitY = new THREE.Vector3( 0, 1, 0 );\n    var unitZ = new THREE.Vector3( 0, 0, 1 );\n\n    var tempVector = new THREE.Vector3();\n    var dirVector = new THREE.Vector3();\n    var alignVector = new THREE.Vector3();\n    var tempMatrix = new THREE.Matrix4();\n    var identityQuaternion = new THREE.Quaternion();\n\n    this.updateMatrixWorld = function() {\n\n        var space = this.space;\n\n        this.position.copy( this.worldPosition );\n\n        if ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n        unitX.set( 1, 0, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n        unitY.set( 0, 1, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n        unitZ.set( 0, 0, 1 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n\n        // Align the plane for current transform mode, axis and space.\n\n        alignVector.copy( unitY );\n\n        switch ( this.mode ) {\n            case 'translate':\n            case 'scale':\n                switch ( this.axis ) {\n                    case 'X':\n                        alignVector.copy( this.eye ).cross( unitX );\n                        dirVector.copy( unitX ).cross( alignVector );\n                        break;\n                    case 'Y':\n                        alignVector.copy( this.eye ).cross( unitY );\n                        dirVector.copy( unitY ).cross( alignVector );\n                        break;\n                    case 'Z':\n                        alignVector.copy( this.eye ).cross( unitZ );\n                        dirVector.copy( unitZ ).cross( alignVector );\n                        break;\n                    case 'XY':\n                        dirVector.copy( unitZ );\n                        break;\n                    case 'YZ':\n                        dirVector.copy( unitX );\n                        break;\n                    case 'XZ':\n                        alignVector.copy( unitZ );\n                        dirVector.copy( unitY );\n                        break;\n                    case 'XYZ':\n                    case 'E':\n                        dirVector.set( 0, 0, 0 );\n                        break;\n                    default:\n                        break;\n                }\n                break;\n            case 'rotate':\n            default:\n                // special case for rotate\n                dirVector.set( 0, 0, 0 );\n        }\n\n        if ( dirVector.length() === 0 ) {\n\n            // If in rotate mode, make the plane parallel to camera\n            this.quaternion.copy( this.cameraQuaternion );\n\n        } else {\n\n            tempMatrix.lookAt( tempVector.set( 0, 0, 0 ), dirVector, alignVector );\n\n            this.quaternion.setFromRotationMatrix( tempMatrix );\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n};\n\nTransformControlsPlane.prototype = Object.assign( Object.create( THREE.Mesh.prototype ), {\n\n    constructor: TransformControlsPlane,\n\n    isTransformControlsPlane: true\n\n} );\n\nexport default TransformControls\n","import {createGraphObjectFromObject, fetchGraphObject} from \"../../syncgraph/utils\";\nimport {\n    Group,\n    Mesh,\n    MeshLambertMaterial,\n    PlaneBufferGeometry\n} from 'three'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport default class SceneDef {\n    make(graph, root) {\n        if(!root.id) throw new Error(\"can't create scene w/ missing parent\")\n        return fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'scene',\n            title:'Scene '+COUNTER++,\n            autoRecenter:true,\n            defaultFloor: false,\n            parent:root.id,\n            children:graph.createArray()\n        }))\n    }\n    makeNode(obj,provider) {\n        const scene = new Group()\n        scene.name = obj.title\n        this.setDefaultFloor(scene,obj.defaultFloor)\n        scene.start = () => {\n            scene.userData.sceneAnchor = new Group()\n            scene.userData.sceneAnchor.name = \"SceneAnchor\"\n            scene.add(scene.userData.sceneAnchor)\n            scene.children.forEach(chNode => {\n                const chObj = provider.accessObject(chNode.userData.graphid)\n                if(!chObj.exists()) return\n                if(chObj.type === OBJ_TYPES.geoanchor) return\n                if(chObj.type === OBJ_TYPES.imageanchor) return\n                scene.userData.sceneAnchor.add(chNode)\n            })\n        }\n        scene.stop = () => {\n            const toMove = scene.userData.sceneAnchor.children.slice()\n            toMove.forEach(chNode => scene.add(chNode))\n            scene.remove(scene.userData.sceneAnchor)\n        }\n        return scene\n    }\n\n    updateProperty(node, obj, op, provider) {\n        console.log(\"update property\",node.name,op.name,op.value)\n        if(op.name === PROP_DEFS.defaultFloor.key) {\n            console.log('setting the floor too',op.value)\n            this.setDefaultFloor(node,op.value)\n        }\n    }\n\n    setDefaultFloor(scene,val) {\n        if (val === true) {\n            const floor = new Mesh(\n                new PlaneBufferGeometry(100, 100, 10, 10),\n                new MeshLambertMaterial({color: 'blue'})\n            )\n            floor.name = 'defaultFloor'\n            floor.rotation.x = -90 * Math.PI / 180\n            scene.parts = {}\n            scene.parts.floor = floor\n            scene.add(floor)\n        } else {\n            if (scene.parts && scene.parts.floor) {\n                scene.remove(scene.parts.floor)\n                delete scene.parts.floor\n            }\n        }\n    }\n\n    getFloorPart(node) {\n        if(!node) return null\n        if(!node.parts) return null\n        return node.parts.floor\n    }\n\n}\n","import React, {Component} from 'react'\nimport * as ToasterManager from './ToasterManager'\n\nexport class ToasterNotification extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            notification:'saved',\n            visible:false\n        }\n    }\n\n    add = (payload) => {\n        this.setState({notification:payload, visible:true})\n        setTimeout(this.hide,2000)\n    }\n\n    hide = () => this.setState({visible:false})\n\n    componentWillMount() {\n        ToasterManager.onAdd(this.add)\n    }\n\n    render() {\n        return <div style={{\n            position:'absolute',\n            bottom:'10px',\n            left:'10px',\n            backgroundColor:'rgba(0,0,0,0.6)',\n            borderRadius:'1em',\n            color:'white',\n            fontSize:'24pt',\n            padding:'1em',\n            display:this.state.visible?'block':'none'\n        }}>{this.state.notification}</div>\n    }\n}\n","import {canHaveBehavior, TOTAL_OBJ_TYPES} from './Common'\nimport * as THREE from \"three\"\nimport WebLayer3D from 'three-web-layer'\nimport GPUParticles from './defs/GPUParticles'\nimport GLTFLoader from './GLTFLoader'\n\nexport class SceneGraphProvider {\n    //return the current scene. provider is in charge of tracking which scene is considered 'current'\n    //including the default scene when the project loads\n    getCurrentScene() { throw new Error(\"getCurrentScene not implemented\")}\n    getSceneObjects(scene) { throw new Error(\"getSceneObjects not implemented\")}\n    getBehaviorsForObject(obj) { throw new Error(\"getBehaviorsForObject(obj) not implemented\")}\n    //return threejs object for the id of the graph object\n    getThreeObject(id) { throw new Error(\"getThreeObject(id) not implemented\")}\n    getParsedBehaviorAsset(beh) { throw new Error(\"getParsedBehaviorAsset(behavior) not implemented\")}\n    getAllBehaviors() { throw new Error(\"getAllBehaviors() not implemented\")}\n    getAllScenes() { throw new Error(\"getAllScenes not implemented\")}\n\n    //navigate to the specified scene\n    navigateScene(id) { throw new Error(\"navigateScene(id) not implemented\")}\n\n    playMediaAsset(id) { throw new Error(\"playMediaAsset(id) not implemented\")}\n    stopMediaAsset(id) { throw new Error(\"stopMediaAsset(id) not implemented\")}\n    getGraphObjectByName(name) { throw new Error(\"getGraphObjectByName(name) not implemented\")}\n    getGraphObjectById(id) { throw new Error(\"getGraphObjectById(id) not implemented\")}\n    getCamera() { throw new Error(\"getCamera() not implemented\")}\n    getTweenManager() { throw new Error(\"getTweenManager() not implemented\")}\n    startImageRecognizer(info) { throw new Error(\"startImageRecognizer not implemented\")}\n    startGeoRecognizer(info) { throw new Error(\"startGeoRecognizer not implemented\")}\n}\n\nexport default class ScriptManager {\n    constructor(sceneGraphProvider, logger) {\n        this.sgp = sceneGraphProvider\n        this.logger = logger\n        this.running = false\n        this.storage = {}\n        this.logger = logger\n        this.logger.log(\"ScriptManager created\")\n\n        if (!window.THREE) window.THREE = THREE\n        if (!window.GLTFLoader) window.GLTFLoader = GLTFLoader\n        if (!window.GPUParticles) window.GPUParticles = GPUParticles\n        if (!window.WebLayer3D) window.WebLayer3D = WebLayer3D\n    }\n\n    makeSystemFacade(evt) {\n        const manager = this\n        const sgp = this.sgp\n        return {\n            globals() {\n                return {\n                    THREE:THREE,\n                    GLTFLoader: GLTFLoader,\n                    GPUParticles: GPUParticles,\n                    WebLayer3D: WebLayer3D\n                }\n            },\n            logger() {\n                return manager.logger\n            },\n            getCurrentScene() {\n                return sgp.getCurrentScene()\n            },\n            getScene(name) {\n                return null\n            },\n            getObject(name) {\n                const obj = sgp.getGraphObjectByName(name)\n                if(!obj) throw new Error(`object '${name}' not found`)\n                return sgp.getThreeObject(obj)\n            },\n            getAsset(name) {\n                const obj = sgp.getGraphObjectByName(name)\n                if(!obj) throw new Error(`asset '${name}' not found`)\n                return new AssetFacade(manager,obj)\n            },\n            getObjectById(id) {\n                return sgp.getGraphObjectById(id)\n            },\n            getThreeObjectById(id) {\n                return sgp.getThreeObject(id)\n            },\n            navigateScene(id) {\n                manager.fireSceneLifecycleEvent('exit',this.getCurrentScene())\n                sgp.navigateScene(id)\n                manager.fireSceneLifecycleEvent('enter',this.getCurrentScene())\n            },\n            playSound(id) {\n                const asset = sgp.getGraphObjectById(id)\n                manager.playMediaAsset(asset)\n            },\n            getCamera() {\n                return sgp.getCamera()\n            },\n            setKeyValue(key, value) {\n                manager.storage[key] = value\n            },\n            getKeyValue(key, defaultValue) {\n                return manager.storage[key]\n            },\n            hasKeyValue(key) {\n                return typeof manager.storage[key] !== 'undefined'\n            },\n            isAR() {\n                return false\n            },\n            sendMessage(name,payload) {\n                const target = evt.graphTarget\n                if(target) {\n                    manager.fireMessageAtTarget(name,payload,target)\n                }\n            },\n            getTweenManager() {\n                return sgp.getTweenManager()\n            },\n            on(target,type,cb) {\n                manager.on(target,type,cb)\n            },\n            fireEvent(target,type, payload) {\n                manager.fireEventFromTarget(target,type,payload)\n            },\n            startImageRecognizer(info) {\n                return sgp.startImageRecognizer(info)\n            },\n            stopImageRecognizer(info) {\n                return sgp.stopImageRecognizer(info)\n            },\n            startGeoRecognizer(info) {\n                return sgp.startGeoRecognizer(info)\n            },\n            stopGeoRecognizer(info) {\n                return sgp.stopGeoRecognizer(info)\n            }\n        }\n    }\n\n    performClickAction(target) {\n        if(!this.running) return\n        try {\n            this.logger.log(\"script manager, got a click event\",target)\n            if (!target || !target.exists || !target.exists()) return\n            const evt = {\n                type: 'click',\n                target: this.sgp.getThreeObject(target),\n                graphTarget: target\n            }\n            evt.system = this.makeSystemFacade(evt)\n            const behaviors = this.sgp.getBehaviorsForObject(target)\n            for (let i in behaviors) {\n                let b = behaviors[i]\n                evt.props = b.props()\n                const asset = this.sgp.getParsedBehaviorAsset(b)\n                if (asset.click) asset.click(evt)\n            }\n        } catch (error) {\n            this.logger.error(\"error in performClickAction\",error.message)\n            this.logger.error(error)\n            this.stopRunning()\n        }\n    }\n\n    fireLifecycleEvent(type) {\n        this.logger.log(`doing ${type} event`)\n        const evt = {\n            type:type,\n        }\n        evt.system = this.makeSystemFacade(evt)\n        this.sgp.getAllScenes().forEach(scene => {\n            scene.find(child => {\n                // this.logger.log(`calling ${type} on ${child.type} ${child.id}`)\n                if(child.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n                    evt.target = this.sgp.getThreeObject(child.parent)\n                    evt.graphTarget = this.sgp.getGraphObjectById(child.parent)\n                    evt.props = child.props()\n                    const asset = this.sgp.getParsedBehaviorAsset(child)\n                    if(asset[type]) asset[type](evt)\n                } else {\n                    evt.target = this.sgp.getThreeObject(child)\n                    evt.graphTarget = child\n                    if(evt.target && evt.target[type]) evt.target[type](evt)\n                }\n            })\n        })\n    }\n\n    fireSceneLifecycleEvent(type, scene, time) {\n        if(type!=='tick') this.logger.log(`doing ${type} event`)\n        const evt = {\n            type:type,\n            time:time-this.startTime,\n            session: this.session,\n            frame: this.frame,\n        }\n        evt.system = this.makeSystemFacade(evt)\n\n        scene.find(child => {\n            if(type!=='tick') this.logger.log(`calling ${type} on ${child.type} ${child.id}`)\n            if(child.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n                evt.target = this.sgp.getThreeObject(child.parent)\n                evt.graphTarget = this.sgp.getGraphObjectById(child.parent)\n                evt.props = child.props()\n                const asset = this.sgp.getParsedBehaviorAsset(child)\n                if(asset[type]) asset[type](evt)\n            } else {\n                evt.target = this.sgp.getThreeObject(child)\n                evt.graphTarget = child\n                if(evt.target && evt.target[type]) {\n                    // this.logger.log(`we are readly doing ${type}`,type,'on',child.type)\n                    evt.target[type](evt)\n                }\n            }\n        })\n    }\n\n    tick(time, session, frame) {\n        if(!this.running) return\n        if(this.startTime ===0) this.startTime = time\n        try {\n            this.session = session\n            this.frame = frame\n            this.fireSceneLifecycleEvent('tick',this.sgp.getCurrentScene(),time)\n        } catch (err) {\n            this.logger.error(\"error in script\",err.message)\n            this.logger.log(err)\n            this.stopRunning()\n        }\n    }\n\n\n    startRunning() {\n        this.running = true\n        this.startTime = 0\n        this.storage = {}\n        this.logger.log(\"ScriptManager starting\")\n        try {\n            this.fireLifecycleEvent('start')\n            this.fireSceneLifecycleEvent('enter',this.sgp.getCurrentScene())\n        } catch(err) {\n            this.logger.error(\"error in script\",err.message)\n            this.logger.error(err)\n            this.stopRunning()\n        }\n    }\n    stopRunning() {\n        try {\n            this.fireSceneLifecycleEvent('exit',this.sgp.getCurrentScene())\n            this.fireLifecycleEvent('stop')\n            this.running = false\n            this.storage = {}\n            this.destroyListeners()\n        } catch(err) {\n            this.running = false\n            this.logger.error(\"error stopping scripts\",err.message)\n            this.logger.error(err)\n        }\n        this.logger.log(\"script manager stopping\")\n    }\n    isRunning() {\n        return this.running\n    }\n\n    fireMessageAtTarget(name, payload, target) {\n        const evt = {\n            type:'message',\n            name:name,\n            message:payload,\n            time:Date.now(),\n            target: this.sgp.getThreeObject(target),\n            graphTarget:target,\n        }\n        evt.system = this.makeSystemFacade(evt)\n        const behaviors = this.sgp.getBehaviorsForObject(target)\n        behaviors.forEach(b => {\n            evt.props = b.props()\n            const asset = this.sgp.getParsedBehaviorAsset(b)\n            if(asset.onMessage) asset.onMessage(evt)\n        })\n    }\n\n    destroyListeners() {\n        this.listeners = {}\n    }\n    on(target,type,cb) {\n        if(!this.listeners) this.listeners = {}\n        if(!this.listeners[target.id]) this.listeners[target.id] = {}\n        if(!this.listeners[target.id][type]) this.listeners[target.id][type] = []\n        this.listeners[target.id][type].push(cb)\n    }\n\n    fireEventFromTarget(target, type, payload) {\n        if(!this.listeners) return\n        if(!this.listeners[target.id]) return\n        if(!this.listeners[target.id][type]) return\n        this.listeners[target.id][type].forEach(cb => cb(payload))\n    }\n}\n\n\nclass AssetFacade {\n    constructor(manager,obj) {\n        this.manager = manager\n        this.obj = obj\n    }\n    play() {\n        this.manager.sgp.playMediaAsset(this.obj)\n    }\n    stop() {\n        this.manager.sgp.stopMediaAsset(this.obj)\n    }\n}\nclass ThreeObjectFacade {\n    constructor(manager,obj) {\n        this.manager = manager\n        this._TYPE = 'ThreeObjectFacade'\n        this.obj = obj\n    }\n    get position() {\n        return this.manager.sgp.getThreeObject(this.obj).position\n    }\n    set position(val) {\n        this.manager.sgp.getThreeObject(this.obj).position.copy(val)\n    }\n\n    get rotation() {\n        return this.manager.sgp.getThreeObject(this.obj).rotation\n    }\n    get visible() {\n        return this.manager.sgp.getThreeObject(this.obj).visible\n    }\n    set visible(val) {\n        return this.manager.sgp.getThreeObject(this.obj).visible = val\n    }\n    lookAt(vec) {\n        return this.manager.sgp.getThreeObject(this.obj).lookAt(vec)\n    }\n}\n","import * as THREE from 'three'\n\nclass Tween {\n    constructor() {\n        this.running = false\n    }\n    update(time) {\n        throw new Error(\"update not implemented\")\n    }\n    start() {\n        this.running = true\n    }\n    isAlive() {\n        return this.running\n    }\n    kill() {\n        this.running = false\n    }\n}\n\nclass WaitTween extends Tween {\n    constructor(dur) {\n        super()\n        this.type = 'wait'\n        this.duration = dur\n    }\n    update(time) {\n        time = time/1000\n        if(!this.startTime) this.startTime = time\n        const diff = time - this.startTime\n        let t = diff/this.duration\n        if(t >= 1) {\n            this.running = false\n        }\n    }\n}\n\nclass ActionTween extends Tween {\n    constructor(fn) {\n        super()\n        this.type = 'action'\n        this.fn = fn\n    }\n    start() {\n        const res = this.fn()\n        this.running = false\n        return res\n    }\n}\n\nclass ForeverTween extends Tween {\n    constructor(fn) {\n        super()\n        this.type = 'forever'\n        this.fn = fn\n    }\n    start() {\n        this.running = true\n        this.startTime = Date.now()/1000\n    }\n    update(time) {\n        const diff = time/1000 - this.startTime\n        this.fn(diff)\n    }\n}\n\nexport const PROP_TYPES = {\n    SINGLE:'single',\n    COMPOUND:'compound',\n}\nexport const LERP_TYPES = {\n    LINEAR:'linear',\n    ELASTIC:'elastic'\n}\n\nfunction easeOutElastic(t) {\n    var p = 0.3;\n    return Math.pow(2,-10*t) * Math.sin((t-p/4)*(2*Math.PI)/p) + 1;\n}\nfunction easeLinear(from,to,t) {\n    return (to - from) * t + from\n}\nclass PropTween extends Tween {\n    constructor(opts) {\n        super()\n        this.type = 'prop'\n        this.target = opts.target\n        this.duration = opts.duration\n        if(typeof this.duration === 'undefined') throw new Error(\"duration is missing\")\n        this.property = opts.property\n        if(typeof this.property === 'undefined') throw new Error(\"property is missing\")\n        this.propertyType = opts.propertyType || PROP_TYPES.SINGLE\n        this.from = opts.from\n        this.to = opts.to\n        this.lerp_type = opts.lerpType || LERP_TYPES.LINEAR\n\n        this.loop = opts.loop\n        if(typeof this.loop === 'undefined') this.loop = 1\n        this.loopCount = 0\n        this.reversed = false\n        this.autoReverse = opts.autoReverse\n        if(typeof this.autoReverse === 'undefined') this.autoReverse = false\n    }\n    update(time) {\n        time = time/1000\n        if(!this.startTime) this.startTime = time\n        const diff = time - this.startTime\n\n        let t = diff/this.duration\n        if(t > 1.0) {\n            t = 1.0\n        }\n        this.setPropertyValue(this.from,this.to,t)\n        if(t === 1.0) {\n            this.loopCount++\n            if(this.autoReverse) {\n                this.reversed = !this.reversed\n            }\n            if(this.loop !== -1) {\n                if(this.loopCount >= this.loop) {\n                    this.running = false\n                    return\n                }\n            }\n            this.startTime = time\n        }\n    }\n\n    setPropertyValue(from,to,t,target,name) {\n        if(this.propertyType === PROP_TYPES.SINGLE) {\n            this.target[this.property] = this.lerp(this.from, this.to, this.reversed ? (1 - t) : t)\n        }\n        if(this.propertyType === PROP_TYPES.COMPOUND) {\n            Object.keys(this.from).forEach(name => {\n                this.target[this.property][name] = this.lerp(this.from[name], this.to[name], this.reversed ? (1 - t) : t)\n            })\n        }\n    }\n\n    lerp(from,to,t) {\n        if(this.lerp_type === LERP_TYPES.LINEAR)  return easeLinear(from,to,t)\n        if(this.lerp_type === LERP_TYPES.ELASTIC) return easeLinear(from,to,easeOutElastic(t))\n        console.log(\"invalid LERP_TYPE\")\n        return from\n    }\n}\n\nclass ClipTween extends Tween {\n    constructor(opts) {\n        super()\n        this.type = 'clip'\n        this.target = opts.target\n        this.name = opts.name\n        this.loop = opts.loop\n        this.autoReverse = opts.autoReverse\n        if(typeof this.autoReverse === 'undefined') this.autoReverse = false\n        if(typeof this.loop === 'undefined') this.loop = 1\n        if(typeof this.name === 'undefined') throw new Error(\"name is missing\")\n        this.speed = opts.speed\n        if(typeof this.speed === 'undefined') this.speed = 1\n    }\n    start() {\n        this.running = true\n        this.mixer = new THREE.AnimationMixer(this.target.scene)\n        this.action = this.mixer.clipAction(THREE.AnimationClip.findByName(this.target.animations,this.name))\n        if(this.loop === 1) {\n            this.action.setLoop(THREE.LoopOnce, 1)\n        }\n        if(this.loop === -1) {\n            this.action.setLoop(this.autoReverse?THREE.LoopPingPong:THREE.LoopRepeat, Infinity)\n        }\n        if(this.loop > 1) {\n            this.action.setLoop(THREE.LoopRepeat, this.loop)\n        }\n        this.action.play()\n        this.action.setEffectiveTimeScale(this.speed)\n        this.startTime = Date.now()/1000\n        this.prevTime = this.startTime\n    }\n    update(time) {\n        const diff = time/1000 - this.prevTime\n        this.mixer.update(diff)\n        this.prevTime = time/1000\n    }\n    kill() {\n        this.action.stop()\n        this.running = false\n    }\n}\n\nclass ParallelTween extends Tween {\n    constructor() {\n        super()\n        this.subs = []\n    }\n    and(obj) {\n        if(obj instanceof Tween) {\n            this.subs.push(obj)\n        } else {\n            this.subs.push(new ActionTween(obj))\n        }\n        return this\n    }\n    start() {\n        // console.log(\"starting parallel\")\n        this.running = true\n        this.subs.forEach(s=>s.start())\n        // console.log('started')\n        // console.log(this.subs)\n        return this\n    }\n    update(time) {\n        this.subs.forEach(s => {\n            if(s.isAlive()) s.update(time)\n        })\n    }\n    isAlive() {\n        const first = this.subs.find(s => s.isAlive() === true)\n        // console.log(\"first alive is\",first)\n        return first !== undefined\n    }\n}\n\nclass SequentialTween extends Tween {\n    constructor() {\n        super()\n        this.subs = []\n        this.n = -1\n    }\n    then(obj) {\n        if(obj instanceof Tween) {\n            this.subs.push(obj)\n        } else {\n            this.subs.push(new ActionTween(obj))\n        }\n        return this\n    }\n    wait(dur) {\n        this.subs.push(new WaitTween(dur))\n        return this\n    }\n    start() {\n        this.running = true\n        this._startNext()\n        return this\n    }\n    _startNext() {\n        this.n = this.n + 1\n\n        //if at the end of everything\n        if(this.n > this.subs.length-1) {\n            this.running = false\n            this.n = -1\n            return null\n        }\n\n\n        const cur = this.subs[this.n]\n        const res = cur.start()\n        if(!cur.isAlive()) {\n            if(res) {\n                console.log(\"the next swapped itself\", res)\n                //swap in the result\n                this.subs[this.n] = res\n                //backup\n                this.n = this.n -1\n                //recurse\n                return this._startNext()\n            } else {\n                // console.log(\"the next didn't swap. just move on\")\n                return this._startNext()\n            }\n        }\n        return cur\n    }\n    update(time) {\n        // console.log('updating')\n        const cur = this.subs[this.n]\n        cur.update(time)\n        // console.log(\"updated cur\",cur, cur.isAlive())\n        if(!cur.isAlive()) this._startNext()\n\n    }\n    isAlive() {\n        const first = this.subs.find(s => s.isAlive() === true)\n        // console.log(\"first alive is\",first)\n        // console.log(this.subs)\n        return first !== undefined\n    }\n}\n\nexport class TweenManager {\n    constructor() {\n        this.subs = []\n    }\n    parallel() {\n        const t = new ParallelTween()\n        this.subs.push(t)\n        return t\n    }\n    sequence() {\n        const t =  new SequentialTween()\n        this.subs.push(t)\n        return t\n    }\n    action(fn) {\n        const t = new ActionTween(fn)\n        this.subs.push(t)\n        return t\n    }\n    prop(opts) {\n        const t = new PropTween(opts)\n        this.subs.push(t)\n        return t\n    }\n    isAlive() {\n        return this.subs.find((s => s.isAlive() === true))\n    }\n    update(time) {\n        const now = Date.now()\n        this.subs.forEach(s => {\n            if(s.isAlive()) s.update(now)\n        })\n    }\n    forever(fn) {\n        const t = new ForeverTween(fn)\n        this.subs.push(t)\n        return t\n    }\n    clip(opts) {\n        const t = new ClipTween(opts)\n        this.subs.push(t)\n        return t\n    }\n    wait(dur) {\n        const t = new WaitTween(dur)\n        this.subs.push(t)\n        return t\n    }\n}\n\n/*\n\nconst obj = { x: -1, y: -1, z: 0, w: 0}\n\nconst para = t2.parallel()\n    .and(t2.prop({ target:obj, property:'x', from:10, to:0, duration: 1}))\n    .and(()=>console.log(\"inside the parallel action\"))\n    .start()\n\nconst seq = t2.sequence()\n    .then(()=>console.log(\"first is an action\"))\n    .then(t2.prop({ target:obj, property:'y', from:10, to:0, duration: 1}))\n    .then(()=> console.log(\"inside the sequential action\"))\n    .then(t2.prop({target:obj, property:'y', from:0, to:10, duration:1 }))\n    .then(()=>{\n        console.log(\"done with part 1. calculating part 2\")\n        return t2.prop({target:obj, property:'x', from: 0, to:-8, duration:1})\n    })\n    .then(() => {\n        console.log(\"now we're going to insert a new parallel tween\")\n        return t2.parallel()\n            .and(t2.prop({target:obj, property:'z', from:-1,to:1, duration:1}))\n            .and(t2.prop({target:obj, property:'w', from:-1,to:1, duration:1}))\n    })\n    .start()\n\nfunction update() {\n    console.log(\"tick\")\n    t2.update()\n    console.log(obj)\n    if(t2.isAlive()) {\n        setTimeout(update,250)\n    } else {\n        console.log(\"done with everything. check it out!\")\n        console.log(obj.z === 1)\n    }\n}\nupdate()\n*/\n","import {toFlatString} from '../utils'\nimport * as ToasterManager from './ToasterManager'\nimport * as mat4 from 'gl-matrix/src/gl-matrix/mat4'\nimport * as vec3 from 'gl-matrix/src/gl-matrix/vec3'\n\nlet Cesium = window.Cesium\nlet XRGeospatialAnchor = window.XRGeospatialAnchor\n\nexport class XRSupport {\n    constructor() {\n        this.imageDetectorMap = {}\n        this._workingMatrix = mat4.create()\n        this._identity = mat4.create()\n        this._vec = vec3.create()\n        \n    }\n    static supportsARKit() {\n        if (navigator.xr && navigator.xr._mozillaXRViewer) {\n            console.log(\"*** Found mozilla xr viewer\")\n            return true\n        }\n        console.log(\"*** Did not find WebXR\")\n        return false\n    }\n\n    getContext(canvas = 0) {\n        this.device = 0\n        this.session = 0\n        this.xrCanvas = 0\n        this.xrContext = 0\n        this.canvas = canvas\n        this.context = 0\n        this.xrCanvas = document.createElement('canvas')\n        this.xrContext = this.xrCanvas.getContext('xrpresent')\n        this._anchoredNodes = new Map() // { XRAnchorOffset, Three.js Object3D }\n\n        let that = this\n        let prom = new Promise((resolve, reject) => {\n            // document.body.insertBefore(this.xrCanvas, document.body.firstChild) <- not needed?\n            navigator.xr.requestDevice().then((xrDevice) => {\n                that.device = xrDevice\n                that.device.requestSession({\n                    outputContext: that.xrContext,\n                    alignEUS: true,\n                    geolocation: true,\n                    worldSensing: true\n                }).then((xrSession) => {\n                    that.session = xrSession\n\n                    // we want to always use the estimated elevation\n                    XRGeospatialAnchor.useEstimatedElevation(true)\n\n                    // enable smooth tracking of image targets\n                    that.session.nonStandard_setNumberOfTrackedImages(4)\n\n                    if (!that.canvas) that.canvas = document.createElement('canvas')\n                    if (!that.context) that.context = that.canvas.getContext('webgl', {compatibleXRDevice: that.device})\n                    that.session.baseLayer = new window.XRWebGLLayer(that.session, that.context)\n                    resolve(that.context)\n                }).catch(err => {\n                    console.error('Session setup error', err)\n                    reject()\n                })\n            }).catch(err => {\n                console.error('Error', err)\n                reject()\n            })\n        })\n        return prom\n    }\n\n    setAnimationLoop(userAnimationCallback) {\n\n        if (!userAnimationCallback) {\n            console.error(\"Supply a callback\")\n            return\n        }\n\n        // head-model is the coordinate system that tracks the position of the display\n        this.session.requestFrameOfReference('head-model').then(frameOfReference => {\n            this.headFrameOfReference = frameOfReference\n        }).catch(err => {\n            console.error('Error finding head frame of reference', err)\n        })\n\n        // get eye level which is somehow different from head level?\n        this.session.requestFrameOfReference('eye-level').then(frameOfReference => {\n            this.eyeLevelFrameOfReference = frameOfReference\n        }).catch(err => {\n            console.error('Error finding eye frame of reference', err)\n        })\n\n        // setup callback\n        this.userAnimationCallback = userAnimationCallback\n        this.__handleAnimationFrame = this._handleAnimationFrame.bind(this)\n        this.session.requestAnimationFrame(this.__handleAnimationFrame)\n    }\n\n    _handleAnimationFrame(time = 0, frame = 0) {\n\n        if (!this.session || this.session.ended) return\n\n        this.session.requestAnimationFrame(this.__handleAnimationFrame)\n\n        if (!this.headFrameOfReference || !this.eyeLevelFrameOfReference) return\n\n        let pose = frame.getDevicePose(this.eyeLevelFrameOfReference)\n        if (!pose) {\n            console.log('No pose')\n            return\n        }\n\n        for (let view of frame.views) {\n            this.userAnimationCallback(\n                this.session.baseLayer.getViewport(view),\n                view.projectionMatrix,\n                pose.getViewMatrix(view),\n                time,frame,\n            )\n            break\n        }\n    }\n\n    addAnchoredNode(anchor, node, logger) {\n        if (!anchor || !anchor.uid) {\n            console.error(\"not a valid anchor\", anchor)\n            logger.error(`not a valid anchor ${toFlatString(anchor)}`)\n            return\n        }\n        this._anchoredNodes.set(anchor.uid, {\n            anchor: anchor,\n            node: node\n        })\n        node.anchor = anchor\n        node.matrixAutoUpdate = false\n        node.matrix.fromArray(anchor.modelMatrix)\n        node.updateMatrixWorld(true)\n        //this._scene.add(node) -> presumably this is already done\n\n        anchor._handleAnchorUpdateCallback = this._handleAnchorUpdate.bind(this, logger)\n        anchor._handleAnchorDeleteCallback = this._handleAnchorDelete.bind(this, logger)\n\n        anchor.addEventListener(\"update\", anchor._handleAnchorUpdateCallback)\n        anchor.addEventListener(\"removed\", anchor._handleAnchorDeleteCallback)\n        logger.log(\"done adding anchored node\")\n        return node\n    }\n\n    async createSceneAnchor(sceneNode, logger) {\n        logger.log(\"Creating Scene Anchor\")\n\n        if (!this.session) {\n            logger.log(\"no session\")\n            return\n        }\n        let eyeLevel = await this.session.requestFrameOfReference('eye-level')\n        let headLevel = await this.session.requestFrameOfReference('head-model')\n\n        // get the pose of the camera in the world\n        headLevel.getTransformTo(eyeLevel, this._workingMatrix)\n\n        // get just the position\n        mat4.getTranslation(this._vec, this._workingMatrix) \n\n        // set the matrix to just the position, which means the orientation is EUS\n        mat4.fromTranslation(this._workingMatrix, this._vec)\n\n        // create that anchor\n        let newAnchor = await this.session.addAnchor(this._workingMatrix, eyeLevel)\n\n        this.addAnchoredNode(newAnchor, sceneNode, logger)\n        return newAnchor\n    }\n\n    updateAnchoredSceneNode(sceneAnchor, sceneNode, logger) {\n        logger.log(\"Replacing the scene node on the existing scene anchor\")\n        this._removeAnchorFromNode(sceneAnchor)\n        this.addAnchoredNode(sceneAnchor, sceneNode, logger)\n    }\n\n    removeSceneAnchor(sceneAnchor, logger) {\n        logger.log(\"Removing Scene Anchor\")\n        this.session.removeAnchor(sceneAnchor)\n        this._removeAnchorFromNode(sceneAnchor)\n    }\n\n    _fetchImage(info,logger) {\n        return new Promise((res,rej) => {\n            const img = new Image()\n            img.crossOrigin = \"Anonymous\"\n            img.src = info.image.src\n            logger.log(\"Loading image\",img.src)\n            img.onload = () => {\n                res(img)\n            }\n        })\n    }\n\n    createDetectionImage(info, logger) {\n        logger.log(\"creating/find an image recognizer\")\n        return new Promise((res,rej) => {            \n            if (!info.image || !info.node) {\n                logger.log(\"createDetectionImage: missing image or threejs node\")\n                rej(\"createDetectionImage: missing image or threejs node\")\n                return\n            }\n\n            if (!this.session) {\n                logger.log(\"no session\")\n                rej(\"no session\")\n                return\n            }\n\n            let imageRealworldWidth = info.imageRealworldWidth || 1\n\n            if (this.imageDetectorMap[info.image.src]) {\n                let det = this.imageDetectorMap[info.image.src]\n                if (imageRealworldWidth != det.realWorldWidth) {\n                    logger.log(\"can't create the same image with different real world width\")\n                    rej(\"can't create the same image with different real world width\")\n                    return\n                }\n                logger.log(\"createDetectionImage: already created, returning it\")\n                res(det.name)\n                return\n            }\n\n            this._fetchImage(info,logger).then(image => {\n                logger.log(\"got the image\",toFlatString(image))\n    \n                //info contains\n                // * callback: to call when the image is found\n                // * image: info about the image to recognize. src is at image.src\n                // * imageRealworldWidth: width of the image in meters\n                // * object: the anchor object\n                // * node: the ThreeJS group which represents the anchor. It should be updated as the scene changes\n                // * recType: current set to SCENE_START, meaning we should recognize as soon as the scene starts up\n    \n        \n                // random name from https://gist.github.com/6174/6062387\n                let name = [...Array(10)].map(i => (~~(Math.random() * 36)).toString(36)).join('')\n        \n                // Get ImageData\n                let canvas = document.createElement('canvas')\n                let context = canvas.getContext('2d')\n                canvas.width = image.width\n                canvas.height = image.height\n        \n                context.drawImage(image, 0, 0)\n                let idata\n                try {\n                    idata = context.getImageData(0, 0, image.width, image.height)\n                } catch (e) {\n                    logger.log(`error drawing image ${toFlatString(e)}`)\n                    logger.log(`name ${e.name}`)\n                    logger.log(`name ${e.message}`)\n                    logger.log(\"local url is \" + document.documentURI)\n                    logger.log(\"image url from \" + image.src)\n                    ToasterManager.add(\"error drawing image\", e.toString())\n                    rej( new Error(\"foo\"))\n                }\n                logger.log(`calling createDetectionImage with image width and height ${image.width} ${image.height}`)\n        \n                // Attach image observer handler\n                this.session.nonStandard_createDetectionImage(name, idata.data, image.width, image.height, imageRealworldWidth).then(() => {\n                    this.imageDetectorMap[info.image.src] = {\n                        name: name,\n                        realWorldWidth: imageRealworldWidth,\n                        anchor: null\n                    }\n                    res(name)\n                }).catch(error => {\n                    logger.error(`error creating detection image: ${error}`)\n                    rej(error)\n                })\n            }).catch(error => {\n                logger.error(`error creating detection image: ${error}`)\n                rej(error)\n            })\n        })\n    }\n\n    startImageRecognizer(info, name, logger) {\n        logger.log(\"starting Image Recognizer\")\n\n        if (!info.image || !info.node) {\n            logger.log(\"missing image or threejs node\")\n            return\n        }\n\n        if (!this.session) {\n            logger.log(\"no session\")\n            return\n        }\n\n        //info contains\n        // * callback: to call when the image is found\n        // * image: info about the image to recognize. src is at image.src\n        // * imageRealworldWidth: width of the image in meters\n        // * object: the anchor object\n        // * node: the ThreeJS group which represents the anchor. It should be updated as the scene changes\n        // * recType: current set to SCENE_START, meaning we should recognize as soon as the scene starts up\n\n        let callback = info.callback\n\n        let node = info.node\n        let recType = 0 // unused. currently set to SCENE_START -> meaning we should recognize as soon as the scene starts up\n\n        if (!this.imageDetectorMap[info.image.src]) {\n            logger.error(\"not detection object for image\", info.image.src)\n            return\n        }\n\n        let det = this.imageDetectorMap[info.image.src]\n\n        // there is already an anchor tracking this image, either from this\n        // scene or another\n        if (det.anchor) {\n            if (info.reactivate) {\n                logger.log(\"Found existing anchor: reactivate\")\n                // we want to reactivate.  So destroy the anchor, remove it from\n                // the node it was tracking, and continue below to reactivate\n                this.session.removeAnchor(det.anchor)\n                logger.log(\"remove from previous node\")\n                this._removeAnchorFromNode(det.anchor)\n                det.anchor = null\n            } else {\n                logger.log(\"Found existing anchor: use it\")\n                // we want to reuse, likely from some previous scene.\n                // So, remove the relationship to whatever node is in the \n                // anchor map, and reset it to this node.   \n                logger.log(\"remove from previous node\")\n                this._removeAnchorFromNode(det.anchor)\n                logger.log(\"add our node\")\n                this.addAnchoredNode(det.anchor, node, logger)\n                if (callback) {\n                    callback(info)\n                }\n                return\n            }\n        } \n\n        node.anchorName = null\n        logger.log(\"activate detection image\")\n        this.session.nonStandard_activateDetectionImage(det.name).then(anchor => {\n            logger.log(\"found detection image\")\n            // this gets invoked after the image is seen for the first time\n            node.anchorName = name\n            node.anchorStyle = \"image\"\n            this.addAnchoredNode(anchor, node, logger)\n            if (callback) {\n                callback(info)\n            }\n        }).catch(error => {\n            logger.error(`error activating detection image: ${error}`)\n        })\n    }\n\n    stopImageRecognizer(info, logger) {\n        console.log(\"Stopping image recognizer\")\n        if(!this._anchoredNodes) return\n\n        if (!this.imageDetectorMap[info.image.src]) {\n            logger.error(\"no detection object for image\", info.image.src)\n            return\n        }\n\n        let det = this.imageDetectorMap[info.image.src]\n\n        if (det.anchor) {\n            console.log(\"already found the image, removing it\")\n            this._removeAnchorFromNode(det.anchor)\n            det.anchor = null\n        }\n\n        console.log(\"deactivating the image\")\n        this.session.nonStandard_deactivateDetectionImage(det.name).then(() => {\n        }).catch(error => {\n            logger.error(`error deactivating detection image: ${error}`)\n        })\n    }\n\n\n    addGeoAnchoredNode(info, logger) {\n        logger.log(\"adding a geo recognizer\")\n\n        if (!info.node) {\n            logger.log(\"Missing threejs node\")\n            return\n        }\n\n        if (!this.session) {\n            logger.log(\"no session\")\n            return\n        }\n\n        /*\n        info contains\n         location:  a geo location asset, has properties for latitude, longitude, altitude, useAltitude\n         recType: the recognition type. for now always SCENE_START\n         object: the anchor object. It reresents the anchor in the 3D scene. has tx,ty,tz, rotation, etc.\n         node: the actual ThreeJS object that mirrors the propertites of the `object` above\n         callback: a function to be called once the geo anchor is recognized. By default this callback will fire a 'recognized' event and make the anchor visible in the scene\n         */\n\n        let callback = info.callback\n        let location = info.location\n        let object = info.object // object that represents anchor variables that users can edit in general-editor\n        let node = info.node\n        let recType = 0 // unused. currently set to SCENE_START -> meaning we should recognize as soon as the scene starts up\n\n        // As a slight hack, look for any non zero value in latitude or longitude as a hint to not use your current location\n\n        // these values are 0 by default, we need to change at least one of them by a bit!\n        if (location.latitude != 0 || location.longitude != 0) {\n            // use supplied altitude?\n\n            let lla = new Cesium.Cartographic(location.longitude * Math.PI / 180, location.latitude * Math.PI / 180, location.altitude)\n\n            if (location.useAltitude) {\n                logger.log(\"XRGeoAnchor: Placing an object at specified lla and specified altitude\")\n                logger.log(toFlatString(lla))\n                XRGeospatialAnchor.createGeoAnchor(lla).then(anchor => {\n                    node.anchorStyle = \"geo\"\n                    this.addAnchoredNode(anchor, node, logger)\n                    if (callback) {\n                        callback(info)\n                    }\n                }).catch(error => {\n                    logger.error(`error creating geospatial anchor: ${error}`)\n                })\n            } else {\n                XRGeospatialAnchor.getDefaultElevation(lla).then(altitude => {\n                    lla.height = altitude\n                    logger.log(\"XRGeoAnchor: Placing an object at specified lla and estimated altitude\")\n                    logger.log(toFlatString(lla))\n                    XRGeospatialAnchor.createGeoAnchor(lla).then(anchor => {\n                        node.anchorStyle = \"geo\"\n                        this.addAnchoredNode(anchor, node, logger)\n                        if (callback) {\n                            callback(info)\n                        }\n                    }).catch(error => {\n                        logger.error(`error creating geospatial anchor: ${error}`)\n                    })\n                }).catch(error => {\n                    logger.error(`error getting default elevation: ${error}`)\n                })\n            }\n        }\n\n        // else find current position and altitude\n        else {\n            XRGeospatialAnchor.getDeviceCartographic().then(cartographic => {\n                // probably don't need to explicitly do this, but to be safe ...\n                XRGeospatialAnchor.getDefaultElevation().then(altitude => {\n                    let lla = new Cesium.Cartographic(cartographic.longitude, cartographic.latitude, altitude)\n                    logger.log(\"XRGeoAnchor: Placing an object at your lla\")\n                    logger.log(toFlatString(lla))\n                    XRGeospatialAnchor.createGeoAnchor(lla).then(anchor => {\n                        node.anchorStyle = \"geo\"\n                        this.addAnchoredNode(anchor, node, logger)\n                        if (callback) {\n                            callback(info)\n                        }\n                    }).catch(error => {\n                        logger.error(`error creating geospatial anchor: ${error}`)\n                    })\n                }).catch(error => {\n                    logger.error(`error getting default elevation: ${error}`)\n                })\n            }).catch(error => {\n                logger.error(`error getting device cartographic location: ${error}`)\n            })\n        }\n    }\n\n    /// BLAIR:  Need a way to destroy geo Anchors!\n    stopGeoRecognizer(info, logger) {\n        this._removeAnchorForNode(info.node)\n    }\n\n    _handleAnchorDelete(logger, details) {\n        logger.log(\"delete anchor\")\n        let anchor = details.source\n        this._removeAnchorFromNode(anchor)\n    }\n\n    _removeAnchorForNode(node) {\n        this._anchoredNodes.forEach( (value) => {\n            if(value.node == node) {\n                this._removeAnchorFromNode(node.anchor)\n                return\n            }\n        })\n    }\n\n    _removeAnchorFromNode(anchor) {\n        const anchoredNode = this._anchoredNodes.get(anchor.uid)\n        if (anchoredNode) {\n            const node = anchoredNode.node\n            node.anchor = null\n\n            anchor.removeEventListener(\"update\", anchor._handleAnchorUpdateCallback)\n            anchor.removeEventListener(\"removed\", anchor._handleAnchorDeleteCallback)\n            anchor._handleAnchorUpdateCallback = null\n            anchor._handleAnchorDeleteCallback = null\n\n            // NOTIFY SOMEBODY? TODO\n            this._anchoredNodes.delete(anchor.uid)\n        }\n    }\n\n    _handleAnchorUpdate(logger, details) {\n        logger.log(\"anchor update\")\n        const anchor = details.source\n        const anchoredNode = this._anchoredNodes.get(anchor.uid)\n        if (anchoredNode) {\n            const node = anchoredNode.node\n            node.matrixAutoUpdate = false\n            node.matrix.fromArray(anchor.modelMatrix)\n            node.updateMatrixWorld(true)\n        }\n    }\n\n}","const THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n */\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one finger move\n//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\n//    Pan - right mouse, or arrow keys / touch: three finger swipe\n\nconst OrbitControls = function ( object, domElement ) {\n\n    this.object = object;\n\n    this.domElement = ( domElement !== undefined ) ? domElement : document;\n\n    // Set to false to disable this control\n    this.enabled = true;\n\n    // \"target\" sets the location of focus, where the object orbits around\n    this.target = new THREE.Vector3();\n\n    // How far you can dolly in and out ( PerspectiveCamera only )\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n\n    // How far you can zoom in and out ( OrthographicCamera only )\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n\n    // How far you can orbit vertically, upper and lower limits.\n    // Range is 0 to Math.PI radians.\n    this.minPolarAngle = 0; // radians\n    this.maxPolarAngle = Math.PI; // radians\n\n    // How far you can orbit horizontally, upper and lower limits.\n    // If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n    this.minAzimuthAngle = - Infinity; // radians\n    this.maxAzimuthAngle = Infinity; // radians\n\n    // Set to true to enable damping (inertia)\n    // If damping is enabled, you must call controls.update() in your animation loop\n    this.enableDamping = false;\n    this.dampingFactor = 0.25;\n\n    // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n    // Set to false to disable zooming\n    this.enableZoom = true;\n    this.zoomSpeed = 1.0;\n\n    // Set to false to disable rotating\n    this.enableRotate = true;\n    this.rotateSpeed = 1.0;\n\n    // Set to false to disable panning\n    this.enablePan = true;\n    this.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n    // Set to true to automatically rotate around the target\n    // If auto-rotate is enabled, you must call controls.update() in your animation loop\n    this.autoRotate = false;\n    this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n    // Set to false to disable use of the keys\n    this.enableKeys = true;\n\n    // The four arrow keys\n    this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n    // Mouse buttons\n    this.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };\n\n    // for reset\n    this.target0 = this.target.clone();\n    this.position0 = this.object.position.clone();\n    this.zoom0 = this.object.zoom;\n\n    //\n    // public methods\n    //\n\n    this.getPolarAngle = function () {\n\n        return spherical.phi;\n\n    };\n\n    this.getAzimuthalAngle = function () {\n\n        return spherical.theta;\n\n    };\n\n    this.saveState = function () {\n\n        scope.target0.copy( scope.target );\n        scope.position0.copy( scope.object.position );\n        scope.zoom0 = scope.object.zoom;\n\n    };\n\n    this.reset = function () {\n\n        scope.target.copy( scope.target0 );\n        scope.object.position.copy( scope.position0 );\n        scope.object.zoom = scope.zoom0;\n\n        scope.object.updateProjectionMatrix();\n        scope.dispatchEvent( changeEvent );\n\n        scope.update();\n\n        state = STATE.NONE;\n\n    };\n\n    // this method is exposed, but perhaps it would be better if we can make it private...\n    this.update = function () {\n\n        var offset = new THREE.Vector3();\n\n        // so camera.up is the orbit axis\n        var quat = new THREE.Quaternion().setFromUnitVectors( object.up, new THREE.Vector3( 0, 1, 0 ) );\n        var quatInverse = quat.clone().inverse();\n\n        var lastPosition = new THREE.Vector3();\n        var lastQuaternion = new THREE.Quaternion();\n\n        return function update() {\n\n            var position = scope.object.position;\n\n            offset.copy( position ).sub( scope.target );\n\n            // rotate offset to \"y-axis-is-up\" space\n            offset.applyQuaternion( quat );\n\n            // angle from z-axis around y-axis\n            spherical.setFromVector3( offset );\n\n            if ( scope.autoRotate && state === STATE.NONE ) {\n\n                rotateLeft( getAutoRotationAngle() );\n\n            }\n\n            spherical.theta += sphericalDelta.theta;\n            spherical.phi += sphericalDelta.phi;\n\n            // restrict theta to be between desired limits\n            spherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\n\n            // restrict phi to be between desired limits\n            spherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n            spherical.makeSafe();\n\n\n            spherical.radius *= scale;\n\n            // restrict radius to be between desired limits\n            spherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n            // move target to panned location\n            scope.target.add( panOffset );\n\n            offset.setFromSpherical( spherical );\n\n            // rotate offset back to \"camera-up-vector-is-up\" space\n            offset.applyQuaternion( quatInverse );\n\n            position.copy( scope.target ).add( offset );\n\n            scope.object.lookAt( scope.target );\n\n            if ( scope.enableDamping === true ) {\n\n                sphericalDelta.theta *= ( 1 - scope.dampingFactor );\n                sphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n            } else {\n\n                sphericalDelta.set( 0, 0, 0 );\n\n            }\n\n            scale = 1;\n            panOffset.set( 0, 0, 0 );\n\n            // update condition is:\n            // min(camera displacement, camera rotation in radians)^2 > EPS\n            // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n            if ( zoomChanged ||\n                lastPosition.distanceToSquared( scope.object.position ) > EPS ||\n                8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n                scope.dispatchEvent( changeEvent );\n\n                lastPosition.copy( scope.object.position );\n                lastQuaternion.copy( scope.object.quaternion );\n                zoomChanged = false;\n\n                return true;\n\n            }\n\n            return false;\n\n        };\n\n    }();\n\n    this.dispose = function () {\n\n        scope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\n        scope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\n        scope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\n\n        scope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\n        scope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\n        scope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\n\n        document.removeEventListener( 'mousemove', onMouseMove, false );\n        document.removeEventListener( 'mouseup', onMouseUp, false );\n\n        window.removeEventListener( 'keydown', onKeyDown, false );\n\n        //scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n    };\n\n    //\n    // internals\n    //\n\n    var scope = this;\n\n    var changeEvent = { type: 'change' };\n    var startEvent = { type: 'start' };\n    var endEvent = { type: 'end' };\n\n    var STATE = { NONE: - 1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };\n\n    var state = STATE.NONE;\n\n    var EPS = 0.000001;\n\n    // current position in spherical coordinates\n    var spherical = new THREE.Spherical();\n    var sphericalDelta = new THREE.Spherical();\n\n    var scale = 1;\n    var panOffset = new THREE.Vector3();\n    var zoomChanged = false;\n\n    var rotateStart = new THREE.Vector2();\n    var rotateEnd = new THREE.Vector2();\n    var rotateDelta = new THREE.Vector2();\n\n    var panStart = new THREE.Vector2();\n    var panEnd = new THREE.Vector2();\n    var panDelta = new THREE.Vector2();\n\n    var dollyStart = new THREE.Vector2();\n    var dollyEnd = new THREE.Vector2();\n    var dollyDelta = new THREE.Vector2();\n\n    function getAutoRotationAngle() {\n\n        return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n    }\n\n    function getZoomScale() {\n\n        return Math.pow( 0.95, scope.zoomSpeed );\n\n    }\n\n    function rotateLeft( angle ) {\n\n        sphericalDelta.theta -= angle;\n\n    }\n\n    function rotateUp( angle ) {\n\n        sphericalDelta.phi -= angle;\n\n    }\n\n    var panLeft = function () {\n\n        var v = new THREE.Vector3();\n\n        return function panLeft( distance, objectMatrix ) {\n\n            v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n            v.multiplyScalar( - distance );\n\n            panOffset.add( v );\n\n        };\n\n    }();\n\n    var panUp = function () {\n\n        var v = new THREE.Vector3();\n\n        return function panUp( distance, objectMatrix ) {\n\n            v.setFromMatrixColumn( objectMatrix, 1 ); // get Y column of objectMatrix\n            v.multiplyScalar( distance );\n\n            panOffset.add( v );\n\n        };\n\n    }();\n\n    // deltaX and deltaY are in pixels; right and down are positive\n    var pan = function () {\n\n        var offset = new THREE.Vector3();\n\n        return function pan( deltaX, deltaY ) {\n\n            var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n            if ( scope.object.isPerspectiveCamera ) {\n\n                // perspective\n                var position = scope.object.position;\n                offset.copy( position ).sub( scope.target );\n                var targetDistance = offset.length();\n\n                // half of the fov is center to top of screen\n                targetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n                // we actually don't use screenWidth, since perspective camera is fixed to screen height\n                panLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n                panUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n            } else if ( scope.object.isOrthographicCamera ) {\n\n                // orthographic\n                panLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n                panUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n            } else {\n\n                // camera neither orthographic nor perspective\n                console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n                scope.enablePan = false;\n\n            }\n\n        };\n\n    }();\n\n    function dollyIn( dollyScale ) {\n\n        if ( scope.object.isPerspectiveCamera ) {\n\n            scale /= dollyScale;\n\n        } else if ( scope.object.isOrthographicCamera ) {\n\n            scope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n            scope.object.updateProjectionMatrix();\n            zoomChanged = true;\n\n        } else {\n\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n            scope.enableZoom = false;\n\n        }\n\n    }\n\n    function dollyOut( dollyScale ) {\n\n        if ( scope.object.isPerspectiveCamera ) {\n\n            scale *= dollyScale;\n\n        } else if ( scope.object.isOrthographicCamera ) {\n\n            scope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n            scope.object.updateProjectionMatrix();\n            zoomChanged = true;\n\n        } else {\n\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n            scope.enableZoom = false;\n\n        }\n\n    }\n\n    //\n    // event callbacks - update the object state\n    //\n\n    function handleMouseDownRotate( event ) {\n\n        //console.log( 'handleMouseDownRotate' );\n\n        rotateStart.set( event.clientX, event.clientY );\n\n    }\n\n    function handleMouseDownDolly( event ) {\n\n        //console.log( 'handleMouseDownDolly' );\n\n        dollyStart.set( event.clientX, event.clientY );\n\n    }\n\n    function handleMouseDownPan( event ) {\n\n        //console.log( 'handleMouseDownPan' );\n\n        panStart.set( event.clientX, event.clientY );\n\n    }\n\n    function handleMouseMoveRotate( event ) {\n\n        //console.log( 'handleMouseMoveRotate' );\n\n        rotateEnd.set( event.clientX, event.clientY );\n        rotateDelta.subVectors( rotateEnd, rotateStart );\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        // rotating across whole screen goes 360 degrees around\n        rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n        // rotating up and down along whole screen attempts to go 360, but limited to 180\n        rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n        rotateStart.copy( rotateEnd );\n\n        scope.update();\n\n    }\n\n    function handleMouseMoveDolly( event ) {\n\n        //console.log( 'handleMouseMoveDolly' );\n\n        dollyEnd.set( event.clientX, event.clientY );\n\n        dollyDelta.subVectors( dollyEnd, dollyStart );\n\n        if ( dollyDelta.y > 0 ) {\n\n            dollyIn( getZoomScale() );\n\n        } else if ( dollyDelta.y < 0 ) {\n\n            dollyOut( getZoomScale() );\n\n        }\n\n        dollyStart.copy( dollyEnd );\n\n        scope.update();\n\n    }\n\n    function handleMouseMovePan( event ) {\n\n        //console.log( 'handleMouseMovePan' );\n\n        panEnd.set( event.clientX, event.clientY );\n\n        panDelta.subVectors( panEnd, panStart );\n\n        pan( panDelta.x, panDelta.y );\n\n        panStart.copy( panEnd );\n\n        scope.update();\n\n    }\n\n    function handleMouseUp( event ) {\n\n        // console.log( 'handleMouseUp' );\n\n    }\n\n    function handleMouseWheel( event ) {\n\n        // console.log( 'handleMouseWheel' );\n\n        if ( event.deltaY < 0 ) {\n\n            dollyOut( getZoomScale() );\n\n        } else if ( event.deltaY > 0 ) {\n\n            dollyIn( getZoomScale() );\n\n        }\n\n        scope.update();\n\n    }\n\n    function handleKeyDown( event ) {\n\n        //console.log( 'handleKeyDown' );\n\n        switch ( event.keyCode ) {\n\n            case scope.keys.UP:\n                pan( 0, scope.keyPanSpeed );\n                scope.update();\n                break;\n\n            case scope.keys.BOTTOM:\n                pan( 0, - scope.keyPanSpeed );\n                scope.update();\n                break;\n\n            case scope.keys.LEFT:\n                pan( scope.keyPanSpeed, 0 );\n                scope.update();\n                break;\n\n            case scope.keys.RIGHT:\n                pan( - scope.keyPanSpeed, 0 );\n                scope.update();\n                break;\n\n        }\n\n    }\n\n    function handleTouchStartRotate( event ) {\n\n        //console.log( 'handleTouchStartRotate' );\n\n        rotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n    }\n\n    function handleTouchStartDolly( event ) {\n\n        //console.log( 'handleTouchStartDolly' );\n\n        var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n        var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n        var distance = Math.sqrt( dx * dx + dy * dy );\n\n        dollyStart.set( 0, distance );\n\n    }\n\n    function handleTouchStartPan( event ) {\n\n        //console.log( 'handleTouchStartPan' );\n\n        panStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n    }\n\n    function handleTouchMoveRotate( event ) {\n\n        //console.log( 'handleTouchMoveRotate' );\n\n        rotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n        rotateDelta.subVectors( rotateEnd, rotateStart );\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        // rotating across whole screen goes 360 degrees around\n        rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n        // rotating up and down along whole screen attempts to go 360, but limited to 180\n        rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n        rotateStart.copy( rotateEnd );\n\n        scope.update();\n\n    }\n\n    function handleTouchMoveDolly( event ) {\n\n        //console.log( 'handleTouchMoveDolly' );\n\n        var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n        var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n        var distance = Math.sqrt( dx * dx + dy * dy );\n\n        dollyEnd.set( 0, distance );\n\n        dollyDelta.subVectors( dollyEnd, dollyStart );\n\n        if ( dollyDelta.y > 0 ) {\n\n            dollyOut( getZoomScale() );\n\n        } else if ( dollyDelta.y < 0 ) {\n\n            dollyIn( getZoomScale() );\n\n        }\n\n        dollyStart.copy( dollyEnd );\n\n        scope.update();\n\n    }\n\n    function handleTouchMovePan( event ) {\n\n        //console.log( 'handleTouchMovePan' );\n\n        panEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n        panDelta.subVectors( panEnd, panStart );\n\n        pan( panDelta.x, panDelta.y );\n\n        panStart.copy( panEnd );\n\n        scope.update();\n\n    }\n\n    function handleTouchEnd( event ) {\n\n        //console.log( 'handleTouchEnd' );\n\n    }\n\n    //\n    // event handlers - FSM: listen for events and reset state\n    //\n\n    function onMouseDown( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n        switch ( event.button ) {\n\n            case scope.mouseButtons.ORBIT:\n\n                if ( scope.enableRotate === false ) return;\n\n                handleMouseDownRotate( event );\n\n                state = STATE.ROTATE;\n\n                break;\n\n            case scope.mouseButtons.ZOOM:\n\n                if ( scope.enableZoom === false ) return;\n\n                handleMouseDownDolly( event );\n\n                state = STATE.DOLLY;\n\n                break;\n\n            case scope.mouseButtons.PAN:\n\n                if ( scope.enablePan === false ) return;\n\n                handleMouseDownPan( event );\n\n                state = STATE.PAN;\n\n                break;\n\n        }\n\n        if ( state !== STATE.NONE ) {\n\n            document.addEventListener( 'mousemove', onMouseMove, false );\n            document.addEventListener( 'mouseup', onMouseUp, false );\n\n            scope.dispatchEvent( startEvent );\n\n        }\n\n    }\n\n    function onMouseMove( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n        switch ( state ) {\n\n            case STATE.ROTATE:\n\n                if ( scope.enableRotate === false ) return;\n\n                handleMouseMoveRotate( event );\n\n                break;\n\n            case STATE.DOLLY:\n\n                if ( scope.enableZoom === false ) return;\n\n                handleMouseMoveDolly( event );\n\n                break;\n\n            case STATE.PAN:\n\n                if ( scope.enablePan === false ) return;\n\n                handleMouseMovePan( event );\n\n                break;\n\n        }\n\n    }\n\n    function onMouseUp( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        handleMouseUp( event );\n\n        document.removeEventListener( 'mousemove', onMouseMove, false );\n        document.removeEventListener( 'mouseup', onMouseUp, false );\n\n        scope.dispatchEvent( endEvent );\n\n        state = STATE.NONE;\n\n    }\n\n    function onMouseWheel( event ) {\n\n        if ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        handleMouseWheel( event );\n\n        scope.dispatchEvent( startEvent ); // not sure why these are here...\n        scope.dispatchEvent( endEvent );\n\n    }\n\n    function onKeyDown( event ) {\n\n        if ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\n\n        handleKeyDown( event );\n\n    }\n\n    function onTouchStart( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        switch ( event.touches.length ) {\n\n            case 1:\t// one-fingered touch: rotate\n\n                if ( scope.enableRotate === false ) return;\n\n                handleTouchStartRotate( event );\n\n                state = STATE.TOUCH_ROTATE;\n\n                break;\n\n            case 2:\t// two-fingered touch: dolly\n\n                if ( scope.enableZoom === false ) return;\n\n                handleTouchStartDolly( event );\n\n                state = STATE.TOUCH_DOLLY;\n\n                break;\n\n            case 3: // three-fingered touch: pan\n\n                if ( scope.enablePan === false ) return;\n\n                handleTouchStartPan( event );\n\n                state = STATE.TOUCH_PAN;\n\n                break;\n\n            default:\n\n                state = STATE.NONE;\n\n        }\n\n        if ( state !== STATE.NONE ) {\n\n            scope.dispatchEvent( startEvent );\n\n        }\n\n    }\n\n    function onTouchMove( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        switch ( event.touches.length ) {\n\n            case 1: // one-fingered touch: rotate\n\n                if ( scope.enableRotate === false ) return;\n                if ( state !== STATE.TOUCH_ROTATE ) return; // is this needed?...\n\n                handleTouchMoveRotate( event );\n\n                break;\n\n            case 2: // two-fingered touch: dolly\n\n                if ( scope.enableZoom === false ) return;\n                if ( state !== STATE.TOUCH_DOLLY ) return; // is this needed?...\n\n                handleTouchMoveDolly( event );\n\n                break;\n\n            case 3: // three-fingered touch: pan\n\n                if ( scope.enablePan === false ) return;\n                if ( state !== STATE.TOUCH_PAN ) return; // is this needed?...\n\n                handleTouchMovePan( event );\n\n                break;\n\n            default:\n\n                state = STATE.NONE;\n\n        }\n\n    }\n\n    function onTouchEnd( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        handleTouchEnd( event );\n\n        scope.dispatchEvent( endEvent );\n\n        state = STATE.NONE;\n\n    }\n\n    function onContextMenu( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n    }\n\n    //\n\n    scope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\n\n    scope.domElement.addEventListener( 'mousedown', onMouseDown, false );\n    scope.domElement.addEventListener( 'wheel', onMouseWheel, false );\n\n    scope.domElement.addEventListener( 'touchstart', onTouchStart, false );\n    scope.domElement.addEventListener( 'touchend', onTouchEnd, false );\n    scope.domElement.addEventListener( 'touchmove', onTouchMove, false );\n\n    // window.addEventListener( 'keydown', onKeyDown, false );\n\n    // force an update at start\n\n    this.update();\n\n};\n\nOrbitControls.prototype = Object.create( THREE.EventDispatcher.prototype );\nOrbitControls.prototype.constructor = THREE.OrbitControls;\n\nObject.defineProperties( OrbitControls.prototype, {\n\n    center: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .center has been renamed to .target' );\n            return this.target;\n\n        }\n\n    },\n\n    // backward compatibility\n\n    noZoom: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\n            return ! this.enableZoom;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\n            this.enableZoom = ! value;\n\n        }\n\n    },\n\n    noRotate: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\n            return ! this.enableRotate;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\n            this.enableRotate = ! value;\n\n        }\n\n    },\n\n    noPan: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\n            return ! this.enablePan;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\n            this.enablePan = ! value;\n\n        }\n\n    },\n\n    noKeys: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\n            return ! this.enableKeys;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\n            this.enableKeys = ! value;\n\n        }\n\n    },\n\n    staticMoving: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\n            return ! this.enableDamping;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\n            this.enableDamping = ! value;\n\n        }\n\n    },\n\n    dynamicDampingFactor: {\n\n        get: function () {\n\n            console.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\n            return this.dampingFactor;\n\n        },\n\n        set: function ( value ) {\n\n            console.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\n            this.dampingFactor = value;\n\n        }\n\n    }\n\n} );\n\n\nexport default OrbitControls","import React, {Component} from 'react'\nimport * as THREE from 'three'\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport TransformControls from './TransformControls.js'\nimport SceneDef from \"./defs/SceneDef\"\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, OBJ_TYPES, TOTAL_OBJ_TYPES} from './Common'\nimport {ToasterNotification} from './ToasterNotification'\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {TweenManager} from '../common/tween'\nimport {toFlatString} from '../utils'\nimport {XRSupport} from './XRSupport'\nimport OrbitControls from './OrbitControls'\n\nconst {SET_PROPERTY, INSERT_ELEMENT, DELETE_ELEMENT} = require(\"syncing_protocol\");\n\n\n// ================  SGP implementation =====================\nclass Adapter extends SceneGraphProvider {\n    constructor(canvas) {\n        super()\n        this.canvas = canvas\n    }\n\n    getAllBehaviors() {\n        return this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot())\n            .find((obj)=> obj.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getAllScenes() {\n        return this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot())\n            .find((obj)=>obj.type === TOTAL_OBJ_TYPES.SCENE)\n    }\n\n    getParsedBehaviorAsset(beh) {\n        const prov = this.canvas.props.provider\n        const asset = prov.accessObject(beh.behavior)\n        return prov.getCachedBehaviorAsset(asset.id)\n    }\n    getGraphObjectById(id) {\n        return this.canvas.props.provider.accessObject(id)\n    }\n    getGraphObjectByName(title) {\n        const list = this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot()).find((o)=>o.title === title)\n        if(!list || list.length<1) return null\n        return list[0]\n    }\n    navigateScene(id) {\n        SelectionManager.setSelection(id)\n    }\n    getCurrentScene() {\n        return this.canvas.props.provider.getSelectedSceneObject()\n    }\n    getSceneObjects(scene) {\n        return scene.getChildren().filter(ch => is3DObjectType(ch.type))\n    }\n    getThreeObject(obj) {\n        if(obj.id) return this.canvas.findNode(obj.id)\n        return this.canvas.findNode(obj)\n    }\n    getBehaviorsForObject(scene) {\n        return scene.getChildren().filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getCamera() {\n        return this.canvas.camera\n    }\n    playMediaAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            const sound = new THREE.Audio(this.canvas.audioListener)\n            const audioLoader = new THREE.AudioLoader()\n            audioLoader.load(asset.src, function (buffer) {\n                sound.setBuffer(buffer);\n                sound.setLoop(false);\n                sound.setVolume(0.5);\n                sound.play();\n            });\n            this.canvas.playing_audio[asset.id] = sound\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            const cache = this.canvas.props.provider.videocache\n            if(cache[asset.src]) cache[asset.src].play()\n        }\n    }\n\n    stopAudioAsset(audio) {\n        if(this.canvas.playing_audio[audio.id]) {\n            this.canvas.playing_audio[audio.id].stop()\n            delete this.canvas.playing_audio[audio.id]\n        }\n    }\n    getTweenManager() {\n        return this.canvas.tweenManager\n    }\n    startImageRecognizer(info) {\n        return this.canvas.startImageRecognizer(info)\n    }\n    stopImageRecognizer(info) {\n        return this.canvas.stopImageRecognizer(info)\n    }\n    startGeoRecognizer(info) {\n        return this.canvas.startGeoRecognizer(info)\n    }\n    stopGeoRecognizer(info) {\n        return this.canvas.stopGeoRecognizer(info)\n    }\n}\n\n\nconst MOVE_SPEED = 0.1\nexport class VRCanvas extends Component {\n    moveCameraForward = () => {\n        this.camera.position.z += -MOVE_SPEED\n    }\n    moveCameraBackward = () => {\n        this.camera.position.z += MOVE_SPEED\n    }\n    handleKeyPress = (e) => {\n        if(e.key === 'ArrowUp') {\n            this.camera.position.z -= MOVE_SPEED\n        }\n        if(e.key === 'ArrowDown') {\n            this.camera.position.z += MOVE_SPEED\n        }\n        if(e.key === 'a') {\n            this.camera.position.x -= MOVE_SPEED\n        }\n        if(e.key === 'd') {\n            this.camera.position.x += MOVE_SPEED\n        }\n        if(e.key === 'ArrowLeft') {\n            this.camera.rotation.y += 0.1\n        }\n        if(e.key === 'ArrowRight') {\n            this.camera.rotation.y -= 0.1\n        }\n    }\n    recenterOnSelection = () => {\n        const sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = this.props.provider.accessObject(sel)\n        if(is3DObjectType(obj.type)) {\n            const node = this.findNode(sel)\n            this.orbitControls.target.copy(node.position)\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            this.orbitControls.reset()\n        }\n    }\n\n    constructor(props) {\n        super(props)\n        this.obj_node_map = {}\n        this.previewUpdateNodes = []\n        this.scenes = []\n        this.state = {\n            scene: -1,\n            running:props.running\n        }\n        this.playing_audio = []\n        this.scriptManager = new ScriptManager(new Adapter(this),this.props.provider.pubnub.getLogger())\n    }\n\n    pauseQueue = (e) => {\n        this.props.provider.pauseQueue()\n    }\n    unpauseQueue = (e) => {\n        this.props.provider.unpauseQueue()\n    }\n    transformChanged = (e) => {\n        const sel = SelectionManager.getSelection()\n        if(sel) {\n            const obj = this.props.provider.accessObject(sel)\n            if(!is3DObjectType(obj.type)) return\n            if(obj.type === OBJ_TYPES.bg360) return\n            const node = this.findNode(sel)\n            if(!node) return\n            const prov = this.props.provider\n            prov.quick_setPropertyValue(sel,'tx',node.position.x)\n            prov.quick_setPropertyValue(sel,'ty',node.position.y)\n            prov.quick_setPropertyValue(sel,'tz',node.position.z)\n        }\n    }\n    transformDraggingChanged = (e) => {\n        this.orbitControls.enabled = ! e.value\n    }\n\n    docSwapped = (e) => {\n        //nuke all the old stuff\n        this.scenes.forEach(sc => this.scene.remove(sc))\n        this.scenes = []\n        this.obj_node_map = {}\n        this.setState({scene: -1})\n        //make new stuff\n        const graph = this.props.provider.getDocGraph()\n        this.rebuildNode(graph,\"\")\n    }\n    rebuildNode(obj, inset) {\n        // console.log(inset,\"rebuilding\",obj.type)\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const node = new SceneDef().makeNode(obj,this.props.provider)\n            this.insertNodeMapping(obj.id,node)\n            this.addSceneWrapper(node)\n            this.setCurrentSceneWrapper(node)\n        }\n        if(is3DObjectType(obj.type)) {\n            const node = get3DObjectDef(obj.type).makeNode(obj,this.props.provider)\n            this.insertNodeMapping(obj.id,node)\n            const parent = this.findNode(obj.parent)\n            parent.add(node)\n        }\n        if(obj.children) {\n            obj.children.forEach(ch => {\n                this.rebuildNode(ch,inset+\"   \")\n            })\n        }\n    }\n    selectionChanged = () => {\n        this.transformControls.detach()\n        const sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = this.props.provider.accessObject(sel)\n\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) return this.setCurrentSceneWrapper(this.findNode(sel))\n\n        if(is3DObjectType(obj.type)) {\n            const sc = this.props.provider.findSceneObjectParent(obj)\n            this.setCurrentSceneWrapper(this.findNode(sc.id))\n            const node = this.findNode(sel)\n            if (!node) return\n            this.transformControls.attach(node)\n            return\n        }\n        console.log(\"selected something not an object or scene\")\n    }\n    windowResized = () => {\n        if(this.canvas) {\n            let cw = this.canvas.clientWidth\n            let ch = this.canvas.clientHeight\n            this.camera.aspect = cw/ch;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize(cw,ch);\n        }\n    }\n\n    checkAspectRatio() {\n        if(!this.canvas) return\n        let cw = this.canvas.clientWidth\n        let ch = this.canvas.clientHeight\n        const aspect = cw/ch\n        if(Math.abs(this.camera.aspect - aspect) > 0.01 ) {\n            this.camera.aspect = aspect\n            this.camera.updateProjectionMatrix()\n            this.renderer.setSize(cw,ch);\n        }\n    }\n\n    componentDidMount() {\n        const canvas = this.canvas\n        const logger = this.props.provider.pubnub.getLogger()\n        logger.log(\"mounting VRCanvas\")\n        if(XRSupport.supportsARKit()) {\n            this.xr = new XRSupport()\n            this.xr.getContext(canvas).then((context) => {\n                this.setupRenderer(canvas,context)\n                this.xr.setAnimationLoop( this.animationLoopWithCamera.bind(this) )\n            }).catch(err => {\n                console.error('Error', err)\n            })\n        } else {\n            this.setupRenderer(canvas,0)\n            this.renderer.setAnimationLoop( this.animationLoop.bind(this) )\n        }\n    }\n\n    componentWillUnmount() {\n        this.transformControls.removeEventListener('change',this.transformChanged)\n        this.transformControls.removeEventListener('mouseDown',this.pauseQueue)\n        this.transformControls.removeEventListener('mouseUp',this.unpauseQueue)\n        this.props.provider.off(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED,this.docSwapped)\n        SelectionManager.off(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n        window.removeEventListener('resize',this.windowResized)\n    }\n\n    setupRenderer(canvas,context) {\n        this.scene = new THREE.Scene();\n        this.camera = new THREE.PerspectiveCamera(50, canvas.width / canvas.height, 0.1, 1000);\n        this.renderer = new THREE.WebGLRenderer({antialias: false, canvas: canvas, context:context});\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize(canvas.width, canvas.height);\n        this.renderer.gammaOutput = true\n        this.audioListener = new THREE.AudioListener()\n        this.camera.add(this.audioListener)\n        //only set a background if there is no XR active\n        if(!this.xr) this.scene.background = new THREE.Color(0x000000);\n        // this.camera.matrixAutoUpdate = false\n        this.scene.add(this.camera)\n        this.camera.position.set(1,6,6)\n\n        this.transformControls = new TransformControls(this.camera, this.renderer.domElement)\n        this.transformControls.addEventListener('change',this.transformChanged)\n        this.transformControls.addEventListener('dragging-changed', this.transformDraggingChanged)\n        this.transformControls.addEventListener('mouseDown',this.pauseQueue)\n        this.transformControls.addEventListener('mouseUp',this.unpauseQueue)\n        this.scene.add(this.transformControls)\n\n        this.orbitControls = new OrbitControls(this.camera,this.renderer.domElement)\n        this.orbitControls.update()\n        // this.orbitControls.autoRotate = true\n        this.raycaster = new THREE.Raycaster();\n\n        const light = new THREE.DirectionalLight(0xffffff, 1.0);\n        light.position.set(1, 1, 1).normalize();\n        this.scene.add(light);\n\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.4))\n        \n        this.tweenManager = new TweenManager()\n\n        this.props.provider.onRawChange(op => this.updateScene(op))\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.docSwapped)\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n\n        window.addEventListener('resize', this.windowResized,false)\n        this.docSwapped()\n    }\n\n    animationLoop(time, frame) {\n        this.checkAspectRatio()\n        let session = null\n        if(this.xr) session = this.xr.session\n        if(this.state.running) this.scriptManager.tick(time, session, frame)\n        if(this.tweenManager) this.tweenManager.update(time)\n        if(this.orbitControls) this.orbitControls.update()\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        this.renderer.render(this.scene, this.camera)\n    }\n\n    animationLoopWithCamera(bounds,projectionMatrix,viewMatrix, time,frame) {\n        if(!this.scene || !this.camera) return\n        this.camera.matrix.fromArray(viewMatrix)\n        this.camera.matrixWorldNeedsUpdate = true\n        this.camera.updateMatrixWorld()\n        this.camera.projectionMatrix.fromArray(projectionMatrix)\n        this.animationLoop(time,frame)\n    }\n\n    insertNodeMapping(id, node) {\n        if (typeof id !== 'string') throw new Error(\"cannot map an object to an object. invalid call in insertNodeMapping\")\n        this.obj_node_map[id] = node\n        node.userData.graphid = id\n        if(node.previewUpdate) this.previewUpdateNodes.push(node)\n    }\n    removeNodeMapping(id,node) {\n        delete this.obj_node_map[id]\n        delete node.userData.graphid\n        this.previewUpdateNodes = this.previewUpdateNodes.filter(n => n !== node)\n    }\n\n\n    findNode(id) {\n        if (!this.obj_node_map[id]) console.warn(\"could not find node for id\", id)\n        return this.obj_node_map[id]\n    }\n\n    updateScene(op) {\n        const prov = this.props.provider\n        if (op.type === INSERT_ELEMENT) {\n            const objid = op.value\n            const obj = prov.accessObject(op.value)\n            if(obj.type === TOTAL_OBJ_TYPES.SCENE) return this.populateNode(objid)\n            if (is3DObjectType(obj.type)) return this.populateNode(objid)\n            if(obj.type === TOTAL_OBJ_TYPES.ASSET) return\n            if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return\n            console.warn(\"unknown object type\", obj)\n            return\n        }\n        if (op.type === SET_PROPERTY) {\n            //skip setting parents. done through insert_element\n            if(op.name === 'parent') return\n            const node = this.findNode(op.object)\n            if (node) {\n                const obj = prov.accessObject(op.object)\n                if(obj.type === 'scene') {\n                    new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                    return\n                }\n                if(is3DObjectType(obj.type)) return get3DObjectDef(obj.type).updateProperty(node,obj,op, this.props.provider)\n            } else {\n                console.log(\"could not find the node for object id:\", op)\n            }\n            return\n        }\n        if (op.type === DELETE_ELEMENT) {\n            this.transformControls.detach()\n            const node = this.findNode(op.value)\n            if(node) {\n                this.removeNodeMapping(op.value,node)\n                const obj = prov.accessObject(op.value)\n                if(is3DObjectType(obj.type)) node.parent.remove(node)\n            }\n            return\n        }\n        // console.log('skipping', op.type)\n    }\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        if('running' in nextProps) {\n            if(nextProps.running !== this.props.running) {\n                this.setState({running:nextProps.running})\n                if(nextProps.running === false) {\n                    this.scriptManager.stopRunning()\n                    this.resetSceneGraph()\n                    this.stopRecognizers()\n                } else {\n                    //start the script manager\n                    this.startRecognizers()\n                    this.scriptManager.startRunning()\n                }\n                return false\n            }\n        }\n        return false\n    }\n\n    render() {\n        return <div style={{}}>\n            <button onClick={this.recenterOnSelection}>recenter on selection</button>\n            <div style={{\n                borderWidth:0,\n                margin:0,\n                padding:0,\n                display:'flex',\n                flexDirection:'column',\n                height:'100%',\n            }}>\n                <canvas ref={c => this.canvas = c} width={'200px'} height={'200px'}\n                        onClick={this.clickedCanvas}\n                        className=\"editable-canvas\"\n                        onKeyDown={this.handleKeyPress}\n                        tabIndex={0}\n                />\n                <ToasterNotification/>\n            </div>\n        </div>\n    }\n\n    populateNode(nodeid) {\n        const obj = this.props.provider.accessObject(nodeid)\n        if (is3DObjectType(obj.type)) {\n            const obj3d = get3DObjectDef(obj.type).makeNode(obj,this.props.provider)\n            this.insertNodeMapping(nodeid, obj3d)\n            const parent = this.findNode(obj.parent)\n            parent.add(obj3d)\n            return obj3d\n        }\n        if (obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const scene = new SceneDef().makeNode(obj,this.props.provider)\n            this.insertNodeMapping(nodeid, scene)\n            this.addSceneWrapper(scene)\n            this.setCurrentSceneWrapper(scene)\n            return scene\n        }\n\n        console.warn(\"cannot populate node for type\", obj.type)\n    }\n\n    addSceneWrapper(scene) {\n        this.scenes.push(scene)\n        this.scene.add(scene)\n    }\n\n    setCurrentSceneWrapper(scene) {\n        this.scenes.forEach(sc => {\n            if(sc === scene) {\n                sc.visible = true\n            } else {\n                sc.visible = false\n            }\n        })\n    }\n\n    dumpScenes() {\n        this.scenes.forEach(sc => {\n            console.log(\"scene\")\n            this.dump(sc,'')\n        })\n    }\n    dump(sc,inset) {\n        console.log(inset+\"\",sc.type,sc.id,  'vis', sc.visible)\n        if(sc.type === 'Mesh') console.log(inset+'  ',sc.geometry.type)\n        // console.log(sc)\n        if(sc.children) {\n            sc.children.forEach((ch) => this.dump(ch, inset + '  '))\n        }\n    }\n\n    getCurrentSceneWrapper() {\n        return this.scenes.find(sc => sc.visible)\n    }\n\n    clickedCanvas = (e) => {\n        this.canvas.focus()\n        const rect = this.canvas.getBoundingClientRect();\n        const pointer = {\n            x: ( e.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( e.clientY - rect.top ) / rect.height * 2 + 1,\n        }\n\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const intersect = this.raycaster.intersectObjects(this.getCurrentSceneWrapper().children, true)\n        if(intersect && intersect.length >= 1) {\n            const obj = intersect[0].object\n            if(this.state.running) {\n                this.scriptManager.performClickAction(this.props.provider.accessObject(obj.userData.graphid))\n            } else {\n                SelectionManager.setSelection(obj.userData.graphid)\n            }\n        } else {\n            SelectionManager.clearSelection()\n        }\n    }\n\n\n    resetSceneGraph() {\n        Object.keys(this.obj_node_map).forEach(id => {\n            const graphObj = this.props.provider.accessObject(id)\n            const threeObj = this.obj_node_map[id]\n            if(graphObj.type === 'scene') {\n                // new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                return\n            }\n            if(is3DObjectType(graphObj.type)) {\n                const def = get3DObjectDef(graphObj.type)\n                if(def.reset) {\n                    def.reset(threeObj,graphObj,this.props.provider.getDataGraph())\n                }\n            }\n        })\n    }\n\n    startRecognizers() {\n        //called when script running is started\n    }\n\n    stopRecognizers() {\n        //called when script running is started\n    }\n\n    startImageRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO start image recognizer\")\n    }\n\n    stopImageRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO stop image recognizer\")\n    }\n\n    startGeoRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO start geo recognizer\")\n    }\n\n    stopGeoRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO stop geo recognizer\")\n    }\n\n}\n","import * as THREE from 'three'\nimport {POINTER_ENTER, POINTER_EXIT, POINTER_MOVE, POINTER_PRESS, POINTER_RELEASE} from 'webxr-boilerplate'\n\n\n\nconst on = (elem,type,cb) => elem.addEventListener(type,cb)\nconst off = (elem,type,cb) => elem.removeEventListener(type,cb)\nconst toRad = (degrees) => degrees*Math.PI/180\n\nexport default class TranslationArrow extends THREE.Group {\n    constructor(axis, control) {\n        super()\n        this.axis = axis\n        this.control = control\n        this.makePlane()\n        this.makeArrow()\n        this.makeInputGrabber()\n    }\n\n    makePlane() {\n        this.plane = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(100, 100, 100, 100),\n            new THREE.MeshBasicMaterial({visible: true, wireframe: true, side: THREE.DoubleSide})\n        )\n        if (this.axis === 'Z') this.plane.rotation.y = toRad(90)\n        this.plane.userData.draggable = true\n        this.plane.visible = false\n        this.add(this.plane)\n    }\n\n    makeArrow() {\n        this.arrow = new THREE.Mesh(\n            new THREE.CylinderBufferGeometry(0.02, 0.02, 4),\n            new THREE.MeshLambertMaterial({color: 'yellow'})\n        )\n        if (this.axis === 'X') this.arrow.rotation.z = toRad(90)\n        if (this.axis === 'Y') this.arrow.rotation.z = toRad(180)\n        if (this.axis === 'Z') this.arrow.rotation.x = toRad(90)\n        this.add(this.arrow)\n    }\n\n    makeInputGrabber() {\n        this.input = new THREE.Mesh(\n            new THREE.CylinderBufferGeometry(0.1, 0.1, 4),\n            new THREE.MeshLambertMaterial({color: 'green', visible: false})\n        )\n        if (this.axis === 'X') this.input.rotation.z = toRad(90)\n        if (this.axis === 'Y') this.input.rotation.z = toRad(180)\n        if (this.axis === 'Z') this.input.rotation.x = toRad(90)\n        this.input.userData.clickable = true\n        this.add(this.input)\n    }\n\n    attach() {\n        on(this.input, POINTER_ENTER, this.startHover)\n        on(this.input, POINTER_EXIT, this.endHover)\n        on(this.input, POINTER_PRESS, this.beginDrag)\n    }\n\n    detach() {\n        off(this.input, POINTER_ENTER, this.startHover)\n        off(this.input, POINTER_EXIT, this.endHover)\n        off(this.input, POINTER_PRESS, this.beginDrag)\n    }\n\n    startHover = () => this.arrow.material.color.set(0xffffff)\n    endHover = () => this.arrow.material.color.set(0xffff00)\n\n    beginDrag = (e) => {\n        this.startPoint = this.parent.position.clone()\n        this.startPoint.copy(e.intersection.point)\n        this.parent.target.parent.worldToLocal(this.startPoint)\n        this.oldFilter = this.parent.pointer.intersectionFilter\n        this.parent.pointer.intersectionFilter = (obj) => obj.userData.draggable\n        this.startPosition = this.parent.target.position.clone()\n        this.plane.visible = true\n        on(this.plane, POINTER_MOVE, this.updateDrag)\n        on(this.plane, POINTER_RELEASE, this.endDrag)\n    }\n    updateDrag = (e) => {\n        this.endPoint = e.intersection.point.clone()\n        this.parent.target.parent.worldToLocal(this.endPoint)\n        //neutralize y and z\n        if (this.axis === 'X') {\n            this.endPoint.y = this.startPoint.y\n            this.endPoint.z = this.startPoint.z\n        }\n        if (this.axis === 'Y') {\n            this.endPoint.x = this.startPoint.x\n            this.endPoint.z = this.startPoint.z\n        }\n        if (this.axis === 'Z') {\n            this.endPoint.x = this.startPoint.x\n            this.endPoint.y = this.startPoint.y\n        }\n        const diff = this.endPoint.clone().sub(this.startPoint)\n        const finalPoint = this.startPosition.clone().add(diff)\n        this.parent.target.position.copy(finalPoint)\n        this.parent.position.copy(finalPoint)\n    }\n    endDrag = (e) => {\n        off(this.plane, POINTER_MOVE, this.updateDrag)\n        off(this.plane, POINTER_RELEASE, this.endDrag)\n        this.parent.pointer.intersectionFilter = this.oldFilter\n        this.plane.visible = false\n        this.parent.dispatchEvent({\n            type: 'change',\n            start: this.startPosition.clone(),\n            end: this.parent.position.clone()\n        })\n    }\n}\n","import * as THREE from 'three'\nimport TranslationArrow from './TranslationArrow'\n\nexport class TranslateControl extends THREE.Group {\n    constructor() {\n        super()\n        this.handles = []\n        this.handles.push(new TranslationArrow('X', this))\n        this.handles.push(new TranslationArrow('Y', this))\n        this.handles.push(new TranslationArrow('Z', this))\n        this.handles.forEach(h => this.add(h))\n        this.visible = false\n    }\n\n    attach(target, pointer) {\n        this.target = target\n        this.pointer = pointer\n        this.position.copy(target.position)\n        this.visible = true\n        this.handles.forEach(h => h.attach())\n    }\n\n    detach() {\n        this.target = null\n        this.pointer = null\n        this.visible = false\n        this.handles.forEach(h => h.attach())\n    }\n}\n","import * as THREE from 'three'\n\nimport {POINTER_RELEASE, POINTER_CLICK, POINTER_ENTER, POINTER_EXIT, POINTER_PRESS, POINTER_MOVE} from 'webxr-boilerplate'\n\n// const $ = (sel) => document.querySelector(sel)\nconst on = (elem, type, cb) => elem.addEventListener(type,cb)\n// const toRad = (deg) => deg * Math.PI/180\n\nexport default class Panel2D extends THREE.Object3D {\n    constructor(scene,camera) {\n        super()\n\n        if(!scene) throw new Error(\"cannot pass empty scene to Panel2D()\")\n        if(!camera) throw new Error(\"cannot pass empty camera to Panel2D()\")\n        this.type = 'panel2d'\n        this.listeners = {}\n        this.scene = scene\n        this.camera = camera\n        this.canvas = document.createElement('canvas')\n        this.canvas.width = 256\n        this.canvas.height = 512\n        this.canvasTexture = new THREE.CanvasTexture(this.canvas)\n        this.redrawHandler = (e) => this.redraw()\n\n        const c = this.canvas.getContext('2d')\n        c.fillStyle = 'red'\n        c.fillRect(0,0,this.canvas.width,this.canvas.height)\n\n        this.mesh = new THREE.Mesh(\n            new THREE.PlaneGeometry(1,2),\n            new THREE.MeshBasicMaterial({color:'white',map:this.canvasTexture})\n        )\n        this.mesh.userData.clickable = true\n        this.comps = []\n\n        this.add(this.mesh)\n\n        let inside = null\n        on(this.mesh,POINTER_MOVE,(e)=>{\n            const uv = e.intersection.uv\n            const fpt = new THREE.Vector2(uv.x*256, 512-uv.y*512)\n            if(inside && !inside.contains(fpt)) {\n                inside.fire(POINTER_EXIT)\n                inside = null\n            }\n            const comp = this.findAt(fpt)\n            // for(let i=0; i<this.comps.length; i++) {\n            //     const comp = this.comps[i]\n            //     if(comp.contains(fpt)) {\n            if(inside !== comp){\n                if(inside) inside.fire(POINTER_EXIT)\n                inside = null\n            }\n            if(comp) comp.fire(POINTER_ENTER)\n            inside = comp\n            // }\n            // }\n        })\n        on(this.mesh,POINTER_CLICK,(e)=>{\n            const uv = e.intersection.uv\n            const fpt = new THREE.Vector2(uv.x*256, 512-uv.y*512)\n            const comp = this.findAt(fpt)\n            if(comp) comp.fire(POINTER_CLICK)\n            // for(let i=0; i<this.comps.length; i++) {\n            //     const comp = this.comps[i]\n            //     if(comp.contains(fpt)) {\n            //         comp.fire(POINTER_CLICK)\n            //     }\n            // }\n        })\n\n        this.header = new THREE.Mesh(\n            new THREE.BoxGeometry(1.0,0.1,0.1),\n            new THREE.MeshBasicMaterial({color:'goldenrod'})\n        )\n        this.header.userData.clickable = true\n        this.header.position.set(0,1.1,0)\n        this.add(this.header)\n\n        on(this.header,POINTER_ENTER, e => this.header.material.color.set('yellow'))\n        on(this.header,POINTER_EXIT,  e => this.header.material.color.set('goldenrod'))\n        on(this.header,POINTER_PRESS, e => this.startDrag())\n    }\n\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n    findAt(pt) {\n        for(let i=0; i<this.comps.length; i++) {\n            const comp = this.comps[i]\n            const res = comp.findAt({x:pt.x-comp.x,y:pt.y-comp.y})\n            if(res) return res\n        }\n        return null\n    }\n\n    add(comp) {\n        if(comp instanceof THREE.Object3D) {\n            super.add(comp)\n        } else {\n            this.comps.push(comp)\n            on(comp, 'changed', this.redrawHandler)\n        }\n    }\n\n    redraw() {\n        const ctx = this.canvas.getContext('2d')\n        ctx.fillStyle = 'white'\n        ctx.fillRect(0,0,this.canvas.width,this.canvas.height)\n        this.comps.forEach(comp => comp.draw(ctx))\n        this.canvasTexture.needsUpdate = true\n    }\n\n    startDrag() {\n        this.header.userData.clickable = false\n        this.mesh.userData.clickable = false\n\n        this.dragSphere = new THREE.Mesh(\n            new THREE.SphereGeometry(4,32,32),\n            new THREE.MeshLambertMaterial({\n                color:'green',\n                wireframe:true,\n                side: THREE.BackSide\n            })\n        )\n        this.dragSphere.userData.clickable = true\n        this.scene.add(this.dragSphere)\n\n        on(this.dragSphere,POINTER_MOVE,(e)=> this.moveDrag(e))\n        on(this.dragSphere,POINTER_RELEASE,(e)=> this.endDrag(e))\n\n    }\n    endDrag() {\n        this.scene.remove(this.dragSphere)\n        this.dragSphere.userData.clickable = false\n        this.header.userData.clickable = true\n        this.mesh.userData.clickable = true\n    }\n\n\n    moveDrag(e) {\n        this.position.copy(e.point)\n        this.position.add(new THREE.Vector3(0,-1,0))\n        this.lookAt(this.camera.position)\n    }\n}\n","export default class Component2D {\n    constructor() {\n        this.listeners = {}\n    }\n    set(key,value) {\n        this[key] = value\n        this.fire('changed',{type:'changed',target:this})\n        return this\n    }\n    get(key) {\n        return this[key]\n    }\n    addEventListener(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n        return this\n    }\n    on(type,cb) {\n        this.addEventListener(type,cb)\n        return this\n    }\n    setAll(props) {\n        Object.keys(props).forEach(key => this.set(key, props[key]))\n        return this\n    }\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n}","import {POINTER_ENTER, POINTER_EXIT} from 'webxr-boilerplate'\nimport Component2D from \"./component2d\";\n\n\nexport default class Button2D extends Component2D {\n    constructor() {\n        super()\n        this.type = 'button'\n        this.text = 'foo'\n        this.x = 0\n        this.y = 0\n        this.fsize = 20\n        this.w = this.text.length * this.fsize\n        this.h = 20\n        this.normalBg = 'white'\n        this.hoverBg = 'red'\n        this.bg = this.normalBg\n        this.on(POINTER_ENTER, () => {\n            this.bg = this.hoverBg\n            this.fire('changed', {type: 'changed', target: this})\n        })\n        this.on(POINTER_EXIT, () => {\n            this.bg = this.normalBg\n            this.fire('changed', {type: 'changed', target: this})\n        })\n    }\n\n    draw(ctx) {\n        ctx.font = `${this.fsize}px sans-serif`\n        const metrics = ctx.measureText(this.text)\n        this.w = 5 + metrics.width + 5\n        this.h = 0 + this.fsize + 4\n        ctx.fillStyle = this.bg\n        ctx.fillRect(this.x, this.y, this.w, this.h)\n        ctx.fillStyle = 'black'\n        ctx.fillText(this.text, this.x + 3, this.y + this.fsize - 2)\n        ctx.strokeStyle = 'black'\n        ctx.strokeRect(this.x, this.y, this.w, this.h)\n    }\n\n    contains(pt) {\n        if (pt.x < this.x) return false\n        if (pt.x > this.x + this.w) return false\n        if (pt.y < this.y) return false\n        if (pt.y > this.y + this.h) return false\n        return true\n    }\n\n    findAt(pt) {\n        if (pt.x < 0) return null\n        if (pt.x > 0 + this.w) return null\n        if (pt.y < 0) return null\n        if (pt.y > 0 + this.h) return null\n        return this\n    }\n\n    set(key, value) {\n        super.set(key, value)\n        if (key === 'normalBg') this.bg = this.normalBg\n    }\n}\n","import Component2D from \"./component2d\";\n\nexport default class Group2D extends Component2D {\n    constructor() {\n        super()\n        this.type = 'group'\n        this.x = 0\n        this.y = 0\n        this.w = 100\n        this.h = 100\n        this.bg = 'gray'\n        this.visible = true\n        this.comps = []\n        this.padding = 5\n        this.border = 1\n\n        this.layout = (comp) => {\n            console.log(\"not laying out anything\")\n        }\n    }\n    draw(ctx) {\n        if(!this.visible) return\n        this.layout(this)\n        ctx.fillStyle = this.bg\n        ctx.fillRect(this.x,this.y,this.w,this.h)\n        if(this.border > 0) {\n            ctx.strokeStyle = 'black'\n            ctx.strokeRect(this.x, this.y, this.w, this.h)\n        }\n        ctx.save()\n        ctx.translate(this.x+this.padding,this.y+this.padding)\n        this.comps.forEach(comp => comp.draw(ctx))\n        ctx.restore()\n    }\n\n    contains(pt) {\n        if(pt.x < this.x) return false\n        if(pt.x > this.x + this.w) return false\n        if(pt.y < this.y) return false\n        if(pt.y > this.y + this.h) return false\n        return true\n    }\n    findAt(pt) {\n        if(!this.visible) return null\n        for(let i=0; i<this.comps.length; i++) {\n            const comp = this.comps[i]\n            const res = comp.findAt({x:pt.x-comp.x-5,y:pt.y-comp.y-5})\n            if(res) return res\n        }\n        return null\n    }\n\n    childSet(key,value) {\n        this.childProps[key] = value\n        this.comps.forEach(ch=>ch.set(key,value))\n        return this\n    }\n\n    add(comp) {\n        this.comps.push(comp)\n        this.fire('changed',{type:'changed',target:this})\n        return this\n    }\n}\n","import * as THREE from 'three'\n\nconst toRad = (deg) => Math.PI/180*deg\nconst YAXIS = new THREE.Vector3(0,1,0)\n\n\nexport default class ThreeDOFController {\n\n\n    constructor(stagePos, stageRot) {\n        this.stagePos = stagePos\n        this.stageRot = stageRot\n        this.states = { touchpad: false}\n        this.listeners = {}\n        this.keystates = {\n            ArrowLeft:{current:false, previous:false},\n            ArrowRight:{current:false, previous:false},\n            ArrowUp:{current:false, previous:false},\n            ArrowDown:{current:false, previous:false}\n        }\n        this.dir = new THREE.Vector3(0,0,1)\n\n\n        document.addEventListener('keydown',(e)=>{\n            if(this.keystates[e.key]) {\n                this.keystates[e.key].current = true\n            }\n        })\n        document.addEventListener('keyup',(e)=>{\n            if(this.keystates[e.key]) {\n                this.keystates[e.key].current = false\n            }\n        })\n\n    }\n\n    addEventListener(type, cb) {\n        if (!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n    }\n\n    _fire(type,payload) {\n        if (!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n\n\n\n    updateKeys() {\n        if(this.keystates.ArrowLeft.current === false && this.keystates.ArrowLeft.previous === true) {\n            this.rotateLeft()\n        }\n        if(this.keystates.ArrowRight.current === false && this.keystates.ArrowRight.previous === true) {\n            this.rotateRight()\n        }\n        if(this.keystates.ArrowUp.current === false && this.keystates.ArrowUp.previous === true) {\n            this.moveForward()\n        }\n        if(this.keystates.ArrowDown.current === false && this.keystates.ArrowDown.previous === true) {\n            this.moveBackward()\n        }\n\n        Object.keys(this.keystates).forEach(key => {\n            this.keystates[key].previous = this.keystates[key].current\n        })\n    }\n\n    rotateLeft() {\n        this.dir.applyAxisAngle(YAXIS,toRad(30))\n        this.stageRot.rotation.y -= toRad(30)\n    }\n\n    rotateRight() {\n        this.dir.applyAxisAngle(YAXIS,-toRad(30))\n        this.stageRot.rotation.y += toRad(30)\n    }\n\n    moveForward() {\n        this.stagePos.position.add(this.dir)\n        this._fire('move',this.stagePos.position)\n    }\n\n    moveBackward() {\n        this.stagePos.position.sub(this.dir)\n        this._fire('move',this.stagePos.position)\n    }\n\n    update() {\n        this.scanGamepads()\n        this.updateKeys()\n    }\n\n    scanGamepads() {\n        // console.log(\"gamepads\",navigator.getGamepads())\n        const gamepads = navigator.getGamepads()\n        for(let i=0; i<gamepads.length; i++) {\n            const gamepad = gamepads[i]\n            if ( gamepad && ( gamepad.id === 'Daydream Controller' ||\n                gamepad.id === 'Gear VR Controller' || gamepad.id === 'Oculus Go Controller' ||\n                gamepad.id === 'OpenVR Gamepad' || gamepad.id.startsWith( 'Oculus Touch' ) ||\n                gamepad.id.startsWith( 'Spatial Controller' ) ) ) {\n                //we should have at least two buttons\n                if(gamepad.buttons.length < 2) return\n\n                const touchpad = gamepad.buttons[0]\n                if(touchpad.pressed && gamepad.axes && gamepad.axes.length === 2) {\n                    const left = gamepad.axes[0] < -0.5\n                    const right = gamepad.axes[0] > 0.5\n                    const down = gamepad.axes[1] < -0.5\n                    const up = (gamepad.axes[1] > 0.5)\n\n\n                    if (down && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.moveForward()\n                    }\n                    if (up && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.moveBackward()\n                    }\n                    if (left && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.rotateLeft()\n                    }\n                    if (right && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.rotateRight()\n                    }\n                }\n\n                const trigger = gamepad.buttons[1]\n                if(trigger.pressed) console.log(\"trigger\")\n                if(this.states.touchpad === false && touchpad.pressed === true) {\n                    console.log(\"pressed\")\n                }\n                if(this.states.touchpad === true && touchpad.pressed === false) {\n                    console.log(\"released\")\n                }\n                this.states.touchpad = touchpad.pressed\n            }\n\n        }\n    }\n\n}\n","import SceneDef from './defs/SceneDef'\nimport SelectionManager from '../SelectionManager'\nimport {toQueryString} from '../utils'\nimport {ITEM_ICONS, OBJ_TYPES} from './Common'\nimport {PopupManager} from 'appy-comps'\nimport {MenuPopup} from '../common/GridEditorApp'\nimport React from 'react'\nimport {AuthModule} from './AuthModule'\n\nexport function addScene(provider) {\n    const root = provider.accessObject(provider.getSceneRoot())\n    const scene = new SceneDef().make(provider.getDataGraph(),root)\n    root.insertFirstChild(scene)\n    SelectionManager.setSelection(scene.id)\n}\n\n\nexport function deleteObject(provider) {\n    if(SelectionManager.isEmpty()) return\n    provider.accessObject(SelectionManager.getSelection()).removeFromParent()\n    SelectionManager.clearSelection()\n}\n\nexport function newDoc(provider) {\n    const opts = Object.assign({},provider.options,\n        {mode:'edit', switcher:false, doc:provider.genID('doc')})\n    document.location =  `./?${toQueryString(opts)}`\n}\n\n\nexport function showAddPopup (e, provider) {\n    let item = provider.getSelectedSceneObject()\n    const acts = Object.keys(OBJ_TYPES).map(type => {\n        return {\n            title: type,\n            icon: ITEM_ICONS[type],\n            fun: () => provider.add3DObject(type,item)\n        }\n    })\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n\n\nexport function showAddAssetPopup(e, provider) {\n    let acts = []\n    // console.log(\"Auth mod\",AuthModule.supportsAssetUpload())\n    if(AuthModule.supportsAssetUpload()) {\n        acts = acts.concat([\n            {\n                title: 'image',\n                icon: ITEM_ICONS.image,\n                fun: () => provider.showAddImageAssetDialog()\n            },\n            {\n                title: 'server image',\n                icon: ITEM_ICONS.image,\n                fun: () => provider.showAddServerImageDialog()\n            },\n            {divider: true},\n            {\n                title: 'GLTF model',\n                icon: ITEM_ICONS.model,\n                fun: () => provider.showAddGLTFAssetDialog()\n            },\n            {\n                title: 'GLB model',\n                icon: ITEM_ICONS.model,\n                fun: () => provider.showAddGLBAssetDialog()\n            },\n            {divider: true},\n            {\n                title: 'audio file',\n                icon: ITEM_ICONS.audio,\n                fun: () => provider.showAddAudioAssetDialog()\n            },\n            {\n                title: 'existing asset on server',\n                icon: ITEM_ICONS.assets,\n                fun: () => provider.showOpenAssetDialog()\n            }])\n    } else {\n        acts.push({\n            title: 'add asset from glitch',\n            icon: ITEM_ICONS.assets,\n            fun: () => provider.showOpenAssetDialog()\n        })    \n    }\n\n    acts.push({\n        title:'geo location',\n        icon: ITEM_ICONS.geoanchor,\n        fun: () => provider.showAddGeoLocationAssetDialog()\n    })\n\n\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n\nexport function showAddBehaviorPopup (e, provider) {\n    const acts = [\n        {\n            title:'Add Behavior from Server',\n            icon: ITEM_ICONS.behavior_script,\n            fun: () => provider.showOpenBehaviorDialog()\n        },\n    ]\n    if(AuthModule.supportsScriptEdit()) {\n        acts.push({\n            title: 'custom behavior',\n            icon: ITEM_ICONS.behavior_script,\n            fun: () => provider.addCustomBehaviorAsset()\n        })\n    }\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n","import React, {Component} from 'react'\nimport {\n    AmbientLight,\n    Audio,\n    AudioLoader,\n    AudioListener,\n    Color,\n    CylinderBufferGeometry,\n    DirectionalLight,\n    Group,\n    Mesh,\n    MeshLambertMaterial,\n    PerspectiveCamera,\n    Scene,\n    WebGLRenderer\n} from 'three'\n\nimport './VREditor.css'\n\nimport {Pointer, POINTER_CLICK, VR_DETECTED, VRManager, VRStats} from \"webxr-boilerplate\"\n\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {TranslateControl} from './TranslateControl'\nimport panel2d from \"./panel2d/panel2d\"\nimport button2d from \"./panel2d/button2d\"\nimport group2d from \"./panel2d/group2d\"\nimport SceneDef from \"./defs/SceneDef\"\nimport {on, parseOptions, toFlatString} from \"../utils\"\nimport {TweenManager} from \"../common/tween\"\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, OBJ_TYPES, SIMPLE_COLORS, toRad, TOTAL_OBJ_TYPES} from './Common'\n//use the oculus go controller\nimport ThreeDOFController from \"./3dof.js\"\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {deleteObject} from './Actions'\nimport {DialogContainer} from 'appy-comps'\nimport {PubnubLogger} from '../syncgraph/PubnubSyncWrapper'\n\nconst {SET_PROPERTY, CREATE_OBJECT, INSERT_ELEMENT, DELETE_ELEMENT} = require(\"syncing_protocol\");\n\nclass Adapter extends SceneGraphProvider {\n    constructor(editor, provider) {\n        super()\n        this.editor = editor\n        this.provider = provider\n    }\n    getCurrentScene ()  {\n        return this.provider.accessObject(this.editor.currentScene)\n    }\n    getSceneObjects (scene)  {\n        return scene.getChildren().filter(ch => is3DObjectType(ch.type))\n    }\n    getBehaviorsForObject (obj)  {\n        return obj.getChildren().filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getThreeObject(id) {\n        return this.editor.findNode(id)\n    }\n    getParsedBehaviorAsset (beh) {\n        const asset = this.provider.accessObject(beh.behavior)\n        return this.provider.getCachedBehaviorAsset(asset.id)\n    }\n    getAllBehaviors ()  {\n        return this.provider.accessObject(this.provider.getSceneRoot())\n            .find((obj)=> obj.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getGraphObjectByName(title) {\n        const list = this.provider.accessObject(this.provider.getSceneRoot()).find((o)=>o.title === title)\n        if(!list || list.length<1) return null\n        return list[0]\n    }\n    navigateScene(id) {\n        return this.editor.swapScene(id)\n    }\n    playMediaAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            const sound = new Audio(this.editor.audioListener)\n            const audioLoader = new AudioLoader()\n            audioLoader.load(asset.src, function (buffer) {\n                sound.setBuffer(buffer);\n                sound.setLoop(false);\n                sound.setVolume(0.5);\n                sound.play();\n            });\n            this.editor.playing_audio[asset.id] = sound\n        }\n    }\n\n    stopAudioAsset(audio) {\n        if(this.editor.playing_audio[audio.id]) {\n            this.editor.playing_audio[audio.id].stop()\n            delete this.editor.playing_audio[audio.id]\n        }\n    }\n\n    getGraphObjectById(id) {\n        return this.provider.accessObject(id)\n    }\n\n    startImageRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO start image recognizer\")\n    }\n\n    stopImageRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO stop image recognizer\")\n    }\n\n    startGeoRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO start geo recognizer\")\n    }\n\n    stopGeoRecognizer(info) {\n        const logger = this.provider.pubnub.getLogger()\n        \n        logger.log(\"NOTHING DONE TO stop geo recognizer\")\n    }\n\n}\n\nexport default class ImmersiveVREditor extends Component {\n    constructor(props) {\n        super(props)\n        this.obj_node_map = {}\n        this.previewUpdateNodes = []\n        this.playing_audio = []\n        const opts = parseOptions({})\n        if(!opts.doc) throw new Error(\"doc not specified\")\n        this.logger = new PubnubLogger(opts.doc)\n        this.scriptManager = new ScriptManager(new Adapter(this, this.props.provider), this.logger)\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        return false\n    }\n\n\n    render() {\n        return <div>\n            <div id=\"overlay\">\n                <div id=\"inner\">\n                    <h1>Application Name</h1>\n                    <div id=\"loading-indicator\">\n                        <label>loading</label>\n                        <progress max=\"100\" value=\"0\" id=\"progress\"></progress>\n                    </div>\n                    <button id=\"enter-button\" disabled>VR not supported, play anyway</button>\n                </div>\n            </div>\n            <div ref={c => this.wrapper = c}></div>\n            <DialogContainer/>\n        </div>\n    }\n\n\n    componentDidMount() {\n        this.sceneWrappers = {}\n        this.initScene()\n        this.renderer.setAnimationLoop(this.render3.bind(this))\n    }\n\n    render3(time) {\n        //update the pointer and stats, if configured\n        if(this.tweenManager) this.tweenManager.update(time)\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        if(this.pointer) this.pointer.tick(time)\n        if(this.stats) this.stats.update(time)\n        if(this.controller) this.controller.update(time)\n        if(this.scriptManager.isRunning()) this.scriptManager.tick(time)\n        this.renderer.render( this.scene, this.camera );\n    }\n\n    initScene() {\n\n        const $ = (sel) => document.querySelector(sel)\n        const on = (elem, type, cb) => elem.addEventListener(type,cb)\n\n        const container = this.wrapper\n        this.tweenManager = new TweenManager()\n        this.scene = new Scene();\n        this.stageRot = new Group()\n        this.scene.add(this.stageRot)\n        this.stagePos = new Group()\n        this.stageRot.add(this.stagePos)\n        this.camera = new PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new WebGLRenderer( { antialias: true } );\n        const renderer = this.renderer\n        renderer.setPixelRatio( window.devicePixelRatio );\n        renderer.setSize( window.innerWidth, window.innerHeight );\n        renderer.gammaOutput = true\n        renderer.vr.enabled = true;\n        container.appendChild( renderer.domElement );\n        this.vrmanager = new VRManager(renderer)\n\n        this.audioListener = new AudioListener()\n        this.camera.add(this.audioListener)\n\n        this.initContent()\n\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n\n\n        on($(\"#enter-button\"),'click',()=>{\n            $(\"#overlay\").style.display = 'none'\n            //we can start playing sound now\n        })\n\n        this.vrmanager.addEventListener(VR_DETECTED,()=>{\n            console.log(\"VR detected\")\n            $(\"#enter-button\").removeAttribute('disabled',false)\n            $(\"#enter-button\").innerText = \"enter vr\"\n            on($(\"#enter-button\"),'click',()=> this.vrmanager.enterVR())\n        })\n\n        const WAIT_FOR_LOAD = false\n\n        if(!WAIT_FOR_LOAD) {\n            $(\"#loading-indicator\").style.display = 'none'\n            $(\"#enter-button\").style.display = 'block'\n            $(\"#enter-button\").removeAttribute('disabled')\n        }\n\n        this.props.provider.onRawChange(this.updateSceneOp.bind(this))\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.documentSwapped.bind(this))\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged.bind(this))\n        //clear selection when click on the bg\n        on(this.pointer,POINTER_CLICK,()=> SelectionManager.clearSelection())\n\n        this.controller = new ThreeDOFController(this.stagePos, this.stageRot)\n        // on(this.controller,'move', this.standardProximityHandler)\n\n        this.loadScene()\n    }\n\n    selectionChanged() {\n        const sel = SelectionManager.getSelection()\n        if (sel === null && this.controls) return this.controls.detach(this.selectedNode)\n        const node = this.findNode(sel)\n        if(this.selectedNode !== node && this.controls) this.controls.detach(this.selectedNode)\n        this.selectedNode = node\n        if (this.selectedNode && this.controls) this.controls.attach(this.selectedNode, this.pointer)\n    }\n\n    standardViewClickHandler = (e)  => {\n        if(this.scriptManager.isRunning()) {\n            this.scriptManager.performClickAction(this.props.provider.accessObject(e.target.userData.graphid))\n        } else {\n            SelectionManager.setSelection(e.target.userData.graphid)\n        }\n    }\n\n\n    initContent() {\n        if(!this.xr) this.scene.background = new Color(0x000000);\n        const light = new DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new AmbientLight(0xffffff,0.2))\n\n        // enable stats visible inside VR\n        this.stats = new VRStats({renderer:this.renderer})\n        if(this.props.editable) {\n            this.camera.add(this.stats)\n        }\n        this.scene.add(this.camera)\n        this.camera.matrixAutoUpdate = false\n\n        //class which handles mouse and VR controller \n        this.pointer = new Pointer(this, {\n            intersectionFilter: ((o) => o.userData.clickable),\n            cameraFollowMouse:false,\n            mouseSimulatesController:false,\n            enableLaser: true,\n            laserLength: 20,\n        })\n\n\n        const STICK_HEIGHT = 1.0\n        const stick = new Mesh(\n            new CylinderBufferGeometry(0.1,0.1,STICK_HEIGHT),\n            new MeshLambertMaterial({color:'aqua'})\n        )\n        stick.position.z = -STICK_HEIGHT/2;\n        stick.rotation.x = toRad(-90)\n        this.pointer.controller1.add(stick)\n\n\n        if(this.props.editable) {\n            this.controls = new TranslateControl()\n            this.controls.name = 'Controls'\n            on(this.controls, 'change', (e) => {\n                const sel = SelectionManager.getSelection()\n                if (sel) {\n                    const node = this.findNode(sel)\n                    const prov = this.props.provider\n                    prov.quick_setPropertyValue(sel, 'tx', node.position.x)\n                    prov.quick_setPropertyValue(sel, 'ty', node.position.y)\n                    prov.quick_setPropertyValue(sel, 'tz', node.position.z)\n                }\n            })\n        }\n\n        if(this.props.editable) {\n            this.tools = new panel2d(this.scene, this.camera)\n            this.tools.position.set(-1, 0, -3)\n            this.scene.add(this.tools)\n\n\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5, text: 'add box'})\n                .on(POINTER_CLICK, () => {\n                    const scene = this.props.provider.accessObject(this.currentScene)\n                    this.props.provider.add3DObject(OBJ_TYPES.cube,scene)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30, text: 'add sphere'})\n                .on(POINTER_CLICK, () => {\n                    const scene = this.props.provider.accessObject(this.currentScene)\n                    this.props.provider.add3DObject(OBJ_TYPES.sphere,scene)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30 + 30, text: 'delete'})\n                .on(POINTER_CLICK, ()=>{\n                    deleteObject(this.props.provider)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30 + 30 + 30, text: 'save'})\n                .on(POINTER_CLICK, this.props.provider.save))\n            const runButton = new button2d()\n                .setAll({x:5, y: 5+30*4, text:'run'})\n                .on(POINTER_CLICK,() => {\n                    if(this.scriptManager.isRunning()) {\n                        runButton.set('text','run')\n                        this.scriptManager.stopRunning()\n                    } else {\n                        runButton.set('text','stop')\n                        this.scriptManager.startRunning()\n                    }\n                })\n            this.tools.add(runButton)\n\n            const rowLayout = (panel) => {\n                let x = 0\n                panel.comps.forEach((c) => {\n                    c.x = x\n                    c.y = 0\n                    x += c.w + panel.padding\n                })\n            }\n\n            const color_group = new group2d().setAll({x: 5, y: 5 + 30 * 5, w: 235, h: 35, layout: rowLayout})\n            SIMPLE_COLORS.forEach(c => {\n                color_group.add(new button2d()\n                    .setAll({text: ' ', normalBg: c})\n                    .on(POINTER_CLICK, () => this.props.provider.setColor(c))\n                )\n            })\n\n            this.tools.add(color_group)\n\n            this.tools.redraw()\n        }\n\n    }\n\n\n    updateSceneOp(op) {\n        //only do scenes with create_object\n        if (op.type === CREATE_OBJECT) {\n            if(op.defaults) {\n                //console.log(\"creating object with defaults\",op.defaults)\n                if(op.defaults.type === 'scene') {\n                    let node =  this.findNode(op.id)\n                    if(node) {\n                        // console.log(\"scene already exists. skipping\", node.name)\n                    } else {\n                        // console.log(\"Making a real scene\", op)\n                        const obj = this.props.provider.accessObject(op.id)\n                        node = new SceneDef().makeNode(obj, this.props.provider)\n                        this.insertNodeMapping(op.id,node)\n                        this.sceneWrappers[op.id] = node\n                        this.stagePos.add(node)\n                        // this.scene.add(node)\n                        this.swapScene(op.id)\n                    }\n                }\n            }\n        }\n        // other objects are done with insert_element\n        if (op.type === INSERT_ELEMENT) {\n            const obj = this.props.provider.accessObject(op.value)\n            if (obj.type === 'scene') return // console.log(\"skipping insert scene\")\n            if(is3DObjectType(obj.type)) {\n                const nodeObj = get3DObjectDef(obj.type).makeNode(obj, this.props.provider)\n                on(nodeObj, POINTER_CLICK, this.standardViewClickHandler)\n                this.insertNodeMapping(obj.id, nodeObj)\n                this.findNode(obj.parent).add(nodeObj)\n                return\n            }\n            if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.ASSET) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return\n            console.warn(\"unknown object type\", obj)\n            return\n        }\n        if (op.type === SET_PROPERTY) {\n            const obj = this.props.provider.accessObject(op.object)\n            if(obj.type === 'asset') return\n            if(obj.type === 'assets') return\n            const node = this.findNode(op.object)\n            if (node) {\n                if(op.name === 'parent') return\n                if(obj.type === 'scene') return new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                if(is3DObjectType(obj.type)) return get3DObjectDef(obj.type).updateProperty(node,obj,op, this.props.provider)\n            } else {\n                console.log(\"could not find the node for object id:\", op)\n                console.log(\"objects are\",this.obj_node_map)\n            }\n            return\n        }\n        if(op.type === DELETE_ELEMENT) {\n            const obj = this.props.provider.accessObject(op.value)\n            if(is3DObjectType(obj.type)) {\n                const node = this.findNode(obj.id)\n                this.findNode(obj.parent).remove(node)\n            }\n            return\n        }\n        // console.log('skipping', op.type)\n    }\n    documentSwapped() {\n        console.log(\"totally new document!\")\n        //nuke all the old stuff\n        Object.keys(this.sceneWrappers).forEach(key => {\n            const scene = this.sceneWrappers[key]\n            if(this.controls) scene.remove(this.controls)\n            this.stagePos.remove(scene)\n        })\n        this.sceneWrappers = {}\n        this.obj_node_map = {}\n        // this.setState({scene: -1})\n        //make new stuff\n        const graph = this.props.provider.getDocGraph()\n        console.log(\"we are rebuilding using this graph\",graph)\n        this.rebuildNode(graph,\"\")\n    }\n\n    rebuildNode(obj, inset) {\n        console.log(inset,\"rebuilding\",obj.type)\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const node = new SceneDef().makeNode(obj, this.props.provider)\n            this.insertNodeMapping(obj.id,node)\n            this.sceneWrappers[obj.id] = node\n            this.stagePos.add(node)\n            this.swapScene(obj.id)\n        }\n        if(is3DObjectType(obj.type)) {\n            const node = get3DObjectDef(obj.type).makeNode(obj, this.props.provider)\n            on(node, POINTER_CLICK, this.standardViewClickHandler)\n            this.insertNodeMapping(obj.id, node)\n            this.findNode(obj.parent).add(node)\n        }\n        if(obj.children) {\n            obj.children.forEach(ch => {\n                this.rebuildNode(ch,inset+\"   \")\n            })\n        }\n    }\n\n    swapScene(id) {\n        this.currentScene = id\n        console.log(\"swapping to the scene\",id)\n        //make all scenes invisible except the right one\n        Object.keys(this.sceneWrappers).forEach(key => {\n            const scene = this.sceneWrappers[key]\n            scene.visible = (key === id)\n            if(this.controls) scene.remove(this.controls)\n        })\n        if(this.controls) this.sceneWrappers[id].add(this.controls)\n        this.sceneWrappers[id].position.x = 0\n        this.sceneWrappers[id].position.z = 0\n    }\n\n\n    loadScene() {\n    }\n\n    insertNodeMapping(id, node) {\n        if (typeof id !== 'string') throw new Error(\"cannot map an object to an object. invalid call in insertNodeMapping\")\n        this.obj_node_map[id] = node\n        if(node.previewUpdate) this.previewUpdateNodes.push(node)\n        node.userData.graphid = id\n    }\n\n    findNode(id) {\n        if (!this.obj_node_map[id]) console.warn(\"could not find node for id\", id)\n        return this.obj_node_map[id]\n    }\n\n\n}\n\n\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\n\nexport class AddGLTFAssetDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        listToArray(this.fileinput.files).forEach(file => {\n            console.log(\"got the file\", file)\n        })\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox>\n                <h3>add GLTF file assets</h3>\n                <p>\n                    chose <b>the directory</b> containing the GLTF file\n                </p>\n                <input type=\"file\" ref={(obj) => this.fileinput = obj} onChange={this.selectedFile} multiple={true}\n                       webkitdirectory=\"true\"/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {addGLBAssetFromFile} from '../AssetActions'\n\nexport class AddGLBAssetDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        listToArray(this.fileinput.files).forEach(file => {\n            addGLBAssetFromFile(file, this.props.provider)\n        })\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox>\n                <h3>add GLB to assets</h3>\n                <p>\n                    choose a GLB file\n                </p>\n                <input type=\"file\" ref={(obj) => this.fileinput = obj} onChange={this.selectedFile} multiple={true}/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {ToggleButton, Toolbar} from '../../common/GridEditorApp'\nimport {addAudioAssetFromFile, addAudioAssetFromURL} from '../AssetActions'\n\nexport class AddAudioAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            view:'local',\n            url:\"\",\n        }\n        this.fileInput = React.createRef();\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        if(this.state.view === 'remote') {\n            console.log(\"adding the url\",this.state.url)\n            addAudioAssetFromURL(this.state.url, this.props.provider)\n        } else {\n            console.log(\"the file input is\",this.fileInput)\n            listToArray(this.fileInput.current.files).forEach(file => {\n                addAudioAssetFromFile(file, this.props.provider)\n            })\n        }\n    }\n    switchLocal = () => this.setState({view:'local'})\n    switchRemote = () => this.setState({view:'remote'})\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>add image to assets</h3>\n                <VBox grow>\n                    <Toolbar>\n                        <ToggleButton onClick={this.switchLocal} selected={this.state.view==='local'}>local</ToggleButton>\n                        <ToggleButton onClick={this.switchRemote} selected={this.state.view==='remote'}>remote</ToggleButton>\n                    </Toolbar>\n                    {this.renderSelectedPanel()}\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n        this.setState({fileInput:e.target.value})\n    }\n\n    typedURL = (e) => {\n        this.setState({url:e.target.value})\n    }\n\n    renderSelectedPanel() {\n        if(this.state.view === 'local') {\n            return <HBox>\n                <label>File\n                    <input key=\"f1\" type=\"file\" onChange={this.selectedFile} ref={this.fileInput}/>\n                </label>\n            </HBox>\n        } else {\n            return <HBox>\n                <label>URL\n                    <input key=\"f2\" value={this.state.url} type=\"input\" onChange={this.typedURL}/>\n                </label>\n            </HBox>\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\n\nexport class UnsavedDocumentDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        this.props.onAnyway()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Warning. Your document has unsaved changes.</h3>\n                <p>Press cancel to go back</p>\n                <p>Press continue to continue anyway and lose the unsaved changes</p>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>continue!</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n}\n\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {toQueryString} from '../../utils'\nimport {AuthModule} from '../AuthModule'\n\nexport class OpenFileDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            docList:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadDocList().then((docs) => this.setState({docList:docs}))\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    generateDocUrl(doc) {\n        const opts = Object.assign({},this.props.provider.options,{\n            mode:'edit',\n            switcher:false,\n            doc:doc.id\n        })\n        const url = `./?${toQueryString(opts)}`\n        return url\n    }\n    deleteDoc(info) {\n        return this.props.provider.removeDoc(info).then((res)=>{\n            console.log('removed?',res)\n            this.refreshList()\n        })\n    }\n\n    dismiss = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Open document</h3>\n                <VBox scroll style={{ maxHeight:'60vh'}}>\n                    <ul>{this.state.docList.map((doc, i) => {\n\n                        return <li key={i}>\n                            <b>{doc.title}</b>\n                            <a className={\"button\"} href={this.generateDocUrl(doc)}>open</a>\n                            {this.renderDeleteButton(doc)}\n                        </li>\n                    })}\n                    </ul>\n                </VBox>\n                <HBox>\n                    <button onClick={this.dismiss}>dismiss</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsDocDelete()) return \"\"\n        return <button onClick={()=>this.deleteDoc(doc)}>delete</button>\n\n    }\n\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {getAssetsURL} from '../../TreeItemProvider'\nimport {isAudioType, isGLTFType, isImageType, isVideoType} from '../Common'\nimport {AuthModule} from '../AuthModule'\nimport {\n    addAudioAssetFromURL,\n    addGLBAssetFromURL,\n    addImageAssetFromExpandedURL,\n    addVideoAssetFromURL\n} from '../AssetActions'\n\nexport class OpenAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            assetList:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadAssetList()\n            .then((assets) => {\n                if(this.props.filter) assets = assets.filter(this.props.filter)\n                this.setState({assetList:assets})\n            })\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    addAsset(info) {\n        DialogManager.hide()\n        if(isImageType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addImageAssetFromExpandedURL(info.url,info.mimeType, info.title, this.props.provider)\n        }\n        if(isAudioType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addAudioAssetFromURL(info.url, info.mimeType, info.title, this.props.provider)\n        }\n        if(isVideoType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addVideoAssetFromURL(info.url, info.mimeType, info.title, this.props.provider)\n        }\n        if(isGLTFType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addGLBAssetFromURL(info.url, info.mimeType, info.title, this.props.provider)\n        }\n        console.log(\"can't add this type\")\n    }\n    deleteAsset(info) {\n        return this.props.provider.removeAssetSource(info).then((res)=>{\n            console.log('removed?',res)\n            this.refreshList()\n        })\n    }\n\n    okay = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Add Asset</h3>\n                <VBox scroll style={{ maxHeight:'60vh'}}>\n                    <ul>{this.state.assetList.map((doc, i) => {\n                        return <li key={i}>\n                            <b>{doc.title} </b>\n                            <i> {doc.mimeType}</i>\n                            <button onClick={()=>this.addAsset(doc)}>add</button>\n                            {this.renderDeleteButton(doc)}\n                        </li>\n                    })}\n                    </ul>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>close</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsAssetUpload()) return \"\"\n        return <button onClick={()=>this.deleteAsset(doc)}>delete</button>\n\n    }\n}\n","import React, {Component} from \"react\"\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport selMan, {SELECTION_MANAGER} from '../SelectionManager'\nimport {TOTAL_OBJ_TYPES} from './Common'\nimport AceEditor from 'react-ace'\nimport 'brace/mode/javascript'\nimport 'brace/theme/github'\n\nexport default class ScriptEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.refresh = () => {\n            const id = selMan.getSelection()\n            const obj = this.props.provider.accessObject(id)\n            console.log('id',id,obj.exists(), obj.type)\n            if(obj.exists() && obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                this.props.provider.fetchBehaviorAssetContents(id).then(text => {\n                    this.setState({id:id, text:text})\n                })\n            } else {\n            }\n        }\n        this.state = {\n            id:null,\n            text:'empty',\n        }\n    }\n    componentDidMount() {\n        this.refresh()\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.refresh)\n        selMan.on(SELECTION_MANAGER.CHANGED,this.swap)\n    }\n\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.refresh)\n        selMan.off(SELECTION_MANAGER.CHANGED,this.swap)\n    }\n    swap = () => {\n        const obj = this.props.provider.accessObject(selMan.getSelection())\n        if(obj.exists()  && obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n            this.refresh()\n        }\n    }\n    changeText = (value) => this.setState({text:value})\n    save = (e) => {\n        this.props.provider.updateBehaviorAssetContents(this.state.id,this.state.text)\n    }\n    render() {\n        if(this.state.id === null) return <div>loading</div>\n        return <AceEditor mode=\"javascript\"\n                          theme=\"github\"\n                          name=\"UNIQUE_ID_OF_DIV\"\n                          value={this.state.text}\n                          onChange={this.changeText}\n                          onBlur={this.save}\n                          showGutter={true}\n                          width={'100%'}\n                          height={'100%'}\n        />\n    }\n\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {getScriptsURL} from '../../TreeItemProvider'\nimport {Spacer} from '../../common/GridEditorApp'\nimport {AuthModule} from '../AuthModule'\n\nexport class OpenScriptDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            scripts:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadScriptList()\n            .then((scripts) => {\n                this.setState({scripts:scripts})\n            })\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    addScript(info) {\n        DialogManager.hide()\n        if(!info.url) info.url = `${getScriptsURL()}${info.name}`\n        const beh = this.props.provider.addBehaviorAssetFromURL(info)\n        if(this.props.onAdd) this.props.onAdd(beh)\n    }\n    deleteScript(info) {\n        return this.props.provider.removeBehaviorAssetSource(info.name).then((res)=>{\n            console.log(\"removed?\",res)\n            this.refreshList()\n        })\n    }\n\n    okay = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Choose Behavior Script</h3>\n                <VBox scroll style={{ maxHeight:'60vh'}}>\n                    <ul className=\"behaviors-list\">{this.state.scripts.map((doc, i) => {\n                        return <HBox key={doc.name}>\n                            <VBox>\n                                <div>\n                                    <i>{doc.name}</i> -  <b>{doc.title}</b>\n                                </div>\n\n                                <p>{doc.description}</p>\n                            </VBox>\n                            <Spacer/>\n                            <button onClick={()=>this.addScript(doc)}>add</button>\n                            {this.renderDeleteButton(doc)}\n                        </HBox>\n                    })}\n                    </ul>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>close</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsScriptEdit()) return \"\"\n        return <button onClick={()=>this.deleteScript(doc)}>delete</button>\n    }\n\n}\n","export const CUSTOM_BEHAVIOR_SCRIPT = `\n/*\n #title untitled behavior\n #description does something\n*/\n({\n  // defines a target property. must be a scene\n    properties: {\n        scene: { \n            type:'enum', \n            title: 'target scene', \n            value:null, \n            hints: {\n                type:'node',\n                nodeType:'scene'\n            }\n        },\n    },\n    init: function() {\n        //called when the program starts\n    },\n    onClick: function(e) {\n        //called when object is clicked on\n        //e.system.navigateScene(e.props.scene)\n    }\n})\n`\n\n\n\nexport const CUSTOM_SCENE_SCRIPT = `\n/*\n #title scene script\n #description does something\n*/\n({\n    // defines a target property. must be a scene\n    properties: {\n        scene: { \n            type:'enum', \n            title: 'target scene', \n            value:null, \n            hints: {\n                type:'node',\n                nodeType:'scene'\n            }\n        },\n    },\n    init: function() {\n        //called when the program starts\n    },\n    onEnter: function() {\n        //called when entering a scene\n    },\n    onExit: function() {\n        //called when exiting a scene\n    },\n})\n`","import React, {Component} from 'react'\nimport QRCode from 'qrcode'\n\nexport default class QRCanvas extends Component {\n    componentDidMount() {\n        if (this.canvas) this.redraw()\n    }\n\n    componentWillReceiveProps(newProps) {\n        if (this.canvas) this.redraw()\n    }\n\n    redraw() {\n        QRCode.toCanvas(this.canvas, this.props.url, {width: this.props.width, height: this.props.height})\n    }\n\n    render() {\n        let style = {}\n        if (this.props.style) Object.assign(style, this.props.style)\n        return <canvas width={this.props.width} height={this.props.height} ref={(canvas) => this.canvas = canvas} style={style}/>\n    }\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport QRCanvas from '../../common/QRCanvas'\n\nexport class QRDialog extends Component {\n\n    okay = () => {\n        DialogManager.hide()\n    }\n\n    render() {\n        let url = document.documentURI\n        if(this.props.url) url = this.props.url\n        let wurl = url.replace(\"https\",\"wxrv\")\n        wurl = wurl.replace(\"http\",\"wxrv\")\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>{this.props.text?this.props.text:'Scan'}</h3>\n                <VBox grow>\n                    <label><a href={url}>{url}</a></label>\n                    <QRCanvas url={wurl} width={160} height={160}/>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>dismiss</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {AuthModule} from '../AuthModule'\n\nexport class PasswordDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            field:\"\"\n        }\n    }\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        AuthModule.doPasswordLogin(this.state.field)\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>login with the password from your env file</h3>\n                <label>password</label>\n                <input type={\"text\"} value={this.state.field} onChange={(e)=>{\n                    this.setState({field:e.target.value})\n                }}/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n}\n\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {AuthModule} from '../AuthModule'\nimport {getLoginURL} from '../../TreeItemProvider'\n\nexport class GithubAuthDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            data:null\n        }\n    }\n    componentDidMount() {\n        console.log(\"opening dialog\")\n        AuthModule.getJSON(getLoginURL()).then(data => {\n            console.log(\"got the data\",data)\n            this.setState({data:data})\n        })\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        console.log(\"opening window with the data\",this.state.data)\n        AuthModule.login(this.state.data)\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Github Auth</h3>\n                <p>To log into MrEd you need a github account. Press the button\n                below to log into github and approve MrEd's access. The app will only use\n                Github for authentication. It does not have access to any of your projects or code.\n                </p>\n                <button onClick={this.okay}>Open Github</button>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n}\n\n","import React, {Component} from 'react'\n\nexport class ErrorCatcher extends Component {\n\n\n    constructor(props, context) {\n        super(props, context)\n        this.state = {error:false }\n    }\n\n    componentDidCatch(error, errorInfo) {\n        this.setState({error:true})\n        const logger = this.props.logger\n        if(!logger) {\n            console.log(\"NO LOGGER!\")\n            return\n        }\n        logger.error(\"an error occurred at the react level\")\n        logger.error(error)\n        logger.error(errorInfo)\n    }\n\n    render() {\n        if(this.state.error === true) {\n            return <div><h1>An error happened. Please look at the console</h1></div>\n        }\n\n        return this.props.children\n    }\n\n}","import SyncGraphProvider from '../syncgraph/SyncGraphProvider'\nimport React, {Component} from 'react'\nimport GridEditorApp, {Panel, Spacer, Toolbar} from '../common/GridEditorApp'\nimport TreeTable from '../common/TreeTable'\nimport PropSheet, {TYPES} from '../common/PropSheet'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {VRCanvas} from './VRCanvas'\nimport {getAssetsURL, getDocsURL, getScriptsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport ImmersiveVREditor from './ImmersiveVREditor'\nimport {fetchGraphObject, insertAsFirstChild, insertAsLastChild, listToArray} from '../syncgraph/utils'\nimport CubeDef from \"./defs/CubeDef\"\nimport SceneDef from \"./defs/SceneDef\"\nimport InputManager from \"../common/InputManager\"\nimport {DialogContainer, DialogManager, HBox, PopupContainer} from \"appy-comps\"\nimport {\n    ASSET_TYPES,\n    canBeDeleted,\n    canHaveBehavior,\n    canHaveScene,\n    canHaveShape,\n    get3DObjectDef,\n    HORIZONTAL_ALIGNMENT,\n    is3DObjectType,\n    isGLTFFile,\n    isImageType,\n    ITEM_ICONS,\n    OBJ_TYPES,\n    parseBehaviorScript,\n    PROP_DEFS,\n    REC_TYPES,\n    SIMPLE_COLORS,\n    TOTAL_OBJ_TYPES\n} from './Common'\nimport {AddImageAssetDialog} from './dialogs/AddImageAssetDialog'\nimport {AddGLTFAssetDialog} from './dialogs/AddGLTFAssetDialog'\nimport {AddGLBAssetDialog} from './dialogs/AddGLBAssetDialog'\nimport {AddAudioAssetDialog} from './dialogs/AddAudioAssetDialog'\nimport {UnsavedDocumentDialog} from \"./dialogs/UnsavedDocumentDialog\"\nimport AssetView from '../metadoc/AssetView'\nimport * as ToasterMananager from './ToasterManager'\nimport GraphAccessor from \"../syncgraph/GraphAccessor\"\nimport {toQueryString} from '../utils'\nimport {OpenFileDialog} from './dialogs/OpenFileDialog'\nimport {AuthModule, CONNECTED, USER_CHANGE} from './AuthModule'\nimport {OpenAssetDialog} from './dialogs/OpenAssetDialog'\nimport ScriptEditor from './ScriptEditor'\nimport {OpenScriptDialog} from './dialogs/OpenScriptDialog'\nimport {CUSTOM_BEHAVIOR_SCRIPT, CUSTOM_SCENE_SCRIPT} from './Templates'\nimport {addScene, deleteObject, newDoc, showAddBehaviorPopup, showAddAssetPopup, showAddPopup} from './Actions'\nimport {addGeoAnchorAsset, addGLBAssetFromFile, addImageAssetFromFile} from './AssetActions'\nimport {QRDialog} from './dialogs/QRDialog'\nimport {PasswordDialog} from './dialogs/PasswordDialog'\nimport {GithubAuthDialog} from './dialogs/GithubAuthDialog'\nimport {ErrorCatcher} from './ErrorCatcher'\n\n\nexport default class VREditor extends SyncGraphProvider {\n    constructor(options) {\n        super(options)\n        this.imagecache = {}\n        this.videocache = {}\n        this.behaviorCache = {}\n    }\n    getDocType() { return \"vr\" }\n    getApp = () => {\n        if(this.mode === 'edit') return <VREditorApp provider={this}/>\n        if(this.mode === 'vredit') return <ImmersiveVREditor provider={this} editable={true}/>\n        if(this.mode === 'embed-view') return <ImmersiveVREditor provider={this} editable={false}/>\n        if(this.mode === 'vrview') return <ImmersiveVREditor provider={this} editable={false}/>\n        console.log(\"no mode!\")\n    }\n    getTitle = () => \"MrEd\"\n    getDocTitle = () => this.accessObject(this.getSceneRoot()).title\n    makeEmptyRoot(doc) {\n        //make root\n        const root = fetchGraphObject(doc,doc.createObject({ type:TOTAL_OBJ_TYPES.ROOT, title:'Untitled Project', defaultScene:0, children:doc.createArray() }))\n        //make scene\n        const scene1 = new SceneDef().make(doc,root)\n        //make cube\n        const obj = new CubeDef().make(doc,scene1)\n        //make assets\n        const assets = fetchGraphObject(doc,doc.createObject({type:TOTAL_OBJ_TYPES.ASSETS_LIST,\n            title:'Assets', children: doc.createArray(), parent:0}))\n        //make behaviors\n        const behaviors = fetchGraphObject(doc,doc.createObject({type:TOTAL_OBJ_TYPES.BEHAVIORS_LIST,\n            title:'Behaviors', children: doc.createArray(), parent:0}))\n        //tie it all together\n        insertAsFirstChild(doc,root,scene1)\n        insertAsFirstChild(doc,scene1,obj)\n        insertAsLastChild(doc,root,behaviors)\n        insertAsLastChild(doc,root,assets)\n    }\n    docLoaded = () => {\n        //pre-cache all of the behaviors\n        this.accessObject(this.getBehaviorsObject()).getChildren()\n            .filter(a => a.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT)\n            .forEach((b)=>{\n                this.fetchBehaviorAssetContents(b.id).then((contents)=> {\n                    try {\n                        const info = parseBehaviorScript(contents)\n                        info.text = contents\n                        this.setCachedBehaviorAsset(b.id, info)\n                    } catch (e) {\n                        console.error(e)\n                    }\n                })\n            })\n    }\n\n    getRendererForItem = (item) => {\n        const obj = this.accessObject(item)\n        if(!obj.exists()) return <div>???</div>\n        if(obj.type === TOTAL_OBJ_TYPES.ASSET) return <div><i className={`fa fa-${ITEM_ICONS[obj.subtype]}`}/> {obj.title}</div>\n        if(ITEM_ICONS[obj.type]) return <div><i className={`fa fa-${ITEM_ICONS[obj.type]}`}/> {obj.title}</div>\n        return <div>{obj.title}</div>\n    }\n\n    getProperties(item) {\n        function copyPropDef(def,value) {\n            const out = {};\n            Object.keys(def).forEach((key) => out[key] = def[key])\n            out.value = value\n            return out;\n        }\n        let defs = []\n        if(!item) return defs\n\n        //show the ID for all objects\n        defs.push({\n            key:'id',\n            name:\"ID\",\n            type:TYPES.STRING,\n            value:item,\n            locked:true\n        })\n\n        const obj = this.accessObject(item)\n        //if a behavior object is selected, get the defs from the root behavior asset\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            const behaviorProps = this.getCachedBehaviorPropDefs(obj.behavior)\n            if(behaviorProps) {\n                Object.keys(behaviorProps).forEach(pname => {\n                    const propdef = behaviorProps[pname]\n                    const ndef = {\n                        key: pname,\n                        name: pname,\n                        type: propdef.type,\n                        value: obj[pname]\n                    }\n                    if(propdef.hints) ndef.hints = propdef.hints\n                    defs.push(ndef)\n                })\n            } else {\n                console.warn(\"Missing prop defs for behavior object\")\n            }\n            defs.push({\n                key:'behavior',\n                name:\"Script\",\n                type:TYPES.STRING,\n                value:obj.behavior,\n                locked:true,\n                custom:true,\n            })\n        }\n\n        const props = this.syncdoc.getPropertiesForObject(item)\n        if(props) {\n            props.forEach(key => {\n                if(key === 'type') return\n                if(key === 'children') return\n                if(key === 'parent') return\n                const value = this.syncdoc.getPropertyValue(item,key)\n                if(PROP_DEFS[key]) {\n                    const def = copyPropDef(PROP_DEFS[key],value)\n                    if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                        if(key === 'title' || key === 'description') def.locked = true\n                    }\n                    if(obj.type === TOTAL_OBJ_TYPES.ASSET && obj.subtype === ASSET_TYPES.IMAGE) {\n                        if(key === 'width' || key === 'height') def.locked = true\n                    }\n                    return defs.push(def)\n                }\n                // console.log(\"unknown property\",key)\n            })\n        }\n\n\n\n        if(is3DObjectType(obj.type)) {\n            defs.push({\n                key: 'scale',\n                name: 'Scale',\n                type: TYPES.GROUP,\n                group: ['sx','sy','sz'],\n                custom:true,\n            })\n        }\n\n        return defs\n    }\n    setPropertyValue(item, def, value) {\n        if(def.key === 'scale') {\n            super.setPropertyValue(item,{key:'sx'},value.sx)\n            super.setPropertyValue(item,{key:'sy'},value.sy)\n            super.setPropertyValue(item,{key:'sz'},value.sz)\n            return\n        }\n        super.setPropertyValue(item,def,value)\n        //size the plane to match the aspect ratio of the asset\n        if(def.key === PROP_DEFS.asset.key) {\n            const asset = this.accessObject(value)\n            if(asset.subtype === ASSET_TYPES.IMAGE) {\n                let height = (asset.height / asset.width) * this.accessObject(item).width\n                super.setPropertyValue(item, {key: 'height'}, height)\n            }\n            if(asset.subtype === ASSET_TYPES.GLTF) {\n                console.log(\"adjusting to a gtlf\")\n            }\n        }\n    }\n    getValuesForEnum(key,obj,def) {\n        const realobj = this.accessObject(obj)\n        //if this is a property on a behavior, then use the hints to generate a target list\n        if(realobj.exists() && realobj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            if(def.hasHints()) {\n                const hints = def.getHints()\n                if(hints.type === 'node') {\n                    return this.accessObject(this.getSceneRoot())\n                        .find(obj => obj.type === hints.nodeType)\n                        .map(ch => ch.id)\n                }\n                if(hints.type === 'audio') {\n                    return this.accessObject(this.getAssetsObject()).getChildren().filter(a => a.subtype === ASSET_TYPES.AUDIO).map(a => a.id)\n                }\n                if(hints.type === 'video') {\n                    return this.accessObject(this.getAssetsObject()).getChildren().filter(a => a.subtype === ASSET_TYPES.VIDEO).map(a => a.id)\n                }\n            }\n        }\n        if (key === PROP_DEFS.asset.key) {\n            const assets = this.accessObject(this.getAssetsObject()).getChildren()\n            if(acceptsImageAsset(realobj.type) && acceptsVideoAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.VIDEO || a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            if(acceptsVideoAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.VIDEO).map(a => a.id)\n            if(acceptsModelAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.GLTF).map(a => a.id)\n            if(acceptsImageAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n        }\n        if(key === PROP_DEFS.horizontalAlign.key) {\n            return Object.keys(HORIZONTAL_ALIGNMENT).map(key => HORIZONTAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.defaultScene.key) {\n            return this.accessObject(this.getSceneRoot()).getChildren()\n                .filter(ch => ch.type === TOTAL_OBJ_TYPES.SCENE)\n                .map(ch => ch.id)\n        }\n        if(key === PROP_DEFS.texture.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.targetImage.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.targetGeoLocation.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.GEOLOCATION).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.recType.key) {\n            return Object.keys(REC_TYPES)\n        }\n    }\n    getRendererForEnum(key,obj) {\n        const realobj = this.accessObject(obj)\n        if(realobj.exists() && realobj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return EnumTitleRenderer\n        switch(key) {\n            case PROP_DEFS.asset.key: return EnumTitleRenderer\n            case PROP_DEFS.defaultScene.key: return EnumTitleRenderer\n            case PROP_DEFS.texture.key: return EnumTitleRenderer\n            case PROP_DEFS.targetImage.key: return EnumTitleRenderer\n            case PROP_DEFS.targetGeoLocation.key: return EnumTitleRenderer\n            default: return null\n        }\n    }\n\n    getSelectedSceneObject() {\n        const sel = SelectionManager.getSelection()\n        if(sel === null) return this.getFirstSceneObject()\n        const selected = this.accessObject(sel)\n        if(selected.type === TOTAL_OBJ_TYPES.SCENE) return selected\n        if(is3DObjectType(selected.type))  return this.findSceneObjectParent(selected)\n        if(selected.type === TOTAL_OBJ_TYPES.BEHAVIOR) return this.findSceneObjectParent(selected)\n        return null\n    }\n    getFirstSceneObject() {\n        return this.accessObject(this.getSceneRoot()).getChildren()[0]\n    }\n    findSceneObjectParent(obj) {\n        if(obj === null) return null\n        if(!obj.exists()) return null\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) return obj\n        obj = this.accessObject(obj.parent)\n        return this.findSceneObjectParent(obj)\n    }\n\n    getAssetsObject = () => this.getDataGraph().getObjectByProperty('type',TOTAL_OBJ_TYPES.ASSETS_LIST)\n    getBehaviorsObject = () => this.getDataGraph().getObjectByProperty('type',TOTAL_OBJ_TYPES.BEHAVIORS_LIST)\n\n    quick_setPropertyValue(item, key, value) {\n        const ov = this.getDataGraph().getPropertyValue(item,key)\n        const op = this.cmd.setProperty(item,key,value)\n        op.prevValue = ov\n        if(op.value === op.prevValue) return\n        this.getRawGraph().process(op)\n        //TODO: this should be fired through the graph already. I shouldn't need to fire this\n        this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,{\n            provider: this,\n            child:item,\n            propKey:key,\n            oldValue:ov,\n            newValue:value\n        })\n    }\n\n    editIn2D = () => {\n        this.save().then(()=>{\n            const opts = Object.assign({},this.options,{mode:'edit', switcher:false})\n            const loc = document.location\n            const url = `${loc.protocol}//${loc.host}${loc.pathname}?${toQueryString(opts)}`\n            DialogManager.show(<QRDialog text={\"Edit in 2D\"} url={url}/>)\n        })\n    }\n\n    editInVR = () => {\n        this.save().then(()=>{\n            const opts = Object.assign({},this.options,{mode:'vredit', switcher:false})\n            const loc = document.location\n            const url = `${loc.protocol}//${loc.host}${loc.pathname}?${toQueryString(opts)}`\n            DialogManager.show(<QRDialog text={\"Edit in AR/VR\"} url={url}/>)\n        })\n    }\n\n    viewInVR = () => {\n        this.save().then(()=> {\n            const opts = Object.assign({}, this.options, {mode: 'play', switcher: false})\n            const loc = document.location\n            const url = `${loc.protocol}//${loc.host}${loc.pathname}?${toQueryString(opts)}`\n            DialogManager.show(<QRDialog text={\"View in AR/VR\"} url={url}/>)\n        })\n    }\n\n\n    add3DObject = (type, parent) => {\n        const obj = get3DObjectDef(type).make(this.getDataGraph(),parent)\n        parent.insertFirstChild(obj)\n        SelectionManager.setSelection(obj.id)\n        ToasterMananager.add('added '+type)\n    }\n\n    calculateContextMenu(item) {\n        const cmds = []\n        const obj = this.accessObject(item)\n        if(canBeDeleted(obj.type)) {\n            cmds.push({title: 'delete', icon: ITEM_ICONS.delete, fun: () => deleteObject(this)});\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) {\n            cmds.push({\n                title: 'existing asset on server',\n                icon: ITEM_ICONS.assets,\n                fun: () => this.showOpenAssetDialog()\n            })\n        }\n        if(canHaveShape(obj.type)) {\n            cmds.push({ divider:true })\n            Object.keys(OBJ_TYPES).forEach(type => cmds.push({\n                title: type,\n                icon: ITEM_ICONS[type],\n                fun: () => this.add3DObject(type,obj)\n            }))\n        }\n        if(canHaveScene(obj.type)) {\n            cmds.push({title: 'scene', icon: ITEM_ICONS.scene, fun: ()=>addScene(this)})\n        }\n\n        if(canHaveBehavior(obj.type)) {\n            cmds.push({ divider:true })\n            this.accessObject(this.getBehaviorsObject()).getChildren()\n                .filter(a => a.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT)\n                .forEach((b) => {\n                    cmds.push({\n                        title: b.title,\n                        icon: ITEM_ICONS.behavior_script,\n                        fun: () => this.addBehaviorToObject(b, item)\n                    })\n                })\n            if(AuthModule.isLoggedIn()) {\n                cmds.push({\n                    title: 'Add Behavior from server',\n                    icon: ITEM_ICONS.behavior_script,\n                    fun: () => {\n                        DialogManager.show(<OpenScriptDialog provider={this} onAdd={(beh)=>{\n                            this.addBehaviorToObject(beh,item).then(b=>{\n                                SelectionManager.setSelection(b.id)\n                            })\n                        }}/>)\n                    }\n                })\n            }\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            cmds.push({ divider:true })\n            if(AuthModule.scriptEditingSupported) {\n                cmds.push({title: 'Add Scene script', icon: ITEM_ICONS.behavior, fun: () => this.addSceneScript(item)})\n            }\n        }\n\n\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            cmds.push({ divider:true })\n            cmds.push({title:'view code', icon: ITEM_ICONS.behavior, fun: ()=>SelectionManager.setSelection(obj.behavior)})\n        }\n\n        if(canBeDeleted(obj.type)) {\n            cmds.push({divider: true})\n            cmds.push({title: 'cut', icon: ITEM_ICONS.cut, fun: this.cutSelection})\n            cmds.push({title: 'copy', icon: ITEM_ICONS.copy, fun: this.copySelection})\n            cmds.push({title: 'paste', icon: ITEM_ICONS.paste, fun: this.pasteSelection})\n        }\n        return cmds\n    }\n\n    cutSelection = (e) => {\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        if(SelectionManager.isEmpty()) return\n        const obj = this.accessObject(SelectionManager.getSelection())\n        SelectionManager.setClipboard(obj.id)\n        obj.removeFromParent()\n        SelectionManager.clearSelection()\n    }\n    copySelection = (e) => {\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        if(SelectionManager.isEmpty()) return\n        const obj = this.accessObject(SelectionManager.getSelection())\n        SelectionManager.setClipboard(obj.id)\n    }\n    pasteSelection = (e) => {\n        //don't intercept if this is a paste into a text field\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        const obj1 = this.accessObject(SelectionManager.getClipboard())\n        let parent = null\n        if(is3DObjectType(obj1.type)) parent = this.getSelectedSceneObject().id\n        if(obj1.type === 'scene') parent = this.accessObject(this.getSceneRoot())\n        if (!parent) return console.error(\"no parent to ad too! bad obj type?\",obj1.type)\n        parent.insertChildLast(obj1.clone())\n    }\n\n    // ============ drag and drop ============\n    canBeMoved(node) {\n        const p = this.accessObject(node)\n        if(p.type === TOTAL_OBJ_TYPES.ROOT) return false\n        if(p.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return false\n        if(p.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return false\n        return true\n    }\n    canAddChild(parent,child) {\n        const p = this.accessObject(parent)\n        const c = this.accessObject(child)\n        if(p.type === TOTAL_OBJ_TYPES.ROOT && c.type === TOTAL_OBJ_TYPES.SCENE) return true\n        if(p.type === TOTAL_OBJ_TYPES.SCENE && is3DObjectType(c.type)) return true\n        if(canHaveShape(p.type) && is3DObjectType(c.type)) return true\n        return false\n    }\n    canBeSibling(src,tgt) {\n        const s = this.accessObject(src)\n        const t = this.accessObject(tgt)\n        if(s.type === TOTAL_OBJ_TYPES.SCENE && t.type === TOTAL_OBJ_TYPES.SCENE) return true\n        if(is3DObjectType(s.type) && is3DObjectType(t.type)) return true\n        return false\n    }\n    canAddExternalChild(parent,child) {\n        const obj = this.accessObject(parent)\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return true\n        return false\n    }\n    acceptDrop(e,tgt) {\n        const obj = this.accessObject(tgt)\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) {\n            listToArray(e.dataTransfer.files).forEach(file => {\n                if(isImageType(file.type)) return addImageAssetFromFile(file,this)\n                if(isGLTFFile(file)) return addGLBAssetFromFile(file,this)\n            })\n        }\n    }\n    requestImageCache(src) {\n        const img = new Image()\n        this.imagecache[src] = img\n        return new Promise((res,rej) => {\n            img.src = src\n            img.onload = () => {\n                this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,{ provider: this })\n                res(img)\n            }\n        })\n    }\n\n    createCustomEditor(item,def,provider, value, onChange) {\n        if(def.key === PROP_DEFS.color.key\n            || def.key === PROP_DEFS.backgroundColor.key\n            || def.key === PROP_DEFS.borderColor.key\n            || def.key === PROP_DEFS.textColor.key\n            || def.key === PROP_DEFS.startColor.key\n            || def.key === PROP_DEFS.endColor.key\n        ) return <HBox>\n            {\n                SIMPLE_COLORS\n                    .map(c => <button\n                        key={c}\n                        onClick={()=>onChange(c)}\n                        style={{color:c, padding:'1px', margin:0, borderWidth:0,}}\n                        className={\"fa fa-square\"}/> )\n            }\n        </HBox>\n\n        if(def.key === 'scale') return <ScaleEditor def={def} item={item} onChange={onChange} provider={this}/>\n        if(def.key === 'behavior') return <button onClick={()=>SelectionManager.setSelection(value)}>view code</button>\n        return <i>no custom editor for {def.key}</i>\n    }\n\n    setColor = (color) => {\n        if(SelectionManager.isEmpty()) return\n        this.accessObject(SelectionManager.getSelection()).set('color',color)\n    }\n\n    showAddImageAssetDialog = () => DialogManager.show(<AddImageAssetDialog provider={this}/>)\n    showAddAudioAssetDialog = () => DialogManager.show(<AddAudioAssetDialog provider={this}/>)\n    showAddGLTFAssetDialog  = () => DialogManager.show(<AddGLTFAssetDialog provider={this}/>)\n    showAddGLBAssetDialog   = () => DialogManager.show(<AddGLBAssetDialog provider={this}/>)\n    showOpenDocumentDialog  = () => DialogManager.show(<OpenFileDialog provider={this}/>)\n    showOpenAssetDialog     = () => DialogManager.show(<OpenAssetDialog provider={this}/>)\n    showAddServerImageDialog= () => DialogManager.show(<OpenAssetDialog provider={this} filter={a => isImageType(a.mimeType)}/>)\n    showOpenBehaviorDialog  = () => DialogManager.show(<OpenScriptDialog provider={this}/>)\n    showAddGeoLocationAssetDialog = () => {\n        addGeoAnchorAsset({\n            latitude:0,\n            longitude:0,\n            altitude:0,\n            useAltitude:false,\n        },\"new geo location\",this)\n    }\n    showPasswordDialog = () => DialogManager.show(<PasswordDialog provider={this}/>)\n    showGithubDialog = () => DialogManager.show(<GithubAuthDialog provider={this}/>)\n\n    accessObject = (id) => {\n        return new GraphAccessor(this.getDataGraph()).object(id)\n    }\n\n    loadDocList() {\n        return AuthModule.getJSON(`${getDocsURL()}list`)\n    }\n    removeDoc(doc) {\n        return AuthModule.fetch(`${getDocsURL()}delete/${doc.id}`,{\n            method:'POST',\n            body:doc.id,\n        }).then(res => res.json())\n    }\n    loadAssetList() {\n        return AuthModule.getJSON(`${getAssetsURL()}list`)\n    }\n    removeAssetSource(info) {\n        return AuthModule.fetch(`${getAssetsURL()}delete/${info.id}`,{\n            method:'POST',\n            body:info.id,\n        }).then(res => res.json())\n    }\n    loadScriptList() {\n        return AuthModule.getJSON(`${getScriptsURL()}list`)\n    }\n\n\n    // ======== behaviors ===============\n    addBehaviorAssetFromURL = (info) => {\n        const graph = this.getDataGraph()\n        const behavior = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT,\n            title:info.title,\n            description:info.description,\n            src:info.url,\n            parent:0\n        }))\n        this.accessObject(this.getBehaviorsObject()).insertChildLast(behavior)\n        SelectionManager.setSelection(behavior.id)\n        return behavior\n    }\n    removeBehaviorAssetSource(name) {\n        const url = `${getScriptsURL()}delete/${name}`\n        console.log(\"removing\",url)\n        return AuthModule.fetch(url,{\n            method:'POST',\n            body:name,\n        }).then(res => res.json())\n    }\n    addCustomBehaviorAsset = (TEMPLATE) => {\n        const randi = (Math.floor(Math.random()*100000000))\n        const fname =`behavior_${randi}.js`\n        const url = `${getScriptsURL()}${fname}`;\n        const contents = TEMPLATE?TEMPLATE:CUSTOM_BEHAVIOR_SCRIPT\n        console.log(\"posting it to\",url)\n        return AuthModule.fetch(url,{\n            method:'POST',\n            body:contents,\n        })\n            .then(res => res.json())\n            .then(ans => {\n                console.log(\"got back the answer\",ans)\n                const graph = this.getDataGraph()\n                const behavior = fetchGraphObject(graph,graph.createObject({\n                    type:TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT,\n                    title:ans.script.title,\n                    description:ans.script.description,\n                    src:url,\n                    parent:0\n                }))\n                this.accessObject(this.getBehaviorsObject()).insertChildLast(behavior)\n                SelectionManager.setSelection(behavior.id)\n                return behavior\n\n            })\n            .catch(err => console.error(err))\n    }\n    addSceneScript = (obj) => {\n        this.addCustomBehaviorAsset(CUSTOM_SCENE_SCRIPT)\n            .then((b)=>this.addBehaviorToObject(b,obj))\n    }\n    addBehaviorToObject = (b,item) => {\n        return this.fetchBehaviorAssetContents(b.id).then((contents)=>{\n            try {\n                const def = {\n                    type: TOTAL_OBJ_TYPES.BEHAVIOR,\n                    title: b.title,\n                    description: b.description,\n                    parent: 0,\n                    behavior:b.id,\n                }\n                const obj = parseBehaviorScript(contents)\n                this.setCachedBehaviorAsset(b.id,obj)\n                //copy properties to the behavior def\n                if(obj.properties) {\n                    Object.keys(obj.properties).forEach(name => {\n                        def[name] = obj.properties[name].value\n                    })\n                }\n                const graph = this.getDataGraph()\n                const behavior = fetchGraphObject(graph, graph.createObject(def))\n                this.accessObject(item).insertChildLast(behavior)\n                return behavior\n            } catch (e) {\n                console.error(e)\n            }\n        })\n    }\n    fetchBehaviorAssetContents(id) {\n        const obj = this.accessObject(id)\n        return AuthModule.fetch(obj.src,{\n            method:'GET',\n        }).then(res => res.text())\n    }\n    updateBehaviorAssetContents(id,text) {\n        if(!AuthModule.supportsScriptEdit()) return\n        //update the cache first\n        const info = parseBehaviorScript(text)\n        info.text = text\n        this.setCachedBehaviorAsset(id, info)\n\n        const obj = this.accessObject(id)\n        return AuthModule.fetch(obj.src,{\n            method:'POST',\n            body:text,\n        }).then(res => res.json())\n            .then(ans => {\n                obj.set('title',ans.script.title)\n                obj.set('description',ans.script.description)\n            })\n    }\n    getCachedBehaviorPropDefs(behavior) {\n        if(!this.behaviorCache[behavior]) {\n            console.error(\"no parsed behavior in the cache\",behavior)\n            return null\n        }\n        return this.behaviorCache[behavior].properties;\n    }\n    getCachedBehaviorAsset(id) {\n        return this.behaviorCache[id]\n    }\n    setCachedBehaviorAsset(id, asset) {\n        this.behaviorCache[id] = asset\n    }\n}\n\nclass VREditorApp extends Component {\n\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            mode:'canvas',\n            user:null,\n            running:false,\n            connected:false,\n            dirty:true\n        }\n\n        this.im = new InputManager()\n        this.im.addKeyBinding({id: 'save', key: InputManager.KEYS.S, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'undo', key: InputManager.KEYS.Z, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({\n            id: 'redo',\n            key: InputManager.KEYS.Z,\n            modifiers: [InputManager.MODIFIERS.COMMAND, InputManager.MODIFIERS.SHIFT]\n        })\n        this.im.addListener('save', this.props.provider.save)\n        this.im.addListener('undo', this.props.provider.performUndo)\n        this.im.addListener('redo', this.props.provider.performRedo)\n\n        this.im.addKeyBinding({id: 'cut', key: InputManager.KEYS.X, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'copy', key: InputManager.KEYS.C, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'paste', key: InputManager.KEYS.V, modifiers: [InputManager.MODIFIERS.COMMAND]})\n\n        this.im.addListener('cut', this.props.provider.cutSelection)\n        this.im.addListener('copy', this.props.provider.copySelection)\n        this.im.addListener('paste', this.props.provider.pasteSelection)\n\n    }\n\n    componentDidMount() {\n        this.im.attachKeyEvents(document)\n        SelectionManager.on(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n        AuthModule.on(USER_CHANGE,()=>this.setState({user:AuthModule.getUsername()}))\n        AuthModule.on(CONNECTED,()=>this.setState({connected:true}))\n        if(AuthModule.isConnected()) this.setState({connected:true})\n        this.props.provider.on(TREE_ITEM_PROVIDER.CLEAR_DIRTY,()=>{\n            this.setState({dirty:false})\n        })\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, () => {\n            this.setState({dirty:true})\n        })\n        this.props.provider.on(TREE_ITEM_PROVIDER.SAVED, () => {\n            this.setState({dirty:false})\n        })\n    }\n    componentWillUnmount() {\n        SelectionManager.off(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n    }\n\n    selectionChanged = () => {\n        if(!SelectionManager.isEmpty()) {\n            const item = this.props.provider.accessObject(SelectionManager.getSelection())\n            if(item.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return this.setState({mode:'script'})\n            if(item.type === PROP_DEFS.asset.key) return this.setState({mode:'asset'})\n        }\n        this.setState({mode:'canvas'})\n    }\n\n    toggleRunning = () => {\n        this.setState({running:!this.state.running})\n    }\n\n    newDoc = () => {\n        if(this.state.dirty) {\n            console.log(\"can't create new becausue dirty\")\n            DialogManager.show(<UnsavedDocumentDialog onAnyway={()=>{\n                console.log(\"we are doing it anyway\")\n                newDoc(this.props.provider)\n            }}/>)\n\n        } else {\n            newDoc(this.props.provider)\n        }\n    }\n\n    render() {\n        if(this.state.connected === false) {\n            return <div><h1>connecting to server</h1></div>\n        }\n        const prov = this.props.provider\n        const bot = <div>\n            {/*<a href={getInfoURL()}>{getInfoURL()}</a>*/}\n            {/*<br/>*/}\n            doc id: <b>{prov.getDocId()}</b>\n        </div>\n        let logger = null\n        if(prov.pubnub) logger = prov.pubnub.getLogger()\n        return <ErrorCatcher logger={logger}><GridEditorApp bottomText={bot}>\n            <Toolbar left top><label>{prov.getTitle()} {this.state.dirty?\"dirty\":\"clean\"}</label></Toolbar>\n            <Panel scroll left middle><TreeTable root={prov.getSceneRoot()} provider={prov}/></Panel>\n\n            <Toolbar left bottom>\n                <button className=\"fa fa-cube\"        onClick={(e)=>showAddPopup(e,prov)}/>\n                <button className=\"fa fa-globe\"       onClick={(e)=>addScene(prov)}/>\n                <button className=\"fa fa-archive\"     onClick={(e)=>showAddAssetPopup(e,prov)}/>\n                <button className=\"fa fa-superpowers\" onClick={(e)=>showAddBehaviorPopup(e,prov)}/>\n            </Toolbar>\n\n\n            <Toolbar center top>\n                <button className=\"fa fa-file\" onClick={this.newDoc} title={'new project'}></button>\n                <button className=\"fa fa-save\" onClick={() => prov.save()} title={'save project'}></button>\n                <button onClick={() => prov.editIn2D()}>2D Edit</button>\n                <button onClick={() => prov.editInVR()}>AR Edit</button>\n                <button onClick={() => prov.viewInVR()}>XR View</button>\n                <Spacer/>\n                <RunButton onClick={this.toggleRunning} active={this.state.running}/>\n                <Spacer/>\n                <button className=\"fa fa-cut\" onClick={prov.cutSelection}/>\n                <button className=\"fa fa-copy\" onClick={prov.copySelection}/>\n                <button className=\"fa fa-paste\" onClick={prov.pasteSelection}/>\n                <button className=\"fa fa-undo\" onClick={prov.performUndo}/>\n                <button className=\"fa fa-repeat\" onClick={prov.performRedo}/>\n            </Toolbar>\n\n\n            <Panel center middle scroll transparent>\n                {this.renderCenterPane(this.state.mode)}\n            </Panel>\n\n            <Panel scroll right><PropSheet provider={prov}/></Panel>\n\n\n            <Toolbar right top>\n                {this.renderLoginButton()}\n            </Toolbar>\n            <Toolbar right bottom>\n            </Toolbar>\n            <DialogContainer/>\n            <PopupContainer/>\n\n        </GridEditorApp></ErrorCatcher>\n    }\n    renderCenterPane(mode) {\n        if (mode === 'script') return <ScriptEditor provider={this.props.provider}/>\n        if (mode === 'canvas') return <VRCanvas provider={this.props.provider} running={this.state.running}/>\n        return <AssetView provider={this.props.provider} asset={SelectionManager.getSelection()}/>\n    }\n\n    renderLoginButton() {\n        const buttons = []\n\n        if(AuthModule.supportsAuth()) {\n            if(AuthModule.isLoggedIn()) {\n                buttons.push(<button key=\"logout\" className=\"fa fa-user\" onClick={AuthModule.logout} title={'logout'}>logout</button>)\n            } else {\n                buttons.push(<button key=\"login\" className=\"fa fa-user\" onClick={()=>{\n                    if(AuthModule.supportsPassword()) {\n                        this.props.provider.showPasswordDialog()\n                    } else {\n                        this.props.provider.showGithubDialog()\n//                        AuthModule.login()\n                    }\n                }} title={'login'}/>)\n            }\n        }\n        if(AuthModule.supportsDocList()) {\n            buttons.push(<button key=\"open\" className=\"fa fa-folder-open\" onClick={this.props.provider.showOpenDocumentDialog} title={\"open\"}/>)\n        }\n        return buttons\n    }\n}\nconst EnumTitleRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        value = props.provider.accessObject(props.value).title\n    }\n    return <b>{value}</b>\n}\n\nclass ScaleEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            sync:false,\n        }\n    }\n    syncChanged = (e) => this.setState({sync: !this.state.sync})\n    changed = (e, key) =>{\n        const obj = this.props.provider.accessObject(this.props.item)\n        const newvals = {\n            sx:obj.sx,\n            sy:obj.sy,\n            sz:obj.sz\n        }\n        const val = parseFloat(e.target.value)\n        newvals[key] = val\n        if(this.state.sync) {\n            newvals.sx = val\n            newvals.sy = val\n            newvals.sz = val\n        }\n        this.props.onChange(newvals)\n    }\n    render() {\n        const obj = this.props.provider.accessObject(this.props.item)\n        return <HBox className=\"scale-editor\">\n            <input type=\"checkbox\" checked={this.state.sync} onChange={this.syncChanged}/>\n            <input type=\"number\" value={obj.sx} onChange={(e)=>this.changed(e,'sx')} step={0.1}/>\n            <input type=\"number\" value={obj.sy} onChange={(e)=>this.changed(e,'sy')} step={0.1}/>\n            <input type=\"number\" value={obj.sz} onChange={(e)=>this.changed(e,'sz')} step={0.1}/>\n        </HBox>\n    }\n}\n\nfunction acceptsModelAsset(type) {\n    if(type=== OBJ_TYPES.model) return true\n    return false\n}\nfunction acceptsImageAsset(type) {\n    if(type === OBJ_TYPES.plane\n        || type === OBJ_TYPES.bg360\n        || type === OBJ_TYPES.img2d\n        || type === OBJ_TYPES.cube\n        || type === OBJ_TYPES.sphere\n    ) return true\n    return false\n}\nfunction acceptsVideoAsset(type) {\n    if(type === OBJ_TYPES.plane\n        || type === OBJ_TYPES.bg360\n        || type === OBJ_TYPES.img2d\n    ) return true\n    return false\n}\n\nconst RunButton = (props) => {\n    const clss = props.active?\"run-button active fa fa-stop\":\"run-button fa fa-play\"\n    return <button onClick={props.onClick} className={clss}/>\n}","import React, {Component} from 'react'\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport TreeItemProvider, {getDocsURL} from '../TreeItemProvider'\nimport {on, parseOptions, toFlatString} from '../utils'\nimport {TweenManager} from '../common/tween'\nimport * as THREE from 'three'\nimport {Group} from \"three\"\nimport {VRManager, VR_DETECTED, Pointer} from 'webxr-boilerplate'\nimport SceneDef from './defs/SceneDef'\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, parseBehaviorScript, TOTAL_OBJ_TYPES} from './Common'\nimport {AuthModule} from './AuthModule'\nimport {XRSupport} from './XRSupport'\nimport {PubnubLogger} from '../syncgraph/PubnubSyncWrapper'\nimport {ErrorCatcher} from './ErrorCatcher'\n\n\nfunction attachUtilFunctions(obj) {\n    obj.find = (match,list) => {\n        if(!list) list = []\n        if(match(obj)) list.push(obj)\n        if(obj.children) obj.children.forEach(ch => {\n            ch.find(match,list)\n        })\n        return list\n    }\n    obj.exists = ()=>true\n}\n\nexport class ImmersivePlayer extends Component {\n    constructor(props) {\n        super(props)\n        const opts = parseOptions({})\n        if(!opts.doc) throw new Error(\"doc not specified\")\n        new TreeItemProvider(props.options)\n        this.obj_map = {}\n        this.three_map = {}\n        this.title_map = {}\n        this.previewUpdateNodes = []\n        this.current_scene = null\n        this.root = null\n        this.behavior_map = {}\n        this.behavior_assets = {}\n        this.pendingAssets = []\n\n        this.sceneAnchor = null\n\n        this.logger = new PubnubLogger(opts.doc)\n        this.scriptManager = new ScriptManager(new Adapter(this),this.logger)\n        this.provider = {\n            accessObject:(id)=>{\n                if(!this.obj_map[id]) return {\n                    exists:()=>false,\n                }\n                return this.obj_map[id]\n            }\n        }\n    }\n\n    componentDidMount() {\n        this.logger.log(\"mounted ImmersivePlayer\")\n        const canvas = this.canvas\n        if(XRSupport.supportsARKit()) {\n            this.xr = new XRSupport()\n            this.xr.getContext(canvas).then((context) => {\n                this.initThreeJS(canvas,context)\n                this.xr.setAnimationLoop( this.renderThreeWithCamera.bind(this))\n                this.startScene()\n            }).catch(err => {\n                console.error('Error', err)\n            })\n        } else {\n            this.initThreeJS(canvas,0)\n            this.renderer.setAnimationLoop(this.renderThree.bind(this))\n            this.startScene()\n        }\n\n    }\n\n    startScene() {\n        const opts = parseOptions({})\n        AuthModule.getJSON(getDocsURL()+opts.doc).then((payload)=>{\n            this.root = payload.graph\n            this.logger.log(\"loaded payload\",this.root)\n            this.buildRoot(this.root)\n            this.logger.log(this.root)\n            if(this.root.defaultScene) {\n                const sc = this.root.children.find(ch => ch.id  === this.root.defaultScene)\n                this.setCurrentScene(sc)\n            } else {\n                const sc = this.root.children[0]\n                this.setCurrentScene(sc)\n            }\n            Promise.all(this.pendingAssets).then(() => {\n                this.logger.log(\"all assets loaded now. starting script manager\")\n                this.scriptManager.startRunning()\n            })\n        })\n    }\n\n    render() {\n        return <div>\n            {/*<div id=\"overlay\">*/}\n            {/*    <div id=\"inner\">*/}\n            {/*        <h1>Application Name</h1>*/}\n            {/*        <div id=\"loading-indicator\">*/}\n            {/*            <label>loading</label>*/}\n            {/*            <progress max=\"100\" value=\"0\" id=\"progress\"></progress>*/}\n            {/*        </div>*/}\n            {/*        <button id=\"enter-button\" disabled>VR not supported, play anyway</button>*/}\n            {/*    </div>*/}\n            {/*</div>*/}\n            <ErrorCatcher logger={this.logger}>\n                <canvas ref={c => this.canvas = c} width={600} height={400}\n                    onClick={this.clickedCanvas}\n                />\n            </ErrorCatcher>\n        </div>\n    }\n\n    clickedCanvas = (e) => {\n        this.canvas.focus()\n        const rect = this.canvas.getBoundingClientRect();\n        const pointer = {\n            x: ( e.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( e.clientY - rect.top ) / rect.height * 2 + 1,\n        }\n        this.logger.log(\"clicked on the canvas\")\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const scene = this.three_map[this.current_scene.id]\n        const intersect = this.raycaster.intersectObjects(scene.children, true)\n        if(intersect && intersect.length >= 1) {\n            const inter = intersect.find(inter => inter.distance > 0)\n            if(inter) {\n                this.logger.log(\"found the interesction\", inter)\n                this.logger.log(\"intersections\", intersect)\n                const obj = inter.object\n                this.logger.log(\"obj\", obj)\n                const gobj = this.obj_map[obj.userData.graphid]\n                this.logger.log(\"jobj\", gobj)\n                this.scriptManager.performClickAction(gobj)\n            }\n        }\n    }\n\n    buildRoot(graph) {\n        //init assets first\n        graph.children.forEach(ch => {\n            if(ch.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return this.initAssets(ch)\n        })\n        graph.children.forEach(ch => {\n            attachUtilFunctions(ch)\n            if(ch.type === TOTAL_OBJ_TYPES.SCENE) return this.initObject(ch)\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return this.initBehaviors(ch)\n        })\n    }\n\n    initObject(obj) {\n        attachUtilFunctions(obj)\n        this.obj_map[obj.id] = obj\n        if(obj.title) this.title_map[obj.title] = obj\n        let node = null\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const scene = new SceneDef().makeNode(obj, this.provider)\n            this.three_map[obj.id] = scene\n            scene.userData.graphid = obj.id\n            this.scenes.add(scene)\n            scene.visible = false\n            node = scene\n        }\n        obj.props = () => obj\n\n        if(is3DObjectType(obj.type)) {\n            node = get3DObjectDef(obj.type).makeNode(obj, this.provider)\n            if(node.previewUpdate) this.previewUpdateNodes.push(node)\n            this.three_map[obj.id] = node\n            node.userData.graphid = obj.id\n            on(node, 'click', () => {\n                this.scriptManager.performClickAction(obj)\n            })\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            this.behavior_map[obj.id] = obj\n        }\n\n        if(obj.children) {\n            obj.children.forEach(ch => {\n                const chnode = this.initObject(ch)\n                if(chnode) node.add(chnode)\n            })\n        }\n\n        return node\n    }\n\n    initThreeJS(canvas, context) {\n        this.tweenManager = new TweenManager()\n        this.scene = new THREE.Scene();\n        this.camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new THREE.WebGLRenderer( { antialias: true, canvas:canvas, context:context } );\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.renderer.gammaOutput = true\n        this.renderer.vr.enabled = true;\n        // this.sceneContainer.appendChild( this.renderer.domElement );\n        this.vrmanager = new VRManager(this.renderer)\n        this.audioListener = new THREE.AudioListener()\n        this.camera.add(this.audioListener)\n        if(!this.xr) this.scene.background = new THREE.Color(0x000000);\n        this.camera.matrixAutoUpdate = false\n        this.scene.add(this.camera)\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n        const light = new THREE.DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.2))\n\n\n        this.scenes = new Group()\n        this.scene.add(this.scenes)\n\n        this.raycaster = new THREE.Raycaster();\n\n        // const $ = (sel) => document.querySelector(sel)\n        // const on = (elem, type, cb) => elem.addEventListener(type,cb)\n\n        // on($(\"#enter-button\"),'click',()=>{\n        //     $(\"#overlay\").style.display = 'none'\n        //     //we can start playing sound now\n        // })\n        /*\n        this.vrmanager.addEventListener(VR_DETECTED,()=>{\n            console.log(\"VR detected\")\n            $(\"#enter-button\").removeAttribute('disabled',false)\n            $(\"#enter-button\").innerText = \"enter vr\"\n            on($(\"#enter-button\"),'click',()=> this.vrmanager.enterVR())\n        })\n         */\n\n        // const WAIT_FOR_LOAD = false\n        /*\n        if(!WAIT_FOR_LOAD) {\n            $(\"#loading-indicator\").style.display = 'none'\n            $(\"#enter-button\").style.display = 'block'\n            $(\"#enter-button\").removeAttribute('disabled')\n        }\n         */\n\n        /*\n        //class which handles mouse and VR controller\n        this.pointer = new Pointer(this, {\n            intersectionFilter: ((o) => o.userData.clickable),\n            cameraFollowMouse:false,\n            mouseSimulatesController:false,\n            enableLaser: true,\n            laserLength: 20,\n        })\n         */\n\n    }\n\n    renderThreeWithCamera = (bounds,projectionMatrix,viewMatrix, time,frame) => {\n        if(!this.scene || !this.camera) return\n        this.camera.matrix.fromArray(viewMatrix)\n        this.camera.matrixWorldNeedsUpdate = true\n        this.camera.updateMatrixWorld()\n        this.camera.projectionMatrix.fromArray(projectionMatrix)\n        this.renderThree(time,frame)\n    }\n\n    renderThree = (time, frame) => {\n        if(this.tweenManager) this.tweenManager.update(time)\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        if(this.pointer) this.pointer.tick(time)\n        if(this.stats) this.stats.update(time)\n        if(this.controller) this.controller.update(time)\n        let session = null\n        if(this.xr) session = this.xr.session\n        this.scriptManager.tick(time, session, frame)\n        this.renderer.render( this.scene, this.camera );\n    }\n\n    initAssets(assets) {\n        assets.children.forEach(obj => {\n            this.logger.log(\"loading asset\",obj)\n            attachUtilFunctions(obj)\n            this.obj_map[obj.id] =  obj\n            if(obj.title) this.title_map[obj.title] = obj\n        })\n    }\n\n    initBehaviors(behaviors) {\n        behaviors.children.forEach(ch => {\n            attachUtilFunctions(ch)\n            this.obj_map[ch.id] =  ch\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                this.logger.log(\"loading behavior\",ch)\n                const prom = AuthModule.fetch(ch.src,{\n                    method:'GET'\n                }) .then(res => res.text())\n                    .then(text => {\n                        const info = parseBehaviorScript(text)\n                        info.text = text\n                        this.behavior_assets[ch.id] = info\n                        return text\n                    })\n                this.pendingAssets.push(prom)\n            }\n        })\n    }\n\n    setCurrentScene(scene) {\n        this.scenes.children.forEach(sc => sc.visible = false)\n        if(this.three_map[scene.id]) this.three_map[scene.id].visible = true\n        this.current_scene = scene\n    }\n\n}\n\n// ================  SGP implementation =====================\n\nclass Adapter extends SceneGraphProvider {\n    constructor(player) {\n        super()\n        this.player = player\n        this.logger = this.player.logger\n    }\n\n    getCurrentScene() {\n        return this.player.current_scene\n    }\n    getBehaviorsForObject (obj) {\n        if(!obj.children) return []\n        return obj.children.filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getSceneObjects(sc) {\n        return sc.children.filter(ch => is3DObjectType(ch.type))\n    }\n    getThreeObject (obj)  {\n        if(obj.id) return this.player.three_map[obj.id]\n        return this.player.three_map[obj]\n    }\n    getParsedBehaviorAsset (b) {\n        return this.player.behavior_assets[b.behavior]\n    }\n    getAllBehaviors () {\n        return Object.keys(this.player.behavior_map).map(key => this.player.behavior_map[key])\n    }\n    getAllScenes() {\n        return Object.keys(this.player.obj_map)\n            .map(key => this.player.obj_map[key])\n            .filter(obj => obj.type === TOTAL_OBJ_TYPES.SCENE)\n    }\n\n    navigateScene (sceneid) {\n        this.logger.log(\"navigating to \",sceneid)\n        const scene = this.player.obj_map[sceneid]\n        if(!scene) return this.logger.error(\"couldn't find scene for\",sceneid)\n\n        // @blair\n        const sceneNode = this.player.three_map[sceneid]\n        // this.logger.log(\"the scene node is\",sceneNode)\n        // this.logger.log(\"if it exists, scene anchor is\", sceneNode.userData.sceneAnchor)\n\n        if (!this.sceneAnchor || (this.sceneAnchor && scene.autoRecenter)) {\n            // create a new scene anchor\n            if (this.sceneAnchor) {\n                this.player.xr.removeSceneAnchor(this.sceneAnchor, this.logger)\n                this.sceneAnchor = null\n            }\n            this.player.xr.createSceneAnchor(sceneNode, this.logger).then(anchor => {\n                this.sceneAnchor = anchor\n            }).catch(error => {\n                this.logger.error(`error creating new scene anchor: ${error}`)\n            })\n        } else {\n            this.player.xr.updateAnchoredSceneNode(this.sceneAnchor, sceneNode, this.logger)\n        }\n\n        this.player.setCurrentScene(scene)\n    }\n    playMediaAsset (asset)  {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            this.logger.log(\"ImmersivePlayer playing audio\", asset)\n            const sound = new THREE.Audio(this.player.audioListener)\n            const audioLoader = new THREE.AudioLoader()\n            audioLoader.load(asset.src, (buffer) => {\n                this.logger.log(\"loaded the buffer\", buffer.length)\n                sound.setBuffer(buffer);\n                sound.setLoop(false);\n                sound.setVolume(0.5);\n                sound.play();\n            });\n        }\n    }\n    getGraphObjectByName(title) {\n        return this.player.title_map[title]\n    }\n    getGraphObjectById (id) {\n        return this.player.obj_map[id]\n    }\n    getCamera() {\n        return this.player.camera\n    }\n    startImageRecognizer(info) {\n        this.logger.log(\"starting the image recognizer\")\n        return new Promise((res,rej) => {\n            //called when an anchor is started that wants to recognize an image\n            // WebXR loaded?\n            if(!this.player.xr || !this.player.xr.session) {\n                this.logger.log(\"XR is not active?\")\n                return\n            }\n\n            this.player.xr.createDetectionImage(info,this.logger).then((name) => {\n                // decorate the info.node with an xr anchor\n                this.player.xr.startImageRecognizer(info, name, this.logger)\n            })\n        })\n    }\n\n    stopImageRecognizer(info) {\n        this.logger.log(\"stopping the image recognizer\")\n\n        if(!this.player.xr || !this.player.xr.session) {\n            this.logger.log(\"XR is not active?\")\n            return\n        }\n\n        this.player.xr.stopImageRecognizer(info, this.logger)\n    }\n\n    startGeoRecognizer(info) {\n        // WebXR loaded?\n        if(!this.player.xr || !this.player.xr.session) {\n            this.logger.log(\"XR is not active?\")\n            return\n        }\n\n        // decorate the info.node with an xr anchor\n        this.player.xr.addGeoAnchoredNode(info, this.logger)\n    }\n\n    stopGeoRecognizer(info) {\n        // WebXR loaded?\n        if(!this.player.xr || !this.player.xr.session) {\n            this.logger.log(\"XR is not active?\")\n            return\n        }\n\n        // decorate the info.node with an xr anchor\n        this.player.xr.stopGeoRecognizer(info, this.logger)\n    }\n\n}\n","import React, {Component} from 'react'\nimport './App.css'\nimport {DialogContainer, PopupContainer, PopupManager, VBox} from \"appy-comps\"\n\nimport MetadocEditor from \"./metadoc/Editor1\"\nimport VREditor from './vr/VREditor'\nimport {ImmersivePlayer} from './vr/ImmersivePlayer'\n\nexport default class App extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            switcher:false,\n        }\n        this.providers = ['vr','metadoc']\n        const sw = this.props.options.switcher\n        if(typeof sw !== 'undefined' && (sw === true || sw === 'true')) {\n            this.state.switcher = true\n        }\n    }\n\n    getApp() {\n        const doctype = this.props.options.doctype || \"vr\"\n        if(doctype === 'vr') {\n            if(this.props.options.mode === 'play') {\n                console.log(\"doing play instead\")\n                return <ImmersivePlayer options={this.props.options}/>\n            }\n            this.provider = new VREditor(this.props.options)\n            return this.provider.getApp()\n        }\n        if(doctype === 'metadoc') {\n            this.provider = new MetadocEditor(this.props.options)\n            return this.provider.getApp()\n        }\n    }\n\n\n//        provider.loadDoc(this.props.options.doc)\n\n    openNewProvider(name){\n        PopupManager.hide()\n        window.open(`./?mode=edit&doctype=${name}`)\n    }\n\n    showProviderList = (e) => {\n        PopupManager.show(\n            <VBox>\n                {this.providers.map((name)=>{\n                    return <button key={name} onClick={()=>this.openNewProvider(name)}>{name}</button>\n                })}\n            </VBox>,\n            e.target\n        )\n    }\n    render() {\n        if(!this.state.switcher) return this.getApp()\n        return (\n            <VBox fill>\n                <button\n                    style={{position:'absolute',zIndex: 10,}}\n                    onClick={this.showProviderList}\n                    >\n                    <img src=\"icon.png\" alt=\"switch apps\" height=\"20\" style={{padding:'0em'}}/>\n                </button>\n                <div style={{position: 'relative', flex: '1'}}>{this.getApp()}</div>\n                <DialogContainer/>\n                <PopupContainer/>\n            </VBox>\n        );\n    }\n}\n\n\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport 'font-awesome/css/font-awesome.css'\nimport App from './App';\nimport {parseOptions} from './utils'\n\nconst default_options = {\n    mode: 'edit',\n}\nconst options = parseOptions(default_options)\nconsole.log(\"options is\",options);\n\nfunction init() {\n    return <App options={options}/>;\n}\n\nReactDOM.render(init(), document.getElementById(\"root\"));\n\n"],"sourceRoot":""}