{"version":3,"sources":["vr/ToasterManager.js","utils.js","common/GridEditorApp.js","SelectionManager.js","common/HSLUVColorPicker.js","vr/AuthModule.js","TreeItemProvider.js","common/StringEditor.js","common/EnumEditor.js","common/ArrayEditor.js","common/PropSheet.js","syncgraph/utils.js","common/TreeTable.js","metadoc/Dimension.js","metadoc/MetadocCanvas.js","syncgraph/UndoQueue.js","metadoc/EventCoalescer.js","syncgraph/PubnubSyncWrapper.js","syncgraph/MissingDocDialog.js","syncgraph/SyncGraphProvider.js","common/InputManager.js","metadoc/RectDef.js","metadoc/CircleDef.js","metadoc/TextDef.js","metadoc/ImageDef.js","metadoc/Common.js","vr/defs/ObjectDef.js","vr/defs/CubeDef.js","vr/defs/SphereDef.js","vr/defs/PlaneDef.js","vr/GLTFLoader.js","vr/defs/ModelDef.js","vr/defs/BG360Def.js","vr/defs/TextDef.js","vr/defs/Image2DDef.js","vr/defs/GroupDef.js","vr/defs/GPUParticles.js","vr/defs/ParticlesDef.js","vr/defs/AnchorDef.js","vr/defs/GeoAnchorDef.js","vr/Common.js","vr/GLTFAssetView.js","metadoc/AssetView.js","vr/AssetActions.js","vr/dialogs/AddImageAssetDialog.js","metadoc/PageCanvasView.js","metadoc/PresentationApp.js","syncgraph/GraphAccessor.js","metadoc/Editor1.js","vr/TransformControls.js","vr/defs/SceneDef.js","vr/ToasterNotification.js","vr/ScriptManager.js","common/tween.js","vr/VRCanvas.js","vr/TranslationArrow.js","vr/TranslateControl.js","vr/panel2d/panel2d.js","vr/panel2d/component2d.js","vr/panel2d/button2d.js","vr/panel2d/group2d.js","vr/3dof.js","vr/Actions.js","vr/ImmersiveVREditor.js","vr/dialogs/AddGLTFAssetDialog.js","vr/dialogs/AddGLBAssetDialog.js","vr/dialogs/AddAudioAssetDialog.js","vr/dialogs/MakeEmbedDialog.js","vr/dialogs/OpenFileDialog.js","vr/dialogs/OpenAssetDialog.js","vr/ScriptEditor.js","vr/dialogs/OpenScriptDialog.js","vr/Templates.js","common/QRCanvas.js","vr/dialogs/QRDialog.js","vr/VREditor.js","vr/ImmersivePlayer.js","App.js","index.js"],"names":["module","exports","adds","add","note","this","forEach","cb","onAdd","push","parseOptions","opts","loc","document","location","search","substring","split","part","keyval","on","elem","type","addEventListener","GET_JSON","path","Promise","res","rej","console","log","req","XMLHttpRequest","onreadystatechange","readyState","status","JSON","parse","responseText","open","send","makePoint","x","y","minus","pt","divide","v","multiply","idivide","Math","floor","distance","dx","dy","sqrt","equals","toString","concat","setQuery","obj","oldOpts","final","Object","keys","key","query","map","join","window","history","pushState","toQueryString","GridLayout","props","clss","leftWidth","rightWidth","showLeft","showRight","style","gridTemplateColumns","react_default","a","createElement","className","children","Toolbar","cls","left","right","bottom","top","center","middle","scroll","Panel","transparent","Spacer","ToggleButton","selected","rest","objectWithoutProperties","assign","MenuPopup","es","actions","act","i","divider","onClick","PopupManager","hide","fun","icon","title","GridEditorApp","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","toggleLeftPane","e","setState","state","toggleRightPane","onMouseDownLeft","preventDefault","stopPropagation","dragSide","onMouseMove","onMouseUp","onMouseDownRight","cursor","clientX","clientY","innerWidth","removeEventListener","GridEditorApp_GridLayout","GridEditorApp_Toolbar","GridEditorApp_Spacer","bottomText","onMouseDown","Component","SELECTION_MANAGER","src_SelectionManager","SelectionManager","listeners","dropTarget","clip","index","indexOf","splice","value","node","fire","length","dropType","HSLUVColorPicker","mousePress","canvasToPoint","lightness","redraw","pressed","mouseMove","mouseUp","drawPicker","drawSlider","drawIndicator","livalToCanvas","l","mouseToCanvas","bounds","target","getBoundingClientRect","mousePressSlider","sliderPressed","hue","canvasToHue","setTimeout","mouseMoveSlider","mouseUpSlider","close","color","hsluv","hsluvToHex","onSelect","comps","hexToHsluv","canvasBounds","canvas","h","height","w","width","c","getContext","j","fillStyle","fillRect","g","cp","strokeStyle","strokeRect","lineWidth","slider","hueToCanvas","indicator","_this2","display","flexDirection","alignItems","ref","can","USER_CHANGE","AuthModule","AuthModuleSingleton","login","getLoginURL","fetch","then","json","win","url","authCallback","focus","logout","localStorage","clear","doclistSupported","msg","origin","data","payload","id","accessToken","setUserData","supported","docDeleteSupported","assetUploadSupported","scriptEditingSupported","isLoggedIn","getInfoURL","info","authentication","assetUpload","scriptEditing","getItem","setItem","getAccessToken","TREE_ITEM_PROVIDER","EXPANDED_CHANGED","STRUCTURE_CHANGED","STRUCTURE_ADDED","STRUCTURE_REMOVED","PROPERTY_CHANGED","CLEAR_DIRTY","SAVED","DOCUMENT_SWAPPED","URLS","BASE","getDocsURL","getAssetsURL","getScriptsURL","TreeItemProvider","options","genID","prefix","random","save","getSceneRoot","payload_obj","doc","getDocType","getDocId","payload_string","stringify","docid","onerror","setRequestHeader","mode","doctype","catch","hasChildren","item","getChildren","expanded_map","SERVER_URL","init","filter","list","current","isExpanded","def","Error","root","provider","setDocument","warn","makeEmptyRoot","_this3","spath","generateSelectionPath","Selection","getSelection","newsel","findNodeFromSelectionPath","setSelection","file","FormData","append","size","name","xml","response","responseType","child","parent","sibling","StringEditor","_Component","_getPrototypeOf2","_len","arguments","args","Array","_key","apply","keypressed","charCode","onCommit","inherits","createClass","prop","hasHints","getHints","multiline","onChange","onBlur","onKeyPress","EnumPicker","Rend","renderer","items","values","val","DefaultEnumRenderer","EnumEditor","show","EnumEditor_EnumPicker","calculateValues","calculateRenderer","selectValue","renderValue","proxy","getRendererForEnum","getKey","vals","getValuesForEnum","ArrayEditor","addValue","showEditor","enumChanged","arr","slice","renderValues","renderEditor","Renderer","deleteItem","EnumEditor_EnumEditor","TYPES","STRING","NUMBER","BOOLEAN","ENUM","COLOR","GROUP","PropEditor","changed","isType","isLive","setValue","updateNum","checked","customChanged","colorChanged","commit","hasOwnProperty","min","max","isNaN","parseFloat","numberKeyDown","shiftKey","booleanChanged","arrayChanged","openColorEditor","HSLUVColorPicker_HSLUVColorPicker","getValue","nextProps","nextState","getType","selMan","isCustom","createCustomEditor","isLocked","StringEditor_StringEditor","step","hints","incrementValue","onKeyDown","backgroundColor","ArrayEditor_ArrayEditor","PropSheet","selection","h2","hand","s","off","_this4","calculateGroups","calculateProps","getName","renderIndeterminate","PropSheet_PropEditor","isIndeterminate","getFullSelection","first","prov","getProperties","A","B","pa","find","pb","multi","MultiPropProxy","match","addSubProxy","PropProxy","p","group_keys","getGroupKeys","subs","sub","same","custom","locked","live","setPropertyValue","group","listToArray","prototype","createGraphObjectFromObject","graph","createObject","fetchGraphObject","objid","getPropertiesForObject","getPropertyValue","propToArray","CH","len","getArrayLength","ch","getElementAt","insertAsFirstChild","setProperty","insertAfter","insertAsLastChild","prev","removeFromParent","n","array","findIndex","removeElement","error","ContextMenu","menu","TreeTableItem","addToSelection","onContextMenu","calculateContextMenu","TreeTable_ContextMenu","toggleItemCollapsed","onDragStart","onDragOver","onDragEnd","onDrop","isSelected","getDropTarget","getDropType","arrow","data-nodeid","depth","getRendererForItem","renderDragBars","canBeMoved","draggable","TreeTable","dataTransfer","effectAllowed","setData","parentNode","setDragImage","dropEffect","dragTarget","internalDrag","canAddExternalChild","setDropTarget","setDropType","canAddChild","canBeSibling","getDataGraph","src","dst","parent2","acceptDrop","generateChildren","chs","listener","other_listener","sel","newProps","TreeTable_TreeTableItem","UNITS","PIXEL","matches","short","MILLIMETER","DEFAULT_DPI","Dimension","unit","scale","dpi","px_per_in","MetadocCanvas","selectionChanged","getPageSize","getSelectedPage","as","getRawGraph","page","drawPage","hsnap","vsnap","restore","toCanvas","shape","findShape","mouseDown","pauseQueue","shapeid","shapeobj","initial","start","layer","getSelectedLayer","snap","process","cmd","unpauseQueue","onRawChange","rect","prevProps","drawLayer","drawShape","getShapeDef","draw","isInside","reverse","_this5","border","EDGES","LEFT","RIGHT","CENTER","TOP","MIDDLE","BOTTOM","NONE","snaps","SNAP_THRESHOLD","isNearH","abs","isNearV","getBounds","nearH","nearV","require","SET_PROPERTY","CREATE_PROPERTY","DELETE_PROPERTY","CREATE_OBJECT","DELETE_OBJECT","INSERT_ELEMENT","DELETE_ELEMENT","UndoQueue","op","last","host","getHostId","seq","nextSeq","timestamp","Date","now","entry","entryid","object","prevValue","makeGUID","EventCoalescer","rawlisteners","fireRaw","paused","buffer","bufferOp","PubnubSyncWrapper","handleGraphChange","pubnub","PubNub","publishKey","subscribeKey","addListener","operation","category","sendHistoryRequest","message","m","handleMessage","subscribe","channels","calculateChannelName","sendMessage","unsubscribe","stop","str","uuid","publish","channel","hist","getHistory","count","chunk","evt","handleGetHistory","handleReceiveHistory","MissingDocDialog","cancel","DialogManager","okay","createNewDocument","visible","grow","DocGraph","CommandGenerator","SyncGraphProvider","getDocTitle","getDocHistory","getDocGraph","getObjectByProperty","DocGraphToObjectGraph","coalescer","syncdoc","hasPropertyValue","expanded","ToasterMananager","method","cache","body","headers","Content-Type","access-key","docLoaded","toggleConnected","connected","unpause","pause","isConnected","performUndo","undoqueue","canUndo","undo","performRedo","canRedo","redo","datalisteners","setupDocFlow","loadDoc","propKey","oldValue","newValue","success","showMissingDocDialog","makeDocFromServerHistory","shutdown","submit","clearSelection","MissingDocDialog_MissingDocDialog","InputManager","keyDown","m2","bindings","b","keyCode","valid","modifiers","mod","MODIFIERS","COMMAND","metaKey","SHIFT","some","dispatchEvents","binding","bind","KEYS","S","Z","C","V","X","LEFT_ARROW","RIGHT_ARROW","RectDef","rx","ry","fillColor","c0","c1","c2","c3","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","newOrigin","CircleDef","radius","arc","PI","pow","TextDef","text","horizontalAlign","HORIZONTAL_ALIGNMENT","verticalAlign","VERTICAL_ALIGNMENT","BASELINE","autoFit","fontSize","fontFamily","STANDARD_FONTS","SANSSERIF","fontWeight","FONT_WEIGHTS","NORMAL","fontStyle","FONT_STYLES","_this$calculateLines","calculateLines","lines","size_px","total_height","total_width","line","lines_height","xoff","yoff","fillText","font","measureText","reduce","total","_this$calculateLines2","insideRect","_this$calculateLines3","ImageDef","asset","isImageCached","drawImage","getCachedImage","requestImageCache","PROP_DEFS","subtype","format","pageSize","SHAPE_DEFS","circle","image","ICONS","plane","model","cut","copy","paste","delete","SERIF","MONOSPACE","BOLD","ITALIC","OBLIQUE","isShapeType","ObjectDef","position","z","rotation","material","set","parseInt","tx","ty","tz","COUNTER","CubeDef","scene","OBJ_TYPES","cube","rz","sx","sy","sz","createArray","Mesh","BoxGeometry","MeshLambertMaterial","userData","clickable","get","geometry","SphereDef","THREE","PlaneDef","side","ASSET_TYPES","IMAGE","tex","load","VIDEO","video","videocache","crossOrigin","GLTFLoader","manager","undefined","DefaultLoadingManager","GLTFRegistry","objects","remove","removeAll","constructor","onLoad","onProgress","onError","scope","LoaderUtils","extractUrlBase","loader","FileLoader","setResponseType","setCrossOrigin","setPath","content","extensions","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","version","extensionsUsed","KHR_LIGHTS","GLTFLightsExtension","KHR_MATERIALS_COMMON","GLTFMaterialsCommonExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","time","GLTFParser","scenes","cameras","animations","timeEnd","lights","lightId","lightNode","light","Color","fromArray","DirectionalLight","PointLight","SpotLight","AmbientLight","constantAttenuation","intensity","linearAttenuation","quadraticAttenuation","decay","fallOffAngle","angle","fallOffExponent","getMaterialType","MeshPhongMaterial","MeshBasicMaterial","extendParams","materialParams","parser","khrMaterial","pending","materialValues","diffuseFactor","opacity","diffuseTexture","assignTexture","specularFactor","specular","specularTexture","shininessFactor","shininess","all","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","BIN","headerView","DataView","header","magic","getUint32","chunkView","chunkIndex","byteLength","chunkLength","chunkType","contentArray","byteOffset","specularGlossinessParams","ShaderMaterial","params","pbrSpecularGlossiness","shader","ShaderLib","uniforms","UniformsUtils","clone","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","fragmentShader","replace","roughness","metalness","roughnessMap","metalnessMap","setHex","glossiness","specularMap","glossinessMap","vertexShader","defines","STANDARD","isArray","emissive","glossinessFactor","specularGlossinessTexture","specGlossIndex","createMaterial","fog","isGLTFSpecularGlossinessMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","derivatives","cloneMaterial","source","il","refreshUniforms","camera","uvScaleMap","offset","repeat","diffuse","multiplyScalar","isWebGLRenderTarget","texture","matrix","matrixAutoUpdate","setUvTransform","uvTransform","offsetRepeat","flipEnvMap","isCubeTexture","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","WEBGL_CONSTANTS","WEBGL_COMPONENT_TYPES","Number","Matrix3","Matrix4","Vector2","Vector3","Vector4","Texture","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipMapNearestFilter","9985","LinearMipMapNearestFilter","9986","NearestMipMapLinearFilter","9987","LinearMipMapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TEXTURE_FORMATS","6406","AlphaFormat","6407","RGBFormat","6408","RGBAFormat","6409","LuminanceFormat","6410","LuminanceAlphaFormat","WEBGL_TEXTURE_DATATYPES","UnsignedByteType","32819","UnsignedShort4444Type","32820","UnsignedShort5551Type","33635","UnsignedShort565Type","WEBGL_TYPE_SIZES","BackSide","FrontSide","NeverDepth","LessDepth","EqualDepth","LessEqualDepth","GreaterEqualDepth","NotEqualDepth","AlwaysDepth","AddEquation","SubtractEquation","ReverseSubtractEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateSmooth","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addMorphTargets","mesh","meshDef","primitiveDef","accessors","targets","morphAttributes","normal","morphTargets","positionAttribute","normalAttribute","attributeName","POSITION","attributes","jl","setXYZ","getX","getY","getZ","morphNormals","updateMorphTargets","morphTargetInfluences","isPrimitiveEqual","indices","attribA","attribB","keysA","keysB","getCachedGeometry","newPrimitive","cached","primitive","primitiveCache","textureLoader","TextureLoader","fileLoader","markDefs","getMultiDependencies","dependencies","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","getDependency","cacheKey","dependency","charAt","toUpperCase","getDependencies","defs","types","results","pendings","loadBuffer","bufferIndex","bufferDef","buffers","uri","resolve","reject","loadBufferView","bufferViewIndex","bufferViewDef","bufferViews","loadAccessor","accessorIndex","accessorDef","pendingBufferViews","bufferView","sparse","bufferAttribute","itemSize","TypedArray","componentType","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","normalized","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setArray","setX","setY","setZ","setW","loadTexture","textureIndex","URL","webkitURL","textureDef","textures","images","sourceURI","isObjectURL","blob","Blob","mimeType","createObjectURL","Loader","Handlers","revokeObjectURL","flipY","internalFormat","sampler","samplers","magFilter","minFilter","wrapS","wrapT","textureName","loadMaterial","materialIndex","materialType","materialDef","materials","materialExtensions","khcExtension","sgExtension","pbrMetallicRoughness","MeshStandardMaterial","metallicRoughness","baseColorFactor","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","DoubleSide","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","encoding","sRGBEncoding","extras","loadGeometries","primitives","geometries","BufferGeometry","attributeId","addAttribute","setIndex","loadMesh","meshIndex","Group","depthTest","uv2","uv","useVertexColors","useFlatShading","useSkinning","useMorphTargets","vertexColors","VertexColors","needsUpdate","flatShading","SkinnedMesh","skinning","drawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","Line","LineLoop","Points","onBeforeRender","loadCamera","cameraIndex","cameraDef","aspectRatio","xfov","yfov","PerspectiveCamera","radToDeg","znear","zfar","OrthographicCamera","xmag","ymag","loadSkin","skinDef","skinEntry","inverseBindMatrices","accessor","loadAnimation","animationIndex","animationDef","tracks","input","parameters","output","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","outputAccessorValues","getW","targetNames","traverse","isMesh","AnimationUtils","arraySlice","AnimationClip","loadNode","Bone","isGroup","Object3D","PropertyBinding","sanitizeNodeName","applyMatrix","quaternion","loadScene","buildNodeHierachy","nodeId","parentObject","allNodes","bones","boneInverses","jointId","jointNode","mat","Skeleton","matrixWorld","sceneIndex","sceneDef","Scene","nodeIds","ModelDef","clicker","gltf","computeBoundingSphere","bs","boundingSphere","customize","onBeforeCompile","imageOffsetAngle","imageCropStartAngle","imageCropEndAngle","matShader","BG360Def","bg360","cssStyle","div","innerHTML","classList","setAttribute","divLayer","WebLayer3D","pixelRatio","devicePixelRatio","refresh","previewUpdate","update","regenerateText","Image2DDef","img2d","ratio","accessObject","exists","GroupDef","GPUParticleShader","UPDATEABLE_ATTRIBUTES","GPUParticles","blending","NormalBlending","PARTICLE_COUNT","maxParticles","PARTICLE_CURSOR","DPR","particleUpdate","onTick","reverseTime","fadeIn","fadeOut","rand","sprite","particleSpriteTex","ctx","CanvasTexture","depthWrite","uTime","uScale","tSprite","defaultAttributeValues","particlePositionsStartTime","particleVelColSizeLife","setDynamic","particleSystem","frustumCulled","attr","getAttribute","updateRange","ttime","geometryUpdate","dispose","old","velocity","acceleration","endColor","positionStartAttribute","startTimeAttribute","velocityAttribute","accelerationAttribute","colorAttribute","endcolorAttribute","sizeAttribute","lifeTimeAttribute","lifetime","sizeRandomness","r","ParticlesDef","particles","pointSize","startColor","positionRandomness","baseVelocity","velocityRandomness","baseColor","colorRandomness","AdditiveBlending","system","spawnParticle","updateSprite","AnchorDef","anchor","targetImage","imageRealworldWidth","recType","REC_TYPES","SCENE_START","SphereBufferGeometry","startImageRecognizer","getObjectById","callback","fireEvent","geoanchor","targetGeoLocation","startGeoRecognizer","stdhints","description","defaultFloor","padding","borderWidth","borderRadius","textColor","borderColor","drawBackground","scriptBody","defaultScene","latitude","longitude","altitude","useAltitude","SIMPLE_COLORS","sphere","TOTAL_OBJ_TYPES","SCENE","ASSET","BEHAVIOR","BEHAVIOR_SCRIPT","ASSETS_LIST","BEHAVIORS_LIST","ROOT","is3DObjectType","canHaveShape","get3DObjectDef","GeoAnchorDef","MIME_TYPES","PNG","JPEG","MP3","AAC","JAVASCRIPT","GLB","MP4","GLTF","AUDIO","GEOLOCATION","isImageType","toLowerCase","ITEM_ICONS","assets","behavior","behavior_script","audio","parseBehaviorScript","contents","Function","AssetView","renderThree","render","initThreeJS","sceneContainer","background","innerHeight","antialias","setPixelRatio","setSize","gammaOutput","vr","enabled","appendChild","domElement","vrmanager","VRManager","aspect","updateProjectionMatrix","setAnimationLoop","normalize","renderAsset","alt","controls","GLTFAssetView_AssetView","addImageAssetFromExpandedURL","getAssetsObject","insertChildLast","img","addImageAssetFromFile","ToasterManager","uploadFile","ans","addGLBAssetFromFile","addAudioAssetFromURL","fileType","lastIndexOf","AddImageAssetDialog","view","fileInput","files","switchLocal","switchRemote","selectedFile","typedURL","React","createRef","GridEditorApp_ToggleButton","renderSelectedPanel","PageCanvasView","handleKeypress","onNext","onPrev","tabIndex","PresentationApp","docSwapped","pageIndex","pages","getPages","PageCanvasView_PageCanvasView","GraphAccessor","hasObject","o","insertFirstChild","id2","createProperty","EnumTitleRenderer","STANDARD_PAGE_SIZES","PageSizeRenderer","MetadocEditor","getApp","PresentationApp_PresentationApp","assertThisInitialized","Editor1_MetadocApp","getTitle","addShape","make","addRect","addCircle","addText","addImage","addImageAssetFromURL","deleteSelection","getSelectedShape","deleteSelectedAsset","cutSelection","setClipboard","copySelection","pasteSelection","obj1","getClipboard","obj2","cloneShape","exportSVG","svg","renderSVGWrapper","renderSVGChildren","link","href","encodeURIComponent","download","click","exportPNG","toDataURL","newView","openPresentationView","showAddImageAssetDialog","AddImageAssetDialog_AddImageAssetDialog","imagecache","rect1","out","copyPropDef","margin","rootobj","parts","trim","parseDimension","toSVGString","tgt","t","complete","Image","onload","MetadocApp","_this6","canvasSelected","showAddPopup","acts","addPage","addLayer","GridEditorApp_MenuPopup","getSelectedRoot","zoomIn","zoom","zoomOut","im","addKeyBinding","_this7","attachKeyEvents","GridEditorApp_GridEditorApp","GridEditorApp_Panel","TreeTable_TreeTable","renderCenterPane","PropSheet_PropSheet","MetadocCanvas_MetadocCanvas","AssetView_AssetView","TransformControls","_gizmo","TransformControlsGizmo","_plane","TransformControlsPlane","defineProperty","changeEvent","mouseDownEvent","mouseUpEvent","objectChangeEvent","ray","Raycaster","_tempVector","_tempVector2","_tempQuaternion","Quaternion","_unit","Y","_identityQuaternion","_alignVector","pointStart","pointEnd","rotationAxis","rotationAngle","cameraPosition","cameraQuaternion","cameraScale","parentPosition","parentQuaternion","parentScale","worldPositionStart","worldQuaternionStart","worldScaleStart","worldPosition","worldQuaternion","worldScale","eye","_positionStart","_quaternionStart","_scaleStart","propName","defaultValue","propValue","dispatchEvent","getPointer","event","pointer","changedTouches","button","onContext","onPointerHover","pointerHover","onPointerDown","onPointerMove","pointerDown","pointerMove","onPointerUp","pointerUp","attach","detach","axis","updateMatrixWorld","decompose","dragging","setFromCamera","intersect","intersectObjects","picker","planeIntersect","space","rotationSnap","round","point","applyQuaternion","inverse","translationSnap","setFromMatrixPosition","d","dot","ROTATION_SPEED","distanceTo","cross","angleTo","setFromAxisAngle","getMode","setMode","setTranslationSnap","setRotationSnap","setSpace","create","isTransformControls","gizmoMaterial","gizmoLineMaterial","LineBasicMaterial","linewidth","matInvisible","matHelper","matRed","matGreen","matBlue","matWhiteTransperent","matYellowTransparent","matCyanTransparent","matMagentaTransparent","matLineRed","matLineGreen","matLineBlue","matLineCyan","matLineMagenta","matLineYellow","matLineGray","matLineYellowTransparent","arrowGeometry","CylinderBufferGeometry","scaleHandleGeometry","BoxBufferGeometry","lineGeometry","Float32BufferAttribute","CircleGeometry","vertices","cos","sin","gizmoTranslate","XYZ","OctahedronBufferGeometry","XY","PlaneBufferGeometry","YZ","XZ","pickerTranslate","helperTranslate","START","END","DELTA","gizmoRotate","E","XYZE","helperRotate","AXIS","pickerRotate","TorusBufferGeometry","gizmoScale","XYZX","XYZY","XYZZ","pickerScale","helperScale","setupGizmo","gizmoMap","gizmo","tag","tempGeometry","tempVector","tempEuler","Euler","alignVector","zeroVector","lookAtMatrix","tempQuaternion","tempQuaternion2","identityQuaternion","unitX","unitY","unitZ","helper","handles","handle","eyeDistance","setFromRotationMatrix","lookAt","atan2","multiplyQuaternions","showX","showY","showZ","_opacity","_color","lerp","setFromEuler","isTransformControlsGizmo","wireframe","dirVector","tempMatrix","isTransformControlsPlane","SceneDef","setDefaultFloor","ToasterNotification","notification","SceneGraphProvider","beh","ScriptManager","sceneGraphProvider","sgp","running","storage","getCurrentScene","getScene","getObject","getGraphObjectByName","ThreeObjectFacade","getAsset","AssetFacade","getGraphObjectById","navigateScene","fireSceneExit","fireSceneEnter","playSound","playAudioAsset","getCamera","setKeyValue","getKeyValue","hasKeyValue","isAR","graphTarget","fireMessageAtTarget","getTweenManager","fireEventFromTarget","makeSystemFacade","behaviors","getBehaviorsForObject","getParsedBehaviorAsset","stopRunning","onExit","onEnter","startTime","getSceneObjects","obj3","getThreeObject","err","getAllBehaviors","destroyListeners","onMessage","playMediaAsset","stopMediaAsset","_TYPE","vec","Tween","WaitTween","dur","duration","ActionTween","fn","ForeverTween","diff","PROP_TYPES","SINGLE","COMPOUND","LERP_TYPES","ELASTIC","easeLinear","from","to","PropTween","property","propertyType","lerp_type","lerpType","loop","loopCount","reversed","autoReverse","easeOutElastic","ClipTween","speed","mixer","action","clipAction","findByName","setLoop","Infinity","play","setEffectiveTimeScale","prevTime","ParallelTween","isAlive","SequentialTween","_this8","_startNext","cur","TweenManager","XRSupport","device","session","xrCanvas","xrContext","context","navigator","xr","requestDevice","xrDevice","requestSession","outputContext","xrSession","compatibleXRDevice","baseLayer","XRWebGLLayer","userAnimationCallback","__handleAnimationFrame","_handleAnimationFrame","requestFrameOfReference","frameOfReference","headFrameOfReference","eyeLevelFrameOfReference","requestAnimationFrame","frame","ended","pose","getDevicePose","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","views","Symbol","iterator","next","done","getViewport","projectionMatrix","getViewMatrix","return","xyz","addAnchor","_mozillaXRViewer","webkit","Adapter","getCachedBehaviorAsset","getSelectedSceneObject","findNode","sound","audioListener","setBuffer","setVolume","playing_audio","tweenManager","VRCanvas","moveCameraForward","moveCameraBackward","handleKeyPress","transformChanged","quick_setPropertyValue","sc","obj_node_map","updateScene","setCurrentSceneWrapper","findSceneObjectParent","windowResized","clickedCanvas","raycaster","getCurrentSceneWrapper","scriptManager","performClickAction","graphid","previewUpdateNodes","supportsARKit","setupRenderer","animationLoopWithCamera","animationLoop","tick","viewMatrix","matrixWorldNeedsUpdate","removeNodeMapping","updateProperty","populateNode","nextContext","resetSceneGraph","stopRecognizer","startRecognizer","startRunning","ToasterNotification_ToasterNotification","nodeid","obj3d","makeNode","insertNodeMapping","addSceneWrapper","dump","inset","_this9","_this10","graphObj","threeObj","reset","toConsumableArray","getImageData","nonStandard_createDetectionImage","nonStandard_activateDetectionImage","anchorName","modelMatrix","toRad","degrees","TranslationArrow","control","startHover","endHover","beginDrag","startPoint","intersection","worldToLocal","oldFilter","intersectionFilter","startPosition","POINTER_MOVE","updateDrag","POINTER_RELEASE","endDrag","endPoint","finalPoint","end","makePlane","makeArrow","makeInputGrabber","POINTER_ENTER","POINTER_EXIT","POINTER_PRESS","TranslateControl","_THREE$Group","Panel2D","canvasTexture","redrawHandler","inside","fpt","contains","comp","findAt","POINTER_CLICK","startDrag","dragSphere","moveDrag","Component2D","Button2D","fsize","normalBg","hoverBg","bg","metrics","Group2D","layout","translate","childProps","deg","YAXIS","ThreeDOFController","stagePos","stageRot","states","touchpad","keystates","ArrowLeft","previous","ArrowRight","ArrowUp","ArrowDown","dir","rotateLeft","rotateRight","moveForward","moveBackward","applyAxisAngle","_fire","scanGamepads","updateKeys","gamepads","getGamepads","gamepad","startsWith","buttons","axes","down","up","addScene","deleteObject","isEmpty","editor","currentScene","swapScene","Audio","AudioLoader","ImmersiveVREditor","standardViewClickHandler","isRunning","disabled","wrapper","sceneWrappers","initScene","render3","stats","controller","$","querySelector","container","WebGLRenderer","AudioListener","initContent","VR_DETECTED","removeAttribute","innerText","enterVR","updateSceneOp","documentSwapped","selectedNode","VRStats","editable","Pointer","cameraFollowMouse","mouseSimulatesController","enableLaser","laserLength","stick","controller1","tools","panel2d","button2d","setAll","add3DObject","runButton","color_group","group2d","panel","setColor","defaults","nodeObj","AddGLTFAssetDialog","fileinput","multiple","webkitdirectory","AddGLBAssetDialog","AddAudioAssetDialog","addAudioAssetFromFile","MakeEmbedDialog","generateEmbedURL","OpenFileDialog","refreshList","loadDocList","docs","docList","switcher","removeDoc","maxHeight","openDoc","renderDeleteButton","supportsDocDelete","deleteDoc","OpenAssetDialog","loadAssetList","assetList","isVideoType","addVideoAssetFromURL","isGLTFType","removeAssetSource","addAsset","supportsAssetUpload","deleteAsset","ScriptEditor","swap","changeText","updateBehaviorAssetContents","fetchBehaviorAssetContents","lib_default","theme","showGutter","OpenScriptDialog","loadScriptList","scripts","addBehaviorAssetFromURL","removeBehaviorAssetSource","addScript","supportsScriptEdit","deleteScript","CUSTOM_BEHAVIOR_SCRIPT","CUSTOM_SCENE_SCRIPT","QRCanvas","QRCode","QRDialog","documentURI","QRCanvas_QRCanvas","VREditor","VREditor_VREditorApp","ImmersiveVREditor_ImmersiveVREditor","getBehaviorsObject","setCachedBehaviorAsset","editInVR","viewInVR","showQRCode","QRDialog_QRDialog","embedView","MakeEmbedDialog_MakeEmbedDialog","nodeName","showAddAudioAssetDialog","AddAudioAssetDialog_AddAudioAssetDialog","showAddGLTFAssetDialog","AddGLTFAssetDialog_AddGLTFAssetDialog","showAddGLBAssetDialog","AddGLBAssetDialog_AddGLBAssetDialog","showOpenDocumentDialog","OpenFileDialog_OpenFileDialog","showOpenAssetDialog","OpenAssetDialog_OpenAssetDialog","showAddServerImageDialog","showOpenBehaviorDialog","OpenScriptDialog_OpenScriptDialog","showAddGeoLocationAssetDialog","addCustomBehaviorAsset","TEMPLATE","randi","fname","script","addSceneScript","addBehaviorToObject","properties","behaviorCache","scene1","behaviorProps","getCachedBehaviorPropDefs","pname","propdef","ndef","realobj","nodeType","acceptsImageAsset","acceptsVideoAsset","getFirstSceneObject","ov","cmds","canHaveBehavior","isGLTFFile","VREditor_ScaleEditor","VREditorApp","toggleRunning","user","getUsername","bot","getSelectedScene","showAddAssetPopup","showAddActionPopup","VREditor_RunButton","active","renderLoginButton","ScriptEditor_ScriptEditor","VRCanvas_VRCanvas","supportsAuth","supportsDocList","ScaleEditor","syncChanged","sync","newvals","RunButton","ImmersivePlayer","obj_map","three_map","title_map","current_scene","behavior_map","behavior_assets","pendingAssets","buildRoot","setCurrentScene","initAssets","initBehaviors","cch","prom","player","sceneid","App","showProviderList","providers","openNewProvider","sw","ImmersivePlayer_ImmersivePlayer","zIndex","flex","ReactDOM","App_App","getElementById"],"mappings":"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","file":"static/js/main.586b4fbe.chunk.js","sourcesContent":["/**\n * Created by josh on 11/29/16.\n */\nmodule.exports = {\n    adds: [],\n    add: function add(note) {\n        this.adds.forEach(cb => cb(note))\n    },\n    onAdd: function onAdd(cb) {\n        this.adds.push(cb);\n    },\n}\n","export function parseOptions(opts) {\n    let loc = document.location\n    if (loc.search) {\n        const parts = loc.search.substring(1).split('&')\n        parts.forEach((part)=>{\n            const keyval = part.split('=')\n            opts[keyval[0]] = keyval[1]\n        })\n    }\n    // console.log(opts)\n    // if(typeof opts.switcher === 'string') {\n    //     console.log(\"parsing switcher\")\n    // }\n    return opts;\n}\n\n\nexport const on = (elem,type,cb) => elem.addEventListener(type,cb)\n\nexport function genID(prefix) {\n    return `${prefix}_${Math.floor(Math.random() * 10000)}`\n}\nexport function GET_JSON(path, cb) {\n    return new Promise((res,rej) => {\n        console.log(\"fetching\",path);\n        const req = new XMLHttpRequest()\n        req.onreadystatechange = function() {\n            // console.log(\"got\",req.readyState, req.status)\n            if(req.readyState === 4) {\n                if(req.status === 200) return res(JSON.parse(req.responseText));\n                //if anything other than 200, reject it\n                rej(req)\n            }\n            if(req.status === 500) rej(req);\n            if(req.status === 404) rej(req);\n        };\n        req.open(\"GET\",path,true);\n        req.send();\n    });\n}\n\n\nexport function POST_JSON(path, payload) {\n    // console.log(\"POSTING\",path,payload);\n    return new Promise((res,rej)=>{\n        const req = new XMLHttpRequest();\n        req.onreadystatechange = function() {\n            if(req.readyState === 4 && req.status === 200) {\n                try {\n                    res(JSON.parse(req.responseText));\n                } catch(e) {\n                    rej(e);\n                }\n            }\n            if(req.status === 500) rej(req);\n            if(req.status === 404) rej(req);\n        };\n        req.onerror = (e) => rej(e);\n        req.open(\"POST\",path,true);\n        req.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n        if(typeof payload === 'string') {\n            req.send(payload)\n        } else {\n            req.send(JSON.stringify(payload));\n        }\n    })\n}\n\n\nexport function makePoint(x,y) {\n    return {\n        x:x,\n        y:y,\n        minus: function(pt) {\n            return makePoint(this.x-pt.x, this.y-pt.y);\n        },\n        add: function(pt) {\n            return makePoint(this.x+pt.x, this.y+pt.y);\n        },\n        divide: function(v) {\n            return makePoint(this.x/v,this.y/v)\n        },\n        multiply: function(v) {\n            return makePoint(this.x*v,this.y*v)\n        },\n        idivide: function(v) {\n            return makePoint(\n                Math.floor(this.x/v),\n                Math.floor(this.y/v)\n            )\n        },\n        floor: function() {\n            return makePoint(\n                Math.floor(this.x),\n                Math.floor(this.y)\n            )\n        },\n        distance(pt) {\n            const dx = pt.x-this.x;\n            const dy = pt.y-this.y;\n            return Math.sqrt(dx*dx+dy*dy)\n        },\n        equals(pt) {\n            return pt.x === this.x && pt.y === this.y\n        },\n        toString() {\n            return `(${x},${y})`\n        }\n    }\n}\n\n//use only capital letters, 65->90\nexport function genAlphaID(count) {\n    let id = \"\"\n    for(let i=0; i<count; i++) {\n        id += String.fromCharCode(65 + Math.floor(Math.random() * (90 - 65)))\n    }\n    return id\n}\n\nexport function setQuery(obj) {\n    const oldOpts = parseOptions({})\n    const final = {}\n    Object.keys(oldOpts).forEach(key=> final[key] = oldOpts[key])\n    Object.keys(obj).forEach(key=> final[key] = obj[key])\n    const query = Object.keys(final).map((key)=>`${key}=${final[key]}`).join('&')\n    window.history.pushState(obj,'a title','?'+query)\n}\nexport function toQueryString(obj) {\n    return Object.keys(obj).map((key)=>`${key}=${obj[key]}`).join('&')\n}\n\n\nexport function shallowCopy(obj) {\n    const out = {};\n    Object.keys(obj).forEach((key) => out[key] = obj[key])\n    return out;\n}\n","import React, {Component} from 'react'\nimport {PopupManager, VBox} from 'appy-comps'\nimport {makePoint} from '../utils'\n\nconst GridLayout = (props) => {\n    let clss = \"grid fill\";\n    let leftWidth = props.leftWidth\n    let rightWidth = props.rightWidth\n    if (!props.showLeft) {\n        clss += ' hide-left'\n        leftWidth = 0\n    }\n    if (!props.showRight) {\n        clss += ' hide-right'\n        rightWidth = 0\n    }\n    const cols = `\n    [left] ${leftWidth}px\n    [left-resize] 2px\n    [center] auto\n    [right-resize] 2px\n    [right] ${rightWidth}px\n    `\n    const style = {gridTemplateColumns:cols}\n    return <div className={clss} style={style}>{props.children}</div>\n};\n\nexport const Toolbar = (props) => {\n    let cls = \"toolbar\";\n    if (props.left) cls += \" left\";\n    if (props.right) cls += \" right\";\n    if (props.bottom) cls += \" bottom\";\n    if (props.top) cls += \" top\";\n    if (props.center) cls += \" center\";\n    if (props.middle) cls += \" middle\";\n    if (props.scroll) cls += \" scroll\";\n    return <div className={cls}>{props.children}</div>\n};\nexport const Panel = (props) => {\n    let cls = 'panel';\n    if (props.left) cls += \" left\";\n    if (props.right) cls += \" right\";\n    if (props.bottom) cls += \" bottom\";\n    if (props.top) cls += \" top\";\n    if (props.center) cls += \" center\";\n    if (props.middle) cls += \" middle\";\n    if (props.scroll) cls += \" scroll\";\n    if(props.transparent) cls += \" transparent\"\n    return <div className={cls}>{props.children}</div>\n};\nexport const Spacer = (props) => {\n    return <span className='spacer'/>\n};\n\nexport const ToggleButton = (props) => {\n    const {selected, ...rest} = props\n    const clss = selected?\"selected\":\"\"\n    return <button className={clss} {...rest}></button>\n}\n\nexport const MenuPopup = (props) => {\n    return <VBox className={\"popup-menu\"}>\n        {props.actions.map((act,i)=>{\n            if(act.divider) return <div className=\"divider\" key={i}></div>\n            return <button  key={i} onClick={()=>{\n                PopupManager.hide();\n                if(act.fun) act.fun()\n            }}><i className={'fa fa-' + act.icon}/> {act.title}</button>\n        })}\n    </VBox>\n\n}\n\nexport default class GridEditorApp extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            showLeft: true,\n            showRight: true,\n            leftWidth:250,\n            rightWidth:250,\n            dragSide:'none'\n        }\n    }\n    toggleLeftPane = (e) => this.setState({showLeft: !this.state.showLeft})\n    toggleRightPane = (e) => this.setState({showRight: !this.state.showRight})\n    onMouseDownLeft = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.setState({dragSide:'left'})\n        window.addEventListener('mousemove',this.onMouseMove)\n        window.addEventListener('mouseup',this.onMouseUp)\n    }\n    onMouseDownRight = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.setState({dragSide:'right'})\n        window.addEventListener('mousemove',this.onMouseMove)\n        window.addEventListener('mouseup',this.onMouseUp)\n    }\n    onMouseMove = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        const cursor = makePoint(e.clientX, e.clientY)\n        if(this.state.dragSide === 'left')  this.setState({leftWidth:cursor.x})\n        if(this.state.dragSide === 'right') this.setState({rightWidth:window.innerWidth-cursor.x})\n    }\n    onMouseUp = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        window.removeEventListener('mousemove', this.onMouseMove)\n        window.removeEventListener('mouseup', this.onMouseUp)\n    }\n    render() {\n        return <GridLayout showLeft={this.state.showLeft}\n                           showRight={this.state.showRight}\n                           leftWidth={this.state.leftWidth}\n                           rightWidth={this.state.rightWidth}\n        >\n            <Toolbar center bottom>\n                <button className={'fa' + (this.state.showLeft ? ' fa-caret-left' : ' fa-caret-right')}\n                        onClick={this.toggleLeftPane}/>\n                <Spacer/>\n                {this.props.bottomText}\n                <Spacer/>\n                <button className={'fa' + (this.state.showRight ? ' fa-caret-right' : ' fa-caret-left')}\n                        onClick={this.toggleRightPane}/>\n            </Toolbar>\n\n            <div className={'left-resize'}  onMouseDown={this.onMouseDownLeft}/>\n            <div className={'right-resize'} onMouseDown={this.onMouseDownRight}/>\n\n            {this.props.children}\n        </GridLayout>\n    }\n}\n","\n\nexport const SELECTION_MANAGER = {\n    CHANGED:'CHANGED',\n    DROP_TARGET_CHANGED:'DROP_TARGET'\n}\n\nclass SelectionManager {\n    constructor(props) {\n        this.listeners = {};\n        this.selected = [];\n        this.dropTarget = null;\n        this.clip = null\n    }\n    on(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].push(cb);\n    }\n    off(type,cb) {\n        const index = this.listeners[type].indexOf(cb)\n        if(index>=0) this.listeners[type].splice(index,1)\n    }\n    fire(type, value) {\n        if(!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].forEach((cb) => cb(value));\n    }\n    setSelection(node) {\n        this.selected = [node]\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    addToSelection(node) {\n        this.selected.push(node)\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    clearSelection() {\n        this.selected = []\n        this.fire(SELECTION_MANAGER.CHANGED,this)\n    }\n    isSelected(node) {\n        return (this.selected.indexOf(node) >= 0)\n    }\n    getSelection() {\n        if(this.selected.length === 0) return null;\n        return this.selected[0];\n    }\n    isEmpty() {\n        return this.selected.length === 0\n    }\n    getFullSelection() {\n        return this.selected\n    }\n    setDropTarget(node) {\n        if(this.dropTarget !== node) {\n            this.dropTarget = node;\n            this.fire(SELECTION_MANAGER.DROP_TARGET_CHANGED, this.dropTarget)\n        }\n    }\n    getDropTarget() {\n        return this.dropTarget\n    }\n    setDropType(type) {\n        this.dropType = type\n    }\n    getDropType() {\n        return this.dropType\n    }\n\n    setClipboard(clip) {\n        this.clip = clip\n    }\n    getClipboard() {\n        return this.clip\n    }\n}\n\nexport default new SelectionManager();\n","import React, { Component } from 'react'\nimport {makePoint} from \"../utils\"\nimport hsluv from 'hsluv'\nimport {PopupManager} from \"appy-comps\"\n\nexport default class HSLUVColorPicker extends Component {\n    constructor(props) {\n        super(props)\n\n        const comps = hsluv.hexToHsluv(props.value)\n        this.state = {\n            hue:comps[0],\n            lightness:comps[1],\n            value:comps[2],\n        }\n        console.log(\"the current value is\",props.value, hsluv.hexToHsluv(props.value))\n    }\n    componentDidMount() {\n        this.redraw();\n    }\n    canvasToPoint(e) {\n        const canvasBounds = this.canvas.getBoundingClientRect()\n        const pt = makePoint(e.clientX, e.clientY).minus(makePoint(canvasBounds.x,canvasBounds.y))\n        const h = this.canvas.height;\n        const w = this.canvas.width;\n        const f = makePoint(pt.x/w*100, pt.y/h*100)\n        return f;\n    }\n    mousePress = (e) => {\n        const pt = this.canvasToPoint(e)\n        this.setState({lightness:pt.x, value:pt.y})\n        this.redraw()\n        this.pressed = true;\n    }\n    mouseMove = (e) => {\n        if(!this.pressed) return\n        const pt = this.canvasToPoint(e)\n        this.setState({lightness:pt.x, value:pt.y})\n        this.redraw()\n    }\n    mouseUp = (e) => {\n        this.pressed = false\n        this.redraw()\n    }\n    redraw = () => {\n        this.drawPicker()\n        this.drawSlider()\n        this.drawIndicator()\n    }\n    drawPicker() {\n        const canvas = this.canvas\n        if(!canvas) return\n        const c = this.canvas.getContext('2d')\n        let w = 100\n        let h = 100\n        const hue = Math.floor(this.state.hue)\n        for(let i=0; i<=4; i++) {\n            for(let j=0; j<=4; j++) {\n                let color = hsluv.hsluvToHex([hue,i*25,j*25])\n                if(color.length > 7) color = '#000000'\n                c.fillStyle = color\n                c.fillRect(i*20,j*20,20,20)\n            }\n        }\n        const g = 20\n        const cp = this.livalToCanvas(this.state.lightness, this.state.value)\n        c.strokeStyle = 'white'\n        c.strokeRect(Math.floor(cp.x/g)*g, Math.floor(cp.y/g)*g,g,g)\n        c.strokeStyle = 'black'\n        c.strokeRect(Math.floor(cp.x/g)*g+1, Math.floor(cp.y/g)*g+1,g-2,g-2)\n\n        c.strokeStyle = 'black';\n        c.lineWidth = 1.0\n        c.strokeRect(0,0,w,h)\n    }\n\n    livalToCanvas = (l,v) => {\n        return makePoint(l/100*100,v/100*100)\n    }\n\n    mouseToCanvas = (e) => {\n        const bounds = e.target.getBoundingClientRect()\n        return makePoint(e.clientX, e.clientY).minus(makePoint(bounds.x,bounds.y))\n    }\n\n    canvasToHue(pt) {\n        return Math.floor(pt.x/this.slider.width*360);\n    }\n    hueToCanvas(hue) {\n        return hue/360*this.slider.width\n    }\n    mousePressSlider = (e) => {\n        this.sliderPressed = true\n        const pt = this.mouseToCanvas(e)\n        const hue = this.canvasToHue(pt)\n        this.setState({hue:hue})\n        setTimeout(this.redraw,100)\n    }\n    mouseMoveSlider = (e) => {\n        if(!this.sliderPressed) return\n        const pt = this.mouseToCanvas(e)\n        const hue = this.canvasToHue(pt)\n        this.setState({hue:hue})\n        setTimeout(this.redraw,100)\n    }\n    mouseUpSlider = () => {\n        this.sliderPressed = false\n    }\n    drawSlider() {\n        const g = 10\n        const c = this.slider.getContext('2d')\n        const w = this.slider.width\n        const h = this.slider.height\n        c.fillStyle = 'red';\n        c.fillRect(0,0,w,h)\n        for(let x=0; x<w; x+=g) {\n            let hue = this.canvasToHue(makePoint(x,0))\n            let color = hsluv.hsluvToHex([hue,100,50])\n            if(color.length > 7) color = '#000000'\n            c.fillStyle = color\n            c.fillRect(x,0,g,h)\n        }\n        c.strokeStyle = 'black'\n        c.lineWidth = 1.0\n        const x = Math.floor(this.hueToCanvas(this.state.hue)/g)*g\n        c.strokeRect(x,0,g,h)\n        c.strokeRect(0,0,w,h)\n    }\n\n    drawIndicator() {\n        const c = this.indicator.getContext('2d')\n        const w = this.indicator.width\n        const h = this.indicator.height\n        let color = hsluv.hsluvToHex([Math.floor(this.state.hue),Math.floor(this.state.lightness),Math.floor(this.state.value)])\n        if(color.length > 7) color = '#000000'\n        c.fillStyle = color\n        c.fillRect(0,0,w,h)\n        c.strokeStyle = 'black'\n        c.lineWidth = 1.0\n        c.strokeRect(0,0,w,h)\n    }\n\n    close = () => {\n        let color = hsluv.hsluvToHex([Math.floor(this.state.hue),Math.floor(this.state.lightness),Math.floor(this.state.value)])\n        if(color.length > 7) color = '#000000'\n        this.props.onSelect(color)\n        PopupManager.hide()\n    }\n\n    render() {\n        return <div style={{\n            display:'flex',\n            flexDirection:'column',\n            alignItems:'center'\n        }}>\n            <canvas\n                ref={(can)=>this.canvas = can}\n                width={100} height={100}\n                onMouseDown={this.mousePress}\n                onMouseMove={this.mouseMove}\n                onMouseUp={this.mouseUp}\n            />\n            <canvas\n                ref={(can)=>this.slider = can}\n                width={100} height={30}\n                onMouseDown={this.mousePressSlider}\n                onMouseMove={this.mouseMoveSlider}\n                onMouseUp={this.mouseUpSlider}\n            />\n            <canvas\n                ref={(can)=>this.indicator = can}\n                width={32} height={32}\n                onClick={this.close}\n            />\n        </div>\n    }\n}","import {} from '../TreeItemProvider'\nimport {getLoginURL} from '../TreeItemProvider'\nimport {getInfoURL} from '../TreeItemProvider'\n\nexport const USER_CHANGE = 'USER_CHANGE'\nclass AuthModuleSingleton {\n    constructor() {\n        this.listeners = {}\n        this.supported = false\n        this.doclistSupported = false\n        this.docDeleteSupported = false\n        this.assetUploadSupported = false\n        this.scriptEditingSupported = false\n    }\n    on(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n    }\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n    init() {\n        if(this.isLoggedIn()) this.doclistSupported = true\n        fetch(getInfoURL()).then(res => res.json())\n            .then(info => {\n                console.log(\"got the info\",info)\n                if(info.authentication === true) {\n                    this.supported = true\n                }\n                if(info.assetUpload === true) {\n                    this.assetUploadSupported = true\n                }\n                if(info.scriptEditing === true)  this.scriptEditingSupported = true\n                if(info.docDeleteSupported === true) this.docDeleteSupported = true\n\n                this.fire(USER_CHANGE)\n            })\n    }\n\n    isLoggedIn() {\n        if(localStorage.getItem('access-token')) return true\n        return false\n    }\n    supportsAuth() {\n        return this.supported\n    }\n    supportsDocList() {\n        return this.doclistSupported\n    }\n    supportsAssetUpload() {\n        return this.assetUploadSupported\n    }\n    supportsScriptEdit() {\n        return this.scriptEditingSupported\n    }\n    supportsDocDelete() {\n        return this.docDeleteSupported\n    }\n\n    login = () => {\n        console.log(\"getting\",getLoginURL())\n        fetch(`${getLoginURL()}`)\n            .then((res)=>res.json())\n            .then((res)=>{\n                this.win = window.open(res.url,'_blank')\n                window.addEventListener('message',this.authCallback)\n                if(this.win) this.win.focus()\n            })\n    }\n    logout = () => {\n        localStorage.clear()\n        this.doclistSupported = false\n        this.fire(USER_CHANGE)\n    }\n    authCallback = (msg) => {\n        console.log(\"got an event from the external window\",msg)\n        console.log(\"origin = \", msg.origin)\n        if(!msg.origin === 'http://localhost:39176') {\n            console.log(\"message is not from the expected origin. what do we do?\")\n        }\n        console.log(\"data is\",msg.data.payload)\n        console.log(\"hello user\", msg.data.payload.id)\n        console.log(\"your access token is\",msg.data.payload.accessToken)\n        this.setUserData(msg.data.payload)\n        //close the window\n        this.win.close()\n        window.removeEventListener('message',this.authCallback)\n        this.doclistSupported = true\n        this.fire(USER_CHANGE)\n    }\n    setUserData(data) {\n        localStorage.setItem('access-token',data.accessToken)\n    }\n    getAccessToken() {\n        return localStorage.getItem('access-token')\n    }\n\n    getUsername() {\n        return this.getAccessToken()\n    }\n\n\n}\n\nexport const AuthModule = new AuthModuleSingleton()\n","import {GET_JSON, POST_JSON, setQuery} from './utils'\nimport Selection from './SelectionManager'\nimport {AuthModule} from './vr/AuthModule'\n\nexport const TREE_ITEM_PROVIDER = {\n    EXPANDED_CHANGED:'EXPANDED_CHANGED',\n    STRUCTURE_CHANGED:'STRUCTURE_CHANGED',\n    STRUCTURE_ADDED:'STRUCTURE_ADDED',\n    STRUCTURE_REMOVED:'STRUCTURE_REMOVED',\n    PROPERTY_CHANGED:'PROPERTY_CHANGED',\n    CLEAR_DIRTY:'CLEAR_DIRTY',\n    SAVED:'SAVED',\n    DOCUMENT_SWAPPED:'DOCUMENT_SWAPPED',\n}\n\nconst URLS = {\n    BASE:'https://vr.josh.earth/generaled/api/'\n    // BASE:'http://localhost:8734/'\n}\nexport function getDocsURL() {\n    return URLS.BASE + 'doc/'\n}\nexport function getAssetsURL() {\n    return URLS.BASE + 'asset/'\n}\nexport function getScriptsURL() {\n    return URLS.BASE + 'scripts/'\n}\nexport function getLoginURL() {\n    return URLS.BASE + 'auth/github/login'\n}\nexport function getInfoURL() {\n    return URLS.BASE +'info'\n}\n\n// export const SERVER_URL = \"http://localhost:30065/doc/\"\n// export const SERVER_URL_ASSETS = \"http://localhost:30065/asset/\"\n// export const SERVER_URL = \"http://localhost:55555/doc/\"\n// export const SERVER_URL = \"https://vr.josh.earth/generaled/api/doc/\"\n// export const BASE_URL = \"http://localhost:55555/\"\n// export const BASE_URL = \"https://vr.josh.earth:55555/\"\n// export const SERVER_URL_ASSETS = \"http://localhost:55555/asset/\"\n// export const SERVER_URL_ASSETS = \"https://vr.josh.earth/generaled/api/asset/\"\n// export const SERVER_URL_ASSETS = \"http://josh.earth:30068/asset/\"\n// export const LOGIN_URL = \"http://localhost:55555/auth/github/login\"\n// export const LOGIN_URL = \"https://vr.josh.earth/generaled/api/auth/github/login\"\n\nclass TreeItemProviderInterface {\n    /** register a listener */\n    on(type, cb) {\n        throw new Error(`interface 'on' not implemented`)\n    }\n\n    /** un-register a listener */\n    off(type, cb) {\n        throw  new Error(\"interface 'off' not implemented\")\n    }\n\n    /** fire an event. internal use */\n    fire(type, value) {\n        throw  new Error(\"interface 'fire' not implemented\")\n    }\n\n    // ============== tree interface\n    /** returns the root of the tree structure */\n    getSceneRoot() {\n        throw new Error(\"interface 'getSceneRoot' not implemented\")\n    }\n    /** delete child node */\n    deleteChild(child) { throw new Error(\"deleteChild not implemented yet\")}\n    /** append child to the parent */\n    appendChild(parent,child) { throw new Error(\"appendChild not implemented yet\")}\n    /** insert child node before a particular other node */\n    insertNodeBefore(node,sibling) { throw new Error(\"insertNodeBefore() not implemented yet\")}\n    /** find a given node by ID */\n    findNodeById(id) { throw new Error(\"findNodeById() not implemented yet\")}\n    /** find the parent of the given node */\n    findParent(node) { throw new Error(\"findParent() not implemented yet\")}\n    /** return true if the given node has children */\n    hasChildren(node) { throw new Error(\"hasChildren() not implemented yet\")}\n    /** returns an array of children for the parent node */\n    getChildren(node) { throw new Error(\"getChildren() not implemented yet\")}\n\n    // ========= Tree View support =========\n\n    /** returns true if item is expanded */\n    isExpanded(item) {\n        throw  new Error(\"interface 'isExpanded' not implemented\")\n    }\n\n    /** return a react component for the context menu of the item in the tree view */\n    calculateContextMenu(item) {\n        throw new Error(\"calculateContextMenu() not implemented yet\")\n    }\n    /** toggles the collapsed state of the item */\n    toggleItemCollapsed(item) {\n        throw new Error(\"toggleItemCollapsed() not implemented yet\")\n    }\n    /** returns a react component to display the item in the tree view */\n    getRendererForItem(item) {\n        throw new Error(\"getRendererForItem() not implemented yet\")\n    }\n\n\n\n    // ================ properties ==================\n    /** set the property value using a prop def */\n    setPropertyValue(item, def, value) {\n        throw new Error(\"interface setPropertyValue not implemented\")\n    }\n    setPropertyValueByName(child,name,value) { throw new Error(`interface 'setPropertyValueByName() not implemented'`)}\n    /** return an array of property definitions for the specified tree item */\n    getProperties(item) { throw new Error(`interface 'getProperties()' not implemented`) }\n\n\n    // ================ doc def stuff\n    getDocId() {  throw new Error(\"getDocId() not implemented\")  }\n    getDocType() {  throw new Error(\"getDocType() not implemented\")  }\n    getApp() { throw new Error(\"getApp() not implemented\")  }\n    getTitle() { throw new Error(\"getTitle() not implemented\") }\n}\n\nexport default class TreeItemProvider extends TreeItemProviderInterface {\n    constructor(options) {\n        super()\n        this.listeners = {};\n        this.expanded_map = {};\n        this.docid = null\n        // URLS.BASE = SERVER_URL\n        if(options.SERVER_URL) {\n            URLS.BASE = `https://${options.SERVER_URL}/`\n        }\n        console.log(\"using server\",URLS.BASE)\n        AuthModule.init()\n    }\n\n    on(type, cb) {\n        if (!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].push(cb);\n    }\n\n    fire(type, value) {\n        if (!this.listeners[type]) this.listeners[type] = [];\n        this.listeners[type].forEach((cb) => cb(value));\n    }\n\n    off(type, cb) {\n        if (this.listeners[type]) this.listeners[type] = this.listeners[type].filter(list => list !== cb)\n    }\n\n    isExpanded(item) {\n        if (!item.id) item.id = \"\" + Math.random();\n        if (typeof this.expanded_map[item.id] === 'undefined') this.expanded_map[item.id] = true;\n        return this.expanded_map[item.id];\n    }\n    toggleItemCollapsed(item) {\n        const current = this.isExpanded(item);\n        this.expanded_map[item.id] = !current;\n        this.fire(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,item);\n    }\n\n\n    setPropertyValue(item, def, value) {\n        throw new Error(\"subclass of TreeItemProvider must implement setPropertyValue\")\n    }\n\n    genID = (prefix) => {\n        return `${prefix}_${Math.floor(Math.random() * 1000*1000*1000)}`\n    }\n\n    setDocument(doc, docid) {\n        this.root = doc\n        this.docid = docid\n        this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, {\n            provider:this\n        });\n    }\n\n    getDocId() {\n        return this.docid\n    }\n\n    save = () => {\n        console.info(\"saving\",this.getSceneRoot())\n        const payload_obj = {\n            doc:this.getSceneRoot(),\n            type:this.getDocType(),\n            id:this.getDocId()\n        }\n        const payload_string = JSON.stringify(payload_obj,(key,value)=>{\n            if(key === 'parent') return undefined\n            return value\n        })\n        console.info(\"doc is\",payload_string)\n        return POST_JSON(getDocsURL()+this.docid,payload_string).then((res)=>{\n            console.log(\"Success result is\",res)\n            setQuery({mode:'edit',doc:this.docid, doctype:this.getDocType()})\n            this.fire(TREE_ITEM_PROVIDER.SAVED,true)\n        }).catch((e)=> console.log(\"error\",e))\n    }\n    loadDoc(docid) {\n        console.log(\"need to load the doc\",docid)\n        GET_JSON(getDocsURL()+docid).then((payload)=>{\n            console.log(\"got the doc\",payload)\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            this.setDocument(payload.doc,payload.id)\n        }).catch((e)=>{\n            console.warn(\"missing doc\",e)\n            this.setDocument(this.makeEmptyRoot(),this.genID('doc'))\n            setQuery({mode:'edit',doc:this.docid, doctype:this.getDocType()})\n        })\n    }\n    reloadDocument() {\n        const spath = this.generateSelectionPath(Selection.getSelection());\n        console.log(\"got the path\",spath)\n        GET_JSON(getDocsURL()+this.docid).then((payload)=>{\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            this.setDocument(payload.doc,payload.id)\n            this.fire(TREE_ITEM_PROVIDER.CLEAR_DIRTY,true)\n            const newsel = this.findNodeFromSelectionPath(this.getSceneRoot(),spath)\n            console.log(\"set new selection to \", newsel)\n            Selection.setSelection(newsel)\n        }).catch((e)=>{\n            console.warn(\"couldn't reload the doc\",e)\n        })\n\n    }\n\n    /* required functions for subclasses */\n\n    generateSelectionPath() {\n        throw new Error(\"generateSelectionPath not implemented\")\n    }\n    findNodeFromSelectionPath() {\n        throw new Error(\"findNodeFromSelectionPath not implemented\")\n    }\n    makeEmptyRoot() {\n        throw new Error(\"makeEmptyRoot() not implemented\")\n    }\n\n    getSceneRoot() {\n        return this.root;\n    }\n\n    uploadFile(file) {\n        return new Promise((res,rej)=>{\n            const fd = new FormData()\n            fd.append('file',file)\n            console.info(\"filesize is\",file.size, file.name);\n            const xml = new XMLHttpRequest()\n            xml.onreadystatechange = () => console.log(`ready state = ${xml.readyState} status ${xml.status}`)\n            xml.addEventListener('progress',(e)=>console.log(`progress`))\n            xml.addEventListener('load',(e)=> res(xml.response))\n            xml.addEventListener('error',(e)=>console.log(`error`))\n            xml.addEventListener('abort',(e)=>console.log(`abort`))\n            const url = getAssetsURL()+file.name;\n            console.info(\"uploading to \", url)\n            xml.responseType = 'json'\n            xml.open('POST',url)\n            xml.setRequestHeader('access-key',AuthModule.getAccessToken())\n            xml.send(file)\n        })\n    }\n\n\n    hasChildren = (item) => item && item.children && item.children.length\n    getChildren = (item) => item.children\n\n}\n","import React, {Component} from \"react\";\n\nexport class StringEditor extends Component {\n    keypressed = (e) => {\n        if(e.charCode === 13) this.props.onCommit();\n    }\n\n    render() {\n        const prop = this.props.def;\n        if (prop.hasHints()) {\n            const hints = prop.getHints()\n            if (hints.multiline) {\n                return <textarea value={this.props.value}\n                                 onChange={this.props.onChange}\n                                 onBlur={this.props.onBlur}\n                />\n            }\n        }\n        return <input type='string'\n                      value={this.props.value}\n                      onChange={this.props.onChange}\n                      onKeyPress={this.keypressed}\n                      onBlur={this.props.onBlur}\n        />\n    }\n}","import React, {Component} from \"react\";\nimport {HBox, PopupManager, VBox} from \"appy-comps\";\n\nconst EnumPicker = (props) => {\n    const Rend = props.renderer\n    const items = props.values.map(val=>\n        <HBox\n            key={val}\n            onClick={(e)=>props.onSelect(val)}>\n            <Rend value={val} def={props.def} obj={props.obj} provider={props.provider}/>\n        </HBox>\n    )\n    return <VBox className=\"popup-menu\">{items}</VBox>\n}\n\nconst DefaultEnumRenderer = (props) => {\n    let value = \"\"\n    if(typeof props.value !== 'undefined' && props.value !== null) {\n        value = props.value.toString()\n    }\n    return <span>{value}</span>\n}\n\nexport class EnumEditor extends Component {\n    calculateRenderer() {\n        const proxy = this.props.def\n        const obj = this.props.obj\n        if (!this.props.provider.getRendererForEnum) return DefaultEnumRenderer\n        const renderer = this.props.provider.getRendererForEnum(proxy.getKey(), obj)\n        if (!renderer) return DefaultEnumRenderer\n        return renderer\n    }\n\n    calculateValues() {\n        const vals = this.props.provider.getValuesForEnum(this.props.def.getKey(), this.props.obj, this.props.def)\n        if (!vals) {\n            console.log(`no values for enum ${this.props.def.getKey()}`);\n            return []\n        }\n        return vals\n    }\n\n    open = (e) => {\n        PopupManager.show(<EnumPicker\n            values={this.calculateValues()}\n            renderer={this.calculateRenderer()}\n            onSelect={this.selectValue}\n            provider={this.props.provider}\n        />, e.target)\n    }\n    selectValue = (value) => {\n        PopupManager.hide()\n        this.props.onChange(value)\n    }\n    renderValue = (value) => {\n        const def = this.props.def\n        const obj = this.props.obj\n        const Rend = this.calculateRenderer()\n        return <Rend value={value} def={def} obj={obj} provider={this.props.provider}/>\n    }\n\n    render() {\n        return <button onClick={this.open}>{this.renderValue(this.props.value)}</button>\n    }\n}","import React, {Component} from \"react\";\nimport {VBox} from \"appy-comps\";\nimport {EnumEditor} from \"./EnumEditor\";\n\nconst DefaultEnumRenderer = (props) => {\n    let value = \"\"\n    if(typeof props.value !== 'undefined') {\n        value = props.value.toString()\n    }\n    return <span>{value}</span>\n}\n\nexport class ArrayEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            showEditor: false,\n            value: \"\"\n        }\n\n    }\n\n    calculateRenderer() {\n        const def = this.props.def\n        const obj = this.props.obj\n        if (!this.props.provider.getRendererForEnum) return DefaultEnumRenderer\n        const renderer = this.props.provider.getRendererForEnum(def.key, obj)\n        if (!renderer) return DefaultEnumRenderer\n        return renderer\n    }\n\n    addValue = () => {\n        this.setState({showEditor: true})\n    }\n    enumChanged = (value) => {\n        const arr = this.props.value.slice();\n        arr.push(value)\n        this.props.onChange(arr)\n    }\n\n    render() {\n        // const def = this.props.def\n        // const obj = this.props.obj\n        let value = this.props.value\n        if (!value) value = []\n        return <div>\n            {this.renderValues()}\n            <button onClick={this.addValue} className=\"fa fa-plus\"/>\n            {this.renderEditor()}\n        </div>\n    }\n\n    deleteItem(val) {\n        let arr = this.props.value.slice()\n        arr = arr.filter((v) => v !== val)\n        this.props.onChange(arr)\n    }\n\n    renderValues() {\n        const Renderer = this.calculateRenderer()\n        return <VBox>{this.props.value.map((val, i) => {\n            return <div key={i}>\n                <button className=\"fa fa-minus\" onClick={() => this.deleteItem(val)}/>\n                <Renderer value={val} provider={this.props.provider}/>\n            </div>\n        })}</VBox>\n    }\n\n    renderEditor() {\n        if (!this.state.showEditor) return \"\"\n        const def = this.props.def\n        const obj = this.props.obj\n        return <EnumEditor value={this.state.value}\n                           onChange={this.enumChanged}\n                           def={def}\n                           obj={obj}\n                           provider={this.props.provider}/>\n\n    }\n}\n","import React, {Component} from 'react';\nimport {PopupManager} from 'appy-comps'\n\nimport selMan, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport HSLUVColorPicker from \"./HSLUVColorPicker\";\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {StringEditor} from \"./StringEditor\";\nimport {EnumEditor} from \"./EnumEditor\";\nimport {ArrayEditor} from \"./ArrayEditor\";\n\nexport const TYPES = {\n    STRING:'string',\n    NUMBER:'number',\n    BOOLEAN:'boolean',\n    ENUM:'enum',\n    COLOR:'color',\n    GROUP:'group',\n}\n\nclass PropEditor extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            value:props.def.getValue()\n        }\n    }\n    componentWillReceiveProps(nextProps) {\n        if(this.props.def !== nextProps.def) {\n            this.setState({value:nextProps.def.getValue()})\n        }\n    }\n    shouldComponentUpdate(nextProps, nextState) {\n        if(nextProps.def.getType() === 'group') return true\n        if(this.state.value !== nextState.value) return true\n        if(this.props.def.getKey() === nextProps.def.getKey()) {\n            if(this.props.def.getValue() === nextProps.def.getValue()) {\n                return false\n            }\n        }\n        return true\n    }\n    changed = (e) => {\n        if(this.props.def.isType(TYPES.STRING)) {\n            this.setState({value:e.target.value})\n            if(this.props.def.isLive()) {\n                this.props.def.setValue(e.target.value)\n            }\n        }\n        if(this.props.def.isType(TYPES.NUMBER)) this.updateNum(e.target.value)\n        if(this.props.def.isType(TYPES.BOOLEAN)) this.setState({value:e.target.checked})\n    }\n    customChanged = value => {\n        if(this.props.def.isType(TYPES.COLOR)) return this.colorChanged(value)\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    keypressed = (e) => {\n        if(e.charCode === 13) this.commit();\n    }\n    updateNum = (v) => {\n        const def = this.props.def;\n        if(def.hasHints()) {\n            if(def.getHints().hasOwnProperty('min')) {\n                if(v < def.getHints().min) v = def.getHints().min\n            }\n            if(def.getHints().hasOwnProperty('max')) {\n                if (v > def.getHints().max) v = def.getHints().max\n            }\n        }\n        this.setState({value:v})\n        if(!isNaN(parseFloat(v))) {\n            def.setValue(parseFloat(v))\n        }\n    }\n    numberKeyDown = (e) => {\n        if(e.key === 'ArrowUp' && e.shiftKey) {\n            e.preventDefault()\n            this.updateNum(this.state.value+10)\n        }\n        if(e.key === 'ArrowDown' && e.shiftKey) {\n            e.preventDefault()\n            this.updateNum(this.state.value-10)\n        }\n    }\n    booleanChanged = (e) => {\n        this.setState({value:e.target.checked});\n        this.props.def.setValue(e.target.checked)\n    }\n    enumChanged = (value) => {\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    arrayChanged = (value) => {\n        this.setState({value:value})\n        this.props.def.setValue(value)\n    }\n    colorChanged = (color) => {\n        this.setState({value:color});\n        this.props.def.setValue(color)\n    }\n    commit = () => {\n        this.props.def.setValue(this.state.value)\n    }\n    openColorEditor = (e) => {\n        PopupManager.show(<HSLUVColorPicker onSelect={this.colorChanged} value={this.state.value}/>, e.target)\n    }\n    render() {\n        const prop = this.props.def;\n        const obj = selMan.getSelection();\n        const provider = this.props.provider\n        if (prop.isCustom()) return this.props.provider.createCustomEditor(this.props.item, prop, provider, this.state.value, this.customChanged)\n        if (prop.isLocked()) return <i>{prop.getValue()}</i>\n        if (prop.isType(TYPES.STRING))  return <StringEditor value={this.state.value}\n                                 onChange={this.changed}\n                                 onBlur={this.commit} onCommit={this.commit}\n                                 def={prop} obj={obj}\n                                 provider={this.props.provider}/>\n        if (prop.isType(TYPES.NUMBER))  {\n            let step = 1\n            if(prop.hasHints()) {\n                const hints = prop.getHints()\n                if (hints.incrementValue) {\n                    step = hints.incrementValue\n                }\n            }\n            return <input type='number'\n                          value={this.state.value}\n                          onChange={this.changed}\n                          onKeyPress={this.keypressed}\n                          onKeyDown={this.numberKeyDown}\n                          onBlur={this.commit}\n                          step={step}/>\n        }\n        if (prop.isType(TYPES.BOOLEAN)) return <input type='checkbox'\n                                                  checked={this.state.value}\n                                                  onChange={this.booleanChanged}/>\n        if (prop.isType(TYPES.ENUM)) return <EnumEditor value={this.state.value} onChange={this.enumChanged} def={prop} obj={obj} provider={this.props.provider}/>\n        if (prop.isType(TYPES.COLOR)) return <button style={{ backgroundColor:this.state.value}} onClick={this.openColorEditor}>{this.state.value}</button>\n        if (prop.isType('array')) return <ArrayEditor value={this.state.value} onChange={this.arrayChanged} def={prop} obj={obj} provider={this.props.provider}/>\n        return <b>{prop.getType()}:{prop.getValue()}</b>\n    }\n}\n\n/*class PaletteColorPicker extends Component {\n    chooseColor(c) {\n        this.props.onSelect(c);\n    }\n    render() {\n        const style = {\n            display:'flex',\n            flexDirection:'row',\n            flexWrap:'wrap'\n        }\n        return <div style={style}>\n            {Object.keys(COLORS2).map((key,i) => {\n                let color = COLORS2[key];\n                let scolor = color.toString(16);\n                while(scolor.length < 6) scolor = \"0\"+scolor\n                scolor = '#' +scolor\n                let style = {\n                    backgroundColor:scolor,\n                    color:'red'\n                }\n                return <button key={key}\n                               style={style}\n                               onClick={this.chooseColor.bind(this, scolor)}\n                >&nbsp;</button>\n            })}\n        </div>\n    }\n}\n*/\nexport default class PropSheet extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            selection:null\n        }\n    }\n    componentDidMount() {\n        this.h2 = () => this.setState({selection:selMan.getSelection()})\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.h2)\n        this.hand = (s) => this.setState({selection:selMan.getSelection()})\n        selMan.on(SELECTION_MANAGER.CHANGED, this.hand)\n    }\n    componentWillUnmount() {\n        selMan.off(SELECTION_MANAGER.CHANGED, this.hand);\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.h2)\n    }\n    render() {\n        const props = this.calculateGroups(this.calculateProps())\n        const item = selMan.getSelection()\n        return <ul className=\"prop-sheet\">{props.map((prop, i) => {\n            return [\n                <label key={prop.getKey()+'-label'}>{prop.getName()}</label>,\n                this.renderIndeterminate(prop,i),\n                <PropEditor key={prop.getKey()+'-editor'} def={prop} provider={this.props.provider} item={item}/>\n            ]\n        })}</ul>\n    }\n    renderIndeterminate(prop, i) {\n        if(prop.isIndeterminate()) {\n            return <i key={prop.getKey()+'-indeterminate'} className=\"icon fa fa-exclamation-circle\"/>\n        } else {\n            return \"\"\n        }\n    }\n    calculateProps() {\n        const items = selMan.getFullSelection()\n        const first = items[0]\n        const prov = this.props.provider\n        let props = prov.getProperties(first)\n        items.forEach((item)=>{\n            props = calculateIntersection(props, prov.getProperties(item))\n        })\n        return props.map((prop)=>{\n            const multi = new MultiPropProxy(prov, prop.key)\n            items.forEach((item)=>{\n                const p2 = prov.getProperties(item)\n                const match = p2.find(def=>def.key === prop.key)\n                multi.addSubProxy(new PropProxy(prov,item,match))\n            })\n            return multi\n        });\n    }\n\n    calculateGroups(props) {\n        const group_defs = props.filter(p => p.getType() === TYPES.GROUP)\n        group_defs.forEach(def => {\n            const group_keys = def.getGroupKeys()\n            //remove any groups in the group keys of a group def\n            props = props.filter(p => group_keys.indexOf(p.getKey())<0)\n        })\n        return props\n    }\n}\n\n//return items from A that are also in B\nfunction calculateIntersection(A,B) {\n    return  A.filter((pa)=> B.find((pb)=>pa.key===pb.key))\n}\n\n\nclass MultiPropProxy {\n    constructor(provider,key) {\n        this.provider = provider\n        this.key = key\n        this.subs = []\n    }\n    addSubProxy(sub) {\n        this.subs.push(sub)\n    }\n    first() {\n        return this.subs[0]\n    }\n    getName()  { return this.first().getName()  }\n    getValue() { return this.first().getValue() }\n    isCustom() { return this.first().isCustom() }\n    hasHints() { return this.first().hasHints() }\n    getHints() { return this.first().getHints() }\n    isLocked() { return this.first().isLocked() }\n    getType()  { return this.first().getType()  }\n    isType(s)  { return this.first().isType(s)  }\n    isLive()   { return this.first().isLive()   }\n    getKey()   { return this.key                }\n    getGroupKeys() { return this.first().getGroupKeys() }\n    setValue(v) {\n        this.subs.forEach((s)=> s.setValue(v))\n    }\n    isIndeterminate() {\n        let same = true\n        let value = this.first().getValue()\n        this.subs.forEach((s)=>{\n            if(s.getValue() !== value) same = false\n        })\n        return !same;\n    }\n}\n\n\nclass PropProxy {\n    constructor(provider, item, def) {\n        this.provider = provider\n        this.item = item\n        this.def = def\n    }\n    getKey() {\n        return this.def.key\n    }\n    getName() {\n        return this.def.name\n    }\n    isCustom() {\n        return this.def.custom\n    }\n    isLocked() {\n        return this.def.locked\n    }\n    getType() {\n        return this.def.type\n    }\n    getValue() {\n        return this.def.value\n    }\n    isLive() {\n        return this.def.live\n    }\n    isType(type) {\n        return this.def.type === type\n    }\n    setValue(value) {\n        return this.provider.setPropertyValue(this.item,this.def,value)\n    }\n    hasHints() {\n        return this.def.hints\n    }\n    getHints() {\n        return this.def.hints\n    }\n    getGroupKeys() {\n        return this.def.group\n    }\n    isIndeterminate() { return false; }\n}\n","export function listToArray(list) {\n    return Array.prototype.slice.call(list)\n}\nexport function createGraphObjectFromObject(graph, json) {\n    return graph.createObject(json)\n}\n\nexport function fetchGraphObject(graph, objid) {\n    const obj = {}\n    graph.getPropertiesForObject(objid).forEach(key => {\n        obj[key] = graph.getPropertyValue(objid, key)\n    })\n    obj.id = objid\n    return obj\n}\n\nexport function propToArray(doc, CH) {\n    const len = doc.getArrayLength(CH)\n    const ch = []\n    for (let i = 0; i < len; i++) {\n        ch.push(doc.getElementAt(CH, i))\n    }\n    return ch\n}\n\nexport function indexOf(graph, array, target) {\n    const arr = propToArray(graph,array)\n    return arr.findIndex(e => e === target)\n}\n\nexport function insertAsFirstChild(graph, parent, child) {\n    graph.setProperty(child.id,'parent',parent.id)\n    const ch = graph.getPropertyValue(parent.id,'children')\n    graph.insertAfter(ch,null,child.id)\n}\n\nexport function insertAsLastChild(graph, parent, child) {\n    graph.setProperty(child.id,'parent',parent.id)\n    const ch = graph.getPropertyValue(parent.id,'children')\n    const len = graph.getArrayLength(ch)\n    const prev = graph.getElementAt(ch,len-1)\n    graph.insertAfter(ch,prev,child.id)\n}\n\nexport function removeFromParent(graph, obj) {\n    const parent = fetchGraphObject(graph, obj.parent)\n    const n = indexOf(graph, parent.children, obj.id)\n    if (n >= 0) {\n        graph.removeElement(parent.children, n)\n    } else {\n        console.error(\"could not find index for child\", obj, 'in children', parent.children)\n    }\n}\n\n\nexport function cloneShape(graph,shape) {\n    const id = shape.id\n    const id2 = graph.createObject()\n    const props = graph.getPropertiesForObject(id)\n    props.forEach(key => {\n        graph.createProperty(id2,key,graph.getPropertyValue(id,key))\n    })\n    const shape2 = fetchGraphObject(graph,id2)\n    return shape2\n}\n","import React, { Component } from 'react';\nimport selMan, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider';\nimport {PopupManager, VBox} from \"appy-comps\";\nimport {fetchGraphObject, removeFromParent} from \"../syncgraph/utils\";\nimport {Spacer} from './GridEditorApp'\n\n\nconst ContextMenu = (props) => {\n    return <VBox className={\"popup-menu\"}>\n        {props.menu.map((item,i)=>{\n            if(item.divider) return <div className=\"divider\" key={i}></div>\n            return <button key={i} onClick={()=>{\n                PopupManager.hide()\n                if(item.fun) item.fun()\n            }}\n            ><i className={'fa fa-'+item.icon}/> {item.title}</button>\n        })}\n    </VBox>\n}\n\nclass TreeTableItem extends Component {\n    onSelect = (e)=>  {\n        if(e.shiftKey) {\n            selMan.addToSelection(this.props.node)\n        } else {\n            selMan.setSelection(this.props.node)\n        }\n    }\n    onContextMenu = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        if(this.props.provider.calculateContextMenu) {\n            const menu = this.props.provider.calculateContextMenu(this.props.node)\n            PopupManager.show(<ContextMenu menu={menu}/>,e.target)\n        }\n    }\n    toggleItemCollapsed = (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        this.props.provider.toggleItemCollapsed(this.props.node);\n    }\n    onDragStart = (e) => {\n        this.props.onDragStart(e,this.props.node)\n    }\n    onDragOver = (e) => {\n        this.props.onDragOver(e,this.props.node)\n    }\n    onDragEnd = (e) => {\n        this.props.onDragEnd(e,this.props.node)\n    }\n    onDrop = (e) => {\n        this.props.onDrop(e,this.props.node)\n    }\n    render() {\n        let cls = \"tree-node\";\n        const node = this.props.node\n        if (selMan.isSelected(node)) cls += \" selected\"\n        if (selMan.getDropTarget() === node) {\n            cls += \" drop-target\"\n            if(selMan.getDropType() === 'parent') cls += \" drop-parent\"\n        }\n        let arrow = \"\";\n        const prov = this.props.provider\n        if (prov.hasChildren(node)) {\n            const expanded = prov.isExpanded(node)\n            if (expanded) {\n                arrow = <button className=\"fa fa-caret-down fa-fw borderless\" onClick={this.toggleItemCollapsed}/>;\n            } else {\n                arrow = <button className=\"fa fa-caret-right fa-fw borderless\" onClick={this.toggleItemCollapsed}/>;\n            }\n        } else {\n            arrow = <span className=\"fa fa-fw borderless\"/>\n        }\n\n        return <div className={cls}\n                    onClick={this.onSelect}\n                    onContextMenu={this.onContextMenu}\n                    data-nodeid={node.id}\n                    onDragOver={this.onDragOver}\n                    onDrop={this.onDrop}\n        >\n            <span style={{\n                width:this.props.depth*1.5+'em'\n            }}></span>\n            {arrow}\n            {prov.getRendererForItem(node)}\n            <Spacer/>\n            {this.renderDragBars()}\n        </div>\n    }\n\n    renderDragBars() {\n        if(this.props.provider.canBeMoved && !this.props.provider.canBeMoved(this.props.node))  return \"\"\n        return <span className={\"drag fa fa-bars\"}\n              draggable\n              onDragStart={this.onDragStart}\n              onDragEnd={this.onDragEnd}\n        />\n\n    }\n}\n\n\n\nexport default class TreeTable extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            root:this.props.root,\n            dropTarget:null,\n            selection:null,\n            dragTarget:null,\n            internalDrag:false,\n        }\n    }\n    componentDidMount() {\n        this.listener = this.props.provider.on(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n        this.props.provider.on(TREE_ITEM_PROVIDER.STRUCTURE_ADDED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n        this.props.provider.on(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,\n            (item)=>  this.setState({root:this.props.provider.getSceneRoot()}))\n\n        this.other_listener = selMan.on(SELECTION_MANAGER.CHANGED, (sel)=> this.setState({selection:sel}))\n        selMan.on(SELECTION_MANAGER.DROP_TARGET_CHANGED, (sel) => this.setState({dropTarget:selMan.getDropTarget()}))\n    }\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.EXPANDED_CHANGED, this.listener)\n        selMan.off(SELECTION_MANAGER.CHANGED,this.other_listener)\n    }\n    componentWillReceiveProps(newProps) {\n        if(newProps.root) this.setState({root:newProps.root})\n    }\n\n    onDragStart = (e,item) => {\n        console.log('starting to drag the item',item)\n        e.dataTransfer.effectAllowed = \"move\";\n        e.dataTransfer.setData(\"text/html\", e.target.parentNode);\n        e.dataTransfer.setDragImage(e.target.parentNode, 20, 20);\n        e.dataTransfer.dropEffect = 'move'\n        this.setState({dragTarget:item, internalDrag:true})\n    }\n    onDragOver = (e,item) => {\n        if(!this.state.internalDrag) {\n            e.preventDefault()\n            if(this.props.provider.canAddExternalChild(item,e.dataTransfer)) {\n                selMan.setDropTarget(item)\n                selMan.setDropType('parent')\n            } else {\n                selMan.setDropType(null)\n                selMan.setDropTarget(null)\n            }\n            return\n        }\n        const prov = this.props.provider\n        if(prov.canAddChild(item,this.state.dragTarget)) {\n            //use the rop target as a parent\n            selMan.setDropTarget(item)\n            selMan.setDropType('parent')\n            return\n        } else if(prov.canBeSibling(item,this.state.dragTarget)) {\n            //use the drop target as a sibling\n            selMan.setDropType('sibling')\n            selMan.setDropTarget(item)\n        } else {\n            //no valid target\n            selMan.setDropType(null)\n            selMan.setDropTarget(null)\n        }\n    }\n    onDragEnd = (e,item) => {\n        //handle external case\n        if(!this.state.internalDrag){\n            this.setState({dragTarget:null, internalDrag:false})\n            e.preventDefault()\n            e.stopPropagation()\n            return\n        }\n\n        const graph = this.props.provider.getDataGraph()\n        const src = fetchGraphObject(graph,this.state.dragTarget)\n        const dst = fetchGraphObject(graph,this.state.dropTarget)\n\n\n        //can't drop onto self\n        if(dst.id === src.id) {\n            this.setState({dragTarget:null, internalDrag:false})\n            selMan.setDropTarget(null)\n            return\n        }\n\n\n        //remove from old location\n        removeFromParent(graph,src)\n\n        const dt = selMan.getDropType()\n        if(dt === 'parent') {\n            graph.setProperty(src.id,'parent',dst.id)\n            graph.insertAfter(dst.children,null,src.id)\n        } else {\n            const parent2 = fetchGraphObject(graph,dst.parent)\n            graph.setProperty(src.id, 'parent', parent2.id)\n            graph.insertAfter(parent2.children, dst.id, src.id)\n        }\n        this.setState({dragTarget:null})\n        selMan.setDropTarget(null)\n    }\n    onDrop = (e,item) => {\n        if(!this.state.internalDrag) {\n            e.stopPropagation()\n            e.preventDefault()\n            this.props.provider.acceptDrop(e,item)\n            this.setState({internalDrag:false, dragTarget:null})\n        }\n        // var data = e.dataTransfer.getData(\"text/html\");\n        // console.log('the dropped data is',data)\n    }\n    render() {\n        if(!this.state.root) return <ul>no root yet</ul>\n        const children = [];\n        this.generateChildren(this.state.root,children,0)\n        return <ul className='tree-table'>\n            {children.map((info,i)=>{\n                return <TreeTableItem key={i}\n                                      node={info.node}\n                                      depth={info.depth}\n                                      provider={this.props.provider}\n                                      selection={this.state.selection}\n                                      onDragStart={this.onDragStart}\n                                      onDragOver={this.onDragOver}\n                                      onDragEnd={this.onDragEnd}\n                                      onDrop={this.onDrop}\n                />\n            })}\n        </ul>\n    }\n\n    generateChildren = (root, chs,depth) => {\n        const prov = this.props.provider\n        chs.push({node:root, depth:depth})\n        if(!prov.hasChildren(root)) return\n        if(!prov.isExpanded(root)) return;\n        prov.getChildren(root).forEach((child)=>{\n            this.generateChildren(child,chs,depth+1)\n        })\n    }\n}\n\n","export const UNITS = {\n    PIXEL:{\n        name:'pixel',\n        matches:['pixel','pixels','px'],\n        short:'px'\n    },\n    MILLIMETER: {\n        name:'millimeter',\n        matches:['mm'],\n        short:'mm'\n    }\n}\nexport const DEFAULT_DPI = 72\n\nexport function parseDimension(str) {\n    if(str.value) str = str.value\n    // console.log(\"parsing dimension\",str)\n\n    const parts = str.trim().match(/(\\d+)\\s*x\\s*(\\d+)\\s*(px|mm)/)\n    // console.log(\"parsed parts\",parts)\n    if(parts[3] === 'px') {\n        return new Dimension(parseInt(parts[1]),parseInt(parts[2]),UNITS.PIXEL)\n    }\n    if(parts[3] === 'mm') {\n        return new Dimension(parseInt(parts[1]),parseInt(parts[2]),UNITS.MILLIMETER)\n    }\n    return new Dimension(100,100,UNITS.PIXEL)\n}\nexport class Dimension {\n    constructor(width,height,unit) {\n        this.width = width\n        this.height = height\n        this.unit = unit\n    }\n\n    as(unit, scale, dpi) {\n        if(this.unit.name === UNITS.MILLIMETER.name && unit.name===UNITS.PIXEL.name) {\n            const in_per_mm = 0.0393701\n            const px_per_in = dpi\n            return new Dimension(\n                this.width*in_per_mm*px_per_in*scale*1,  // 100mm at dpi of 76 is 76 px/in * mm/in 0.0393701\n                this.height*in_per_mm*px_per_in*scale*1,  // 100mm at dpi of 76 is 76 px/in * mm/in 0.0393701\n                unit\n            )\n        }\n        return new Dimension(\n            this.width*scale,\n            this.height*scale,\n            unit,\n        )\n    }\n}","import React, {Component} from \"react\";\nimport SelectionManager, {SELECTION_MANAGER} from \"../SelectionManager\";\nimport {TREE_ITEM_PROVIDER} from \"../TreeItemProvider\";\nimport {fetchGraphObject, propToArray} from \"../syncgraph/utils\";\nimport {makePoint} from '../utils'\nimport {UNITS, DEFAULT_DPI} from \"./Dimension\"\n\n\nexport class MetadocCanvas extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            pressed: false,\n            selection: null,\n            shape:null,\n            hsnap:null,\n            vsnap:null,\n        }\n        props.prov.onRawChange(e => {\n            if (this.props.list === -1) return\n            this.redraw()\n        })\n    }\n\n    selectionChanged = (sel) => this.setState({selection: sel})\n    componentDidMount() {\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n        this.props.prov.on(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, this.redraw)\n    }\n    componentWillUnmount() {\n        SelectionManager.off(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n        this.props.prov.off(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, this.redraw)\n    }\n\n    toCanvas(e) {\n        const rect = e.target.getBoundingClientRect()\n        return makePoint(\n            Math.floor((e.clientX - rect.left) / this.props.scale),\n            Math.floor((e.clientY - rect.top) / this.props.scale))\n    }\n\n\n    componentDidUpdate(prevProps) {\n        this.redraw()\n    }\n\n    redraw = () => {\n        if(!this.canvas) return\n        const c = this.canvas.getContext('2d')\n        const size = this.props.prov.getPageSize(this.props.prov.getSelectedPage()).as(UNITS.PIXEL,this.props.scale,DEFAULT_DPI)\n        this.canvas.width = size.width\n        this.canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, this.canvas.width, this.canvas.height)\n        c.save()\n        c.scale(this.props.scale, this.props.scale)\n        const graph = this.props.prov.getRawGraph()\n        const page = this.props.prov.getSelectedPage()\n        if(page) this.drawPage(c,graph,page)\n        c.fillStyle = \"rgba(0,255,255,0.5)\"\n        if(this.state.hsnap) c.fillRect(this.state.hsnap.value - 1,0,2,this.canvas.height)\n        if(this.state.vsnap) c.fillRect(0, this.state.vsnap.value - 1,this.canvas.width,2)\n        c.restore()\n    }\n\n    drawPage(c,g,page) {\n        propToArray(g,page.children).forEach(id => this.drawLayer(c,g,fetchGraphObject(g,id)))\n    }\n\n    drawLayer(c,g,layer) {\n        propToArray(g,layer.children).forEach(id => this.drawShape(c,g,fetchGraphObject(g,id)))\n    }\n\n    drawShape(c,g,shape) {\n        const def = this.props.prov.getShapeDef(shape.type)\n        if(def) def.draw(c,g,shape,SelectionManager.getSelection() === shape.id,this.props.prov)\n    }\n\n    isInside(pt, objid) {\n        const graph = this.props.prov.getRawGraph()\n        const shape = fetchGraphObject(graph,objid)\n        const def = this.props.prov.getShapeDef(shape.type)\n        if(def) return def.isInside(pt,shape,this.canvas)\n        return false\n    }\n\n    onClick = (e) => {\n        const pt = this.toCanvas(e)\n        const shape = this.findShape(pt)\n        if (shape) this.props.onSelect(shape)\n    }\n\n    findShape(pt) {\n        const prov = this.props.prov\n        const layer = prov.getSelectedLayer()\n        if (!layer) return null\n        const graph = prov.getRawGraph()\n        const arr = propToArray(graph,layer.children)\n        arr.reverse()\n        return arr.find((ch)=> this.isInside(pt,ch))\n    }\n\n    mouseDown = (e) => {\n        this.props.prov.pauseQueue()\n        const pt = this.toCanvas(e)\n        const shapeid = this.findShape(pt)\n        if (shapeid) {\n            const shapeobj = fetchGraphObject(this.props.prov.getRawGraph(),shapeid)\n            this.setState({\n                pressed: true,\n                initial: makePoint(shapeobj.x,shapeobj.y).minus(pt),\n                start: pt,\n                shape: shapeid,\n            })\n        } else {\n            const layer = this.props.prov.getSelectedLayer()\n            if(layer) SelectionManager.setSelection(layer.id)\n        }\n    }\n    mouseMove = (e) => {\n        if (!this.state.pressed) return\n        let pt = this.toCanvas(e).add(this.state.initial)\n        pt = this.snap(pt)\n        const graph = this.props.prov.getRawGraph()\n        graph.process(this.props.prov.cmd.setProperty(this.state.shape, 'x', pt.x))\n        graph.process(this.props.prov.cmd.setProperty(this.state.shape, 'y', pt.y))\n    }\n    mouseUp = (e) => {\n        this.setState({pressed: false, hsnap:null, vsnap:null})\n        this.props.prov.unpauseQueue()\n    }\n\n    render() {\n        return <div className=\"panel\">\n            <canvas style={{border: '0px solid red'}}\n                    width={100} height={100} ref={(e) => this.canvas = e}\n                    onClick={this.onClick}\n                    onMouseDown={this.mouseDown}\n                    onMouseUp={this.mouseUp}\n                    onMouseMove={this.mouseMove}\n            ></canvas>\n        </div>\n    }\n\n    snap(pt) {\n        const EDGES = {\n            LEFT:'LEFT',\n            RIGHT:'RIGHT',\n            CENTER:'CENTER',\n            TOP:'TOP',\n            MIDDLE:'MIDDLE',\n            BOTTOM:'BOTTOM',\n            NONE:'NONE',\n        }\n\n        const snaps = [\n            {value:0,type:EDGES.LEFT},\n            {value:320,type:EDGES.CENTER},\n            {value:640,type:EDGES.RIGHT},\n            {value:0, type:EDGES.TOP},\n            {value:240, type:EDGES.MIDDLE},\n            {value:480, type:EDGES.BOTTOM},\n        ]\n        const SNAP_THRESHOLD = 20\n        function isNearH(pt,snap) {\n            if(snap.type === EDGES.LEFT && Math.abs(pt.x-snap.value) < SNAP_THRESHOLD) return EDGES.LEFT\n            if(snap.type === EDGES.CENTER && Math.abs(pt.x + pt.width/2 - snap.value) < SNAP_THRESHOLD) return EDGES.CENTER\n            if(snap.type === EDGES.RIGHT && Math.abs(pt.x + pt.width - snap.value) < SNAP_THRESHOLD) return EDGES.RIGHT\n            return EDGES.NONE\n        }\n        function isNearV(pt,snap) {\n            if(snap.type === EDGES.TOP && Math.abs(pt.y-snap.value) < SNAP_THRESHOLD) return EDGES.TOP\n            if(snap.type === EDGES.MIDDLE && Math.abs(pt.y + pt.height/2 -snap.value) < SNAP_THRESHOLD) return EDGES.MIDDLE\n            if(snap.type === EDGES.BOTTOM && Math.abs(pt.y + pt.height -snap.value) < SNAP_THRESHOLD) return EDGES.BOTTOM\n            return EDGES.NONE\n        }\n\n        const graph = this.props.prov.getRawGraph()\n        const shape = fetchGraphObject(graph,this.state.shape)\n        const def = this.props.prov.getShapeDef(shape.type)\n        let hsnap = null\n        let vsnap = null\n        if(def) {\n            const bounds = def.getBounds(pt,shape,this.canvas)\n            for(let i=0; i<snaps.length; i++)  {\n                const snap = snaps[i]\n                const nearH = isNearH(bounds,snap)\n                if(nearH === EDGES.LEFT)   pt.x = snap.value\n                if(nearH === EDGES.CENTER) pt.x = snap.value-bounds.width/2\n                if(nearH === EDGES.RIGHT)  pt.x = snap.value-bounds.width\n\n                const nearV = isNearV(bounds,snap)\n                if(nearV === EDGES.TOP)    pt.y = snap.value\n                if(nearV === EDGES.MIDDLE) pt.y = snap.value-bounds.height/2\n                if(nearV === EDGES.BOTTOM) pt.y = snap.value-bounds.height\n\n                if(nearH !== EDGES.NONE) hsnap = snap\n                if(nearV !== EDGES.NONE) vsnap = snap\n            }\n        }\n        this.setState({hsnap:hsnap, vsnap:vsnap})\n\n        return pt\n    }\n}\n","const {SET_PROPERTY, CREATE_PROPERTY, DELETE_PROPERTY,\n    CREATE_OBJECT, DELETE_OBJECT,\n    INSERT_ELEMENT, DELETE_ELEMENT\n} = require(\"syncing_protocol\");\n\nexport class UndoQueue {\n    constructor(graph) {\n        this.graph = graph\n        this.history = []\n        this.current = -1\n    }\n\n    submit(op) {\n        // console.log(\"UNDOREDO: submit\",op)\n        this.history.push(op)\n        this.current = this.history.length - 1\n    }\n\n    canUndo() {\n        return this.current >= 0\n    }\n\n    canRedo() {\n        return this.current < this.history.length - 1\n    }\n\n    undo() {\n        const last = this.history[this.current]\n        this.current--\n        // console.log(\"undoing\",last)\n        // this.history.forEach(op => console.log(short(op)))\n        if (last.type === SET_PROPERTY) {\n            if (!last.prevValue) {\n                console.warn(\"undoing set property without a previous value!\", last)\n                return\n            }\n            const op = {\n                type: SET_PROPERTY,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.prevValue,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_PROPERTY) {\n            const op = {\n                type: DELETE_PROPERTY,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_OBJECT) {\n            const op = {\n                type: DELETE_OBJECT,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                id: last.id,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === INSERT_ELEMENT) {\n            const op = {\n                type: DELETE_ELEMENT,\n                host: this.graph.getHostId(),\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                array: last.array,\n                entry: last.entryid\n            }\n            this.graph.process(op)\n            return\n        }\n        throw new Error(`undo for type not supported: ${last.type}`)\n    }\n\n    redo() {\n        this.current++\n        const last = this.history[this.current]\n        // console.log(\"redoin\",this.current,last.type,last.name,'=',last.value)\n        if (last.type === SET_PROPERTY) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.value\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_PROPERTY) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                object: last.object,\n                name: last.name,\n                value: last.value\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === CREATE_OBJECT) {\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                id: last.id,\n            }\n            this.graph.process(op)\n            return\n        }\n        if (last.type === INSERT_ELEMENT) {\n            console.log(\"redoing\", last)\n            const op = {\n                type: last.type,\n                host: last.host,\n                seq: this.graph.nextSeq(),\n                timestamp: Date.now(),\n                array: last.array,\n                value: last.value,\n                entryid: this.graph.makeGUID(),\n                prev: -1,\n            }\n            this.graph.process(op)\n            return\n        }\n        throw new Error(`redo for type not supported: ${last.type}`)\n    }\n\n    dump() {\n        return this.history.map((op, i) => i + \" \" + op.type + \" \" + op.name + \" => \" + op.value)\n    }\n}\n","const {SET_PROPERTY} = require(\"syncing_protocol\");\n\n\nexport class EventCoalescer {\n    constructor(graph) {\n        this.graph = graph\n        this.listeners = []\n        this.rawlisteners = []\n        this.paused = false\n        this.buffer = []\n        this.first = {}\n        this.last = {}\n    }\n\n    pause() {\n        this.paused = true\n    }\n\n    unpause() {\n        this.paused = false\n        this.buffer = []\n        // console.log(\"need to send out set property updates\",this.last)\n        // console.log('the originals are',this.first)\n        Object.keys(this.last).forEach((key) => {\n            Object.keys(this.last[key]).forEach(name => {\n                const op = this.last[key][name]\n                // console.log(\"sending\",short(op))\n                op.prevValue = this.first[key][name].value\n                this.fire(op)\n                this.graph.process(op)\n            })\n        })\n\n        this.first = {}\n        this.last = {}\n\n        // console.log(this.graph.dumpGraph())\n        // this.graph.getHistory().forEach(h => console.log(h.type,h.name,h.value))\n    }\n\n    onChange = cb => this.listeners.push(cb)\n    onRawChange = cb => this.rawlisteners.push(cb)\n    fire = op => this.listeners.forEach(cb => cb(op))\n    fireRaw = op => this.rawlisteners.forEach(cb => cb(op))\n    getPropertiesForObject = (obj) => this.graph.getPropertiesForObject(obj)\n    getArrayLength = (obj) => this.graph.getArrayLength(obj)\n    getElementAt = (obj, index) => this.graph.getElementAt(obj, index)\n    getHostId = () => this.graph.getHostId()\n\n\n    getPropertyValue(obj, key) {\n        // console.log(\"checking\",this.paused,obj,key)\n        if (this.paused && this.last[obj] && this.last[obj][key]) {\n            // console.log(\"returning the raw property values\",this.last[obj][key])\n            return this.last[obj][key].value\n        } else {\n            return this.graph.getPropertyValue(obj, key)\n        }\n    }\n\n    bufferOp(op) {\n        if (!this.first[op.object]) this.first[op.object] = {}\n        if (!this.first[op.object][op.name]) this.first[op.object][op.name] = op\n        if (!this.last[op.object]) this.last[op.object] = {}\n        this.last[op.object][op.name] = op\n        this.buffer.push(op)\n        this.fireRaw(op)\n    }\n\n    process(op) {\n        if (op.type === SET_PROPERTY && this.paused) {\n            this.bufferOp(op)\n        } else {\n            this.fire(op)\n            this.graph.process(op)\n        }\n    }\n}\n","import PubNub from \"pubnub\";\nfunction short(op) {\n    let str = `${op.type} ${op.uuid} |  `\n    if(op.name) {\n        str += `${op.name} = ${op.value}  prev = ${op.prevValue}`\n    }\n    return str\n}\n\nexport class PubnubSyncWrapper {\n    constructor(provider, graph) {\n        if(!provider) throw new Error('created PubnubSyncWrapper without a provider')\n        if(!graph) throw new Error('created PubnubSyncWrapper without a graph')\n        this.paused = false\n        this.buffer = []\n        this.provider = provider\n\n        graph.onChange((e)=>this.handleGraphChange(e))\n\n        const settings = {\n            publishKey: 'pub-c-1cba58da-c59a-4b8b-b756-09e9b33b1edd',\n            subscribeKey: 'sub-c-39263f3a-f6fb-11e7-847e-5ef6eb1f4733',\n        }\n\n        this.pubnub = new PubNub(settings)\n    }\n\n    calculateChannelName() {\n        return \"metadoc-docupdate-\" + this.provider.getDocId()\n    }\n\n    start() {\n        this.pubnub.addListener({\n            status: (e) => {\n                // console.log(e)\n                if (e.operation === 'PNSubscribeOperation' && e.category === 'PNConnectedCategory') {\n                    this.sendHistoryRequest()\n                }\n            },\n            message: (m)=>this.handleMessage(m),\n        })\n\n        this.pubnub.subscribe({channels: [this.calculateChannelName()]})\n    }\n\n    pause() {\n        this.paused = true\n    }\n\n    unpause() {\n        this.paused = false\n        // console.log(\"we need to send the waiting messages\", this.buffer)\n        this.buffer.forEach(op => this.sendMessage(op))\n        this.buffer = []\n        //now request history from the network for anything we missed\n        // this.sendHistoryRequest()\n    }\n\n    shutdown() {\n        this.pubnub.unsubscribe({channels: [this.calculateChannelName()]})\n        this.pubnub.stop()\n    }\n\n    sendMessage(e) {\n        console.log(\"PN_SEND:\", short(e))\n        this.pubnub.publish({\n            channel: this.calculateChannelName(),\n            message: e\n        }, (status, response) => {\n            // console.log(\"published\",status,response)\n        })\n\n    }\n\n    handleGraphChange (e) {\n        // console.log(\"graph changed\",e)\n        const host = this.provider.getDataGraph().getHostId()\n        if (e.host !== host) return\n        if (this.paused) return this.buffer.push(e)\n        this.sendMessage(e)\n    }\n\n    sendHistoryRequest() {\n        // console.log(\"sending a history request\")\n        this.pubnub.publish({\n            channel: this.calculateChannelName(),\n            message: {\n                type: 'GET_HISTORY',\n                host: this.provider.getDataGraph().getHostId()\n            }\n        })\n    }\n\n    handleGetHistory() {\n        // console.log(\"need to send out the history\")\n        const graph = this.provider.getDataGraph()\n        const hist = graph.getHistory().slice()\n        console.log(hist)\n        const chunkSize = 30\n        let count = 0\n        while (hist.length > 0) {\n            if (count > 100) {\n                console.log(\"breaking out. possible infinite loop\")\n                break\n            }\n            count++\n            const chunk = hist.splice(0, chunkSize)\n            console.log(\"sending\", chunk.length, chunk)\n            this.pubnub.publish({\n                channel: this.calculateChannelName(),\n                message: {\n                    type: 'SEND_HISTORY',\n                    host: graph.getHostId(),\n                    history: chunk\n                }\n            }, (status, response) => {\n                console.log(\"published\", status, response)\n            })\n        }\n\n    }\n\n    handleReceiveHistory(msg) {\n        console.log(\"got some history\", msg.history.length)\n        msg.history.forEach(op => this.provider.getDataGraph().process(op))\n    }\n\n\n    handleMessage (evt) {\n        if (this.paused) return\n        const graph = this.provider.getDataGraph()\n        // console.log('PN_REMOTE',evt)\n        if (evt.message.type === 'GET_HISTORY') {\n            // console.log(\"got a history request\",evt.message.host, graph.getHostId())\n            if (evt.message.host !== graph.getHostId()) {\n                return this.handleGetHistory()\n            }\n            return\n        }\n        if (evt.message.type === 'SEND_HISTORY') {\n            if (evt.message.host !== graph.getHostId()) {\n                return this.handleReceiveHistory(evt.message)\n            }\n            return\n        }\n        const op = evt.message\n        if (!op.host) return console.log(\"received a message without a host\", op)\n        if (!op.timestamp) return console.error(\"received a message without a timestamp\", op)\n        if (op.host && op.host === graph.getHostId()) {\n            // console.log(\"SKIP: my own message came in. ignoring it\")\n            return\n        }\n        console.log(\"REMOTE\", op)\n        graph.process(op)\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\n\nexport class MissingDocDialog extends Component {\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n\n    okay = () => {\n        DialogManager.hide()\n        this.props.provider.createNewDocument(this.props.docid)\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Document \"<b>{this.props.docid}</b>\" not found</h3>\n                <VBox grow>\n                    Create a new document?\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}","import TreeItemProvider, {getDocsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {GET_JSON, POST_JSON, setQuery, toQueryString} from '../utils'\nimport {UndoQueue} from './UndoQueue'\nimport {EventCoalescer} from '../metadoc/EventCoalescer'\nimport SelectionManager from '../SelectionManager'\nimport {PubnubSyncWrapper} from './PubnubSyncWrapper'\nimport {propToArray} from \"./utils\";\nimport * as ToasterMananager from '../vr/ToasterManager'\nimport {DialogManager} from 'appy-comps'\nimport {MissingDocDialog} from './MissingDocDialog'\nimport React from 'react'\nimport {AuthModule} from '../vr/AuthModule'\n\nconst {DocGraph, CommandGenerator} = require(\"syncing_protocol\");\n\n\nfunction DocGraphToObjectGraph(doc, id) {\n    const props = doc.getPropertiesForObject(id)\n    const obj = {}\n    props.forEach(name => {\n        obj[name] = doc.getPropertyValue(id,name)\n        if(name === 'children') {\n            obj.children = propToArray(doc,obj[name]).map(child => {\n                return DocGraphToObjectGraph(doc,child)\n            })\n        }\n    })\n    obj.id = id\n    return obj\n}\n\n\nexport default class SyncGraphProvider extends TreeItemProvider {\n    constructor(options) {\n        super(options)\n        this.options = options || {}\n        this.mode = options.mode || 'edit'\n        this.datalisteners = []\n        this.rawlisteners = []\n        this.expanded = {}\n\n        const doc = new DocGraph()\n        this.makeEmptyRoot(doc)\n        this.setupDocFlow(doc,this.genID('doc'))\n        if(options.doc) this.loadDoc(options.doc)\n    }\n    getDocTitle = () => \"untitled\"\n    getDocHistory = () => this.getDataGraph().getHistory()\n    getDocGraph = () => {\n        const root = this.getDataGraph().getObjectByProperty('type','root')\n        return DocGraphToObjectGraph(this.getDataGraph(),root)\n    }\n    onRawChange = cb => this.rawlisteners.push(cb)\n    getRawGraph = () => this.coalescer\n    getDataGraph = () => this.syncdoc\n    getSceneRoot = () => this.getDataGraph().getObjectByProperty('type','root')\n    hasChildren = (item) => item && this.getDataGraph().hasPropertyValue(item,'children')\n    getChildren = (item) => {\n        const doc = this.getDataGraph()\n        return propToArray(doc,doc.getPropertyValue(item,'children'))\n    }\n    isExpanded = (item) => {\n        if (typeof this.expanded[item] === 'undefined') this.expanded[item] = true;\n        return this.expanded[item]\n    }\n    toggleItemCollapsed(item) {\n        const current = this.isExpanded(item);\n        this.expanded[item] = !current;\n        this.fire(TREE_ITEM_PROVIDER.EXPANDED_CHANGED,item);\n    }\n\n    setPropertyValue(item, def, value) {\n        const op = this.cmd.setProperty(item,def.key,value)\n        op.prevValue = def.value\n        this.getRawGraph().process(op)\n        this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,{\n            provider: this,\n            child:item,\n            propKey:def.key,\n            oldValue:def.value,\n            newValue:value\n        })\n    }\n\n    save = (e) => {\n        if(e) e.preventDefault()\n        const payload_obj = {\n            history:this.getDocHistory(),\n            type:this.getDocType(),\n            id:this.getDocId(),\n            graph:this.getDocGraph(),\n            title:this.getDocTitle(),\n        }\n        const payload_string = JSON.stringify(payload_obj)\n        ToasterMananager.add('saving')\n        const opts = {\n            type:this.getDocType(),\n            title:this.getDocTitle(),\n        }\n        const url = getDocsURL()+this.getDocId()+'?'+toQueryString(opts)\n        console.log(`saving ${payload_string.length} chars to ${url}`, payload_obj)\n        return fetch(url,{\n            method:'POST',\n            mode:'cors',\n            cache:'no-cache',\n            body:payload_string,\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        })\n            .then(res=>res.json())\n            .then(res => {\n                console.log(\"got back result\",res)\n                setQuery({mode:this.mode,doc:this.getDocId(), doctype:this.getDocType()})\n                ToasterMananager.add(res.message)\n                this.fire(TREE_ITEM_PROVIDER.SAVED,true)\n            }).catch((e)=> console.log(\"error\",e))\n    }\n\n    loadDoc(docid) {\n        console.log(\"loading\",docid)\n        return fetch(getDocsURL()+docid,{\n            method:'GET',\n            mode: \"cors\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        })\n            .then(res => res.json())\n            .then((payload)=>{\n                console.log(\"got the payload\",payload)\n                if(payload.success === false) return this.showMissingDocDialog(docid)\n                const doc = this.makeDocFromServerHistory(payload.history)\n                this.setupDocFlow(doc,docid)\n            })\n            .catch((e)=> this.showMissingDocDialog(docid))\n    }\n\n    createNewDocument(docid) {\n        const doc = new DocGraph()\n        this.makeEmptyRoot(doc)\n        this.setupDocFlow(doc,docid)\n    }\n\n    setupDocFlow(doc,docid) {\n        //shut down old network connection\n        if(this.pubnub) this.pubnub.shutdown()\n        this.pubnub = null\n\n        this.syncdoc = doc\n        this.cmd = new CommandGenerator(this.syncdoc)\n        this.root = this.getSceneRoot()\n        this.docid = docid\n        this.undoqueue = new UndoQueue(doc)\n        this.coalescer = new EventCoalescer(this.syncdoc) //sends calls on to sync doc, and fires change event\n        this.coalescer.onChange((op) => this.undoqueue.submit(op))\n\n        this.coalescer.onRawChange(op =>this.rawlisteners.forEach(cb => cb(op)))\n        this.syncdoc.onChange(op => this.rawlisteners.forEach(cb => cb(op)))\n        this.syncdoc.onChange((op)=>{\n            this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, { provider:this });\n            this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED, { provider:this });\n        })\n        this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED, { provider:this });\n        this.fire(TREE_ITEM_PROVIDER.CLEAR_DIRTY,true)\n        SelectionManager.clearSelection()\n        this.pubnub = new PubnubSyncWrapper(this,this.syncdoc)\n        this.pubnub.unpause()\n        this.pubnub.start()\n        this.connected = true\n        this.fire(\"CONNECTED\",this.connected)\n        this.fire(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED,{provider:this})\n        setQuery({mode:this.mode,doc:this.getDocId(), doctype:this.getDocType()})\n        this.docLoaded()\n    }\n\n    reloadDocument() {\n        return GET_JSON(getDocsURL()+this.docid).then((payload)=>{\n            if(payload.type !== this.getDocType()) throw new Error(\"incorrect doctype for this provider\",payload.type)\n            const doc = this.makeDocFromServerHistory(payload.history)\n            this.setupDocFlow(doc,this.docid)\n        }).catch((e)=>{\n            console.log(\"couldn't reload the doc\",e)\n        })\n\n    }\n\n    docLoaded = () => {\n    }\n\n    toggleConnected = () => {\n        this.connected = !this.connected\n        if(this.pubnub) {\n            if(this.connected) {\n                this.pubnub.unpause()\n            } else {\n                this.pubnub.pause()\n            }\n        }\n        this.fire(\"CONNECTED\",this.connected)\n    }\n\n    isConnected = () => this.connected\n\n    pauseQueue = () => this.coalescer.pause()\n    unpauseQueue = () => this.coalescer.unpause()\n\n    performUndo = (e) => {\n        if(e && e.preventDefault) e.preventDefault()\n\n        if(this.undoqueue.canUndo()) {\n            this.undoqueue.undo()\n        } else {\n            console.warn(\"at beginnning of the undo queue\")\n        }\n    }\n    performRedo = (e) => {\n        if(e && e.preventDefault) e.preventDefault()\n        if(this.undoqueue.canRedo()) this.undoqueue.redo()\n    }\n\n    makeDocFromServerHistory(history) {\n        const doc = new DocGraph()\n        history.forEach(op => doc.process(op))\n        return doc\n    }\n\n\n    showMissingDocDialog(docid) {\n        DialogManager.show(<MissingDocDialog docid={docid} provider={this}/>)\n    }\n}\n","\nexport default class InputManager {\n    static KEYS = {\n        S:83,\n        Z:90,\n        C:67,\n        V:86,\n        X:88,\n        LEFT_ARROW:37,\n        RIGHT_ARROW:39,\n    }\n    static MODIFIERS = {\n        COMMAND:'COMMAND',\n        SHIFT:'SHIFT'\n    }\n\n    constructor() {\n        this.bindings = []\n        this.listeners = {}\n    }\n\n    addKeyBinding(binding) {\n        this.bindings.push(binding)\n    }\n    addListener(name,cb) {\n        if(!this.listeners[name]) {\n            this.listeners[name] = []\n        }\n        this.listeners[name].push(cb)\n    }\n\n    attachKeyEvents(document) {\n        document.addEventListener('keydown',this.keyDown)\n    }\n\n    keyDown = (e)=>{\n        // console.log(\"-------------\")\n        // console.log(\"got a key press\",e.shiftKey, e.metaKey, e.key, e.keyCode)\n        const matches = this.bindings.filter((b)=>b.key === e.keyCode)\n        // console.log(\"got the bindings\",matches)\n        const m2 = matches.filter((b)=>{\n            let valid = true\n            b.modifiers.forEach((mod)=>{\n                if(mod === InputManager.MODIFIERS.COMMAND && !e.metaKey) {\n                    // console.log(\"missing the meta key\");\n                    valid = false\n                }\n                if(mod === InputManager.MODIFIERS.SHIFT && !e.shiftKey) {\n                    // console.log(\"missing the shift key\");\n                    valid = false\n                }\n            })\n            if(e.shiftKey && !b.modifiers.some(mod=>mod === InputManager.MODIFIERS.SHIFT)) {\n                // console.log(\"shift is down, but missing shift in the def\")\n                valid = false\n            }\n            // console.log(\"still valid\",valid)\n            return valid\n        })\n        // console.log(\"final list is\",m2.length)\n        if(m2.length > 0) {\n            // console.log(\"something matched\")\n            // e.preventDefault()\n            this.dispatchEvents(m2,e)\n        }\n    }\n    dispatchEvents(matches,e) {\n        matches.forEach((bind)=>{\n            if(this.listeners[bind.id]) this.listeners[bind.id].forEach((cb)=>cb?cb(e):null)\n        })\n    }\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class RectDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,graph.createObject({\n            type:'rect',\n            title:'second rect',\n            x: 100,\n            y: 100,\n            rx:20,\n            ry:20,\n            width: 100,\n            height: 100,\n            fillColor: '#ff00ff',\n            parent:layer.id,\n        }))\n    }\n\n    draw(c,g,shape,selected) {\n        c.fillStyle = 'gray'\n        c.fillStyle = shape.fillColor\n        if(shape.rx > 0 || shape.ry > 0) {\n            const c0 = {x:shape.x,y:shape.y}\n            const c1 = {x:shape.x+shape.width, y:shape.y}\n            const c2 = {x:shape.x+shape.width, y:shape.y+shape.height}\n            const c3 = {x:shape.x, y:shape.y+shape.height}\n            c.beginPath()\n            c.moveTo(c0.x+shape.rx,c0.y)\n            c.lineTo(c1.x-shape.rx,c1.y)\n            c.quadraticCurveTo(c1.x,c1.y, c1.x,c1.y+shape.ry)\n            c.lineTo(c2.x,c2.y-shape.ry)\n            c.quadraticCurveTo(c2.x,c2.y, c2.x-shape.rx,c2.y)\n            c.lineTo(c3.x+shape.rx,c3.y)\n            c.quadraticCurveTo(c3.x,c3.y, c3.x,c3.y-shape.ry)\n            c.lineTo(c0.x,c0.y+shape.ry)\n            c.quadraticCurveTo(c0.x,c0.y, c0.x+shape.rx,c0.y)\n            c.closePath()\n            c.fill()\n        } else {\n            c.fillRect(shape.x, shape.y, shape.width, shape.height)\n        }\n\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x+0.5,shape.y+0.5,shape.width, shape.height)\n        }\n\n    }\n\n    isInside(pt,shape) {\n        if (pt.x < shape.x) return false\n        if (pt.x > shape.x + shape.width) return false\n        if (pt.y < shape.y) return false\n        if (pt.y > shape.y + shape.height) return false\n        return true\n    }\n\n    getBounds(newOrigin,shape) {\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:shape.width,\n            height:shape.height,\n        }\n    }\n\n    toSVGString(obj) {\n        return `<rect x=\"${obj.x}\" y=\"${obj.y}\" width=\"${obj.width}\" height=\"${obj.height}\" fill=\"${obj.fillColor}\"/>`\n    }\n\n}\n","import {createGraphObjectFromObject, fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class CircleDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,createGraphObjectFromObject(graph, {\n            type: 'circle',\n            title: 'circle',\n            x: 100,\n            y: 100,\n            radius: 50,\n            fillColor: '#ffff00',\n            parent: layer.id,\n        }))\n    }\n\n\n    draw(c,g,shape,selected) {\n        c.fillStyle = 'gray'\n        c.fillStyle = shape.fillColor\n        c.beginPath()\n        c.arc(shape.x, shape.y, shape.radius, 0, Math.PI*2)\n        c.fill()\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x-shape.radius+0.5,shape.y-shape.radius+0.5,shape.radius*2, shape.radius*2)\n        }\n    }\n\n    isInside(pt,shape) {\n        if(Math.pow(shape.x-pt.x,2) + Math.pow(shape.y - pt.y,2) < Math.pow(shape.radius,2)) return true\n        return false\n    }\n\n    getBounds(newOrigin,shape, canvas) {\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:shape.radius*2,\n            height:shape.radius*2,\n        }\n    }\n\n    toSVGString(obj) {\n        return `<circle cx=\"${obj.x}\" cy=\"${obj.y}\" r=\"${obj.radius}\" fill=\"${obj.fillColor}\"/>`\n    }\n\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\nimport {FONT_STYLES, FONT_WEIGHTS, HORIZONTAL_ALIGNMENT, STANDARD_FONTS, VERTICAL_ALIGNMENT} from \"./Common\";\n\nexport default class TextDef {\n    make(graph,layer) {\n        const text = fetchGraphObject(graph,graph.createObject({\n            type:'text',\n            title:'text',\n\n            text:'title text',\n\n            horizontalAlign:HORIZONTAL_ALIGNMENT.CENTER,\n            verticalAlign:VERTICAL_ALIGNMENT.BASELINE,\n            autoFit:true,\n            fontSize:30,\n            fontFamily:STANDARD_FONTS.SANSSERIF,\n            fontWeight:FONT_WEIGHTS.NORMAL,\n            fontStyle:FONT_STYLES.NORMAL,\n\n            x: 100,\n            y: 100,\n            width: 200,\n            height: 120,\n            fillColor: '#ff00ff',\n            parent:layer.id,\n        }))\n        return text\n    }\n\n    draw(c,g,shape,selected) {\n        //calculate the general line metrics\n        const {lines, size_px, total_height, total_width} = this.calculateLines(shape,c)\n        //add offsets for alignment\n        lines.forEach((line,i) => {\n            const lines_height = lines.length*size_px\n            line.xoff = 0\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.LEFT)   line.xoff = 0\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.CENTER) line.xoff = (total_width - line.width)/2\n            if(shape.horizontalAlign === HORIZONTAL_ALIGNMENT.RIGHT)  line.xoff = total_width  - line.width\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.TOP)        line.yoff = 0\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.CENTER)     line.yoff = (total_height- lines_height)/2\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.BASELINE)   line.yoff = total_height - lines_height\n            if(shape.verticalAlign === VERTICAL_ALIGNMENT.BOTTOM)     line.yoff = total_height - lines_height\n            line.yoff += (i+1)*line.height\n        })\n\n        //draw text\n        c.fillStyle = shape.fillColor\n        lines.forEach((line,i) => c.fillText(line.text,shape.x+line.xoff,shape.y+ line.yoff))\n        //draw outline\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x + 0.5, shape.y + 0.5, total_width, total_height)\n        }\n    }\n\n    calculateLines(shape,c) {\n        const size_px = parseFloat(shape.fontSize)\n        c.font = `normal ${size_px}px sans-serif`\n        const lines = shape.text.split(\"\\n\").map(text => {\n            return {\n                text:text,\n                width: c.measureText(text).width,\n                height: size_px\n            }\n        })\n\n        let total_width = 0\n        let total_height = 0\n        if(shape.autoFit) {\n            total_width = lines.reduce((max, line) => Math.max(max,line.width),0)\n            total_height = lines.reduce((total,line) => total + line.height,0)\n        } else {\n            total_width = shape.width\n            total_height = shape.height\n        }\n        return {\n            total_width:total_width,\n            total_height: total_height,\n            lines:lines,\n            size_px:size_px\n        }\n    }\n\n    insideRect(pt,x,y,w,h) {\n        if (pt.x < x) return false\n        if (pt.x > x + w) return false\n        if (pt.y < y) return false\n        if (pt.y > y + h) return false\n        return true\n    }\n\n    isInside(pt,shape, canvas) {\n        const c = canvas.getContext('2d')\n        const {total_width, total_height} = this.calculateLines(shape,c)\n        return this.insideRect(pt,shape.x,shape.y,total_width,total_height)\n    }\n\n    getBounds(newOrigin,shape, canvas) {\n        const c = canvas.getContext('2d')\n        const {total_width, total_height} = this.calculateLines(shape,c)\n        return {\n            x:newOrigin.x,\n            y:newOrigin.y,\n            width:total_width,\n            height:total_height,\n        }\n    }\n\n\n    toSVGString(obj) {\n        return `<text x=\"${obj.x}\" y=\"${obj.y}\"\n                     fill=\"${obj.fillColor}\" fontSize=\"${obj.fontSize}\"\n                     fontFamily=\"${obj.fontFamily}\"\n                >${obj.text}</text>`\n    }\n\n}\n","import {fetchGraphObject} from \"../syncgraph/utils\";\n\nexport default class ImageDef {\n    make(graph,layer) {\n        return fetchGraphObject(graph,graph.createObject({\n            type:'image',\n            title:'image',\n            x: 100,\n            y: 100,\n            width: 50,\n            height: 50,\n            asset:0,\n            parent:layer.id,\n        }))\n    }\n\n    draw(c,g,shape,selected, provider) {\n        if(shape.asset) {\n            const src = g.getPropertyValue(shape.asset,'src')\n            if(provider.isImageCached(src)) {\n                c.drawImage(provider.getCachedImage(src),shape.x,shape.y,shape.width,shape.height)\n            } else {\n                provider.requestImageCache(src)\n                c.fillStyle = 'aqua'\n                c.fillRect(shape.x,shape.y,shape.width,shape.height)\n            }\n        } else {\n            c.fillStyle = 'aqua'\n            c.fillRect(shape.x,shape.y,shape.width,shape.height)\n        }\n        if (selected) {\n            c.strokeStyle = 'red'\n            c.strokeRect(shape.x+0.5,shape.y+0.5,shape.width, shape.height)\n        }\n    }\n\n    isInside(pt,shape) {\n        if (pt.x < shape.x) return false\n        if (pt.x > shape.x + shape.width) return false\n        if (pt.y < shape.y) return false\n        if (pt.y > shape.y + shape.height) return false\n        return true\n    }\n    toSVGString(obj,prov) {\n        console.log('serializing',obj,prov)\n        const asset = fetchGraphObject(prov.getDataGraph(),obj.asset)\n        console.log('asset is',asset)\n        // return `<rect x=\"${obj.x}\" y=\"${obj.y}\" width=\"${obj.width}\" height=\"${obj.height}\" fill=\"${obj.fillColor}\"/>`\n        return `<image xlinkHref=\"${asset.src}\"\n                      width=\"${obj.width}\" height=\"${obj.height}\"\n        />`\n\n    }\n}\n","import {TYPES} from \"../common/PropSheet\";\nimport RectDef from \"./RectDef\";\nimport CircleDef from \"./CircleDef\";\nimport TextDef from \"./TextDef\";\nimport ImageDef from \"./ImageDef\";\n\nexport const PROP_DEFS = {\n    title: {\n        key:'title',\n        name:'Title',\n        type:TYPES.STRING\n    },\n    x: {\n        key:'x',\n        name:'X',\n        type:TYPES.NUMBER\n    },\n    y: {\n        key:'y',\n        name:'Y',\n        type:TYPES.NUMBER\n    },\n    rx: {\n        key:'rx',\n        name:'RX',\n        type:TYPES.NUMBER\n    },\n    ry: {\n        key:'ry',\n        name:'RY',\n        type:TYPES.NUMBER\n    },\n    fillColor: {\n        key:'fillColor',\n        name:'color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    width: {\n        key:'width',\n        name:'Width',\n        type:TYPES.NUMBER\n    },\n    height: {\n        key:'height',\n        name:'Height',\n        type:TYPES.NUMBER\n    },\n    radius: {\n        key:'radius',\n        name:'Radius',\n        type:TYPES.NUMBER\n    },\n    text: {\n        key:'text',\n        name:'text',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    src: {\n        key:'src',\n        name:'src',\n        type:TYPES.STRING,\n    },\n    asset: {\n        key:'asset',\n        name:'asset',\n        type:TYPES.ENUM,\n    },\n    subtype: {\n        key:'subtype',\n        name:'kind',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    format: {\n        key:'format',\n        name:'format',\n        type:TYPES.STRING,\n        locked:true,\n    },\n\n    autoFit: {\n        key:'autoFit',\n        name:'Size to Fit',\n        type:TYPES.BOOLEAN,\n        locked:false,\n    },\n    fontSize: {\n        key:'fontSize',\n        name:'Font Size',\n        type:TYPES.STRING,\n        locked:false,\n    },\n    fontFamily: {\n        key:'fontFamily',\n        name:'Font Family',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    fontWeight: {\n        key:'fontWeight',\n        name:'Font Weight',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    fontStyle: {\n        key:'fontStyle',\n        name:'Font Style',\n        type:TYPES.ENUM,\n        locked:true,\n    },\n    horizontalAlign: {\n        key:'horizontalAlign',\n        name:'H Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    verticalAlign: {\n        key:'verticalAlign',\n        name:'V Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    pageSize: {\n        key:'pageSize',\n        name:'Size',\n        type:TYPES.STRING,\n        locked:false,\n        custom:true,\n    }\n}\n\nexport const SHAPE_DEFS = {\n    rect: new RectDef(),\n    circle: new CircleDef(),\n    text: new TextDef(),\n    image: new ImageDef(),\n}\n\nexport const ICONS = {\n    page:'file',\n    layer:'sticky-note',\n    rect:'square',\n    circle:'circle',\n    text:'font',\n    plane:'plane',\n    image:'image',\n    model:'cube',\n    cut:'cut',\n    copy:'copy',\n    paste:'paste',\n    delete:'close'\n}\n\nexport const VERTICAL_ALIGNMENT = {\n    TOP:'TOP',\n    BASELINE:'BASELINE',\n    CENTER:'CENTER',\n    BOTTOM:'BOTTOM',\n}\nexport const HORIZONTAL_ALIGNMENT = {\n    LEFT:'LEFT',\n    CENTER:'CENTER',\n    RIGHT:'RIGHT',\n}\n\nexport const STANDARD_FONTS = {\n    SERIF:'serif',\n    SANSSERIF:'sans-serif',\n    MONOSPACE:'monospace',\n}\n\nexport const FONT_WEIGHTS = {\n    NORMAL:'normal',\n    BOLD:'bold'\n}\n\nexport const FONT_STYLES = {\n    NORMAL:'normal',\n    ITALIC:'italic',\n    OBLIQUE:'oblique'\n}\n\n\n\nexport function isShapeType(type) {\n    if(type === 'rect') return true\n    if(type === 'circle') return true\n    if(type === 'text') return true\n    if(type === 'image') return true\n    return false\n}\n","export default class ObjectDef {\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'tx') node.position.x = parseFloat(op.value)\n        if (op.name === 'ty') node.position.y = parseFloat(op.value)\n        if (op.name === 'tz') node.position.z = parseFloat(op.value)\n        if (op.name === 'rx') node.rotation.x = parseFloat(op.value)\n        if (op.name === 'ry') node.rotation.y = parseFloat(op.value)\n        if (op.name === 'rz') node.rotation.z = parseFloat(op.value)\n        if (op.name === 'sx') node.scale.x = parseFloat(op.value)\n        if (op.name === 'sy') node.scale.y = parseFloat(op.value)\n        if (op.name === 'sz') node.scale.z = parseFloat(op.value)\n        if (op.name === 'visible') node.visible = op.value\n\n        if (op.name === 'color') {\n            let color = op.value\n            if(color.indexOf('#') === 0) color = color.substring(1)\n            node.material.color.set(parseInt(color,16))\n            return\n        }\n\n    }\n    reset(node, obj) {\n        node.position.set(obj.tx,obj.ty,obj.tz)\n        node.visible = obj.visible\n    }\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {BoxGeometry, Mesh, MeshLambertMaterial} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES} from '../Common'\n\nlet COUNTER = 0\n\nexport default class CubeDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.cube,\n            title:'cube '+COUNTER++,\n            visible:true,\n            width:1, height:1, depth:1,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Mesh(\n            new BoxGeometry(obj.width, obj.height, obj.depth),\n            new MeshLambertMaterial({color: obj.color})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'width' || op.name === 'height' || op.name === 'depth') {\n            node.geometry = new BoxGeometry(obj.width, obj.height, obj.depth)\n            return\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport ObjectDef from './ObjectDef'\n\nexport default class SphereDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'sphere',\n            title:'a sphere',\n            visible:true,\n            radius: 0.5,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#0000ff',\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new THREE.Mesh(\n            new THREE.SphereBufferGeometry(obj.radius),\n            new THREE.MeshLambertMaterial({color: obj.color})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'radius') node.geometry = new THREE.SphereGeometry(op.value)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {ASSET_TYPES, PROP_DEFS} from '../Common'\nimport ObjectDef from './ObjectDef'\n\nexport default class PlaneDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create plane w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'plane',\n            title:'a plane',\n            visible:true,\n            width: 3,\n            height: 3,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#ffffff',\n            children:graph.createArray(),\n            asset:0,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(obj.width,obj.height),\n            new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide})\n        )\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === 'width') node.geometry = new THREE.PlaneBufferGeometry(op.value,obj.height)\n        if (op.name === 'height') node.geometry = new THREE.PlaneBufferGeometry(obj.width,op.value)\n        if (op.name === PROP_DEFS.asset.key) {\n            const g = provider.getDataGraph()\n            const asset = fetchGraphObject(g,op.value)\n            if(asset) {\n                if(asset.subtype === ASSET_TYPES.IMAGE) {\n                    const tex = new THREE.TextureLoader().load(asset.src)\n                    node.material = new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide, map: tex})\n                }\n                if(asset.subtype === ASSET_TYPES.VIDEO) {\n                    let video\n                    if(!provider.videocache[asset.src]) {\n                        video = document.createElement('video')\n                        video.crossOrigin = 'anonymous'\n                        video.src = asset.src\n                        provider.videocache[asset.src] = video\n                    } else {\n                        video = provider.videocache[asset.src]\n                    }\n                    const tex = new THREE.VideoTexture(video)\n                    node.material = new THREE.MeshLambertMaterial({color: obj.color, side: THREE.DoubleSide, map: tex})\n                }\n            }\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","const THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author Rich Tibbett / https://github.com/richtr\n * @author mrdoob / http://mrdoob.com/\n * @author Tony Parisi / http://www.tonyparisi.com/\n * @author Takahiro / https://github.com/takahirox\n * @author Don McCurdy / https://www.donmccurdy.com\n */\n\nconst GLTFLoader = ( function () {\n\n    function GLTFLoader( manager ) {\n\n        this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\n\n    }\n\n    GLTFLoader.prototype = {\n\n        constructor: GLTFLoader,\n\n        crossOrigin: 'Anonymous',\n\n        load: function ( url, onLoad, onProgress, onError ) {\n\n            var scope = this;\n\n            var path = this.path !== undefined ? this.path : THREE.LoaderUtils.extractUrlBase( url );\n\n            var loader = new THREE.FileLoader( scope.manager );\n\n            loader.setResponseType( 'arraybuffer' );\n\n            loader.load( url, function ( data ) {\n\n                try {\n\n                    scope.parse( data, path, onLoad, onError );\n\n                } catch ( e ) {\n\n                    if ( onError !== undefined ) {\n\n                        onError( e );\n\n                    } else {\n\n                        throw e;\n\n                    }\n\n                }\n\n            }, onProgress, onError );\n\n        },\n\n        setCrossOrigin: function ( value ) {\n\n            this.crossOrigin = value;\n            return this;\n\n        },\n\n        setPath: function ( value ) {\n\n            this.path = value;\n            return this;\n\n        },\n\n        parse: function ( data, path, onLoad, onError ) {\n\n            var content;\n            var extensions = {};\n\n            if ( typeof data === 'string' ) {\n\n                content = data;\n\n            } else {\n\n                var magic = THREE.LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n                if ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n                    try {\n\n                        extensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n                    } catch ( error ) {\n\n                        if ( onError ) onError( error );\n                        return;\n\n                    }\n\n                    content = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n                } else {\n\n                    content = THREE.LoaderUtils.decodeText( new Uint8Array( data ) );\n\n                }\n\n            }\n\n            var json = JSON.parse( content );\n\n            if ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n                if ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.' ) );\n                return;\n\n            }\n\n            if ( json.extensionsUsed ) {\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_LIGHTS ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_LIGHTS ] = new GLTFLightsExtension( json );\n\n                }\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_COMMON ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] = new GLTFMaterialsCommonExtension( json );\n\n                }\n\n                if ( json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ) >= 0 ) {\n\n                    extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\n\n                }\n\n            }\n\n            console.time( 'GLTFLoader' );\n\n            var parser = new GLTFParser( json, extensions, {\n\n                path: path || this.path || '',\n                crossOrigin: this.crossOrigin,\n                manager: this.manager\n\n            } );\n\n            parser.parse( function ( scene, scenes, cameras, animations, asset ) {\n\n                console.timeEnd( 'GLTFLoader' );\n\n                var glTF = {\n                    scene: scene,\n                    scenes: scenes,\n                    cameras: cameras,\n                    animations: animations,\n                    asset: asset\n                };\n\n                onLoad( glTF );\n\n            }, onError );\n\n        }\n\n    };\n\n    /* GLTFREGISTRY */\n\n    function GLTFRegistry() {\n\n        var objects = {};\n\n        return\t{\n\n            get: function ( key ) {\n\n                return objects[ key ];\n\n            },\n\n            add: function ( key, object ) {\n\n                objects[ key ] = object;\n\n            },\n\n            remove: function ( key ) {\n\n                delete objects[ key ];\n\n            },\n\n            removeAll: function () {\n\n                objects = {};\n\n            }\n\n        };\n\n    }\n\n    /*********************************/\n    /********** EXTENSIONS ***********/\n    /*********************************/\n\n    var EXTENSIONS = {\n        KHR_BINARY_GLTF: 'KHR_binary_glTF',\n        KHR_LIGHTS: 'KHR_lights',\n        KHR_MATERIALS_COMMON: 'KHR_materials_common',\n        KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness'\n    };\n\n    /**\n     * Lights Extension\n     *\n     * Specification: PENDING\n     */\n    function GLTFLightsExtension( json ) {\n\n        this.name = EXTENSIONS.KHR_LIGHTS;\n\n        this.lights = {};\n\n        var extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_LIGHTS ] ) || {};\n        var lights = extension.lights || {};\n\n        for ( var lightId in lights ) {\n\n            var light = lights[ lightId ];\n            var lightNode;\n\n            var color = new THREE.Color().fromArray( light.color );\n\n            switch ( light.type ) {\n\n                case 'directional':\n                    lightNode = new THREE.DirectionalLight( color );\n                    lightNode.position.set( 0, 0, 1 );\n                    break;\n\n                case 'point':\n                    lightNode = new THREE.PointLight( color );\n                    break;\n\n                case 'spot':\n                    lightNode = new THREE.SpotLight( color );\n                    lightNode.position.set( 0, 0, 1 );\n                    break;\n\n                case 'ambient':\n                    lightNode = new THREE.AmbientLight( color );\n                    break;\n\n            }\n\n            if ( lightNode ) {\n\n                if ( light.constantAttenuation !== undefined ) {\n\n                    lightNode.intensity = light.constantAttenuation;\n\n                }\n\n                if ( light.linearAttenuation !== undefined ) {\n\n                    lightNode.distance = 1 / light.linearAttenuation;\n\n                }\n\n                if ( light.quadraticAttenuation !== undefined ) {\n\n                    lightNode.decay = light.quadraticAttenuation;\n\n                }\n\n                if ( light.fallOffAngle !== undefined ) {\n\n                    lightNode.angle = light.fallOffAngle;\n\n                }\n\n                if ( light.fallOffExponent !== undefined ) {\n\n                    console.warn( 'THREE.GLTFLoader:: light.fallOffExponent not currently supported.' );\n\n                }\n\n                lightNode.name = light.name || ( 'light_' + lightId );\n                this.lights[ lightId ] = lightNode;\n\n            }\n\n        }\n\n    }\n\n    /**\n     * Common Materials Extension\n     *\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_common\n     */\n    function GLTFMaterialsCommonExtension( json ) {\n\n        this.name = EXTENSIONS.KHR_MATERIALS_COMMON;\n\n    }\n\n    GLTFMaterialsCommonExtension.prototype.getMaterialType = function ( material ) {\n\n        var khrMaterial = material.extensions[ this.name ];\n\n        switch ( khrMaterial.type ) {\n\n            case 'commonBlinn' :\n            case 'commonPhong' :\n                return THREE.MeshPhongMaterial;\n\n            case 'commonLambert' :\n                return THREE.MeshLambertMaterial;\n\n            case 'commonConstant' :\n            default :\n                return THREE.MeshBasicMaterial;\n\n        }\n\n    };\n\n    GLTFMaterialsCommonExtension.prototype.extendParams = function ( materialParams, material, parser ) {\n\n        var khrMaterial = material.extensions[ this.name ];\n\n        var pending = [];\n\n        var keys = [];\n\n        // TODO: Currently ignored: 'ambientFactor', 'ambientTexture'\n        switch ( khrMaterial.type ) {\n\n            case 'commonBlinn' :\n            case 'commonPhong' :\n                keys.push( 'diffuseFactor', 'diffuseTexture', 'specularFactor', 'specularTexture', 'shininessFactor' );\n                break;\n\n            case 'commonLambert' :\n                keys.push( 'diffuseFactor', 'diffuseTexture' );\n                break;\n\n            case 'commonConstant' :\n            default :\n                break;\n\n        }\n\n        var materialValues = {};\n\n        keys.forEach( function ( v ) {\n\n            if ( khrMaterial[ v ] !== undefined ) materialValues[ v ] = khrMaterial[ v ];\n\n        } );\n\n        if ( materialValues.diffuseFactor !== undefined ) {\n\n            materialParams.color = new THREE.Color().fromArray( materialValues.diffuseFactor );\n            materialParams.opacity = materialValues.diffuseFactor[ 3 ];\n\n        }\n\n        if ( materialValues.diffuseTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'map', materialValues.diffuseTexture.index ) );\n\n        }\n\n        if ( materialValues.specularFactor !== undefined ) {\n\n            materialParams.specular = new THREE.Color().fromArray( materialValues.specularFactor );\n\n        }\n\n        if ( materialValues.specularTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'specularMap', materialValues.specularTexture.index ) );\n\n        }\n\n        if ( materialValues.shininessFactor !== undefined ) {\n\n            materialParams.shininess = materialValues.shininessFactor;\n\n        }\n\n        return Promise.all( pending );\n\n    };\n\n    /* BINARY EXTENSION */\n\n    var BINARY_EXTENSION_BUFFER_NAME = 'binary_glTF';\n    var BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\n    var BINARY_EXTENSION_HEADER_LENGTH = 12;\n    var BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\n    function GLTFBinaryExtension( data ) {\n\n        this.name = EXTENSIONS.KHR_BINARY_GLTF;\n        this.content = null;\n        this.body = null;\n\n        var headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n        this.header = {\n            magic: THREE.LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n            version: headerView.getUint32( 4, true ),\n            length: headerView.getUint32( 8, true )\n        };\n\n        if ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n            throw new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n        } else if ( this.header.version < 2.0 ) {\n\n            throw new Error( 'THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.' );\n\n        }\n\n        var chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n        var chunkIndex = 0;\n\n        while ( chunkIndex < chunkView.byteLength ) {\n\n            var chunkLength = chunkView.getUint32( chunkIndex, true );\n            chunkIndex += 4;\n\n            var chunkType = chunkView.getUint32( chunkIndex, true );\n            chunkIndex += 4;\n\n            if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n                var contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n                this.content = THREE.LoaderUtils.decodeText( contentArray );\n\n            } else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n                var byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n                this.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n            }\n\n            // Clients must ignore chunks with unknown types.\n\n            chunkIndex += chunkLength;\n\n        }\n\n        if ( this.content === null ) {\n\n            throw new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n        }\n\n    }\n\n    /**\n     * Specular-Glossiness Extension\n     *\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/Khronos/KHR_materials_pbrSpecularGlossiness\n     */\n    function GLTFMaterialsPbrSpecularGlossinessExtension() {\n\n        return {\n\n            name: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\n\n            specularGlossinessParams: [\n                'color',\n                'map',\n                'lightMap',\n                'lightMapIntensity',\n                'aoMap',\n                'aoMapIntensity',\n                'emissive',\n                'emissiveIntensity',\n                'emissiveMap',\n                'bumpMap',\n                'bumpScale',\n                'normalMap',\n                'displacementMap',\n                'displacementScale',\n                'displacementBias',\n                'specularMap',\n                'specular',\n                'glossinessMap',\n                'glossiness',\n                'alphaMap',\n                'envMap',\n                'envMapIntensity',\n                'refractionRatio',\n            ],\n\n            getMaterialType: function () {\n\n                return THREE.ShaderMaterial;\n\n            },\n\n            extendParams: function ( params, material, parser ) {\n\n                var pbrSpecularGlossiness = material.extensions[ this.name ];\n\n                var shader = THREE.ShaderLib[ 'standard' ];\n\n                var uniforms = THREE.UniformsUtils.clone( shader.uniforms );\n\n                var specularMapParsFragmentChunk = [\n                    '#ifdef USE_SPECULARMAP',\n                    '\tuniform sampler2D specularMap;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var glossinessMapParsFragmentChunk = [\n                    '#ifdef USE_GLOSSINESSMAP',\n                    '\tuniform sampler2D glossinessMap;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var specularMapFragmentChunk = [\n                    'vec3 specularFactor = specular;',\n                    '#ifdef USE_SPECULARMAP',\n                    '\tvec4 texelSpecular = texture2D( specularMap, vUv );',\n                    '\ttexelSpecular = sRGBToLinear( texelSpecular );',\n                    '\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\n                    '\tspecularFactor *= texelSpecular.rgb;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var glossinessMapFragmentChunk = [\n                    'float glossinessFactor = glossiness;',\n                    '#ifdef USE_GLOSSINESSMAP',\n                    '\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\n                    '\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\n                    '\tglossinessFactor *= texelGlossiness.a;',\n                    '#endif'\n                ].join( '\\n' );\n\n                var lightPhysicalFragmentChunk = [\n                    'PhysicalMaterial material;',\n                    'material.diffuseColor = diffuseColor.rgb;',\n                    'material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );',\n                    'material.specularColor = specularFactor.rgb;',\n                ].join( '\\n' );\n\n                var fragmentShader = shader.fragmentShader\n                    .replace( '#include <specularmap_fragment>', '' )\n                    .replace( 'uniform float roughness;', 'uniform vec3 specular;' )\n                    .replace( 'uniform float metalness;', 'uniform float glossiness;' )\n                    .replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\n                    .replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\n                    .replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\n                    .replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\n                    .replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\n\n                delete uniforms.roughness;\n                delete uniforms.metalness;\n                delete uniforms.roughnessMap;\n                delete uniforms.metalnessMap;\n\n                uniforms.specular = { value: new THREE.Color().setHex( 0x111111 ) };\n                uniforms.glossiness = { value: 0.5 };\n                uniforms.specularMap = { value: null };\n                uniforms.glossinessMap = { value: null };\n\n                params.vertexShader = shader.vertexShader;\n                params.fragmentShader = fragmentShader;\n                params.uniforms = uniforms;\n                params.defines = { 'STANDARD': '' };\n\n                params.color = new THREE.Color( 1.0, 1.0, 1.0 );\n                params.opacity = 1.0;\n\n                var pending = [];\n\n                if ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\n\n                    var array = pbrSpecularGlossiness.diffuseFactor;\n\n                    params.color.fromArray( array );\n                    params.opacity = array[ 3 ];\n\n                }\n\n                if ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\n\n                    pending.push( parser.assignTexture( params, 'map', pbrSpecularGlossiness.diffuseTexture.index ) );\n\n                }\n\n                params.emissive = new THREE.Color( 0.0, 0.0, 0.0 );\n                params.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\n                params.specular = new THREE.Color( 1.0, 1.0, 1.0 );\n\n                if ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\n\n                    params.specular.fromArray( pbrSpecularGlossiness.specularFactor );\n\n                }\n\n                if ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\n\n                    var specGlossIndex = pbrSpecularGlossiness.specularGlossinessTexture.index;\n                    pending.push( parser.assignTexture( params, 'glossinessMap', specGlossIndex ) );\n                    pending.push( parser.assignTexture( params, 'specularMap', specGlossIndex ) );\n\n                }\n\n                return Promise.all( pending );\n\n            },\n\n            createMaterial: function ( params ) {\n\n                // setup material properties based on MeshStandardMaterial for Specular-Glossiness\n\n                var material = new THREE.ShaderMaterial( {\n                    defines: params.defines,\n                    vertexShader: params.vertexShader,\n                    fragmentShader: params.fragmentShader,\n                    uniforms: params.uniforms,\n                    fog: true,\n                    lights: true,\n                    opacity: params.opacity,\n                    transparent: params.transparent\n                } );\n\n                material.isGLTFSpecularGlossinessMaterial = true;\n\n                material.color = params.color;\n\n                material.map = params.map === undefined ? null : params.map;\n\n                material.lightMap = null;\n                material.lightMapIntensity = 1.0;\n\n                material.aoMap = params.aoMap === undefined ? null : params.aoMap;\n                material.aoMapIntensity = 1.0;\n\n                material.emissive = params.emissive;\n                material.emissiveIntensity = 1.0;\n                material.emissiveMap = params.emissiveMap === undefined ? null : params.emissiveMap;\n\n                material.bumpMap = params.bumpMap === undefined ? null : params.bumpMap;\n                material.bumpScale = 1;\n\n                material.normalMap = params.normalMap === undefined ? null : params.normalMap;\n                if ( params.normalScale ) material.normalScale = params.normalScale;\n\n                material.displacementMap = null;\n                material.displacementScale = 1;\n                material.displacementBias = 0;\n\n                material.specularMap = params.specularMap === undefined ? null : params.specularMap;\n                material.specular = params.specular;\n\n                material.glossinessMap = params.glossinessMap === undefined ? null : params.glossinessMap;\n                material.glossiness = params.glossiness;\n\n                material.alphaMap = null;\n\n                material.envMap = params.envMap === undefined ? null : params.envMap;\n                material.envMapIntensity = 1.0;\n\n                material.refractionRatio = 0.98;\n\n                material.extensions.derivatives = true;\n\n                return material;\n\n            },\n\n            /**\n             * Clones a GLTFSpecularGlossinessMaterial instance. The ShaderMaterial.copy() method can\n             * copy only properties it knows about or inherits, and misses many properties that would\n             * normally be defined by MeshStandardMaterial.\n             *\n             * This method allows GLTFSpecularGlossinessMaterials to be cloned in the process of\n             * loading a glTF model, but cloning later (e.g. by the user) would require these changes\n             * AND also updating `.onBeforeRender` on the parent mesh.\n             *\n             * @param  {THREE.ShaderMaterial} source\n             * @return {THREE.ShaderMaterial}\n             */\n            cloneMaterial: function ( source ) {\n\n                var target = source.clone();\n\n                target.isGLTFSpecularGlossinessMaterial = true;\n\n                var params = this.specularGlossinessParams;\n\n                for ( var i = 0, il = params.length; i < il; i ++ ) {\n\n                    target[ params[ i ] ] = source[ params[ i ] ];\n\n                }\n\n                return target;\n\n            },\n\n            // Here's based on refreshUniformsCommon() and refreshUniformsStandard() in WebGLRenderer.\n            refreshUniforms: function ( renderer, scene, camera, geometry, material, group ) {\n\n                var uniforms = material.uniforms;\n                var defines = material.defines;\n\n                uniforms.opacity.value = material.opacity;\n\n                uniforms.diffuse.value.copy( material.color );\n                uniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\n\n                uniforms.map.value = material.map;\n                uniforms.specularMap.value = material.specularMap;\n                uniforms.alphaMap.value = material.alphaMap;\n\n                uniforms.lightMap.value = material.lightMap;\n                uniforms.lightMapIntensity.value = material.lightMapIntensity;\n\n                uniforms.aoMap.value = material.aoMap;\n                uniforms.aoMapIntensity.value = material.aoMapIntensity;\n\n                // uv repeat and offset setting priorities\n                // 1. color map\n                // 2. specular map\n                // 3. normal map\n                // 4. bump map\n                // 5. alpha map\n                // 6. emissive map\n\n                var uvScaleMap;\n\n                if ( material.map ) {\n\n                    uvScaleMap = material.map;\n\n                } else if ( material.specularMap ) {\n\n                    uvScaleMap = material.specularMap;\n\n                } else if ( material.displacementMap ) {\n\n                    uvScaleMap = material.displacementMap;\n\n                } else if ( material.normalMap ) {\n\n                    uvScaleMap = material.normalMap;\n\n                } else if ( material.bumpMap ) {\n\n                    uvScaleMap = material.bumpMap;\n\n                } else if ( material.glossinessMap ) {\n\n                    uvScaleMap = material.glossinessMap;\n\n                } else if ( material.alphaMap ) {\n\n                    uvScaleMap = material.alphaMap;\n\n                } else if ( material.emissiveMap ) {\n\n                    uvScaleMap = material.emissiveMap;\n\n                }\n\n                if ( uvScaleMap !== undefined ) {\n\n                    // backwards compatibility\n                    if ( uvScaleMap.isWebGLRenderTarget ) {\n\n                        uvScaleMap = uvScaleMap.texture;\n\n                    }\n\n                    var offset;\n                    var repeat;\n\n                    if ( uvScaleMap.matrix !== undefined ) {\n\n                        // > r88.\n\n                        if ( uvScaleMap.matrixAutoUpdate === true ) {\n\n                            offset = uvScaleMap.offset;\n                            repeat = uvScaleMap.repeat;\n                            var rotation = uvScaleMap.rotation;\n                            var center = uvScaleMap.center;\n\n                            uvScaleMap.matrix.setUvTransform( offset.x, offset.y, repeat.x, repeat.y, rotation, center.x, center.y );\n\n                        }\n\n                        uniforms.uvTransform.value.copy( uvScaleMap.matrix );\n\n                    } else {\n\n                        // <= r87. Remove when reasonable.\n\n                        offset = uvScaleMap.offset;\n                        repeat = uvScaleMap.repeat;\n\n                        uniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\n\n                    }\n\n                }\n\n                uniforms.envMap.value = material.envMap;\n                uniforms.envMapIntensity.value = material.envMapIntensity;\n                uniforms.flipEnvMap.value = ( material.envMap && material.envMap.isCubeTexture ) ? - 1 : 1;\n\n                uniforms.refractionRatio.value = material.refractionRatio;\n\n                uniforms.specular.value.copy( material.specular );\n                uniforms.glossiness.value = material.glossiness;\n\n                uniforms.glossinessMap.value = material.glossinessMap;\n\n                uniforms.emissiveMap.value = material.emissiveMap;\n                uniforms.bumpMap.value = material.bumpMap;\n                uniforms.normalMap.value = material.normalMap;\n\n                uniforms.displacementMap.value = material.displacementMap;\n                uniforms.displacementScale.value = material.displacementScale;\n                uniforms.displacementBias.value = material.displacementBias;\n\n                if ( uniforms.glossinessMap.value !== null && defines.USE_GLOSSINESSMAP === undefined ) {\n\n                    defines.USE_GLOSSINESSMAP = '';\n                    // set USE_ROUGHNESSMAP to enable vUv\n                    defines.USE_ROUGHNESSMAP = '';\n\n                }\n\n                if ( uniforms.glossinessMap.value === null && defines.USE_GLOSSINESSMAP !== undefined ) {\n\n                    delete defines.USE_GLOSSINESSMAP;\n                    delete defines.USE_ROUGHNESSMAP;\n\n                }\n\n            }\n\n        };\n\n    }\n\n    /*********************************/\n    /********** INTERNALS ************/\n    /*********************************/\n\n    /* CONSTANTS */\n\n    var WEBGL_CONSTANTS = {\n        FLOAT: 5126,\n        //FLOAT_MAT2: 35674,\n        FLOAT_MAT3: 35675,\n        FLOAT_MAT4: 35676,\n        FLOAT_VEC2: 35664,\n        FLOAT_VEC3: 35665,\n        FLOAT_VEC4: 35666,\n        LINEAR: 9729,\n        REPEAT: 10497,\n        SAMPLER_2D: 35678,\n        POINTS: 0,\n        LINES: 1,\n        LINE_LOOP: 2,\n        LINE_STRIP: 3,\n        TRIANGLES: 4,\n        TRIANGLE_STRIP: 5,\n        TRIANGLE_FAN: 6,\n        UNSIGNED_BYTE: 5121,\n        UNSIGNED_SHORT: 5123\n    };\n\n    var WEBGL_TYPE = {\n        5126: Number,\n        //35674: THREE.Matrix2,\n        35675: THREE.Matrix3,\n        35676: THREE.Matrix4,\n        35664: THREE.Vector2,\n        35665: THREE.Vector3,\n        35666: THREE.Vector4,\n        35678: THREE.Texture\n    };\n\n    var WEBGL_COMPONENT_TYPES = {\n        5120: Int8Array,\n        5121: Uint8Array,\n        5122: Int16Array,\n        5123: Uint16Array,\n        5125: Uint32Array,\n        5126: Float32Array\n    };\n\n    var WEBGL_FILTERS = {\n        9728: THREE.NearestFilter,\n        9729: THREE.LinearFilter,\n        9984: THREE.NearestMipMapNearestFilter,\n        9985: THREE.LinearMipMapNearestFilter,\n        9986: THREE.NearestMipMapLinearFilter,\n        9987: THREE.LinearMipMapLinearFilter\n    };\n\n    var WEBGL_WRAPPINGS = {\n        33071: THREE.ClampToEdgeWrapping,\n        33648: THREE.MirroredRepeatWrapping,\n        10497: THREE.RepeatWrapping\n    };\n\n    var WEBGL_TEXTURE_FORMATS = {\n        6406: THREE.AlphaFormat,\n        6407: THREE.RGBFormat,\n        6408: THREE.RGBAFormat,\n        6409: THREE.LuminanceFormat,\n        6410: THREE.LuminanceAlphaFormat\n    };\n\n    var WEBGL_TEXTURE_DATATYPES = {\n        5121: THREE.UnsignedByteType,\n        32819: THREE.UnsignedShort4444Type,\n        32820: THREE.UnsignedShort5551Type,\n        33635: THREE.UnsignedShort565Type\n    };\n\n    var WEBGL_SIDES = {\n        1028: THREE.BackSide, // Culling front\n        1029: THREE.FrontSide // Culling back\n        //1032: THREE.NoSide   // Culling front and back, what to do?\n    };\n\n    var WEBGL_DEPTH_FUNCS = {\n        512: THREE.NeverDepth,\n        513: THREE.LessDepth,\n        514: THREE.EqualDepth,\n        515: THREE.LessEqualDepth,\n        516: THREE.GreaterEqualDepth,\n        517: THREE.NotEqualDepth,\n        518: THREE.GreaterEqualDepth,\n        519: THREE.AlwaysDepth\n    };\n\n    var WEBGL_BLEND_EQUATIONS = {\n        32774: THREE.AddEquation,\n        32778: THREE.SubtractEquation,\n        32779: THREE.ReverseSubtractEquation\n    };\n\n    var WEBGL_BLEND_FUNCS = {\n        0: THREE.ZeroFactor,\n        1: THREE.OneFactor,\n        768: THREE.SrcColorFactor,\n        769: THREE.OneMinusSrcColorFactor,\n        770: THREE.SrcAlphaFactor,\n        771: THREE.OneMinusSrcAlphaFactor,\n        772: THREE.DstAlphaFactor,\n        773: THREE.OneMinusDstAlphaFactor,\n        774: THREE.DstColorFactor,\n        775: THREE.OneMinusDstColorFactor,\n        776: THREE.SrcAlphaSaturateFactor\n        // The followings are not supported by Three.js yet\n        //32769: CONSTANT_COLOR,\n        //32770: ONE_MINUS_CONSTANT_COLOR,\n        //32771: CONSTANT_ALPHA,\n        //32772: ONE_MINUS_CONSTANT_COLOR\n    };\n\n    var WEBGL_TYPE_SIZES = {\n        'SCALAR': 1,\n        'VEC2': 2,\n        'VEC3': 3,\n        'VEC4': 4,\n        'MAT2': 4,\n        'MAT3': 9,\n        'MAT4': 16\n    };\n\n    var PATH_PROPERTIES = {\n        scale: 'scale',\n        translation: 'position',\n        rotation: 'quaternion',\n        weights: 'morphTargetInfluences'\n    };\n\n    var INTERPOLATION = {\n        CUBICSPLINE: THREE.InterpolateSmooth,\n        LINEAR: THREE.InterpolateLinear,\n        STEP: THREE.InterpolateDiscrete\n    };\n\n    var STATES_ENABLES = {\n        2884: 'CULL_FACE',\n        2929: 'DEPTH_TEST',\n        3042: 'BLEND',\n        3089: 'SCISSOR_TEST',\n        32823: 'POLYGON_OFFSET_FILL',\n        32926: 'SAMPLE_ALPHA_TO_COVERAGE'\n    };\n\n    var ALPHA_MODES = {\n        OPAQUE: 'OPAQUE',\n        MASK: 'MASK',\n        BLEND: 'BLEND'\n    };\n\n    /* UTILITY FUNCTIONS */\n\n    function resolveURL( url, path ) {\n\n        // Invalid URL\n        if ( typeof url !== 'string' || url === '' ) return '';\n\n        // Absolute URL http://,https://,//\n        if ( /^(https?:)?\\/\\//i.test( url ) ) return url;\n\n        // Data URI\n        if ( /^data:.*,.*$/i.test( url ) ) return url;\n\n        // Blob URL\n        if ( /^blob:.*$/i.test( url ) ) return url;\n\n        // Relative URL\n        return path + url;\n\n    }\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n     */\n    function createDefaultMaterial() {\n\n        return new THREE.MeshStandardMaterial( {\n            color: 0xFFFFFF,\n            emissive: 0x000000,\n            metalness: 1,\n            roughness: 1,\n            transparent: false,\n            depthTest: true,\n            side: THREE.FrontSide\n        } );\n\n    }\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n     *\n     * TODO: Implement support for morph targets on TANGENT attribute.\n     *\n     * @param {THREE.Mesh} mesh\n     * @param {GLTF.Mesh} meshDef\n     * @param {GLTF.Primitive} primitiveDef\n     * @param {Array<THREE.BufferAttribute>} accessors\n     */\n    function addMorphTargets( mesh, meshDef, primitiveDef, accessors ) {\n\n        var geometry = mesh.geometry;\n        var material = mesh.material;\n\n        var targets = primitiveDef.targets;\n        var morphAttributes = geometry.morphAttributes;\n\n        morphAttributes.position = [];\n        morphAttributes.normal = [];\n\n        material.morphTargets = true;\n\n        for ( var i = 0, il = targets.length; i < il; i ++ ) {\n\n            var target = targets[ i ];\n            var attributeName = 'morphTarget' + i;\n\n            var positionAttribute, normalAttribute;\n\n            if ( target.POSITION !== undefined ) {\n\n                // Three.js morph formula is\n                //   position\n                //     + weight0 * ( morphTarget0 - position )\n                //     + weight1 * ( morphTarget1 - position )\n                //     ...\n                // while the glTF one is\n                //   position\n                //     + weight0 * morphTarget0\n                //     + weight1 * morphTarget1\n                //     ...\n                // then adding position to morphTarget.\n                // So morphTarget value will depend on mesh's position, then cloning attribute\n                // for the case if attribute is shared among two or more meshes.\n\n                positionAttribute = accessors[ target.POSITION ].clone();\n                var position = geometry.attributes.position;\n\n                for ( var j = 0, jl = positionAttribute.count; j < jl; j ++ ) {\n\n                    positionAttribute.setXYZ(\n                        j,\n                        positionAttribute.getX( j ) + position.getX( j ),\n                        positionAttribute.getY( j ) + position.getY( j ),\n                        positionAttribute.getZ( j ) + position.getZ( j )\n                    );\n\n                }\n\n            } else if ( geometry.attributes.position ) {\n\n                // Copying the original position not to affect the final position.\n                // See the formula above.\n                positionAttribute = geometry.attributes.position.clone();\n\n            }\n\n            if ( positionAttribute !== undefined ) {\n\n                positionAttribute.name = attributeName;\n                morphAttributes.position.push( positionAttribute );\n\n            }\n\n            if ( target.NORMAL !== undefined ) {\n\n                material.morphNormals = true;\n\n                // see target.POSITION's comment\n\n                normalAttribute = accessors[ target.NORMAL ].clone();\n                var normal = geometry.attributes.normal;\n\n                for ( var j = 0, jl = normalAttribute.count; j < jl; j ++ ) {\n\n                    normalAttribute.setXYZ(\n                        j,\n                        normalAttribute.getX( j ) + normal.getX( j ),\n                        normalAttribute.getY( j ) + normal.getY( j ),\n                        normalAttribute.getZ( j ) + normal.getZ( j )\n                    );\n\n                }\n\n            } else if ( geometry.attributes.normal !== undefined ) {\n\n                normalAttribute = geometry.attributes.normal.clone();\n\n            }\n\n            if ( normalAttribute !== undefined ) {\n\n                normalAttribute.name = attributeName;\n                morphAttributes.normal.push( normalAttribute );\n\n            }\n\n        }\n\n        mesh.updateMorphTargets();\n\n        if ( meshDef.weights !== undefined ) {\n\n            for ( var i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n                mesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n            }\n\n        }\n\n    }\n\n    function isPrimitiveEqual( a, b ) {\n\n        if ( a.indices !== b.indices ) {\n\n            return false;\n\n        }\n\n        var attribA = a.attributes || {};\n        var attribB = b.attributes || {};\n        var keysA = Object.keys( attribA );\n        var keysB = Object.keys( attribB );\n\n        if ( keysA.length !== keysB.length ) {\n\n            return false;\n\n        }\n\n        for ( var i = 0, il = keysA.length; i < il; i ++ ) {\n\n            var key = keysA[ i ];\n\n            if ( attribA[ key ] !== attribB[ key ] ) {\n\n                return false;\n\n            }\n\n        }\n\n        return true;\n\n    }\n\n    function getCachedGeometry( cache, newPrimitive ) {\n\n        for ( var i = 0, il = cache.length; i < il; i ++ ) {\n\n            var cached = cache[ i ];\n\n            if ( isPrimitiveEqual( cached.primitive, newPrimitive ) ) {\n\n                return cached.geometry;\n\n            }\n\n        }\n\n        return null;\n\n    }\n\n    /* GLTF PARSER */\n\n    function GLTFParser( json, extensions, options ) {\n\n        this.json = json || {};\n        this.extensions = extensions || {};\n        this.options = options || {};\n\n        // loader object cache\n        this.cache = new GLTFRegistry();\n\n        // BufferGeometry caching\n        this.primitiveCache = [];\n\n        this.textureLoader = new THREE.TextureLoader( this.options.manager );\n        this.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\n        this.fileLoader = new THREE.FileLoader( this.options.manager );\n        this.fileLoader.setResponseType( 'arraybuffer' );\n\n    }\n\n    GLTFParser.prototype.parse = function ( onLoad, onError ) {\n\n        var json = this.json;\n        var parser = this;\n\n        // Clear the loader cache\n        this.cache.removeAll();\n\n        // Mark the special nodes/meshes in json for efficient parse\n        this.markDefs();\n\n        // Fire the callback on complete\n        this.getMultiDependencies( [\n\n            'scene',\n            'animation',\n            'camera'\n\n        ] ).then( function ( dependencies ) {\n\n            var scenes = dependencies.scenes || [];\n            var scene = scenes[ json.scene || 0 ];\n            var animations = dependencies.animations || [];\n            var asset = json.asset;\n            var cameras = dependencies.cameras || [];\n\n            onLoad( scene, scenes, cameras, animations, asset );\n\n        } ).catch( onError );\n\n    };\n\n    /**\n     * Marks the special nodes/meshes in json for efficient parse.\n     */\n    GLTFParser.prototype.markDefs = function () {\n\n        var nodeDefs = this.json.nodes || [];\n        var skinDefs = this.json.skins || [];\n        var meshDefs = this.json.meshes || [];\n\n        var meshReferences = {};\n        var meshUses = {};\n\n        // Nothing in the node definition indicates whether it is a Bone or an\n        // Object3D. Use the skins' joint references to mark bones.\n        for ( var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n            var joints = skinDefs[ skinIndex ].joints;\n\n            for ( var i = 0, il = joints.length; i < il; i ++ ) {\n\n                nodeDefs[ joints[ i ] ].isBone = true;\n\n            }\n\n        }\n\n        // Meshes can (and should) be reused by multiple nodes in a glTF asset. To\n        // avoid having more than one THREE.Mesh with the same name, count\n        // references and rename instances below.\n        //\n        // Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n        for ( var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n            var nodeDef = nodeDefs[ nodeIndex ];\n\n            if ( nodeDef.mesh !== undefined ) {\n\n                if ( meshReferences[ nodeDef.mesh ] === undefined ) {\n\n                    meshReferences[ nodeDef.mesh ] = meshUses[ nodeDef.mesh ] = 0;\n\n                }\n\n                meshReferences[ nodeDef.mesh ] ++;\n\n                // Nothing in the mesh definition indicates whether it is\n                // a SkinnedMesh or Mesh. Use the node's mesh reference\n                // to mark SkinnedMesh if node has skin.\n                if ( nodeDef.skin !== undefined ) {\n\n                    meshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n                }\n\n            }\n\n        }\n\n        this.json.meshReferences = meshReferences;\n        this.json.meshUses = meshUses;\n\n    };\n\n    /**\n     * Requests the specified dependency asynchronously, with caching.\n     * @param {string} type\n     * @param {number} index\n     * @return {Promise<Object>}\n     */\n    GLTFParser.prototype.getDependency = function ( type, index ) {\n\n        var cacheKey = type + ':' + index;\n        var dependency = this.cache.get( cacheKey );\n\n        if ( ! dependency ) {\n\n            var fnName = 'load' + type.charAt( 0 ).toUpperCase() + type.slice( 1 );\n            dependency = this[ fnName ]( index );\n            this.cache.add( cacheKey, dependency );\n\n        }\n\n        return dependency;\n\n    };\n\n    /**\n     * Requests all dependencies of the specified type asynchronously, with caching.\n     * @param {string} type\n     * @return {Promise<Array<Object>>}\n     */\n    GLTFParser.prototype.getDependencies = function ( type ) {\n\n        var dependencies = this.cache.get( type );\n\n        if ( ! dependencies ) {\n\n            var parser = this;\n            var defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n            dependencies = Promise.all( defs.map( function ( def, index ) {\n\n                return parser.getDependency( type, index );\n\n            } ) );\n\n            this.cache.add( type, dependencies );\n\n        }\n\n        return dependencies;\n\n    };\n\n    /**\n     * Requests all multiple dependencies of the specified types asynchronously, with caching.\n     * @param {Array<string>} types\n     * @return {Promise<Object<Array<Object>>>}\n     */\n    GLTFParser.prototype.getMultiDependencies = function ( types ) {\n\n        var results = {};\n        var pendings = [];\n\n        for ( var i = 0, il = types.length; i < il; i ++ ) {\n\n            var type = types[ i ];\n            var value = this.getDependencies( type );\n\n            value = value.then( function ( key, value ) {\n\n                results[ key ] = value;\n\n            }.bind( this, type + ( type === 'mesh' ? 'es' : 's' ) ) );\n\n            pendings.push( value );\n\n        }\n\n        return Promise.all( pendings ).then( function () {\n\n            return results;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n     * @param {number} bufferIndex\n     * @return {Promise<ArrayBuffer>}\n     */\n    GLTFParser.prototype.loadBuffer = function ( bufferIndex ) {\n\n        var bufferDef = this.json.buffers[ bufferIndex ];\n        var loader = this.fileLoader;\n\n        if ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n            throw new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n        }\n\n        // If present, GLB container is required to be the first buffer.\n        if ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n            return Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n        }\n\n        var options = this.options;\n\n        return new Promise( function ( resolve, reject ) {\n\n            loader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n                reject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n            } );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n     * @param {number} bufferViewIndex\n     * @return {Promise<ArrayBuffer>}\n     */\n    GLTFParser.prototype.loadBufferView = function ( bufferViewIndex ) {\n\n        var bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n        return this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n            var byteLength = bufferViewDef.byteLength || 0;\n            var byteOffset = bufferViewDef.byteOffset || 0;\n            return buffer.slice( byteOffset, byteOffset + byteLength );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n     * @param {number} accessorIndex\n     * @return {Promise<THREE.BufferAttribute|THREE.InterleavedBufferAttribute>}\n     */\n    GLTFParser.prototype.loadAccessor = function ( accessorIndex ) {\n\n        var json = this.json;\n\n        var accessorDef = this.json.accessors[ accessorIndex ];\n\n        var pendingBufferViews = [];\n\n        if ( accessorDef.bufferView !== undefined ) {\n\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n        } else {\n\n            pendingBufferViews.push( null );\n\n        }\n\n        if ( accessorDef.sparse !== undefined ) {\n\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n            pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n        }\n\n        return Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n            var bufferView = bufferViews[ 0 ];\n\n            var itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n            var TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n            // For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n            var elementBytes = TypedArray.BYTES_PER_ELEMENT;\n            var itemBytes = elementBytes * itemSize;\n            var byteStride = json.bufferViews[ accessorDef.bufferView ].byteStride;\n            var normalized = accessorDef.normalized === true;\n            var array, bufferAttribute;\n\n            // The buffer is not interleaved if the stride is the item size in bytes.\n            if ( byteStride && byteStride !== itemBytes ) {\n\n                // Use the full buffer if it's interleaved.\n                array = new TypedArray( bufferView );\n\n                // Integer parameters to IB/IBA are in array elements, not bytes.\n                var ib = new THREE.InterleavedBuffer( array, byteStride / elementBytes );\n\n                bufferAttribute = new THREE.InterleavedBufferAttribute( ib, itemSize, accessorDef.byteOffset / elementBytes, normalized );\n\n            } else {\n\n                if ( bufferView === null ) {\n\n                    array = new TypedArray( accessorDef.count * itemSize );\n\n                } else {\n\n                    array = new TypedArray( bufferView, accessorDef.byteOffset, accessorDef.count * itemSize );\n\n                }\n\n                bufferAttribute = new THREE.BufferAttribute( array, itemSize, normalized );\n\n            }\n\n            // https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n            if ( accessorDef.sparse !== undefined ) {\n\n                var itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n                var TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n                var byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n                var byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n                var sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n                var sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n                if ( bufferView !== null ) {\n\n                    // Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n                    bufferAttribute.setArray( bufferAttribute.array.slice() );\n\n                }\n\n                for ( var i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n                    var index = sparseIndices[ i ];\n\n                    bufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n                    if ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n                    if ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n                    if ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n                    if ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n                }\n\n            }\n\n            return bufferAttribute;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n     * @param {number} textureIndex\n     * @return {Promise<THREE.Texture>}\n     */\n    GLTFParser.prototype.loadTexture = function ( textureIndex ) {\n\n        var parser = this;\n        var json = this.json;\n        var options = this.options;\n        var textureLoader = this.textureLoader;\n\n        var URL = window.URL || window.webkitURL;\n\n        var textureDef = json.textures[ textureIndex ];\n        var source = json.images[ textureDef.source ];\n        var sourceURI = source.uri;\n        var isObjectURL = false;\n\n        if ( source.bufferView !== undefined ) {\n\n            // Load binary image data from bufferView, if provided.\n\n            sourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\n\n                isObjectURL = true;\n                var blob = new Blob( [ bufferView ], { type: source.mimeType } );\n                sourceURI = URL.createObjectURL( blob );\n                return sourceURI;\n\n            } );\n\n        }\n\n        return Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n            // Load Texture resource.\n\n            var loader = THREE.Loader.Handlers.get( sourceURI ) || textureLoader;\n\n            return new Promise( function ( resolve, reject ) {\n\n                loader.load( resolveURL( sourceURI, options.path ), resolve, undefined, reject );\n\n            } );\n\n        } ).then( function ( texture ) {\n\n            // Clean up resources and configure Texture.\n\n            if ( isObjectURL === true ) {\n\n                URL.revokeObjectURL( sourceURI );\n\n            }\n\n            texture.flipY = false;\n\n            if ( textureDef.name !== undefined ) texture.name = textureDef.name;\n\n            texture.format = textureDef.format !== undefined ? WEBGL_TEXTURE_FORMATS[ textureDef.format ] : THREE.RGBAFormat;\n\n            if ( textureDef.internalFormat !== undefined && texture.format !== WEBGL_TEXTURE_FORMATS[ textureDef.internalFormat ] ) {\n\n                console.warn( 'THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. ' +\n                    'internalFormat will be forced to be the same value as format.' );\n\n            }\n\n            texture.type = textureDef.type !== undefined ? WEBGL_TEXTURE_DATATYPES[ textureDef.type ] : THREE.UnsignedByteType;\n\n            var samplers = json.samplers || {};\n            var sampler = samplers[ textureDef.sampler ] || {};\n\n            texture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || THREE.LinearFilter;\n            texture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || THREE.LinearMipMapLinearFilter;\n            texture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || THREE.RepeatWrapping;\n            texture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || THREE.RepeatWrapping;\n\n            return texture;\n\n        } );\n\n    };\n\n    /**\n     * Asynchronously assigns a texture to the given material parameters.\n     * @param {Object} materialParams\n     * @param {string} textureName\n     * @param {number} textureIndex\n     * @return {Promise}\n     */\n    GLTFParser.prototype.assignTexture = function ( materialParams, textureName, textureIndex ) {\n\n        return this.getDependency( 'texture', textureIndex ).then( function ( texture ) {\n\n            materialParams[ textureName ] = texture;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n     * @param {number} materialIndex\n     * @return {Promise<THREE.Material>}\n     */\n    GLTFParser.prototype.loadMaterial = function ( materialIndex ) {\n\n        var parser = this;\n        var json = this.json;\n        var extensions = this.extensions;\n        var materialDef = this.json.materials[ materialIndex ];\n\n        var materialType;\n        var materialParams = {};\n        var materialExtensions = materialDef.extensions || {};\n\n        var pending = [];\n\n        if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) {\n\n            var khcExtension = extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ];\n            materialType = khcExtension.getMaterialType( materialDef );\n            pending.push( khcExtension.extendParams( materialParams, materialDef, parser ) );\n\n        } else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\n\n            var sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n            materialType = sgExtension.getMaterialType( materialDef );\n            pending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\n\n        } else if ( materialDef.pbrMetallicRoughness !== undefined ) {\n\n            // Specification:\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n            materialType = THREE.MeshStandardMaterial;\n\n            var metallicRoughness = materialDef.pbrMetallicRoughness;\n\n            materialParams.color = new THREE.Color( 1.0, 1.0, 1.0 );\n            materialParams.opacity = 1.0;\n\n            if ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n                var array = metallicRoughness.baseColorFactor;\n\n                materialParams.color.fromArray( array );\n                materialParams.opacity = array[ 3 ];\n\n            }\n\n            if ( metallicRoughness.baseColorTexture !== undefined ) {\n\n                pending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture.index ) );\n\n            }\n\n            materialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n            materialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n            if ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n                var textureIndex = metallicRoughness.metallicRoughnessTexture.index;\n                pending.push( parser.assignTexture( materialParams, 'metalnessMap', textureIndex ) );\n                pending.push( parser.assignTexture( materialParams, 'roughnessMap', textureIndex ) );\n\n            }\n\n        } else {\n\n            materialType = THREE.MeshPhongMaterial;\n\n        }\n\n        if ( materialDef.doubleSided === true ) {\n\n            materialParams.side = THREE.DoubleSide;\n\n        }\n\n        var alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n        if ( alphaMode === ALPHA_MODES.BLEND ) {\n\n            materialParams.transparent = true;\n\n        } else {\n\n            materialParams.transparent = false;\n\n            if ( alphaMode === ALPHA_MODES.MASK ) {\n\n                materialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n            }\n\n        }\n\n        if ( materialDef.normalTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture.index ) );\n\n            materialParams.normalScale = new THREE.Vector2( 1, 1 );\n\n            if ( materialDef.normalTexture.scale !== undefined ) {\n\n                materialParams.normalScale.set( materialDef.normalTexture.scale, materialDef.normalTexture.scale );\n\n            }\n\n        }\n\n        if ( materialDef.occlusionTexture !== undefined ) {\n\n            pending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture.index ) );\n\n            if ( materialDef.occlusionTexture.strength !== undefined ) {\n\n                materialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n            }\n\n        }\n\n        if ( materialDef.emissiveFactor !== undefined ) {\n\n            if ( materialType === THREE.MeshBasicMaterial ) {\n\n                materialParams.color = new THREE.Color().fromArray( materialDef.emissiveFactor );\n\n            } else {\n\n                materialParams.emissive = new THREE.Color().fromArray( materialDef.emissiveFactor );\n\n            }\n\n        }\n\n        if ( materialDef.emissiveTexture !== undefined ) {\n\n            if ( materialType === THREE.MeshBasicMaterial ) {\n\n                pending.push( parser.assignTexture( materialParams, 'map', materialDef.emissiveTexture.index ) );\n\n            } else {\n\n                pending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture.index ) );\n\n            }\n\n        }\n\n        return Promise.all( pending ).then( function () {\n\n            var material;\n\n            if ( materialType === THREE.ShaderMaterial ) {\n\n                material = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\n\n            } else {\n\n                material = new materialType( materialParams );\n\n            }\n\n            if ( materialDef.name !== undefined ) material.name = materialDef.name;\n\n            // Normal map textures use OpenGL conventions:\n            // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#materialnormaltexture\n            if ( material.normalScale ) {\n\n                material.normalScale.x = - material.normalScale.x;\n\n            }\n\n            // emissiveTexture and baseColorTexture use sRGB encoding.\n            if ( material.map ) material.map.encoding = THREE.sRGBEncoding;\n            if ( material.emissiveMap ) material.emissiveMap.encoding = THREE.sRGBEncoding;\n\n            if ( materialDef.extras ) material.userData = materialDef.extras;\n\n            return material;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n     * @param {Array<Object>} primitives\n     * @return {Promise<Array<THREE.BufferGeometry>>}\n     */\n    GLTFParser.prototype.loadGeometries = function ( primitives ) {\n\n        var cache = this.primitiveCache;\n\n        return this.getDependencies( 'accessor' ).then( function ( accessors ) {\n\n            var geometries = [];\n\n            for ( var i = 0, il = primitives.length; i < il; i ++ ) {\n\n                var primitive = primitives[ i ];\n\n                // See if we've already created this geometry\n                var cached = getCachedGeometry( cache, primitive );\n\n                if ( cached ) {\n\n                    // Use the cached geometry if it exists\n                    geometries.push( cached );\n\n                } else {\n\n                    // Otherwise create a new geometry\n                    var geometry = new THREE.BufferGeometry();\n\n                    var attributes = primitive.attributes;\n\n                    for ( var attributeId in attributes ) {\n\n                        var attributeEntry = attributes[ attributeId ];\n\n                        var bufferAttribute = accessors[ attributeEntry ];\n\n                        switch ( attributeId ) {\n\n                            case 'POSITION':\n\n                                geometry.addAttribute( 'position', bufferAttribute );\n                                break;\n\n                            case 'NORMAL':\n\n                                geometry.addAttribute( 'normal', bufferAttribute );\n                                break;\n\n                            case 'TEXCOORD_0':\n                            case 'TEXCOORD0':\n                            case 'TEXCOORD':\n\n                                geometry.addAttribute( 'uv', bufferAttribute );\n                                break;\n\n                            case 'TEXCOORD_1':\n\n                                geometry.addAttribute( 'uv2', bufferAttribute );\n                                break;\n\n                            case 'COLOR_0':\n                            case 'COLOR0':\n                            case 'COLOR':\n\n                                geometry.addAttribute( 'color', bufferAttribute );\n                                break;\n\n                            case 'WEIGHTS_0':\n                            case 'WEIGHT': // WEIGHT semantic deprecated.\n\n                                geometry.addAttribute( 'skinWeight', bufferAttribute );\n                                break;\n\n                            case 'JOINTS_0':\n                            case 'JOINT': // JOINT semantic deprecated.\n\n                                geometry.addAttribute( 'skinIndex', bufferAttribute );\n                                break;\n\n                        }\n\n                    }\n\n                    if ( primitive.indices !== undefined ) {\n\n                        geometry.setIndex( accessors[ primitive.indices ] );\n\n                    }\n\n                    // Cache this geometry\n                    cache.push( {\n\n                        primitive: primitive,\n                        geometry: geometry\n\n                    } );\n\n                    geometries.push( geometry );\n\n                }\n\n            }\n\n            return geometries;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n     * @param {number} meshIndex\n     * @return {Promise<THREE.Group|THREE.Mesh|THREE.SkinnedMesh>}\n     */\n    GLTFParser.prototype.loadMesh = function ( meshIndex ) {\n\n        var scope = this;\n        var json = this.json;\n        var extensions = this.extensions;\n\n        var meshDef = this.json.meshes[ meshIndex ];\n\n        return this.getMultiDependencies( [\n\n            'accessor',\n            'material'\n\n        ] ).then( function ( dependencies ) {\n\n            var group = new THREE.Group();\n\n            var primitives = meshDef.primitives;\n\n            return scope.loadGeometries( primitives ).then( function ( geometries ) {\n\n                for ( var i = 0, il = primitives.length; i < il; i ++ ) {\n\n                    var primitive = primitives[ i ];\n                    var geometry = geometries[ i ];\n\n                    var material = primitive.material === undefined\n                        ? createDefaultMaterial()\n                        : dependencies.materials[ primitive.material ];\n\n                    if ( material.aoMap\n                        && geometry.attributes.uv2 === undefined\n                        && geometry.attributes.uv !== undefined ) {\n\n                        console.log( 'THREE.GLTFLoader: Duplicating UVs to support aoMap.' );\n                        geometry.addAttribute( 'uv2', new THREE.BufferAttribute( geometry.attributes.uv.array, 2 ) );\n\n                    }\n\n                    // If the material will be modified later on, clone it now.\n                    var useVertexColors = geometry.attributes.color !== undefined;\n                    var useFlatShading = geometry.attributes.normal === undefined;\n                    var useSkinning = meshDef.isSkinnedMesh === true;\n                    var useMorphTargets = primitive.targets !== undefined;\n\n                    if ( useVertexColors || useFlatShading || useSkinning || useMorphTargets ) {\n\n                        if ( material.isGLTFSpecularGlossinessMaterial ) {\n\n                            var specGlossExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n                            material = specGlossExtension.cloneMaterial( material );\n\n                        } else {\n\n                            material = material.clone();\n\n                        }\n\n                    }\n\n                    if ( useVertexColors ) {\n\n                        material.vertexColors = THREE.VertexColors;\n                        material.needsUpdate = true;\n\n                    }\n\n                    if ( useFlatShading ) {\n\n                        material.flatShading = true;\n\n                    }\n\n                    var mesh;\n\n                    if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n                        primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n                        primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n                        primitive.mode === undefined ) {\n\n                        if ( useSkinning ) {\n\n                            mesh = new THREE.SkinnedMesh( geometry, material );\n                            material.skinning = true;\n\n                        } else {\n\n                            mesh = new THREE.Mesh( geometry, material );\n\n                        }\n\n                        if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n                            mesh.drawMode = THREE.TriangleStripDrawMode;\n\n                        } else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n                            mesh.drawMode = THREE.TriangleFanDrawMode;\n\n                        }\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n                        mesh = new THREE.LineSegments( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n                        mesh = new THREE.Line( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n                        mesh = new THREE.LineLoop( geometry, material );\n\n                    } else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n                        mesh = new THREE.Points( geometry, material );\n\n                    } else {\n\n                        throw new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n                    }\n\n                    mesh.name = meshDef.name || ( 'mesh_' + meshIndex );\n\n                    if ( useMorphTargets ) {\n\n                        addMorphTargets( mesh, meshDef, primitive, dependencies.accessors );\n\n                    }\n\n                    if ( meshDef.extras !== undefined ) mesh.userData = meshDef.extras;\n                    if ( primitive.extras !== undefined ) mesh.geometry.userData = primitive.extras;\n\n                    // for Specular-Glossiness.\n                    if ( material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                        mesh.onBeforeRender = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].refreshUniforms;\n\n                    }\n\n                    if ( primitives.length > 1 ) {\n\n                        mesh.name += '_' + i;\n\n                        group.add( mesh );\n\n                    } else {\n\n                        return mesh;\n\n                    }\n\n                }\n\n                return group;\n\n            } );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n     * @param {number} cameraIndex\n     * @return {Promise<THREE.Camera>}\n     */\n    GLTFParser.prototype.loadCamera = function ( cameraIndex ) {\n\n        var camera;\n        var cameraDef = this.json.cameras[ cameraIndex ];\n        var params = cameraDef[ cameraDef.type ];\n\n        if ( ! params ) {\n\n            console.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n            return;\n\n        }\n\n        if ( cameraDef.type === 'perspective' ) {\n\n            var aspectRatio = params.aspectRatio || 1;\n            var xfov = params.yfov * aspectRatio;\n\n            camera = new THREE.PerspectiveCamera( THREE.Math.radToDeg( xfov ), aspectRatio, params.znear || 1, params.zfar || 2e6 );\n\n        } else if ( cameraDef.type === 'orthographic' ) {\n\n            camera = new THREE.OrthographicCamera( params.xmag / - 2, params.xmag / 2, params.ymag / 2, params.ymag / - 2, params.znear, params.zfar );\n\n        }\n\n        if ( cameraDef.name !== undefined ) camera.name = cameraDef.name;\n        if ( cameraDef.extras ) camera.userData = cameraDef.extras;\n\n        return Promise.resolve( camera );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n     * @param {number} skinIndex\n     * @return {Promise<Object>}\n     */\n    GLTFParser.prototype.loadSkin = function ( skinIndex ) {\n\n        var skinDef = this.json.skins[ skinIndex ];\n\n        var skinEntry = { joints: skinDef.joints };\n\n        if ( skinDef.inverseBindMatrices === undefined ) {\n\n            return Promise.resolve( skinEntry );\n\n        }\n\n        return this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\n\n            skinEntry.inverseBindMatrices = accessor;\n\n            return skinEntry;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n     * @param {number} animationIndex\n     * @return {Promise<THREE.AnimationClip>}\n     */\n    GLTFParser.prototype.loadAnimation = function ( animationIndex ) {\n\n        var json = this.json;\n\n        var animationDef = this.json.animations[ animationIndex ];\n\n        return this.getMultiDependencies( [\n\n            'accessor',\n            'node'\n\n        ] ).then( function ( dependencies ) {\n\n            var tracks = [];\n\n            for ( var i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n                var channel = animationDef.channels[ i ];\n                var sampler = animationDef.samplers[ channel.sampler ];\n\n                if ( sampler ) {\n\n                    var target = channel.target;\n                    var name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\n                    var input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n                    var output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n                    var inputAccessor = dependencies.accessors[ input ];\n                    var outputAccessor = dependencies.accessors[ output ];\n\n                    var node = dependencies.nodes[ name ];\n\n                    if ( node ) {\n\n                        node.updateMatrix();\n                        node.matrixAutoUpdate = true;\n\n                        var TypedKeyframeTrack;\n\n                        switch ( PATH_PROPERTIES[ target.path ] ) {\n\n                            case PATH_PROPERTIES.weights:\n\n                                TypedKeyframeTrack = THREE.NumberKeyframeTrack;\n                                break;\n\n                            case PATH_PROPERTIES.rotation:\n\n                                TypedKeyframeTrack = THREE.QuaternionKeyframeTrack;\n                                break;\n\n                            case PATH_PROPERTIES.position:\n                            case PATH_PROPERTIES.scale:\n                            default:\n\n                                TypedKeyframeTrack = THREE.VectorKeyframeTrack;\n                                break;\n\n                        }\n\n                        var targetName = node.name ? node.name : node.uuid;\n\n                        if ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n                            var itemSize = outputAccessor.itemSize;\n                            var TypedArray = outputAccessor.array.constructor;\n                            var outputAccessorValues = new TypedArray( outputAccessor.count * itemSize / 3 );\n\n                            // Layout of keyframe output values for CUBICSPLINE animations:\n                            //\n                            //   [ inTangent1, splineVertex1, outTangent1, inTangent2, splineVertex2, ... ]\n                            //\n                            // THREE.KeyframeTrack infers tangents from the spline vertices when interpolating:\n                            // those values are extracted below. This still guarantees smooth curves, but does\n                            // throw away more precise information in the tangents. In the future, consider\n                            // re-sampling at a higher framerate using the tangents provided.\n                            //\n                            // See: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\n\n                            for ( var j = 0, jl = outputAccessor.count; j < jl; j += 3 ) {\n\n                                outputAccessorValues[ j * itemSize / 3 ] = outputAccessor.getX( j + 1 );\n                                if ( itemSize > 1 ) outputAccessorValues[ j * itemSize / 3 + 1 ] = outputAccessor.getY( j + 1 );\n                                if ( itemSize > 2 ) outputAccessorValues[ j * itemSize / 3 + 2 ] = outputAccessor.getZ( j + 1 );\n                                if ( itemSize > 3 ) outputAccessorValues[ j * itemSize / 3 + 3 ] = outputAccessor.getW( j + 1 );\n\n                            }\n\n                            outputAccessor = new THREE.BufferAttribute( outputAccessorValues, itemSize / 3, outputAccessor.normalized );\n\n                        }\n\n                        var interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : THREE.InterpolateLinear;\n\n                        var targetNames = [];\n\n                        if ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n                            // node should be THREE.Group here but\n                            // PATH_PROPERTIES.weights(morphTargetInfluences) should be\n                            // the property of a mesh object under node.\n                            // So finding targets here.\n\n                            node.traverse( function ( object ) {\n\n                                if ( object.isMesh === true && object.material.morphTargets === true ) {\n\n                                    targetNames.push( object.name ? object.name : object.uuid );\n\n                                }\n\n                            } );\n\n                        } else {\n\n                            targetNames.push( targetName );\n\n                        }\n\n                        // KeyframeTrack.optimize() will modify given 'times' and 'values'\n                        // buffers before creating a truncated copy to keep. Because buffers may\n                        // be reused by other tracks, make copies here.\n                        for ( var j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n                            tracks.push( new TypedKeyframeTrack(\n                                targetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n                                THREE.AnimationUtils.arraySlice( inputAccessor.array, 0 ),\n                                THREE.AnimationUtils.arraySlice( outputAccessor.array, 0 ),\n                                interpolation\n                            ) );\n\n                        }\n\n                    }\n\n                }\n\n            }\n\n            var name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\n\n            return new THREE.AnimationClip( name, undefined, tracks );\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n     * @param {number} nodeIndex\n     * @return {Promise<THREE.Object3D>}\n     */\n    GLTFParser.prototype.loadNode = function ( nodeIndex ) {\n\n        var json = this.json;\n        var extensions = this.extensions;\n\n        var meshReferences = this.json.meshReferences;\n        var meshUses = this.json.meshUses;\n\n        var nodeDef = this.json.nodes[ nodeIndex ];\n\n        return this.getMultiDependencies( [\n\n            'mesh',\n            'skin',\n            'camera'\n\n        ] ).then( function ( dependencies ) {\n\n            var node;\n\n            if ( nodeDef.isBone === true ) {\n\n                node = new THREE.Bone();\n\n            } else if ( nodeDef.mesh !== undefined ) {\n\n                var mesh = dependencies.meshes[ nodeDef.mesh ];\n\n                node = mesh.clone();\n\n                // for Specular-Glossiness\n                if ( mesh.isGroup === true ) {\n\n                    for ( var i = 0, il = mesh.children.length; i < il; i ++ ) {\n\n                        var child = mesh.children[ i ];\n\n                        if ( child.material && child.material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                            node.children[ i ].onBeforeRender = child.onBeforeRender;\n\n                        }\n\n                    }\n\n                } else {\n\n                    if ( mesh.material && mesh.material.isGLTFSpecularGlossinessMaterial === true ) {\n\n                        node.onBeforeRender = mesh.onBeforeRender;\n\n                    }\n\n                }\n\n                if ( meshReferences[ nodeDef.mesh ] > 1 ) {\n\n                    node.name += '_instance_' + meshUses[ nodeDef.mesh ] ++;\n\n                }\n\n            } else if ( nodeDef.camera !== undefined ) {\n\n                node = dependencies.cameras[ nodeDef.camera ];\n\n            } else if ( nodeDef.extensions\n                && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\n                && nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\n\n                var lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\n                node = lights[ nodeDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ];\n\n            } else {\n\n                node = new THREE.Object3D();\n\n            }\n\n            if ( nodeDef.name !== undefined ) {\n\n                node.name = THREE.PropertyBinding.sanitizeNodeName( nodeDef.name );\n\n            }\n\n            if ( nodeDef.extras ) node.userData = nodeDef.extras;\n\n            if ( nodeDef.matrix !== undefined ) {\n\n                var matrix = new THREE.Matrix4();\n                matrix.fromArray( nodeDef.matrix );\n                node.applyMatrix( matrix );\n\n            } else {\n\n                if ( nodeDef.translation !== undefined ) {\n\n                    node.position.fromArray( nodeDef.translation );\n\n                }\n\n                if ( nodeDef.rotation !== undefined ) {\n\n                    node.quaternion.fromArray( nodeDef.rotation );\n\n                }\n\n                if ( nodeDef.scale !== undefined ) {\n\n                    node.scale.fromArray( nodeDef.scale );\n\n                }\n\n            }\n\n            return node;\n\n        } );\n\n    };\n\n    /**\n     * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n     * @param {number} sceneIndex\n     * @return {Promise<THREE.Scene>}\n     */\n    GLTFParser.prototype.loadScene = function () {\n\n        // scene node hierachy builder\n\n        function buildNodeHierachy( nodeId, parentObject, json, allNodes, skins ) {\n\n            var node = allNodes[ nodeId ];\n            var nodeDef = json.nodes[ nodeId ];\n\n            // build skeleton here as well\n\n            if ( nodeDef.skin !== undefined ) {\n\n                var meshes = node.isGroup === true ? node.children : [ node ];\n\n                for ( var i = 0, il = meshes.length; i < il; i ++ ) {\n\n                    var mesh = meshes[ i ];\n                    var skinEntry = skins[ nodeDef.skin ];\n\n                    var bones = [];\n                    var boneInverses = [];\n\n                    for ( var j = 0, jl = skinEntry.joints.length; j < jl; j ++ ) {\n\n                        var jointId = skinEntry.joints[ j ];\n                        var jointNode = allNodes[ jointId ];\n\n                        if ( jointNode ) {\n\n                            bones.push( jointNode );\n\n                            var mat = new THREE.Matrix4();\n\n                            if ( skinEntry.inverseBindMatrices !== undefined ) {\n\n                                mat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\n\n                            }\n\n                            boneInverses.push( mat );\n\n                        } else {\n\n                            console.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', jointId );\n\n                        }\n\n                    }\n\n                    mesh.bind( new THREE.Skeleton( bones, boneInverses ), mesh.matrixWorld );\n\n                }\n\n            }\n\n            // build node hierachy\n\n            parentObject.add( node );\n\n            if ( nodeDef.children ) {\n\n                var children = nodeDef.children;\n\n                for ( var i = 0, il = children.length; i < il; i ++ ) {\n\n                    var child = children[ i ];\n                    buildNodeHierachy( child, node, json, allNodes, skins );\n\n                }\n\n            }\n\n        }\n\n        return function loadScene( sceneIndex ) {\n\n            var json = this.json;\n            var extensions = this.extensions;\n            var sceneDef = this.json.scenes[ sceneIndex ];\n\n            return this.getMultiDependencies( [\n\n                'node',\n                'skin'\n\n            ] ).then( function ( dependencies ) {\n\n                var scene = new THREE.Scene();\n                if ( sceneDef.name !== undefined ) scene.name = sceneDef.name;\n\n                if ( sceneDef.extras ) scene.userData = sceneDef.extras;\n\n                var nodeIds = sceneDef.nodes || [];\n\n                for ( var i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n                    buildNodeHierachy( nodeIds[ i ], scene, json, dependencies.nodes, dependencies.skins );\n\n                }\n\n                // Ambient lighting, if present, is always attached to the scene root.\n                if ( sceneDef.extensions\n                    && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ]\n                    && sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light !== undefined ) {\n\n                    var lights = extensions[ EXTENSIONS.KHR_LIGHTS ].lights;\n                    scene.add( lights[ sceneDef.extensions[ EXTENSIONS.KHR_LIGHTS ].light ] );\n\n                }\n\n                return scene;\n\n            } );\n\n        };\n\n    }();\n\n    return GLTFLoader;\n\n} )();\n\nconsole.log(\"GLTF = \", GLTFLoader)\nexport default GLTFLoader","import {fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {PROP_DEFS} from '../Common'\nimport GLTFLoader from '../GLTFLoader'\nimport {MeshLambertMaterial} from 'three'\nimport ObjectDef from './ObjectDef'\n\nexport default class ModelDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create model w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:'model',\n            title:'a model',\n            visible:true,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#ffffff',\n            asset:0,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new THREE.Group()\n        node.name = obj.title\n        const clicker =  new THREE.Mesh(\n            new THREE.SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        // on(clicker,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) {\n            const g = provider.getDataGraph()\n            const asset = fetchGraphObject(g,op.value)\n            console.log(\"got the asset\",asset)\n            if(asset.src) {\n                const loader = new GLTFLoader()\n                console.log(\"loading the url\",asset.src)\n                loader.load(asset.src, (gltf)=> {\n                    console.log(\"loaded\", gltf)\n                    //swap the model\n                    if(node.userData.model) node.remove(node.userData.model)\n                    node.userData.model = gltf.scene.clone()\n                    node.add(node.userData.model)\n\n                    //calculate the size of the model\n                    if(node.userData.model.geometry) {\n                        node.userData.model.geometry.computeBoundingSphere()\n                        const bs = node.userData.model.geometry.boundingSphere\n                        const model = node.userData.model\n                        model.position.x = -bs.center.x\n                        model.position.y = -bs.center.y\n                        model.position.z = -bs.center.z\n                        node.userData.clicker.geometry = new THREE.SphereBufferGeometry(bs.radius)\n                    }\n                })\n\n            }\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from '../../syncgraph/utils'\nimport {ASSET_TYPES, OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\n\nfunction customize(node,mat,obj) {\n    mat.onBeforeCompile = (shader) => {\n        //add uniform\n        shader.uniforms.imageOffsetAngle    = { value: obj.imageOffsetAngle }\n        shader.uniforms.imageCropStartAngle = { value: obj.imageCropStartAngle }\n        shader.uniforms.imageCropEndAngle   = { value: obj.imageCropEndAngle }\n        //prepend to the shader the defs\n        shader.vertexShader = `\n            uniform float imageOffsetAngle;\n            varying float vImageOffsetAngle;\n            uniform float imageCropStartAngle;            \n            varying float vImageCropStartAngle;            \n            uniform float imageCropEndAngle;            \n            varying float vImageCropEndAngle;            \n        ` + shader.vertexShader\n\n        //copy into fragment shader\n        shader.vertexShader = shader.vertexShader.replace('#include <begin_vertex>',`\n            #include <begin_vertex>\n            vImageOffsetAngle = imageOffsetAngle;\n            vImageCropStartAngle = imageCropStartAngle;\n            vImageCropEndAngle = imageCropEndAngle;\n        `)\n\n        //prepend to the fragment shader the defs\n        shader.fragmentShader = `\n                varying float vImageOffsetAngle;\n                varying float vImageCropStartAngle;\n                varying float vImageCropEndAngle;\n            `+shader.fragmentShader\n        //use in the shader\n        shader.fragmentShader = shader.fragmentShader.replace('#include <dithering_fragment>',`\n            if(vUv.x < vImageCropStartAngle) discard;\n            if(vUv.x > vImageCropEndAngle)  discard;\n            // gl_FragColor.r = vUv.x;\n            // vec3 jv = vec3(cos(gl_FragCoord.x/50.0)); \n            // vec3 empty = vec3(0.0,0.0,0.0);//vec3(jv,jv,jv)\n            // gl_FragColor.rgb = mix(empty,diffuseColor.rgb,jv);\n        `)\n        node.userData.matShader = shader\n    }\n}\n\nexport default class BG360Def {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.bg360,\n            title:'background',\n            visible:true,\n            asset:0,\n            parent:scene.id,\n            imageOffsetAngle:0.0, //offset in UV coords, 0 to 1\n            imageCropStartAngle:0.0, //crop left edge of image\n            imageCropEndAngle:1.0, //crop right edge of image\n        }))\n    }\n    makeNode(obj) {\n        const mat = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide})\n        const node = new THREE.Mesh(new THREE.SphereBufferGeometry(20.0, 50,50),mat)\n        customize(node,mat,obj)\n        node.name = obj.title\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        return node\n    }\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) {\n            const g = provider.getDataGraph()\n            const asset = fetchGraphObject(g,op.value)\n            if(asset) {\n                if(asset.subtype === ASSET_TYPES.IMAGE) {\n                    const tex = new THREE.TextureLoader().load(asset.src)\n                    node.material = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide, map: tex})\n                    customize(node, node.material, obj)\n                }\n                if(asset.subtype === ASSET_TYPES.VIDEO) {\n                    const video = document.createElement('video')\n                    video.crossOrigin = 'anonymous'\n                    video.src = asset.src\n                    const tex = new THREE.VideoTexture(video)\n                    node.material = new THREE.MeshLambertMaterial({color: 'white', side: THREE.BackSide, map: tex})\n                }\n            }\n        }\n        if(node.userData.matShader) {\n            if (op.name === 'imageOffsetAngle') node.userData.matShader.uniforms.imageOffsetAngle.value = op.value\n            if (op.name === 'imageCropStartAngle') node.userData.matShader.uniforms.imageCropStartAngle.value = op.value\n            if (op.name === 'imageCropEndAngle') node.userData.matShader.uniforms.imageCropEndAngle.value = op.value\n        } else {\n            console.warn(\"BG360: no shader reference?!\")\n        }\n    }\n\n}\n","import ObjectDef from './ObjectDef'\nimport {fetchGraphObject} from '../../syncgraph/utils'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport WebLayer3D from 'three-web-layer'\n\nexport default class TextDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create sphere w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.text,\n            title:'some text',\n            visible:true,\n            text:'cool <b>formatted</b> <i>text</i>',\n            cssStyle:`color:white;`,\n\n            tx:0, ty:1.5, tz:-0.6,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n\n    makeNode(obj) {\n        const div = document.createElement('div')\n        div.innerHTML = obj.text\n        div.id = `div_${obj.id}`\n        div.classList.add('weblayer-div')\n        if(obj.cssStyle) div.setAttribute('style',obj.cssStyle)\n        const divLayer = new WebLayer3D(div,{\n            pixelRatio: window.devicePixelRatio,\n        })\n\n        divLayer.refresh(true)\n        divLayer.userData.clickable = true\n        const node = new THREE.Object3D()\n        node.previewUpdate = function() {\n            divLayer.update()\n        }\n        node.add(divLayer)\n        node.userData.divLayer = divLayer\n        node.userData.div = div\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(    op.name === PROP_DEFS.text.key) this.regenerateText(node,obj)\n        if(    op.name === PROP_DEFS.cssStyle.key) this.regenerateText(node,obj)\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n\n    regenerateText(node, obj) {\n        node.userData.div.innerHTML = obj.text\n        if(obj.cssStyle) node.userData.div.setAttribute('style',obj.cssStyle)\n        node.userData.divLayer.refresh(true)\n    }\n}\n\n\n\n","import {fetchGraphObject} from '../../syncgraph/utils'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport * as THREE from 'three'\nimport ObjectDef from './ObjectDef'\n\nexport default class Image2DDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create Image2D with missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.img2d,\n            title:'image',\n            visible:true,\n            width:1,\n            ratio:1,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            asset:0,\n            parent:scene.id,\n        }))\n    }\n    makeNode(obj) {\n        const node = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(obj.width, obj.width*obj.ratio),\n            new THREE.MeshLambertMaterial({color: 'white', side: THREE.DoubleSide})\n        )\n        node.name = obj.title\n        node.userData.clickable = true\n        // on(node,POINTER_CLICK,e =>SelectionManager.setSelection(node.userData.graphid))\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n    updateProperty(node, obj, op, provider) {\n        if (op.name === PROP_DEFS.asset.key) {\n            const asset = provider.accessObject(op.value)\n            if(asset.exists()) {\n                const tex = new THREE.TextureLoader().load(asset.src)\n                node.material = new THREE.MeshLambertMaterial({color:'white', side: THREE.DoubleSide, map:tex})\n                asset.set('ratio',asset.width/asset.height)\n            }\n            return\n        }\n        if( op.name === PROP_DEFS.width.key || op.name === 'ratio') {\n            node.geometry = new THREE.PlaneBufferGeometry(obj.width, obj.width*(1/obj.ratio))\n            return\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES} from '../Common'\n\nlet COUNTER = 0\n\nexport default class GroupDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.group,\n            title:'group '+COUNTER++,\n            visible:true,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {\n    BufferAttribute,\n    BufferGeometry,\n    CanvasTexture,\n    Color,\n    NormalBlending,\n    Object3D,\n    Points,\n    RepeatWrapping,\n    ShaderMaterial,\n    Vector3\n} from 'three'\n\n/*\n* modified from the version from the ThreeJS examples repo\n */\n\nconst GPUParticleShader = {\n\n    vertexShader:\n        `\n                uniform float uTime;\n                uniform float uScale;\n                uniform bool reverseTime;\n                uniform float fadeIn;\n                uniform float fadeOut;\n    \n                attribute vec3 positionStart;\n                attribute float startTime;\n                attribute vec3 velocity;\n                attribute vec3 acceleration;\n                attribute vec3 color;\n                attribute vec3 endColor;\n                attribute float size;\n                attribute float lifeTime;\n    \n                varying vec4 vColor;\n                varying vec4 vEndColor;\n                varying float lifeLeft;\n                varying float alpha;\n    \n                void main() {\n                    vColor = vec4( color, 1.0 );\n                    vEndColor = vec4( endColor, 1.0);\n                    vec3 newPosition;\n                    float timeElapsed = uTime - startTime;\n                    if(reverseTime) timeElapsed = lifeTime - timeElapsed;\n                    if(timeElapsed < fadeIn) {\n                        alpha = timeElapsed/fadeIn;\n                    }\n                    if(timeElapsed >= fadeIn && timeElapsed <= (lifeTime - fadeOut)) {\n                        alpha = 1.0;\n                    }\n                    if(timeElapsed > (lifeTime - fadeOut)) {\n                        alpha = 1.0 - (timeElapsed - (lifeTime-fadeOut))/fadeOut;\n                    }\n                    \n                    lifeLeft = 1.0 - ( timeElapsed / lifeTime );\n                    gl_PointSize = ( uScale * size );// * lifeLeft;\n                    newPosition = positionStart \n                        + (velocity * timeElapsed)\n                        + (acceleration * 0.5 * timeElapsed * timeElapsed)\n                        ;\n                    if (lifeLeft < 0.0) { \n                        lifeLeft = 0.0; \n                        gl_PointSize = 0.;\n                    }\n                    //while active use the new position\n                    if( timeElapsed > 0.0 ) {\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n                    } else {\n                        //if dead use the initial position and set point size to 0\n                        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                        lifeLeft = 0.0;\n                        gl_PointSize = 0.;\n                    }\n                }\n                `\n    ,\n\n    fragmentShader: `\n                varying vec4 vColor;\n                varying vec4 vEndColor;\n                varying float lifeLeft;\n                varying float alpha;\n                uniform sampler2D tSprite;\n                void main() {\n                    // color based on particle texture and the lifeLeft. \n                    // if lifeLeft is 0 then make invisible\n                    vec4 tex = texture2D( tSprite, gl_PointCoord );\n                    vec4 color = mix(vColor, vEndColor, 1.0-lifeLeft);\n                    gl_FragColor = vec4( color.rgb*tex.rgb, alpha * tex.a);\n                }\n    \n            `\n};\n\nconst UPDATEABLE_ATTRIBUTES = [\n    'positionStart', 'startTime',\n    'velocity', 'acceleration',\n    'color', 'endColor',\n    'size', 'lifeTime']\n\nexport default class GPUParticles extends Object3D {\n    constructor(options) {\n        super()\n        options = options || {};\n\n\n        this.blending = options.blending? options.blending : NormalBlending\n        this.PARTICLE_COUNT = options.maxParticles || 1000000;\n        this.PARTICLE_CURSOR = 0;\n        this.time = 0;\n        this.offset = 0;\n        this.count = 0;\n        this.DPR = window.devicePixelRatio;\n        this.particleUpdate = false;\n        this.onTick = options.onTick\n\n        this.reverseTime = options.reverseTime\n        this.fadeIn = options.fadeIn || 1\n        if(this.fadeIn === 0) this.fadeIn = 0.001\n        this.fadeOut = options.fadeOut || 1\n        if(this.fadeOut === 0) this.fadeOut = 0.001\n\n        // preload a 10_000 random numbers from -0.5 to 0.5\n        this.rand = [];\n        let i;\n        for (i = 1e5; i>0; i--) {\n            this.rand.push( Math.random() - 0.5 );\n        }\n        this.i = i\n\n        //setup the texture\n        this.sprite = options.particleSpriteTex || null;\n        if(!this.sprite) {\n            const can = document.createElement('canvas')\n            can.width = 16\n            can.height = 16\n            const ctx = can.getContext('2d')\n            ctx.fillStyle = 'black'\n            ctx.fillRect(0,0,can.width,can.height)\n            ctx.fillStyle = 'rgba(255,255,255,0.5)'\n            ctx.beginPath()\n            ctx.arc(8,8,8,0,Math.PI*2)\n            ctx.fill()\n            this.sprite = new CanvasTexture(can)\n        }\n        this.sprite.wrapS = this.sprite.wrapT = RepeatWrapping;\n\n        //setup the shader material\n        this.material = new ShaderMaterial( {\n            transparent: true,\n            depthWrite: false,\n            uniforms: {\n                'uTime': {\n                    value: 0.0\n                },\n                'uScale': {\n                    value: 1.0\n                },\n                'tSprite': {\n                    value: this.sprite\n                },\n                reverseTime: {\n                    value: this.reverseTime\n                },\n                fadeIn: {\n                    value: this.fadeIn\n                },\n                fadeOut: {\n                    value: this.fadeOut,\n                }\n            },\n            blending: this.blending,\n            vertexShader: GPUParticleShader.vertexShader,\n            fragmentShader: GPUParticleShader.fragmentShader\n        } );\n\n        // define defaults for all values\n        this.material.defaultAttributeValues.particlePositionsStartTime = [ 0, 0, 0, 0 ];\n        this.material.defaultAttributeValues.particleVelColSizeLife = [ 0, 0, 0, 0 ];\n\n\n        // geometry\n        this.geometry = new BufferGeometry();\n\n        //vec3 attributes\n        this.geometry.addAttribute('position',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('positionStart', new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('velocity',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('acceleration',  new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('color',         new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n        this.geometry.addAttribute('endColor',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT * 3), 3).setDynamic(true));\n\n        //scalar attributes\n        this.geometry.addAttribute('startTime',     new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n        this.geometry.addAttribute('size',          new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n        this.geometry.addAttribute('lifeTime',      new BufferAttribute(new Float32Array(this.PARTICLE_COUNT), 1).setDynamic(true));\n\n\n        this.particleSystem = new Points(this.geometry, this.material);\n        this.particleSystem.frustumCulled = false;\n        this.add(this.particleSystem);\n    }\n\n    /*\n      This updates the geometry on the shader if at least one particle has been spawned.\n      It uses the offset and the count to determine which part of the data needs to actually\n      be sent to the GPU. This ensures no more data than necessary is sent.\n     */\n    geometryUpdate () {\n        if (this.particleUpdate === true) {\n            this.particleUpdate = false;\n            UPDATEABLE_ATTRIBUTES.forEach(name => {\n                const attr = this.geometry.getAttribute(name)\n                if (this.offset + this.count < this.PARTICLE_COUNT) {\n                    attr.updateRange.offset = this.offset * attr.itemSize\n                    attr.updateRange.count = this.count * attr.itemSize\n                } else {\n                    attr.updateRange.offset = 0\n                    attr.updateRange.count = -1\n                }\n                attr.needsUpdate = true\n            })\n            this.offset = 0;\n            this.count = 0;\n        }\n    }\n\n\n    //use one of the random numbers\n    random () {\n        return ++ this.i >= this.rand.length ? this.rand[ this.i = 1 ] : this.rand[ this.i ];\n    }\n\n    update ( ttime ) {\n        this.time = ttime/1000\n        this.material.uniforms.uTime.value = this.time;\n        if(this.onTick) this.onTick(this,this.time)\n        this.geometryUpdate();\n    }\n\n    dispose () {\n        this.material.dispose();\n        this.sprite.dispose();\n        this.geometry.dispose();\n    }\n\n    updateSprite(sprite) {\n        if(sprite) {\n            const old = this.sprite\n            this.sprite = sprite\n            this.sprite.wrapS = this.sprite.wrapT = RepeatWrapping;\n            this.material.uniforms.tSprite.value = sprite\n            if(old) old.dispose()\n        }\n    }\n\n    /* spawn a particle\n\n    This works by updating values inside of\n    the attribute arrays, then updates the count and the PARTICLE_CURSOR and\n    sets particleUpdate to true.\n\n    This if spawnParticle is called three times in a row before rendering,\n    then count will be 3 and the cursor will have moved by three.\n     */\n    spawnParticle ( options ) {\n        // console.log('spawnparticle')\n        let position = new Vector3()\n        let velocity = new Vector3()\n        let acceleration = new Vector3()\n        let color = new Color()\n        let endColor = new Color()\n\n        const positionStartAttribute = this.geometry.getAttribute('positionStart')\n        const startTimeAttribute = this.geometry.getAttribute('startTime')\n        const velocityAttribute = this.geometry.getAttribute('velocity')\n        const accelerationAttribute = this.geometry.getAttribute('acceleration')\n        const colorAttribute = this.geometry.getAttribute('color')\n        const endcolorAttribute = this.geometry.getAttribute('endColor')\n        const sizeAttribute = this.geometry.getAttribute('size')\n        const lifeTimeAttribute = this.geometry.getAttribute('lifeTime')\n\n        options = options || {};\n\n        // setup reasonable default values for all arguments\n\n        position = options.position !== undefined ? position.copy(options.position) : position.set(0, 0, 0);\n        velocity = options.velocity !== undefined ? velocity.copy(options.velocity) : velocity.set(0, 0, 0);\n        acceleration = options.acceleration !== undefined ? acceleration.copy(options.acceleration) : acceleration.set(0, 0, 0);\n        color = options.color !== undefined ? color.copy(options.color) : color.set(0xffffff);\n        endColor = options.endColor !== undefined ? endColor.copy(options.endColor) : endColor.copy(color)\n\n        const lifetime = options.lifetime !== undefined ? options.lifetime : 5\n        let size = options.size !== undefined ? options.size : 10\n        const sizeRandomness = options.sizeRandomness !== undefined ? options.sizeRandomness : 0\n\n        if (this.DPR !== undefined) size *= this.DPR;\n\n        const i = this.PARTICLE_CURSOR\n\n        // position\n        positionStartAttribute.array[i * 3 + 0] = position.x\n        positionStartAttribute.array[i * 3 + 1] = position.y\n        positionStartAttribute.array[i * 3 + 2] = position.z\n\n        velocityAttribute.array[i * 3 + 0] = velocity.x;\n        velocityAttribute.array[i * 3 + 1] = velocity.y;\n        velocityAttribute.array[i * 3 + 2] = velocity.z;\n\n        accelerationAttribute.array[i * 3 + 0] = acceleration.x;\n        accelerationAttribute.array[i * 3 + 1] = acceleration.y;\n        accelerationAttribute.array[i * 3 + 2] = acceleration.z;\n\n        colorAttribute.array[i * 3 + 0] = color.r;\n        colorAttribute.array[i * 3 + 1] = color.g;\n        colorAttribute.array[i * 3 + 2] = color.b;\n\n        endcolorAttribute.array[i * 3 + 0] = endColor.r;\n        endcolorAttribute.array[i * 3 + 1] = endColor.g;\n        endcolorAttribute.array[i * 3 + 2] = endColor.b;\n\n        //size, lifetime and starttime\n        sizeAttribute.array[i] = size + this.random() * sizeRandomness;\n        lifeTimeAttribute.array[i] = lifetime;\n        startTimeAttribute.array[i] = this.time + this.random() * 2e-2;\n\n        // offset\n        if (this.offset === 0) this.offset = this.PARTICLE_CURSOR;\n        // counter and cursor\n        this.count++;\n        this.PARTICLE_CURSOR++;\n        //wrap the cursor around\n        if (this.PARTICLE_CURSOR >= this.PARTICLE_COUNT) this.PARTICLE_CURSOR = 0;\n        this.particleUpdate = true;\n    };\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {AdditiveBlending, Color, TextureLoader, Vector3} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, PROP_DEFS} from '../Common'\nimport GPUParticles from './GPUParticles'\n\nexport const rand = (min,max) => Math.random()*(max-min) + min\n\nlet COUNTER = 0\n\nexport default class ParticlesDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't create cube w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.particles,\n            title:'particles '+COUNTER++,\n            visible:true,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            children:graph.createArray(),\n            pointSize:10.0,\n            lifetime:3.0,\n            startColor:'#ff0000',\n            endColor:'#0000ff',\n            parent:scene.id,\n            texture:null,\n        }))\n    }\n    makeNode(obj) {\n        let tex = null\n        if(obj.texture) tex = new TextureLoader().load(obj.texture)\n        const options = {\n            velocity: new Vector3(0,1,0),\n            position: new Vector3(0,0,0),\n            size:obj.pointSize,\n            lifetime:obj.lifetime,\n            color: new Color(1.0,0.0,1.0),\n            endColor: new Color(0,1,1),\n        }\n\n        const node = new GPUParticles({\n            maxParticles: 10000,\n            position: new Vector3(0,0,0),\n            positionRandomness: 0.0,\n            baseVelocity: new Vector3(0.0, 0.0, -1),\n            velocity: new Vector3(0.0, 0.0, 0.0),\n            velocityRandomness: 1.0,\n            acceleration: new Vector3(0,0.0,0),\n            baseColor: new Color(1.0,1.0,0.5),\n            color: new Color(1.0,0,0),\n            colorRandomness: 0.5,\n            lifetime: 3,\n            size: 10,\n            sizeRandomness: 1.0,\n            particleSpriteTex: tex,\n            blending: AdditiveBlending,\n            onTick: (system, time) => {\n                options.velocity.set(rand(-1,1),1,rand(-1,1))\n                system.spawnParticle(options);\n            }\n        })\n        node.userData.options = options\n        node.name = obj.title\n        node.userData.clickable = false\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        if(op.name === PROP_DEFS.pointSize.key) return node.userData.options.size = obj.pointSize\n        if(op.name === PROP_DEFS.lifetime.key) return node.userData.options.lifetime = obj.lifetime\n        if(op.name === PROP_DEFS.startColor.key) return node.userData.options.color.set(obj.startColor)\n        if(op.name === PROP_DEFS.endColor.key) return node.userData.options.endColor.set(obj.endColor)\n        if(op.name === PROP_DEFS.texture.key) {\n            const texture = provider.accessObject(obj.texture)\n            if(texture) {\n                const tex = new TextureLoader().load(texture.src)\n                node.updateSprite(tex)\n            }\n            return\n        }\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, REC_TYPES} from '../Common'\n\nlet COUNTER = 0\n\nexport default class AnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if(!scene.id) throw new Error(\"can't anchor w/ missing parent\")\n        return fetchGraphObject(graph,graph.createObject({\n            type:OBJ_TYPES.anchor,\n            title:'anchor '+COUNTER++,\n            visible:true,\n            tx:0, ty:1.5, tz:-5,\n            rx:0, ry:0, rz:0,\n            sx:1, sy:1, sz:1,\n            color:'#00ff00',\n            children:graph.createArray(),\n            targetImage:null,\n            imageRealworldWidth:1,\n            recType:REC_TYPES.SCENE_START,\n            parent:scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        node.init = (evt) => {\n            clicker.visible = false\n            node.visible = false\n            evt.system.startImageRecognizer({\n                image:evt.system.getObjectById(obj.targetImage),\n                imageRealworldWidth: obj.imageRealworldWidth,\n                recType:obj.recType,\n                object:obj,\n                node:node,\n                callback:(info) => {\n                    evt.system.fireEvent(obj, 'recognized', info)\n                    node.visible = true\n                }\n            })\n        }\n        node.stop = () => {\n            clicker.visible = true\n        }\n        return node\n    }\n\n    updateProperty(node, obj, op, provider) {\n        return super.updateProperty(node,obj,op,provider)\n    }\n\n}\n","import {fetchGraphObject} from \"../../syncgraph/utils\"\nimport {Group, Mesh, MeshLambertMaterial, SphereBufferGeometry} from 'three'\nimport ObjectDef from './ObjectDef'\nimport {OBJ_TYPES, REC_TYPES} from '../Common'\nlet COUNTER = 0\n\nexport default class AnchorDef extends ObjectDef {\n    make(graph, scene) {\n        if (!scene.id) throw new Error(\"can't create geo anchor w/ missing parent\")\n        return fetchGraphObject(graph, graph.createObject({\n            type: OBJ_TYPES.geoanchor,\n            title: 'geo-anchor ' + COUNTER++,\n            visible: true,\n            tx: 0, ty: 1.5, tz: -5,\n            rx: 0, ry: 0, rz: 0,\n            sx: 1, sy: 1, sz: 1,\n            color: '#00ff00',\n            children: graph.createArray(),\n            targetGeoLocation: null,\n            recType: REC_TYPES.SCENE_START,\n            parent: scene.id\n        }))\n    }\n    makeNode(obj) {\n        const node = new Group()\n        node.name = obj.title\n        node.userData.clickable = true\n        node.position.set(obj.tx, obj.ty, obj.tz)\n        node.rotation.set(obj.rx,obj.ry,obj.rz)\n        node.scale.set(obj.sx,obj.sy,obj.sz)\n\n        const clicker =  new Mesh(\n            new SphereBufferGeometry(1),\n            new MeshLambertMaterial({color:\"red\", transparent:true, opacity: 0.2})\n        )\n        clicker.material.visible = true\n        clicker.userData.clickable = true\n        node.userData.clicker = clicker\n        node.add(clicker)\n        node.init = (evt) => {\n            clicker.visible = false\n            node.visible = false\n            evt.system.startGeoRecognizer({\n                location:evt.system.getObjectById(obj.targetGeoLocation),\n                recType:obj.recType,\n                object:obj,\n                node:node,\n                callback:(info) => {\n                    evt.system.fireEvent(obj, 'recognized', info)\n                    node.visible = true\n                }\n            })\n        }\n        node.stop = () => {\n            clicker.visible = true\n        }\n        return node\n    }\n}","import {TYPES} from '../common/PropSheet'\nimport CubeDef from './defs/CubeDef'\nimport SphereDef from './defs/SphereDef'\nimport PlaneDef from './defs/PlaneDef'\nimport ModelDef from './defs/ModelDef'\nimport BG360Def from './defs/BG360Def'\nimport TextDef from './defs/TextDef'\nimport Image2DDef from './defs/Image2DDef'\nimport GroupDef from './defs/GroupDef'\nimport ParticlesDef from './defs/ParticlesDef'\nimport AnchorDef from './defs/AnchorDef'\nimport GeoAnchorDef from './defs/GeoAnchorDef'\n\nconst stdhints = {\n    incrementValue:0.1,\n}\nexport const PROP_DEFS = {\n    title: {\n        key:'title',\n        name:'Title',\n        type:TYPES.STRING\n    },\n    description: {\n        key:'description',\n        name:'Description',\n        type:TYPES.STRING\n    },\n    width: {\n        key:'width',\n        name:'Width',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    height: {\n        key:'height',\n        name:'Height',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    depth: {\n        key:'depth',\n        name:'Depth',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    radius: {\n        key:'radius',\n        name:'Radius',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    tx: {\n        key:'tx',\n        name:'TX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    ty: {\n        key:'ty',\n        name:'TY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    tz: {\n        key:'tz',\n        name:'TZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    rx: {\n        key:'rx',\n        name:'RX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    ry: {\n        key:'ry',\n        name:'RY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    rz: {\n        key:'rz',\n        name:'RZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sx: {\n        key:'sx',\n        name:'SX',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sy: {\n        key:'sy',\n        name:'SY',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    sz: {\n        key:'sz',\n        name:'SZ',\n        type:TYPES.NUMBER,\n        hints: stdhints\n    },\n    color: {\n        key:'color',\n        name:'Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    defaultFloor: {\n        key:'defaultFloor',\n        name:'Default Floor',\n        type:TYPES.BOOLEAN\n    },\n    src: {\n        key:'src',\n        name:'src',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    asset: {\n        key:'asset',\n        name:'asset',\n        type:TYPES.ENUM,\n    },\n    subtype: {\n        key:'subtype',\n        name:'kind',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    format: {\n        key:'format',\n        name:'format',\n        type:TYPES.STRING,\n        locked:true,\n    },\n    imageOffsetAngle: {\n        key:'imageOffsetAngle',\n        name:'Image Offset Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageCropStartAngle: {\n        key:'imageCropStartAngle',\n        name:'Image Crop Start Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageCropEndAngle: {\n        key:'imageCropEndAngle',\n        name:'Image Crop End Angle',\n        type:TYPES.NUMBER,\n        hints: {\n            incrementValue:0.05,\n        }\n    },\n    imageRealworldWidth: {\n        key:'imageRealworldWidth',\n        name:'Image width in meters',\n        type: TYPES.NUMBER,\n        hints: {\n            incrementValue:0.01\n        }\n    },\n    recType: {\n        key:'recType',\n        name:'Recognition Type',\n        type: TYPES.ENUM,\n    },\n\n    targetImage: {\n        key:'targetImage',\n        name:'Image to Recognize',\n        type: TYPES.ENUM,\n    },\n\n    targetGeoLocation: {\n        key:'targetGeoLocation',\n        name:'Target Location',\n        type: TYPES.ENUM,\n    },\n\n    text: {\n        key:'text',\n        name:'Text',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    fontSize: {\n        key:'fontSize',\n        name:'Font Size',\n        type:TYPES.NUMBER,\n    },\n    padding: {\n        key:'padding',\n        name:'Padding',\n        type:TYPES.NUMBER,\n    },\n    borderWidth: {\n        key:'borderWidth',\n        name:'Border width',\n        type:TYPES.NUMBER,\n    },\n    borderRadius: {\n        key:'borderRadius',\n        name:'Corner Size',\n        type:TYPES.NUMBER,\n    },\n    horizontalAlign: {\n        key:'horizontalAlign',\n        name:'H Align',\n        type:TYPES.ENUM,\n        locked:false,\n    },\n    textColor: {\n        key:'textColor',\n        name:'Text Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    backgroundColor: {\n        key:'backgroundColor',\n        name:'BG Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    borderColor: {\n        key:'borderColor',\n        name:'Border Color',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    startColor: {\n        key:'startColor',\n        name:'Start',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    endColor: {\n        key:'endColor',\n        name:'End',\n        type:TYPES.COLOR,\n        custom:true,\n    },\n    drawBackground: {\n        key:'drawBackground',\n        name:'BG?',\n        type:TYPES.BOOLEAN,\n    },\n    scriptBody: {\n        key:'scriptBody',\n        name:'code',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    defaultScene: {\n        key:'defaultScene',\n        name:'Start Scene',\n        type:TYPES.ENUM,\n    },\n    visible: {\n        key:'visible',\n        name:'Visible',\n        type:TYPES.BOOLEAN\n    },\n\n\n    pointSize: {\n        key:'pointSize',\n        name:'Point Size',\n        type:TYPES.NUMBER,\n    },\n    lifetime: {\n        key:'lifetime',\n        name:'Lifetime',\n        type:TYPES.NUMBER,\n        hints: stdhints,\n    },\n    texture: {\n        key:'texture',\n        name:'texture',\n        type:TYPES.ENUM,\n    },\n    cssStyle: {\n        key:'cssStyle',\n        name:'Style',\n        type:TYPES.STRING,\n        hints: {\n            multiline:true\n        }\n    },\n    latitude: {\n        key:'latitude',\n        name:\"Latitude\",\n        type:TYPES.NUMBER, //value in degrees\n    },\n    longitude: {\n        key:'longitude',\n        name:\"Longitude\",\n        type:TYPES.NUMBER, //value in degrees\n    },\n    altitude: {\n        key:'altitude',\n        name:\"altitude\",\n        type:TYPES.NUMBER, //value in meters\n    },\n    useAltitude: {\n        key:'useAltitude',\n        name:\"use altitude?\",\n        type:TYPES.BOOLEAN,\n    }\n}\n\nexport const SIMPLE_COLORS = [\"#ffffff\",\"#ff0000\",\"#ffff00\",\"#00ff00\",\"#00ffff\",\"#0000ff\",\"#ff00ff\",\"#000000\"]\n\nexport const OBJ_TYPES = {\n    cube:'cube',\n    sphere:'sphere',\n    plane:'plane',\n    model:'model',\n    bg360:'bg360',\n    text:'text',\n    img2d:'img2d',\n    group:'group',\n    particles:'particles',\n    anchor:'anchor',\n    geoanchor:'geoanchor',\n}\n\nexport const TOTAL_OBJ_TYPES = {\n    SCENE:'scene',\n    ASSET:'asset',\n    BEHAVIOR:'behavior',\n    BEHAVIOR_SCRIPT:'behavior_script',\n    ASSETS_LIST: 'assets',\n    BEHAVIORS_LIST: 'behaviors',\n    ROOT: 'root'\n}\nexport const HORIZONTAL_ALIGNMENT = {\n    LEFT:'LEFT',\n    CENTER:'CENTER',\n    RIGHT:'RIGHT',\n}\n\n\nexport function is3DObjectType(type) {\n    if(type === OBJ_TYPES.cube) return true\n    if(type === OBJ_TYPES.sphere) return true\n    if(type === OBJ_TYPES.plane) return true\n    if(type === OBJ_TYPES.model) return true\n    if(type === OBJ_TYPES.text) return true\n    if(type === OBJ_TYPES.bg360) return true\n    if(type === OBJ_TYPES.img2d) return true\n    if(type === OBJ_TYPES.group) return true\n    if(type === OBJ_TYPES.particles) return true\n    if(type === OBJ_TYPES.anchor) return true\n    if(type === OBJ_TYPES.geoanchor) return true\n    return false\n}\n\nexport function canHaveShape(type) {\n    if(type === OBJ_TYPES.group) return true\n    if(type === OBJ_TYPES.anchor) return true\n    if(type === OBJ_TYPES.geoanchor) return true\n    if(type === TOTAL_OBJ_TYPES.SCENE) return true\n    return false\n}\n\nexport function canHaveBehavior(type) {\n    if(is3DObjectType(type)) return true\n    if(type === TOTAL_OBJ_TYPES.SCENE) return true\n    return false\n}\n\nexport function canHaveScene(type) {\n    if(type === TOTAL_OBJ_TYPES.ROOT) return true\n    return false\n}\n\nexport function get3DObjectDef(type) {\n    if(type === OBJ_TYPES.cube) return new CubeDef()\n    if(type === OBJ_TYPES.sphere) return new SphereDef()\n    if(type === OBJ_TYPES.plane) return new PlaneDef()\n    if(type === OBJ_TYPES.model) return new ModelDef()\n    if(type === OBJ_TYPES.bg360) return new BG360Def()\n    if(type === OBJ_TYPES.text) return new TextDef()\n    if(type === OBJ_TYPES.img2d) return new Image2DDef()\n    if(type === OBJ_TYPES.group) return new GroupDef()\n    if(type === OBJ_TYPES.particles) return new ParticlesDef()\n    if(type === OBJ_TYPES.anchor) return new AnchorDef()\n    if(type === OBJ_TYPES.geoanchor) return new GeoAnchorDef()\n    throw new Error(`unknown 3d object type ${type}`)\n}\n\nexport const toRad = (degrees) => degrees*Math.PI/180\n\nexport const MIME_TYPES = { PNG:'image/png', JPEG:'image/jpeg', MP3: 'audio/mpeg', AAC: 'audio/aac', JAVASCRIPT: 'text/javascript', GLB: 'model/gltf-binary', MP4:'video/mp4' }\nexport const ASSET_TYPES = {\n    BEHAVIOR:'behavior',\n    IMAGE:'image',\n    GLTF: 'gltf',\n    AUDIO:'audio',\n    VIDEO:'video',\n    GEOLOCATION: 'geolocation'\n}\nexport function isImageType(type) {\n    if (!type) return false\n    if (type.toLowerCase() === MIME_TYPES.PNG) return true\n    if (type.toLowerCase() === MIME_TYPES.JPEG) return true\n    return false;\n}\nexport function isAudioType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.MP3) return true\n    if(type.toLowerCase() === MIME_TYPES.AAC) return true\n    return false\n}\n\nexport function isVideoType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.MP4) return true\n    return false\n}\nexport function isGLTFType(type) {\n    if(!type) return false\n    if(type.toLowerCase() === MIME_TYPES.GLB) return true\n    return false\n}\n\n\nexport function isGLTFFile(file) {\n    if (!file) return false\n    console.log(\"looking at the file\", file, 'type', file.type, 'type')\n    if (!file.type || file.type === '' || file.type.length === 0) {\n        console.log(\"no mimetype. check extension\")\n        if (file.name.toLowerCase().indexOf(\".gltf\") > 0) return true\n        if (file.name.toLowerCase().indexOf(\".glb\") > 0) return true\n    }\n    if (file.type.toLowerCase() === 'image/gltf') return true\n    return false;\n}\n\nexport const ITEM_ICONS = {\n    plane: 'plane',\n    cube: 'square',\n    sphere: 'circle',\n    model: 'cube',\n    asset: 'file',\n    assets: 'archive',\n    behavior:'superpowers',\n    behavior_script:'superpowers',\n    scene: 'globe',\n    bg360:'image',\n    img2d:'image',\n    image:'image',\n    text:'font',\n    audio:'music',\n    video:'video-camera',\n    group:'object-group',\n    particles:'certificate',\n    gltf:'cube',\n    anchor:'anchor',\n    geoanchor:'globe',\n\n    cut:'cut',\n    copy:'copy',\n    paste:'paste',\n    delete:'close'\n}\n\n\nexport function parseBehaviorScript(contents) {\n    return Function('\"use strict\"; return('+contents+')')();\n}\n\nexport const REC_TYPES = {\n    SCENE_START:'SCENE_START'\n}","import * as THREE from 'three'\nimport React, {Component} from \"react\"\nimport {VRManager} from 'webxr-boilerplate'\nimport GLTFLoader from './GLTFLoader'\n\nexport default class AssetView extends Component {\n    componentDidMount() {\n        this.initThreeJS()\n    }\n    render() {\n        return <div>GLTF viewer\n            <div ref={c => this.sceneContainer = c}></div>\n        </div>\n    }\n    initThreeJS() {\n        const asset = this.props.asset\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color( 0x000000 );\n        this.camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new THREE.WebGLRenderer( { antialias: true } );\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.renderer.gammaOutput = true\n        this.renderer.vr.enabled = true;\n        this.sceneContainer.appendChild( this.renderer.domElement );\n        this.vrmanager = new VRManager(this.renderer)\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n        this.renderer.setAnimationLoop(this.renderThree)\n        const light = new THREE.DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.2))\n        console.log(\"rendering the asset\",asset)\n\n        const loader = new GLTFLoader()\n        console.log(\"loading the url\",asset.src)\n        loader.load(asset.src, (gltf)=> {\n            console.log(\"loaded\", gltf)\n            //swap the model\n            this.scene.add(gltf.scene.clone())\n        })\n\n    }\n    renderThree = (time) => {\n        this.renderer.render( this.scene, this.camera );\n    }\n\n}\n","import React, {Component} from \"react\"\nimport {fetchGraphObject} from '../syncgraph/utils'\nimport {ASSET_TYPES} from '../vr/Common'\nimport GLTFAssetView from '../vr/GLTFAssetView'\n\nexport default class AssetView extends Component {\n    render() {\n        const prov = this.props.provider\n        const asset = fetchGraphObject(prov.getDataGraph(),this.props.asset)\n        return <div>asset view\n            <h3>{asset.type} : <b>{asset.title}</b></h3>\n            {this.renderAsset(asset)}\n        </div>\n    }\n\n    renderAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.IMAGE) return <img src={asset.src} alt={asset.title}/>\n        if(asset.subtype === ASSET_TYPES.AUDIO) return <audio src={asset.src} controls/>\n        if(asset.subtype === ASSET_TYPES.VIDEO) return <video src={asset.src} controls crossOrigin=\"anonymous\"/>\n        if(asset.subtype === ASSET_TYPES.BEHAVIOR) return <div>{asset.src}</div>\n        if(asset.subtype === ASSET_TYPES.GLTF) return <GLTFAssetView asset={asset}/>\n        return <div>unknown type</div>\n    }\n}\n","import * as ToasterManager from './ToasterManager'\nimport {getAssetsURL} from '../TreeItemProvider'\nimport {ASSET_TYPES, MIME_TYPES, TOTAL_OBJ_TYPES} from './Common'\nimport {fetchGraphObject} from '../syncgraph/utils'\n\nexport function addImageAssetFromExpandedURL(url,format,title, prov) {\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type:TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.IMAGE,\n        format:format,\n        src:url,\n        width:100,\n        height:100,\n        title:title,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    prov.requestImageCache(url).then(img => {\n        asset.set('width',img.width)\n        asset.set('height',img.height)\n    })\n}\n\nexport function addGeoAnchorAsset(info,title,prov) {\n    const asset = prov.accessObject(prov.getDataGraph().createObject({\n        type:TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.GEOLOCATION,\n        title:title,\n        latitude:info.latitude,\n        longitude:info.longitude,\n        altitude:info.altitude,\n        useAltitude:info.useAltitude,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\nexport function addImageAssetFromFile (file, prov) {\n    ToasterManager.add('uploading ' + file.name)\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        return addImageAssetFromExpandedURL(getAssetsURL()+ans.asset.id, ans.asset.mimeType, file.name, prov)\n    })\n}\nexport function addImageAssetFromURL  (url, prov) {\n    //TODO: make this format detection code more robust\n    const name = url.substring(url.lastIndexOf('/') + 1)\n    const type = name.substring(name.lastIndexOf(\".\") + 1)\n    let fileType = \"image/unknown\"\n    if (type.toLowerCase() === 'png') fileType = MIME_TYPES.PNG\n    if (type.toLowerCase() === 'jpg') fileType = MIME_TYPES.JPEG\n    if (type.toLowerCase() === 'jpeg') fileType = MIME_TYPES.JPEG\n    return addImageAssetFromExpandedURL(url, fileType, name, prov)\n}\nexport function addGLBAssetFromFile (file, prov) {\n    ToasterManager.add('uploading '+ file.name)\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        const url = getAssetsURL()+ans.asset.id\n        const graph = prov.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.ASSET,\n            subtype:ASSET_TYPES.GLTF,\n            format:MIME_TYPES.GLB,\n            src:url,\n            title:file.name,\n            parent:0\n        }))\n        prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    })\n}\n\nexport function addAudioAssetFromFile (file, prov) {\n    ToasterManager.add('uploading')\n    prov.uploadFile(file).then((ans)=>{\n        ToasterManager.add('uploaded')\n        console.log(\"uploaded file with answer\",ans)\n        if(ans.success === false) return console.log(\"there was an error uploading! :(\")\n        const url = getAssetsURL()+ans.asset.id\n        const graph = prov.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.ASSET,\n            subtype:ASSET_TYPES.AUDIO,\n            format:ans.asset.mimeType,\n            src:url,\n            title:file.name,\n            parent:0\n        }))\n        prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n    })\n}\nexport function addAudioAssetFromURL (url, fileType, name, prov) {\n    //TODO: make this format detection code more robust\n    if(!name) {\n        name = url.substring(url.lastIndexOf('/') + 1)\n    }\n    if(!fileType) {\n        const type = name.substring(name.lastIndexOf(\".\") + 1)\n        fileType = \"audio/unknown\"\n        if(type.toLowerCase() === 'mp3') fileType = MIME_TYPES.MP3\n        if(type.toLowerCase() === 'aac') fileType = MIME_TYPES.AAC\n    }\n\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph,graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.AUDIO,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\nexport function addVideoAssetFromURL (url, fileType, name, prov) {\n    //TODO: make this format detection code more robust\n    if(!name) {\n        name = url.substring(url.lastIndexOf('/') + 1)\n    }\n    /*\n    if(!fileType) {\n        const type = name.substring(name.lastIndexOf(\".\") + 1)\n        fileType = \"audio/unknown\"\n        if(type.toLowerCase() === 'mp3') fileType = MIME_TYPES.MP3\n        if(type.toLowerCase() === 'aac') fileType = MIME_TYPES.AAC\n    }\n    */\n\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph,graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.VIDEO,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}\n\n\nexport function addGLBAssetFromURL(url, fileType, name, prov) {\n    const graph = prov.getDataGraph()\n    const asset = fetchGraphObject(graph, graph.createObject({\n        type: TOTAL_OBJ_TYPES.ASSET,\n        subtype:ASSET_TYPES.GLTF,\n        format:fileType,\n        src:url,\n        title:name,\n        parent:0\n    }))\n    prov.accessObject(prov.getAssetsObject()).insertChildLast(asset)\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {ToggleButton, Toolbar} from '../../common/GridEditorApp'\nimport {addImageAssetFromFile, addImageAssetFromURL} from '../AssetActions'\n\nexport class AddImageAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            view:'local',\n            url:\"\",\n        }\n        this.fileInput = React.createRef();\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        if(this.state.view === 'remote') {\n            console.log(\"adding the url\",this.state.url)\n            addImageAssetFromURL(this.state.url, this.props.provider)\n        } else {\n            console.log(\"the file input is\",this.fileInput)\n            listToArray(this.fileInput.current.files).forEach(file => {\n                addImageAssetFromFile(file, this.props.provider)\n            })\n        }\n    }\n    switchLocal = () => this.setState({view:'local'})\n    switchRemote = () => this.setState({view:'remote'})\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>add image to assets</h3>\n                <VBox grow>\n                    <Toolbar>\n                        <ToggleButton onClick={this.switchLocal} selected={this.state.view==='local'}>local</ToggleButton>\n                        <ToggleButton onClick={this.switchRemote} selected={this.state.view==='remote'}>remote</ToggleButton>\n                    </Toolbar>\n                    {this.renderSelectedPanel()}\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        this.setState({fileInput:e.target.value})\n    }\n\n    typedURL = (e) => {\n        this.setState({url:e.target.value})\n    }\n\n    renderSelectedPanel() {\n        if(this.state.view === 'local') {\n            return <HBox>\n                <label>File\n                    <input key=\"f1\" type=\"file\" onChange={this.selectedFile} ref={this.fileInput}/>\n                </label>\n            </HBox>\n        } else {\n            return <HBox>\n                <label>URL\n                    <input key=\"f2\" value={this.state.url} type=\"input\" onChange={this.typedURL}/>\n                </label>\n            </HBox>\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport {DEFAULT_DPI, UNITS} from './Dimension'\nimport {fetchGraphObject, propToArray} from '../syncgraph/utils'\nimport SelectionManager from '../SelectionManager'\n\nexport class PageCanvasView extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            scale: 1.0,\n        }\n    }\n\n    componentDidMount() {\n        this.canvas.focus()\n        this.redraw()\n    }\n\n    componentDidUpdate(prevProps) {\n        this.redraw()\n    }\n\n    redraw = () => {\n        if (!this.canvas) return\n        const c = this.canvas.getContext('2d')\n        const size = this.props.provider.getPageSize(this.props.page).as(UNITS.PIXEL, 1, DEFAULT_DPI)\n        this.canvas.width = size.width\n        this.canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, this.canvas.width, this.canvas.height)\n        c.save()\n        c.scale(this.state.scale, this.state.scale)\n        const graph = this.props.provider.getRawGraph()\n        const page = this.props.page\n        if (page) this.drawPage(c, graph, page)\n        c.restore()\n    }\n\n    drawPage(c, g, page) {\n        propToArray(g, page.children).forEach(id => this.drawLayer(c, g, fetchGraphObject(g, id)))\n    }\n\n    drawLayer(c, g, layer) {\n        propToArray(g, layer.children).forEach(id => this.drawShape(c, g, fetchGraphObject(g, id)))\n    }\n\n    drawShape(c, g, shape) {\n        const def = this.props.provider.getShapeDef(shape.type)\n        if (def) def.draw(c, g, shape, SelectionManager.getSelection() === shape.id, this.props.provider)\n    }\n\n    render() {\n        return <canvas\n            tabIndex={-1}\n            width={100} height={100} ref={(e) => this.canvas = e}\n            style={{\n                width: '100vw',\n            }}\n            onClick={this.props.onNext}\n            onKeyDown={this.handleKeypress}\n        ></canvas>\n    }\n\n    handleKeypress = (e) => {\n        if (e.key === 'ArrowRight') this.props.onNext()\n        if (e.key === 'ArrowLeft') this.props.onPrev()\n    }\n}","import React, {Component} from 'react'\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {PageCanvasView} from './PageCanvasView'\n\n\nexport default class PresentationApp extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            pageIndex:-1\n        }\n    }\n\n    componentDidMount() {\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.docSwapped)\n    }\n\n    docSwapped = () => this.setState({pageIndex:0})\n\n    getPages() {\n        const provider = this.props.provider\n        const root = provider.accessObject(provider.getSceneRoot())\n        return root.array('children').map(ch => provider.accessObject(ch) ).filter(ch => ch.type === 'page')\n    }\n\n    render() {\n        const provider = this.props.provider\n        const pages = this.getPages()\n        if(this.state.pageIndex < 0) return <div>no pages loaded</div>\n        const page = pages[this.state.pageIndex]\n        return <PageCanvasView page={page} provider={provider} onNext={this.onNext} onPrev={this.onPrev}/>\n    }\n\n    onNext = () => {\n        const pages = this.getPages()\n        if(this.state.pageIndex === pages.length-1) this.state.pageIndex = -1\n        this.setState({pageIndex:this.state.pageIndex+1})\n    }\n\n    onPrev = () => {\n        const pages = this.getPages()\n        if(this.state.pageIndex === 0) this.state.pageIndex = pages.length\n        this.setState({pageIndex:this.state.pageIndex-1})\n    }\n}\n\n","export default class GraphAccessor {\n    constructor(graph) {\n        this.graph = graph\n    }\n    object(id) {\n        // console.log('accessing',id)\n        if(this.graph.hasObject(id)) {\n            const obj = {}\n            this.graph.getPropertiesForObject(id).forEach(key => {\n                obj[key] = this.graph.getPropertyValue(id, key)\n            })\n            obj.id = id\n            obj.exists = function() { return true }\n            obj.set = (key, value) => {\n                this.graph.setProperty(id,key,value)\n                return obj\n            }\n            obj.props = () => {\n                const o = {}\n                this.graph.getPropertiesForObject(id).forEach(key => {\n                    o[key] = this.graph.getPropertyValue(id, key)\n                })\n                return o\n            }\n            obj.array = (key) => {\n                // console.log(\"looking at key\",key)\n                // console.log(\"self is\",obj)\n                const CH = obj[key]\n                // console.log(\"children id is\",CH)\n                const len = this.graph.getArrayLength(CH)\n                const ch = []\n                for (let i = 0; i < len; i++) {\n                    ch.push(this.graph.getElementAt(CH, i))\n                }\n                return ch\n            }\n            obj.getChildren = () => {\n                if(obj.children) return obj.array('children').map(id => this.object(id))\n                return []\n            }\n            obj.insertChildLast = (child) => {\n                this.graph.setProperty(child.id,'parent',obj.id)\n                const CH = this.graph.getPropertyValue(obj.id,'children')\n                const len = this.graph.getArrayLength(CH)\n                const prev = this.graph.getElementAt(CH,len-1)\n                this.graph.insertAfter(CH,prev,child.id)\n            }\n            obj.insertFirstChild = (child) => {\n                this.graph.setProperty(child.id,'parent',obj.id)\n                const ch = this.graph.getPropertyValue(obj.id,'children')\n                this.graph.insertAfter(ch,null,child.id)\n            }\n            obj.child = (index) => this.object(obj.array('children')[index])\n            obj.removeFromParent = () => {\n                const parent = this.object(obj.parent)\n                const n = parent.array('children').findIndex(ch => ch === obj.id)\n                // const n = indexOf(graph, parent.children, obj.id)\n                if (n >= 0) {\n                    this.graph.removeElement(parent.children, n)\n                } else {\n                    console.error(\"could not find index for child\", obj, 'in children', parent.children)\n                }\n            }\n            obj.clone = () => {\n                const shape = obj;\n                const id = shape.id\n                const id2 = this.graph.createObject()\n                const props = this.graph.getPropertiesForObject(id)\n                props.forEach(key => {\n                    this.graph.createProperty(id2,key,this.graph.getPropertyValue(id,key))\n                })\n                return this.object(id2)\n            }\n            obj.find = (match,list) => {\n                if(!list) list = []\n                if(match(obj)) list.push(obj)\n                if(obj.children) obj.getChildren().forEach(ch => {\n                    ch.find(match,list)\n                })\n                return list\n            }\n            return obj\n        } else {\n            return {\n                exists: function() { return false }\n            }\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport GridEditorApp, {MenuPopup, Panel, Spacer, Toolbar} from '../common/GridEditorApp'\nimport PropSheet from '../common/PropSheet'\nimport TreeTable from '../common/TreeTable'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {MetadocCanvas} from \"./MetadocCanvas\";\nimport SyncGraphProvider from '../syncgraph/SyncGraphProvider'\nimport {\n    cloneShape,\n    createGraphObjectFromObject,\n    fetchGraphObject,\n    insertAsFirstChild, insertAsLastChild, listToArray,\n    propToArray,\n    removeFromParent\n} from \"../syncgraph/utils\";\nimport {DialogManager, HBox, PopupManager} from \"appy-comps\";\nimport InputManager from \"../common/InputManager\";\nimport {getAssetsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport {\n    HORIZONTAL_ALIGNMENT,\n    ICONS,\n    isShapeType,\n    PROP_DEFS,\n    SHAPE_DEFS,\n    STANDARD_FONTS,\n    VERTICAL_ALIGNMENT\n} from \"./Common\";\nimport AssetView from './AssetView'\nimport {AddImageAssetDialog} from '../vr/dialogs/AddImageAssetDialog'\nimport {DEFAULT_DPI, parseDimension, UNITS} from \"./Dimension\"\nimport {EnumEditor} from \"../common/EnumEditor\";\nimport PresentationApp from './PresentationApp'\nimport GraphAccessor from '../syncgraph/GraphAccessor'\n\n\nconst EnumTitleRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        const graph = props.provider.getDataGraph()\n        value = graph.getPropertyValue(props.value,'title')\n    }\n    return <b>{value}</b>\n}\n\nconst STANDARD_PAGE_SIZES = [\n    {\n        name:\"1024 x 768 pixels\",\n        value:'1024x768px',\n    },\n    {\n        name:\"VGA (640x480)\",\n        value:\"640x480px\"\n    },\n    {\n        name:\"A4 paper\",\n        value:\"210x297mm\"\n    },\n    {\n        name:\"16:9\",\n        value:\"300x169mm\"\n    },\n    {\n        name:\"4:3\",\n        value:\"225x169mm\"\n    },\n]\nconst PageSizeRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        const size = STANDARD_PAGE_SIZES.find(s => s.value === props.value)\n        if(size) {\n            value = size.name\n        } else {\n            value = props.value\n        }\n    }\n    return <b>{value}</b>\n}\n\nexport default class MetadocEditor extends  SyncGraphProvider {\n    constructor(options) {\n        super(options)\n        this.imagecache = {}\n    }\n    getDocType() { return \"metadoc\" }\n    getApp = () => {\n        if(this.mode === 'view') return <PresentationApp provider={this}/>\n        return <MetadocApp provider={this}/>\n    }\n    getTitle = () => \"MetaDoc\"\n\n    makeEmptyRoot(doc) {\n        //create root and children\n        const root = fetchGraphObject(doc,doc.createObject({ type:'root', title:'root', pageSize:'640 x 480 px', children: doc.createArray(), parent:0}))\n        //create page and children\n        const page = fetchGraphObject(doc,doc.createObject({ type:'page', title:'page 1', children: doc.createArray(),parent:0}))\n        //create layer and children\n        const layer = fetchGraphObject(doc,doc.createObject({type:'layer',title:'layer 1', children: doc.createArray(),parent:0}))\n        //create rect\n        const rect1 = SHAPE_DEFS.rect.make(doc,layer)\n        // create assets\n        const assets = fetchGraphObject(doc,doc.createObject({type:'assets',title:'Assets', children: doc.createArray(), parent:0}))\n        //connect it all together\n        insertAsFirstChild(doc,layer,rect1)\n        insertAsFirstChild(doc,page,layer)\n        insertAsFirstChild(doc,root,page)\n        insertAsLastChild(doc,root,assets)\n    }\n\n    getRendererForItem = (item) => {\n        if(!this.getDataGraph().getObjectById(item)) return <div>???</div>\n        const type = this.getDataGraph().getPropertyValue(item,'type')\n        const title = this.getDataGraph().getPropertyValue(item,'title')\n        if(ICONS[type]) return <div><i className={`fa fa-${ICONS[type]}`}/> {title}</div>\n        return <div>{title}</div>\n    }\n\n    setPropertyValue(item, def, value) {\n        super.setPropertyValue(item,def,value)\n        if(def.key === PROP_DEFS.asset.key) {\n            const asset = fetchGraphObject(this.getDataGraph(),value)\n            super.setPropertyValue(item,{key:'width'},asset.width)\n            super.setPropertyValue(item,{key:'height'},asset.height)\n        }\n    }\n\n\n    getProperties(item) {\n        function copyPropDef(def,value) {\n            const out = {};\n            Object.keys(def).forEach((key) => out[key] = def[key])\n            out.value = value\n            return out;\n        }\n        let defs = []\n        if(!item) return defs\n\n        const props = this.syncdoc.getPropertiesForObject(item)\n        if(props) {\n            props.forEach(key => {\n                if(key === 'type') return\n                if(key === 'children') return\n                if(key === 'parent') return\n                const value = this.syncdoc.getPropertyValue(item,key)\n                if(PROP_DEFS[key]) return defs.push(copyPropDef(PROP_DEFS[key],value))\n                console.log(\"unknown property\",key)\n            })\n        }\n\n        return defs\n    }\n\n    createCustomEditor(item,def,provider, value, onChange) {\n        if(def.key === PROP_DEFS.fillColor.key) return <HBox>\n            {\n                [\"#ffffff\",\"#ff0000\",\"#ffff00\",\"#00ff00\",\"#00ffff\",\"#0000ff\",\"#ff00ff\",\"#000000\"]\n                    .map(c => <button\n                        key={c}\n                        onClick={()=>onChange(c)}\n                        style={{color:c, padding:'1px', margin:0, borderWidth:0,}}\n                        className={\"fa fa-square\"}/> )\n            }\n        </HBox>\n        if(def.key === PROP_DEFS.pageSize.key) {\n            const obj = fetchGraphObject(this.getDataGraph(),item)\n            return <EnumEditor def={def} provider={this} obj={item} value={obj.pageSize} onChange={onChange}/>\n        }\n        return <i>no custom editor for {def.key}</i>\n    }\n\n    getValuesForEnum(key,obj) {\n        if(key === PROP_DEFS.asset.key) {\n            const children = this.getDataGraph().getPropertyValue(this.getAssetsObject(),'children')\n            return propToArray(this.getDataGraph(),children)\n        }\n        if(key === PROP_DEFS.fontFamily.key) {\n            return Object.keys(STANDARD_FONTS).map(key => STANDARD_FONTS[key])\n        }\n        if(key === PROP_DEFS.verticalAlign.key) {\n            return Object.keys(VERTICAL_ALIGNMENT).map(key => VERTICAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.horizontalAlign.key) {\n            return Object.keys(HORIZONTAL_ALIGNMENT).map(key => HORIZONTAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.pageSize.key) {\n            return STANDARD_PAGE_SIZES.map(s => s.value)\n        }\n    }\n    getRendererForEnum(key,obj) {\n        if(key === PROP_DEFS.asset.key) return EnumTitleRenderer\n        if(key === PROP_DEFS.pageSize.key) return PageSizeRenderer\n    }\n\n\n    getPageSize(page) {\n        const root = this.getSceneRoot()\n        const rootobj = fetchGraphObject(this.getDataGraph(),root)\n        console.log(\"parsing\",rootobj)\n        return parseDimension(rootobj.pageSize)\n    }\n\n\n\n    getShapeDef(type) {\n        return SHAPE_DEFS[type]\n    }\n    getSelectedRoot() {\n        return fetchGraphObject(this.getDataGraph(),this.getSceneRoot())\n    }\n    getSelectedPage() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        while(true) {\n            const type = this.getDataGraph().getPropertyValue(sel, 'type')\n            if(type === 'root') return null\n            if(type === 'page') return fetchGraphObject(this.getDataGraph(),sel)\n            sel = this.getDataGraph().getPropertyValue(sel,'parent')\n            if(!sel) break\n        }\n    }\n\n    getSelectedLayer() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        while(true) {\n            const type = this.getDataGraph().getPropertyValue(sel, 'type')\n            if(type === 'root') return null\n            if(type === 'layer') return fetchGraphObject(this.getDataGraph(),sel)\n            sel = this.getDataGraph().getPropertyValue(sel,'parent')\n            if(!sel) break\n        }\n        console.log(fetchGraphObject(this.getDataGraph(),sel))\n    }\n\n    getSelectedShape() {\n        let sel = SelectionManager.getSelection()\n        if(!sel) return null\n        const type = this.getDataGraph().getPropertyValue(sel, 'type')\n        if(SHAPE_DEFS[type]) return fetchGraphObject(this.getDataGraph(),sel)\n        return null\n    }\n\n    calculateContextMenu(item) {\n        const obj = fetchGraphObject(this.getDataGraph(),item)\n        if(obj.type === 'assets') {\n            return [{\n                title:'Add Image',\n                icon:'image',\n                fun:this.showAddImageAssetDialog\n            }]\n        }\n        if(obj.type === 'asset') {\n            return [{\n                title:'delete',\n                icon:'close',\n                fun: this.deleteSelectedAsset\n            }]\n        }\n        const cmds =  [\n            {\n                title:'delete',\n                icon:'close',\n                fun: this.deleteSelection\n            },\n            {\n                title:'rect',\n                icon:ICONS.rect,\n                fun: this.addRect\n            },\n            {\n                title:'circle',\n                icon:ICONS.circle,\n                fun: this.addCircle\n            },\n            {\n                title:'text',\n                icon:ICONS.text,\n                fun: this.addText\n            },\n            {\n                title:'image',\n                icon: ICONS.image,\n                fun: this.addImage\n            },\n            {\n                title:'cut',\n                icon: ICONS.cut,\n                fun:this.cutSelection\n            },\n            {\n                title:'copy',\n                icon: ICONS.copy,\n                fun:this.copySelection\n            },\n            {\n                title:'paste',\n                icon: ICONS.paste,\n                fun:this.pasteSelection\n            },\n        ]\n        return cmds\n    }\n\n    addShape = (def) => {\n        const graph = this.getDataGraph()\n        const layer = this.getSelectedLayer()\n        if(!layer) return console.error(\"no layer!\")\n        const shape = def.make(graph,layer)\n        insertAsFirstChild(graph,layer,shape)\n    }\n    addRect   = () => this.addShape(this.getShapeDef('rect'))\n    addCircle = () => this.addShape(this.getShapeDef('circle'))\n    addText   = () => this.addShape(this.getShapeDef('text'))\n    addImage   = () => this.addShape(this.getShapeDef('image'))\n\n    addImageAssetFromFile = (file) => {\n        this.uploadFile(file).then((ans)=>{\n            console.log(\"uploaded file with answer\",ans)\n            const url = getAssetsURL()+ans.id\n            const graph = this.getDataGraph()\n            const asset = fetchGraphObject(graph,graph.createObject({\n                type:'asset',\n                subtype:'image',\n                format:file.type,\n                src:url,\n                width:100,\n                height:100,\n                title:file.name,\n                parent:0\n            }))\n            const assets = fetchGraphObject(graph,this.getAssetsObject())\n            insertAsLastChild(graph,assets,asset)\n            this.requestImageCache(url).then(img => {\n                graph.setProperty(asset.id,'width',img.width)\n                graph.setProperty(asset.id,'height',img.height)\n            })\n        })\n    }\n\n    addImageAssetFromURL = (url) => {\n        //TODO: make this format detection code more robust\n        const name = url.substring(url.lastIndexOf('/')+1)\n        const type = name.substring(name.lastIndexOf(\".\")+1)\n        let fileType = \"image/unknown\"\n        if(type.toLowerCase() === 'png') fileType = 'image/png'\n        if(type.toLowerCase() === 'jpg') fileType = 'image/jpeg'\n        if(type.toLowerCase() === 'jpeg') fileType = 'image/jpeg'\n\n        const graph = this.getDataGraph()\n        const asset = fetchGraphObject(graph,graph.createObject({\n            type:'asset',\n            subtype:'image',\n            format:fileType,\n            src:url,\n            width:100,\n            height:100,\n            title:name,\n            parent:0\n        }))\n        const assets = fetchGraphObject(graph,this.getAssetsObject())\n        insertAsLastChild(graph,assets,asset)\n        this.requestImageCache(url).then(img => {\n            graph.setProperty(asset.id,'width',img.width)\n            graph.setProperty(asset.id,'height',img.height)\n        })\n    }\n    deleteSelection = () => {\n        const graph = this.getDataGraph()\n        // const layer = this.getSelectedLayer()\n        const shape = this.getSelectedShape()\n        if(!shape) return\n        removeFromParent(graph,shape)\n        SelectionManager.clearSelection()\n    }\n    deleteSelectedAsset = () => {\n        const graph = this.getDataGraph()\n        const sel = SelectionManager.getSelection()\n        const obj = fetchGraphObject(graph,sel)\n        removeFromParent(graph,obj)\n        SelectionManager.clearSelection()\n    }\n    cutSelection = () => {\n        const graph = this.getDataGraph()\n        let sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = fetchGraphObject(graph,sel)\n        SelectionManager.setClipboard(obj.id)\n        removeFromParent(graph,obj)\n        SelectionManager.clearSelection()\n    }\n    copySelection = () => {\n        const graph = this.getDataGraph()\n        let sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = fetchGraphObject(graph,sel)\n        SelectionManager.setClipboard(obj.id)\n    }\n    pasteSelection = (e) => {\n        if(e.target && e.target.getAttribute('type') === 'input') return console.log(\"pasting into an input field. don't intercept\")\n        const graph = this.getDataGraph()\n        const shapeid = SelectionManager.getClipboard()\n        const obj1 = fetchGraphObject(graph,shapeid)\n\n        let parent = null\n        if(isShapeType(obj1.type)) parent = this.getSelectedLayer()\n        if(obj1.type === 'layer') parent = this.getSelectedPage()\n        if(obj1.type === 'page') parent = fetchGraphObject(graph,this.getSceneRoot())\n        if (!parent) return console.error(\"no parent to ad too! bad obj type?\",obj1.type)\n\n        const obj2 = cloneShape(graph,obj1)\n        graph.setProperty(obj2.id, 'parent', parent.id)\n        insertAsFirstChild(graph, parent, obj2)\n        return\n    }\n\n    exportSVG = () => {\n        const page = this.getSelectedPage()\n\n        const svg = this.renderSVGWrapper(this.renderSVGChildren(page))\n        const link = document.createElement('a');\n        link.href = 'data:image/svg+xml,'+encodeURIComponent(svg)\n        link.download = 'test.svg'\n        document.body.appendChild(link)\n        link.click()\n    }\n    renderSVGWrapper(str) {\n        return `<svg id=\"svg-canvas\" viewBox=\"0 0 1000 1000\" \n                xmlns=\"http://www.w3.org/2000/svg\" \n                xmlnsXlink=\"http://www.w3.org/1999/xlink\">\n                ${str}</svg>`\n    }\n    renderSVGChildren(obj) {\n        if(obj.type === 'page') return propToArray(this.getDataGraph(),obj.children)\n            .map((layer) => `<g>${this.renderSVGChildren(fetchGraphObject(this.getDataGraph(),layer))}</g>`).join(\"\")\n        if(obj.type === 'layer') return propToArray(this.getDataGraph(),obj.children)\n            .map(shape => this.renderSVGChildren(fetchGraphObject(this.getDataGraph(),shape))).join(\"\")\n        if(SHAPE_DEFS[obj.type]) return SHAPE_DEFS[obj.type].toSVGString(obj,this)\n        return \"\";\n    }\n\n    exportPNG = () => {\n        const page = this.getSelectedPage()\n        const canvas = document.createElement('canvas')\n        const c = canvas.getContext('2d')\n        const g = this.getRawGraph()\n        const size = this.getPageSize(page).as(UNITS.PIXEL, 1, DEFAULT_DPI)\n        canvas.width = size.width\n        canvas.height = size.height\n        c.fillStyle = 'white'\n        c.fillRect(0, 0, canvas.width, canvas.height)\n        if(page) {\n            this.accessObject(page.id).getChildren().forEach(layer => {\n                layer.getChildren().forEach(shape => {\n                    const def = this.getShapeDef(shape.type)\n                    if (def) def.draw(c, g, shape, false, this)\n                })\n            })\n        }\n\n        const link = document.createElement('a');\n        link.href = canvas.toDataURL('image/png')\n        link.download = 'test.png'\n        document.body.appendChild(link)\n        link.click()\n    }\n\n\n    canAddChild(parent,child) {\n        const p = fetchGraphObject(this.getDataGraph(),parent)\n        const c = fetchGraphObject(this.getDataGraph(),child)\n        if(p.type === 'layer' && isShapeType(c.type)) return true\n        if(p.type === 'page' && c.type === 'layer') return true\n        if(p.type === 'root' && c.type === 'page') return true\n        return false\n    }\n    canBeSibling(src,tgt) {\n        const s = fetchGraphObject(this.getDataGraph(),src)\n        const t = fetchGraphObject(this.getDataGraph(),tgt)\n        if(s.type === 'layer' && t.type === 'layer') return true\n        if(s.type === 'page' && t.type === 'page') return true\n        if(isShapeType(s.type) && isShapeType(t.type)) return true\n        return false\n    }\n    canAddExternalChild(parent,child) {\n        const pobj = fetchGraphObject(this.getDataGraph(),parent)\n        // console.log('parent is',pobj)\n        if(pobj.type === 'assets') return true\n        return false\n    }\n    acceptDrop(e,tgt) {\n        const obj = fetchGraphObject(this.getDataGraph(),tgt)\n        if(obj.type === 'assets') {\n            listToArray(e.dataTransfer.files).forEach(file => this.addImageAssetFromFile(file))\n        }\n    }\n\n\n    newView = () => window.open( `./?mode=metadoc&doctype=${this.getDocType()}&doc=${this.getDocId()}`)\n    openPresentationView = () => window.open( `./?mode=view&doctype=${this.getDocType()}&doc=${this.getDocId()}`)\n\n\n    isImageCached(src) {\n        if(this.imagecache[src]) return this.imagecache[src].complete\n        return false\n    }\n    requestImageCache(src) {\n        const img = new Image()\n        this.imagecache[src] = img\n        return new Promise((res,rej) => {\n            img.src = src\n            img.onload = () => {\n                this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,{ provider: this })\n                res(img)\n            }\n        })\n    }\n    getCachedImage(src) {\n        return this.imagecache[src]\n    }\n\n    getAssetsObject = () => this.getDataGraph().getObjectByProperty('type','assets')\n\n    showAddImageAssetDialog = () => DialogManager.show(<AddImageAssetDialog provider={this}/>)\n\n    accessObject = (id) => {\n        return new GraphAccessor(this.getDataGraph()).object(id)\n    }\n\n}\n\n\n\nclass MetadocApp extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            connected:false,\n            zoom: 0,\n            mode:'canvas'\n        }\n\n        this.im = new InputManager()\n        this.im.addKeyBinding({ id:'save',  key:InputManager.KEYS.S, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({ id:'undo', key:InputManager.KEYS.Z,  modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({ id:'redo', key:InputManager.KEYS.Z,  modifiers:[InputManager.MODIFIERS.COMMAND, InputManager.MODIFIERS.SHIFT]})\n        this.im.addListener('save',this.props.provider.save)\n        this.im.addListener('undo',this.props.provider.performUndo)\n        this.im.addListener('redo',this.props.provider.performRedo)\n\n        this.im.addKeyBinding({id:'cut', key:InputManager.KEYS.X, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id:'copy', key:InputManager.KEYS.C, modifiers:[InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id:'paste', key:InputManager.KEYS.V, modifiers:[InputManager.MODIFIERS.COMMAND]})\n\n        this.im.addListener('cut',this.props.provider.cutSelection)\n        this.im.addListener('copy',this.props.provider.copySelection)\n        this.im.addListener('paste',this.props.provider.pasteSelection)\n    }\n\n    componentDidMount() {\n        this.im.attachKeyEvents(document)\n        this.props.provider.on('CONNECTED',()=> this.setState({connected: this.props.provider.isConnected()}))\n        SelectionManager.on(SELECTION_MANAGER.CHANGED,()=>{\n            const sel = SelectionManager.getSelection()\n            if(sel) {\n                const item = fetchGraphObject(this.props.provider.getDataGraph(),sel)\n                if(item.type === PROP_DEFS.asset.key) {\n                    this.setState({mode:'asset'})\n                    return\n                }\n            }\n            this.setState({mode:'canvas'})\n        })\n    }\n\n    canvasSelected = (rect) => SelectionManager.setSelection(rect)\n\n\n    showAddPopup = (e) => {\n        const acts = [\n            {\n                title: 'page',\n                icon: ICONS.page,\n                fun: () => this.addPage()\n            },\n            {\n                title: 'layer',\n                icon: ICONS.layer,\n                fun: () => this.addLayer()\n            },\n            {\n                title: 'rect',\n                icon: ICONS.rect,\n                fun: () => this.props.provider.addRect()\n            },\n            {\n                title: 'circle',\n                icon: ICONS.circle,\n                fun: () => this.props.provider.addCircle()\n            },\n            {\n                title: 'text',\n                icon: ICONS.text,\n                fun: () => this.props.provider.addText()\n            },\n            {\n                title:'image',\n                icon: ICONS.image,\n                fun: () => this.props.provider.addImage()\n            },\n        ]\n        PopupManager.show(<MenuPopup actions={acts}/>,e.target)\n    }\n    addPage = () => {\n        const graph = this.props.provider.getDataGraph()\n        const root = this.props.provider.getSelectedRoot()\n        const page = fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'page',\n            title:'new page',\n            parent:root.id,\n            children: graph.createArray()\n        }))\n        insertAsFirstChild(graph,root,page)\n    }\n    addLayer = () => {\n        const graph = this.props.provider.getDataGraph()\n        const page = this.props.provider.getSelectedPage()\n        const layer = fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'layer',\n            title:'new layer',\n            parent:page.id,\n            children:graph.createArray()\n        }))\n        insertAsFirstChild(graph,page,layer)\n    }\n\n    zoomIn  = () => this.setState({zoom:this.state.zoom+1})\n    zoomOut = () => this.setState({zoom:this.state.zoom-1})\n\n    render() {\n        const prov = this.props.provider\n        return <GridEditorApp>\n            <Toolbar left top><label>{prov.getTitle()}</label></Toolbar>\n            <Panel scroll left middle>\n                <TreeTable root={prov.getSceneRoot()} provider={prov}/>\n            </Panel>\n\n            <Toolbar left bottom>\n                <button className=\"fa fa-plus\" onClick={this.showAddPopup}/>\n                <button className=\"fa fa-close\" onClick={prov.deleteSelection}/>\n                <button className=\"fa fa-file-image-o\" onClick={prov.showAddImageAssetDialog}/>\n            </Toolbar>\n\n            <Toolbar center top>\n                <button className=\"fa fa-save\" onClick={prov.save}/>\n                <button className=\"fa fa-download\" onClick={prov.exportSVG}> SVG</button>\n                <button className=\"fa fa-download\" onClick={prov.exportPNG}> PNG</button>\n                <button className=\"fa fa-undo\" onClick={prov.performUndo}/>\n                <button className=\"fa fa-repeat\" onClick={prov.performRedo}/>\n                <button className=\"fa fa-search-plus\" onClick={this.zoomIn}/>\n                <button className=\"fa fa-search-minus\" onClick={this.zoomOut}/>\n                <Spacer/>\n                <button className=\"fa fa-cut\" onClick={prov.cutSelection}/>\n                <button className=\"fa fa-copy\" onClick={prov.copySelection}/>\n                <button className=\"fa fa-paste\" onClick={prov.pasteSelection}/>\n                <Spacer/>\n                <button className=\"fa fa-play\" onClick={prov.openPresentationView}/>\n                <button className=\"fa fa-plus\" onClick={prov.newView}> view</button>\n                <button className=\"fa fa-superpowers\" onClick={prov.toggleConnected}>{this.state.connected?\"disconnect\":\"connect\"}</button>\n            </Toolbar>\n\n            <Panel center middle scroll>\n                {this.renderCenterPane(this.state.mode)}\n            </Panel>\n\n            <Panel scroll right><PropSheet provider={prov}/></Panel>\n\n            <Toolbar right top/>\n            <Toolbar right bottom/>\n\n        </GridEditorApp>\n    }\n\n    renderCenterPane(mode) {\n        if (mode === 'canvas') {\n            return <MetadocCanvas prov={this.props.provider} onSelect={this.canvasSelected} scale={Math.pow(2, this.state.zoom)}/>\n        } else {\n            const sel = SelectionManager.getSelection()\n            return <AssetView provider={this.props.provider} asset={sel}/>\n        }\n    }\n}\n\n\n","const THREE = require('three');//requireimport * as THREE from 'three'\n\n/**\n * @author arodic / https://github.com/arodic\n */\n\nconst TransformControls = function ( camera, domElement ) {\n\n    THREE.Object3D.call( this );\n\n    domElement = ( domElement !== undefined ) ? domElement : document;\n\n    this.visible = false;\n\n    var _gizmo = new TransformControlsGizmo();\n    this.add( _gizmo );\n\n    var _plane = new TransformControlsPlane();\n    this.add( _plane );\n\n    var scope = this;\n\n    // Define properties with getters/setter\n    // Setting the defined property will automatically trigger change event\n    // Defined properties are passed down to gizmo and plane\n\n    defineProperty( \"camera\", camera );\n    defineProperty( \"object\", undefined );\n    defineProperty( \"enabled\", true );\n    defineProperty( \"axis\", null );\n    defineProperty( \"mode\", \"translate\" );\n    defineProperty( \"translationSnap\", null );\n    defineProperty( \"rotationSnap\", null );\n    defineProperty( \"space\", \"world\" );\n    defineProperty( \"size\", 1 );\n    defineProperty( \"dragging\", false );\n    defineProperty( \"showX\", true );\n    defineProperty( \"showY\", true );\n    defineProperty( \"showZ\", true );\n\n    var changeEvent = { type: \"change\" };\n    var mouseDownEvent = { type: \"mouseDown\" };\n    var mouseUpEvent = { type: \"mouseUp\", mode: scope.mode };\n    var objectChangeEvent = { type: \"objectChange\" };\n\n    // Reusable utility variables\n\n    var ray = new THREE.Raycaster();\n\n    var _tempVector = new THREE.Vector3();\n    var _tempVector2 = new THREE.Vector3();\n    var _tempQuaternion = new THREE.Quaternion();\n    var _unit = {\n        X: new THREE.Vector3( 1, 0, 0 ),\n        Y: new THREE.Vector3( 0, 1, 0 ),\n        Z: new THREE.Vector3( 0, 0, 1 )\n    };\n    var _identityQuaternion = new THREE.Quaternion();\n    var _alignVector = new THREE.Vector3();\n\n    var pointStart = new THREE.Vector3();\n    var pointEnd = new THREE.Vector3();\n    var rotationAxis = new THREE.Vector3();\n    var rotationAngle = 0;\n\n    var cameraPosition = new THREE.Vector3();\n    var cameraQuaternion = new THREE.Quaternion();\n    var cameraScale = new THREE.Vector3();\n\n    var parentPosition = new THREE.Vector3();\n    var parentQuaternion = new THREE.Quaternion();\n    var parentScale = new THREE.Vector3();\n\n    var worldPositionStart = new THREE.Vector3();\n    var worldQuaternionStart = new THREE.Quaternion();\n    var worldScaleStart = new THREE.Vector3();\n\n    var worldPosition = new THREE.Vector3();\n    var worldQuaternion = new THREE.Quaternion();\n    var worldScale = new THREE.Vector3();\n\n    var eye = new THREE.Vector3();\n\n    var _positionStart = new THREE.Vector3();\n    var _quaternionStart = new THREE.Quaternion();\n    var _scaleStart = new THREE.Vector3();\n\n    // TODO: remove properties unused in plane and gizmo\n\n    defineProperty( \"parentQuaternion\", parentQuaternion );\n    defineProperty( \"worldPosition\", worldPosition );\n    defineProperty( \"worldPositionStart\", worldPositionStart );\n    defineProperty( \"worldQuaternion\", worldQuaternion );\n    defineProperty( \"worldQuaternionStart\", worldQuaternionStart );\n    defineProperty( \"cameraPosition\", cameraPosition );\n    defineProperty( \"cameraQuaternion\", cameraQuaternion );\n    defineProperty( \"pointStart\", pointStart );\n    defineProperty( \"pointEnd\", pointEnd );\n    defineProperty( \"rotationAxis\", rotationAxis );\n    defineProperty( \"rotationAngle\", rotationAngle );\n    defineProperty( \"eye\", eye );\n\n\n\n        domElement.addEventListener( \"mousedown\", onPointerDown, false );\n        domElement.addEventListener( \"touchstart\", onPointerDown, false );\n        domElement.addEventListener( \"mousemove\", onPointerHover, false );\n        domElement.addEventListener( \"touchmove\", onPointerHover, false );\n        domElement.addEventListener( \"touchmove\", onPointerMove, false );\n        document.addEventListener( \"mouseup\", onPointerUp, false );\n        domElement.addEventListener( \"touchend\", onPointerUp, false );\n        domElement.addEventListener( \"touchcancel\", onPointerUp, false );\n        domElement.addEventListener( \"touchleave\", onPointerUp, false );\n        domElement.addEventListener( \"contextmenu\", onContext, false );\n\n\n\n    this.dispose = function () {\n\n        domElement.removeEventListener( \"mousedown\", onPointerDown );\n        domElement.removeEventListener( \"touchstart\", onPointerDown );\n        domElement.removeEventListener( \"mousemove\", onPointerHover );\n        domElement.removeEventListener( \"touchmove\", onPointerHover );\n        domElement.removeEventListener( \"touchmove\", onPointerMove );\n        document.removeEventListener( \"mouseup\", onPointerUp );\n        domElement.removeEventListener( \"touchend\", onPointerUp );\n        domElement.removeEventListener( \"touchcancel\", onPointerUp );\n        domElement.removeEventListener( \"touchleave\", onPointerUp );\n        domElement.removeEventListener( \"contextmenu\", onContext );\n\n    };\n\n    // Set current object\n    this.attach = function ( object ) {\n\n        this.object = object;\n        this.visible = true;\n\n    };\n\n    // Detatch from object\n    this.detach = function () {\n\n        this.object = undefined;\n        this.visible = false;\n        this.axis = null;\n\n    };\n\n    // Defined getter, setter and store for a property\n    function defineProperty( propName, defaultValue ) {\n\n        var propValue = defaultValue;\n\n        Object.defineProperty( scope, propName, {\n\n            get: function() {\n\n                return propValue !== undefined ? propValue : defaultValue;\n\n            },\n\n            set: function( value ) {\n\n                if ( propValue !== value ) {\n\n                    propValue = value;\n                    _plane[ propName ] = value;\n                    _gizmo[ propName ] = value;\n\n                    scope.dispatchEvent( { type: propName + \"-changed\", value: value } );\n                    scope.dispatchEvent( changeEvent );\n\n                }\n\n            }\n\n        });\n\n        scope[ propName ] = defaultValue;\n        _plane[ propName ] = defaultValue;\n        _gizmo[ propName ] = defaultValue;\n\n    }\n\n    // updateMatrixWorld  updates key transformation variables\n    this.updateMatrixWorld = function () {\n\n        if ( this.object !== undefined ) {\n\n            this.object.updateMatrixWorld();\n            this.object.parent.matrixWorld.decompose( parentPosition, parentQuaternion, parentScale );\n            this.object.matrixWorld.decompose( worldPosition, worldQuaternion, worldScale );\n\n        }\n\n        this.camera.updateMatrixWorld();\n        this.camera.matrixWorld.decompose( cameraPosition, cameraQuaternion, cameraScale );\n\n        if ( this.camera instanceof THREE.PerspectiveCamera ) {\n\n            eye.copy( cameraPosition ).sub( worldPosition ).normalize();\n\n        } else if ( this.camera instanceof THREE.OrthographicCamera ) {\n\n            eye.copy( cameraPosition ).normalize();\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n    this.pointerHover = function( pointer ) {\n\n        if ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        ray.setFromCamera( pointer, this.camera );\n\n        var intersect = ray.intersectObjects( _gizmo.picker[ this.mode ].children, true )[ 0 ] || false;\n\n        if ( intersect ) {\n\n            this.axis = intersect.object.name;\n\n        } else {\n\n            this.axis = null;\n\n        }\n\n    };\n\n    this.pointerDown = function( pointer ) {\n\n        if ( this.object === undefined || this.dragging === true || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        if ( ( pointer.button === 0 || pointer.button === undefined ) && this.axis !== null ) {\n\n            ray.setFromCamera( pointer, this.camera );\n\n            var planeIntersect = ray.intersectObjects( [ _plane ], true )[ 0 ] || false;\n\n            if ( planeIntersect ) {\n\n                var space = this.space;\n\n                if ( this.mode === 'scale') {\n\n                    space = 'local';\n\n                } else if ( this.axis === 'E' ||  this.axis === 'XYZE' ||  this.axis === 'XYZ' ) {\n\n                    space = 'world';\n\n                }\n\n                if ( space === 'local' && this.mode === 'rotate' ) {\n\n                    var snap = this.rotationSnap;\n\n                    if ( this.axis === 'X' && snap ) this.object.rotation.x = Math.round( this.object.rotation.x / snap ) * snap;\n                    if ( this.axis === 'Y' && snap ) this.object.rotation.y = Math.round( this.object.rotation.y / snap ) * snap;\n                    if ( this.axis === 'Z' && snap ) this.object.rotation.z = Math.round( this.object.rotation.z / snap ) * snap;\n\n                }\n\n                this.object.updateMatrixWorld();\n                this.object.parent.updateMatrixWorld();\n\n                _positionStart.copy( this.object.position );\n                _quaternionStart.copy( this.object.quaternion );\n                _scaleStart.copy( this.object.scale );\n\n                this.object.matrixWorld.decompose( worldPositionStart, worldQuaternionStart, worldScaleStart );\n\n                pointStart.copy( planeIntersect.point ).sub( worldPositionStart );\n\n                if ( space === 'local' ) pointStart.applyQuaternion( worldQuaternionStart.clone().inverse() );\n\n            }\n\n            this.dragging = true;\n            mouseDownEvent.mode = this.mode;\n            this.dispatchEvent( mouseDownEvent );\n\n        }\n\n    };\n\n    this.pointerMove = function( pointer ) {\n\n        var axis = this.axis;\n        var mode = this.mode;\n        var object = this.object;\n        var space = this.space;\n\n        if ( mode === 'scale') {\n\n            space = 'local';\n\n        } else if ( axis === 'E' ||  axis === 'XYZE' ||  axis === 'XYZ' ) {\n\n            space = 'world';\n\n        }\n\n        if ( object === undefined || axis === null || this.dragging === false || ( pointer.button !== undefined && pointer.button !== 0 ) ) return;\n\n        ray.setFromCamera( pointer, this.camera );\n\n        var planeIntersect = ray.intersectObjects( [ _plane ], true )[ 0 ] || false;\n\n        if ( planeIntersect === false ) return;\n\n        pointEnd.copy( planeIntersect.point ).sub( worldPositionStart );\n\n        if ( space === 'local' ) pointEnd.applyQuaternion( worldQuaternionStart.clone().inverse() );\n\n        if ( mode === 'translate' ) {\n\n            if ( axis.search( 'X' ) === -1 ) {\n                pointEnd.x = pointStart.x;\n            }\n            if ( axis.search( 'Y' ) === -1 ) {\n                pointEnd.y = pointStart.y;\n            }\n            if ( axis.search( 'Z' ) === -1 ) {\n                pointEnd.z = pointStart.z;\n            }\n\n            // Apply translate\n\n            if ( space === 'local' ) {\n                object.position.copy( pointEnd ).sub( pointStart ).applyQuaternion( _quaternionStart );\n            } else {\n                object.position.copy( pointEnd ).sub( pointStart );\n            }\n\n            object.position.add( _positionStart );\n\n            // Apply translation snap\n\n            if ( this.translationSnap ) {\n\n                if ( space === 'local' ) {\n\n                    object.position.applyQuaternion(_tempQuaternion.copy( _quaternionStart ).inverse() );\n\n                    if ( axis.search( 'X' ) !== -1 ) {\n                        object.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Y' ) !== -1 ) {\n                        object.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Z' ) !== -1 ) {\n                        object.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    object.position.applyQuaternion( _quaternionStart );\n\n                }\n\n                if ( space === 'world' ) {\n\n                    if ( object.parent ) {\n                        object.position.add( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n                    }\n\n                    if ( axis.search( 'X' ) !== -1 ) {\n                        object.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Y' ) !== -1 ) {\n                        object.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( axis.search( 'Z' ) !== -1 ) {\n                        object.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n                    }\n\n                    if ( object.parent ) {\n                        object.position.sub( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n                    }\n\n                }\n\n            }\n\n        } else if ( mode === 'scale' ) {\n\n            if ( axis.search( 'XYZ' ) !== -1 ) {\n\n                var d = pointEnd.length() / pointStart.length();\n\n                if ( pointEnd.dot( pointStart ) < 0 ) d *= -1;\n\n                _tempVector.set( d, d, d );\n\n            } else {\n\n                _tempVector.copy( pointEnd ).divide( pointStart );\n\n                if ( axis.search( 'X' ) === -1 ) {\n                    _tempVector.x = 1;\n                }\n                if ( axis.search( 'Y' ) === -1 ) {\n                    _tempVector.y = 1;\n                }\n                if ( axis.search( 'Z' ) === -1 ) {\n                    _tempVector.z = 1;\n                }\n\n            }\n\n            // Apply scale\n\n            object.scale.copy( _scaleStart ).multiply( _tempVector );\n\n        } else if ( mode === 'rotate' ) {\n\n            var ROTATION_SPEED = 20 / worldPosition.distanceTo( _tempVector.setFromMatrixPosition( this.camera.matrixWorld ) );\n\n            var quaternion = this.space === \"local\" ? worldQuaternion : _identityQuaternion;\n\n            var unit = _unit[ axis ];\n\n            if ( axis === 'E' ) {\n\n                _tempVector.copy( pointEnd ).cross( pointStart );\n                rotationAxis.copy( eye );\n                rotationAngle = pointEnd.angleTo( pointStart ) * ( _tempVector.dot( eye ) < 0 ? 1 : -1 );\n\n            } else if ( axis === 'XYZE' ) {\n\n                _tempVector.copy( pointEnd ).sub( pointStart ).cross( eye ).normalize();\n                rotationAxis.copy( _tempVector );\n                rotationAngle = pointEnd.sub( pointStart ).dot( _tempVector.cross( eye ) ) * ROTATION_SPEED;\n\n            } else if ( axis === 'X' || axis === 'Y' || axis === 'Z' ) {\n\n                _alignVector.copy( unit ).applyQuaternion( quaternion );\n\n                rotationAxis.copy( unit );\n\n                _tempVector = unit.clone();\n                _tempVector2 = pointEnd.clone().sub( pointStart );\n                if ( space === 'local' ) {\n                    _tempVector.applyQuaternion( quaternion );\n                    _tempVector2.applyQuaternion( worldQuaternionStart );\n                }\n                rotationAngle = _tempVector2.dot( _tempVector.cross( eye ).normalize() ) * ROTATION_SPEED;\n\n            }\n\n            // Apply rotation snap\n\n            if ( this.rotationSnap ) rotationAngle = Math.round( rotationAngle / this.rotationSnap ) * this.rotationSnap;\n\n            this.rotationAngle = rotationAngle;\n\n            // Apply rotate\n\n            if ( space === 'local' ) {\n\n                object.quaternion.copy( _quaternionStart );\n                object.quaternion.multiply( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n\n            } else {\n\n                object.quaternion.copy( _tempQuaternion.setFromAxisAngle( rotationAxis, rotationAngle ) );\n                object.quaternion.multiply( _quaternionStart );\n\n            }\n\n        }\n\n        this.dispatchEvent( changeEvent );\n        this.dispatchEvent( objectChangeEvent );\n\n    };\n\n    this.pointerUp = function( pointer ) {\n\n        if ( pointer.button !== undefined && pointer.button !== 0 ) return;\n\n        if ( this.dragging && ( this.axis !== null ) ) {\n\n            mouseUpEvent.mode = this.mode;\n            this.dispatchEvent( mouseUpEvent );\n\n        }\n\n        this.dragging = false;\n\n        if ( pointer.button === undefined ) this.axis = null;\n\n    };\n\n    // normalize mouse / touch pointer and remap {x,y} to view space.\n\n    function getPointer( event ) {\n\n        var pointer = event.changedTouches ? event.changedTouches[ 0 ] : event;\n\n        var rect = domElement.getBoundingClientRect();\n\n        return {\n            x: ( pointer.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( pointer.clientY - rect.top ) / rect.height * 2 + 1,\n            button: event.button\n        };\n\n    }\n\n    // mouse / touch event handlers\n\n    function onContext( event ) {\n\n        event.preventDefault();\n\n    }\n\n    function onPointerHover( event ) {\n\n        if ( !scope.enabled ) return;\n\n        scope.pointerHover( getPointer( event ) );\n\n    }\n\n    function onPointerDown( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault();\n\n        document.addEventListener( \"mousemove\", onPointerMove, false );\n\n        scope.pointerHover( getPointer( event ) );\n        scope.pointerDown( getPointer( event ) );\n\n    }\n\n    function onPointerMove( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault();\n\n        scope.pointerMove( getPointer( event ) );\n\n    }\n\n    function onPointerUp( event ) {\n\n        if ( !scope.enabled ) return;\n\n        event.preventDefault(); // Prevent MouseEvent on mobile\n\n        document.removeEventListener( \"mousemove\", onPointerMove, false );\n\n        scope.pointerUp( getPointer( event ) );\n\n    }\n\n    // TODO: depricate\n\n    this.getMode = function () {\n\n        return scope.mode;\n\n    };\n\n    this.setMode = function ( mode ) {\n\n        scope.mode = mode;\n\n    };\n\n    this.setTranslationSnap = function ( translationSnap ) {\n\n        scope.translationSnap = translationSnap;\n\n    };\n\n    this.setRotationSnap = function ( rotationSnap ) {\n\n        scope.rotationSnap = rotationSnap;\n\n    };\n\n    this.setSize = function ( size ) {\n\n        scope.size = size;\n\n    };\n\n    this.setSpace = function ( space ) {\n\n        scope.space = space;\n\n    };\n\n    this.update = function () {\n\n        console.warn( 'TransformControls: update function has been depricated.' );\n\n    };\n\n};\n\nTransformControls.prototype = Object.assign( Object.create( THREE.Object3D.prototype ), {\n\n    constructor: TransformControls,\n\n    isTransformControls: true\n\n} );\n\n\nconst TransformControlsGizmo = function () {\n\n\n    THREE.Object3D.call( this );\n\n    this.type = 'TransformControlsGizmo';\n\n    // shared materials\n\n    var gizmoMaterial = new THREE.MeshBasicMaterial({\n        depthTest: false,\n        depthWrite: false,\n        transparent: true,\n        side: THREE.DoubleSide,\n        fog: false\n    });\n\n    var gizmoLineMaterial = new THREE.LineBasicMaterial({\n        depthTest: false,\n        depthWrite: false,\n        transparent: true,\n        linewidth: 1,\n        fog: false\n    });\n\n    // Make unique material for each axis/color\n\n    var matInvisible = gizmoMaterial.clone();\n    matInvisible.opacity = 0.15;\n\n    var matHelper = gizmoMaterial.clone();\n    matHelper.opacity = 0.33;\n\n    var matRed = gizmoMaterial.clone();\n    matRed.color.set( 0xff0000 );\n\n    var matGreen = gizmoMaterial.clone();\n    matGreen.color.set( 0x00ff00 );\n\n    var matBlue = gizmoMaterial.clone();\n    matBlue.color.set( 0x0000ff );\n\n    var matWhiteTransperent = gizmoMaterial.clone();\n    matWhiteTransperent.opacity = 0.25;\n\n    var matYellowTransparent = matWhiteTransperent.clone();\n    matYellowTransparent.color.set( 0xffff00 );\n\n    var matCyanTransparent = matWhiteTransperent.clone();\n    matCyanTransparent.color.set( 0x00ffff );\n\n    var matMagentaTransparent = matWhiteTransperent.clone();\n    matMagentaTransparent.color.set( 0xff00ff );\n\n    var matYellow = gizmoMaterial.clone();\n    matYellow.color.set( 0xffff00 );\n\n    var matLineRed = gizmoLineMaterial.clone();\n    matLineRed.color.set( 0xff0000 );\n\n    var matLineGreen = gizmoLineMaterial.clone();\n    matLineGreen.color.set( 0x00ff00 );\n\n    var matLineBlue = gizmoLineMaterial.clone();\n    matLineBlue.color.set( 0x0000ff );\n\n    var matLineCyan = gizmoLineMaterial.clone();\n    matLineCyan.color.set( 0x00ffff );\n\n    var matLineMagenta = gizmoLineMaterial.clone();\n    matLineMagenta.color.set( 0xff00ff );\n\n    var matLineYellow = gizmoLineMaterial.clone();\n    matLineYellow.color.set( 0xffff00 );\n\n    var matLineGray = gizmoLineMaterial.clone();\n    matLineGray.color.set( 0x787878);\n\n    var matLineYellowTransparent = matLineYellow.clone();\n    matLineYellowTransparent.opacity = 0.25;\n\n    // reusable geometry\n\n    var arrowGeometry = new THREE.CylinderBufferGeometry( 0, 0.05, 0.2, 12, 1, false);\n\n    var scaleHandleGeometry = new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125);\n\n    var lineGeometry = new THREE.BufferGeometry( );\n    lineGeometry.addAttribute('position', new THREE.Float32BufferAttribute( [ 0, 0, 0,\t1, 0, 0 ], 3 ) );\n\n    var CircleGeometry = function( radius, arc ) {\n\n        var geometry = new THREE.BufferGeometry( );\n        var vertices = [];\n\n        for ( var i = 0; i <= 64 * arc; ++i ) {\n\n            vertices.push( 0, Math.cos( i / 32 * Math.PI ) * radius, Math.sin( i / 32 * Math.PI ) * radius );\n\n        }\n\n        geometry.addAttribute('position', new THREE.Float32BufferAttribute( vertices, 3 ) );\n\n        return geometry;\n\n    };\n\n    // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n    var TranslateHelperGeometry = function( radius, arc ) {\n\n        var geometry = new THREE.BufferGeometry()\n\n        geometry.addAttribute('position', new THREE.Float32BufferAttribute( [ 0, 0, 0, 1, 1, 1 ], 3 ) );\n\n        return geometry;\n\n    };\n\n    // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n    var gizmoTranslate = {\n        X: [\n            [ new THREE.Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, -Math.PI / 2 ], null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matRed ), [ 1, 0, 0 ], [ 0, 0, Math.PI / 2 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineRed ) ]\n        ],\n        Y: [\n            [ new THREE.Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], null, null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matGreen ), [ 0, 1, 0 ], [ Math.PI, 0, 0 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ Math.PI / 2, 0, 0 ], null, 'fwd' ],\n            [ new THREE.Mesh( arrowGeometry, matBlue ), [ 0, 0, 1 ], [ -Math.PI / 2, 0, 0 ], null, 'bwd' ],\n            [ new THREE.Line( lineGeometry, matLineBlue ), null, [ 0, -Math.PI / 2, 0 ] ]\n        ],\n        XYZ: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.1, 0 ), matWhiteTransperent ), [ 0, 0, 0 ], [ 0, 0, 0 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matYellowTransparent ), [ 0.15, 0.15, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.18, 0.3, 0 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.3, 0.18, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matCyanTransparent ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.18, 0.3 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.3, 0.18 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.295, 0.295 ), matMagentaTransparent ), [ 0.15, 0, 0.15 ], [ -Math.PI / 2, 0, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.18, 0, 0.3 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.3, 0, 0.18 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ]\n    };\n\n    var pickerTranslate = {\n        X: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0.6, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0.6, 0 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false ), matInvisible ), [ 0, 0, 0.6 ], [ Math.PI / 2, 0, 0 ] ]\n        ],\n        XYZ: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.2, 0 ), matInvisible ) ]\n        ],\n        XY: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0.2, 0 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0, 0.2, 0.2 ], [ 0, Math.PI / 2, 0 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( new THREE.PlaneBufferGeometry( 0.4, 0.4 ), matInvisible ), [ 0.2, 0, 0.2 ], [ -Math.PI / 2, 0, 0 ] ]\n        ]\n    };\n\n    var helperTranslate = {\n        START: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n        ],\n        END: [\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n        ],\n        DELTA: [\n            [ new THREE.Line( TranslateHelperGeometry(), matHelper ), null, null, null, 'helper' ]\n        ],\n        X: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Y: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, -1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Z: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, 0, -1e3 ], [ 0, -Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    var gizmoRotate = {\n        X: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineRed ) ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matRed ), [ 0, 0, 0.99 ], null, [ 1, 3, 1 ] ],\n        ],\n        Y: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineGreen ), null, [ 0, 0, -Math.PI / 2 ] ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matGreen ), [ 0, 0, 0.99 ], null, [ 3, 1, 1 ] ],\n        ],\n        Z: [\n            [ new THREE.Line( CircleGeometry( 1, 0.5 ), matLineBlue ), null, [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Mesh( new THREE.OctahedronBufferGeometry( 0.04, 0 ), matBlue ), [ 0.99, 0, 0 ], null, [ 1, 3, 1 ] ],\n        ],\n        E: [\n            [ new THREE.Line( CircleGeometry( 1.25, 1 ), matLineYellowTransparent ), null, [ 0, Math.PI / 2, 0 ] ],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 1.17, 0, 0 ], [ 0, 0, -Math.PI / 2 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ -1.17, 0, 0 ], [ 0, 0, Math.PI / 2 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, -1.17, 0 ], [ Math.PI, 0, 0 ], [ 1, 1, 0.001 ]],\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.03, 0, 0.15, 4, 1, false ), matLineYellowTransparent ), [ 0, 1.17, 0 ], [ 0, 0, 0 ], [ 1, 1, 0.001 ]],\n        ],\n        XYZE: [\n            [ new THREE.Line( CircleGeometry( 1, 1 ), matLineGray ), null, [ 0, Math.PI / 2, 0 ] ]\n        ]\n    };\n\n    var helperRotate = {\n        AXIS: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    var pickerRotate = {\n        X: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, -Math.PI / 2, -Math.PI / 2 ] ],\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ] ],\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ],\n        ],\n        E: [\n            [ new THREE.Mesh( new THREE.TorusBufferGeometry( 1.25, 0.1, 2, 24 ), matInvisible ) ]\n        ],\n        XYZE: [\n            [ new THREE.Mesh( new THREE.SphereBufferGeometry( 0.7, 10, 8 ), matInvisible ) ]\n        ]\n    };\n\n    var gizmoScale = {\n        X: [\n            [ new THREE.Mesh( scaleHandleGeometry, matRed ), [ 0.8, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineRed ), null, null, [ 0.8, 1, 1 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( scaleHandleGeometry, matGreen ), [ 0, 0.8, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineGreen ), null, [ 0, 0, Math.PI / 2 ], [ 0.8, 1, 1 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, 0.8 ], [ Math.PI / 2, 0, 0 ] ],\n            [ new THREE.Line( lineGeometry, matLineBlue ), null, [ 0, -Math.PI / 2, 0 ], [ 0.8, 1, 1 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( scaleHandleGeometry, matYellowTransparent ), [ 0.85, 0.85, 0 ], null, [ 2, 2, 0.2 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.855, 0.98, 0 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineYellow ), [ 0.98, 0.855, 0 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ]\n        ],\n        YZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matCyanTransparent ), [ 0, 0.85, 0.85 ], null, [ 0.2, 2, 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.855, 0.98 ], [ 0, 0, Math.PI / 2 ], [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineCyan ), [ 0, 0.98, 0.855 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matMagentaTransparent ), [ 0.85, 0, 0.85 ], null, [ 2, 0.2, 2 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.855, 0, 0.98 ], null, [ 0.125, 1, 1 ] ],\n            [ new THREE.Line( lineGeometry, matLineMagenta ), [ 0.98, 0, 0.855 ], [ 0, -Math.PI / 2, 0 ], [ 0.125, 1, 1 ] ]\n        ],\n        XYZX: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 1.1, 0, 0 ] ],\n        ],\n        XYZY: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 0, 1.1, 0 ] ],\n        ],\n        XYZZ: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.125, 0.125, 0.125 ), matWhiteTransperent ), [ 0, 0, 1.1 ] ],\n        ]\n    };\n\n    var pickerScale = {\n        X: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0.5, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\n        ],\n        Y: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0.5, 0 ] ]\n        ],\n        Z: [\n            [ new THREE.Mesh( new THREE.CylinderBufferGeometry( 0.2, 0, 0.8, 4, 1, false ), matInvisible ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ] ]\n        ],\n        XY: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0.85, 0 ], null, [ 3, 3, 0.2 ] ],\n        ],\n        YZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0, 0.85, 0.85 ], null, [ 0.2, 3, 3 ] ],\n        ],\n        XZ: [\n            [ new THREE.Mesh( scaleHandleGeometry, matInvisible ), [ 0.85, 0, 0.85 ], null, [ 3, 0.2, 3 ] ],\n        ],\n        XYZX: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 1.1, 0, 0 ] ],\n        ],\n        XYZY: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 1.1, 0 ] ],\n        ],\n        XYZZ: [\n            [ new THREE.Mesh( new THREE.BoxBufferGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 0, 1.1 ] ],\n        ]\n    };\n\n    var helperScale = {\n        X: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ -1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Y: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, -1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n        ],\n        Z: [\n            [ new THREE.Line( lineGeometry, matHelper.clone() ), [ 0, 0, -1e3 ], [ 0, -Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n        ]\n    };\n\n    // Creates an Object3D with gizmos described in custom hierarchy definition.\n\n    var setupGizmo = function( gizmoMap ) {\n\n        var gizmo = new THREE.Object3D();\n\n        for ( var name in gizmoMap ) {\n\n            for ( var i = gizmoMap[ name ].length; i --; ) {\n\n                var object = gizmoMap[ name ][ i ][ 0 ].clone();\n                var position = gizmoMap[ name ][ i ][ 1 ];\n                var rotation = gizmoMap[ name ][ i ][ 2 ];\n                var scale = gizmoMap[ name ][ i ][ 3 ];\n                var tag = gizmoMap[ name ][ i ][ 4 ];\n\n                // name and tag properties are essential for picking and updating logic.\n                object.name = name;\n                object.tag = tag;\n\n                if (position) {\n                    object.position.set(position[ 0 ], position[ 1 ], position[ 2 ]);\n                }\n                if (rotation) {\n                    object.rotation.set(rotation[ 0 ], rotation[ 1 ], rotation[ 2 ]);\n                }\n                if (scale) {\n                    object.scale.set(scale[ 0 ], scale[ 1 ], scale[ 2 ]);\n                }\n\n                object.updateMatrix();\n\n                var tempGeometry = object.geometry.clone();\n                tempGeometry.applyMatrix(object.matrix);\n                object.geometry = tempGeometry;\n\n                object.position.set( 0, 0, 0 );\n                object.rotation.set( 0, 0, 0 );\n                object.scale.set(1, 1, 1);\n\n                gizmo.add(object);\n\n            }\n\n        }\n\n        return gizmo;\n\n    };\n\n    // Reusable utility variables\n\n    var tempVector = new THREE.Vector3( 0, 0, 0 );\n    var tempEuler = new THREE.Euler();\n    var alignVector = new THREE.Vector3( 0, 1, 0 );\n    var zeroVector = new THREE.Vector3( 0, 0, 0 );\n    var lookAtMatrix = new THREE.Matrix4();\n    var tempQuaternion = new THREE.Quaternion();\n    var tempQuaternion2 = new THREE.Quaternion();\n    var identityQuaternion = new THREE.Quaternion();\n\n    var unitX = new THREE.Vector3( 1, 0, 0 );\n    var unitY = new THREE.Vector3( 0, 1, 0 );\n    var unitZ = new THREE.Vector3( 0, 0, 1 );\n\n    // Gizmo creation\n\n    this.gizmo = {};\n    this.picker = {};\n    this.helper = {};\n\n    this.add( this.gizmo[ \"translate\" ] = setupGizmo( gizmoTranslate ) );\n    this.add( this.gizmo[ \"rotate\" ] = setupGizmo( gizmoRotate ) );\n    this.add( this.gizmo[ \"scale\" ] = setupGizmo( gizmoScale ) );\n    this.add( this.picker[ \"translate\" ] = setupGizmo( pickerTranslate ) );\n    this.add( this.picker[ \"rotate\" ] = setupGizmo( pickerRotate ) );\n    this.add( this.picker[ \"scale\" ] = setupGizmo( pickerScale ) );\n    this.add( this.helper[ \"translate\" ] = setupGizmo( helperTranslate ) );\n    this.add( this.helper[ \"rotate\" ] = setupGizmo( helperRotate ) );\n    this.add( this.helper[ \"scale\" ] = setupGizmo( helperScale ) );\n\n    // Pickers should be hidden always\n\n    this.picker[ \"translate\" ].visible = false;\n    this.picker[ \"rotate\" ].visible = false;\n    this.picker[ \"scale\" ].visible = false;\n\n    // updateMatrixWorld will update transformations and appearance of individual handles\n\n    this.updateMatrixWorld = function () {\n\n        var space = this.space;\n\n        if ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n        var quaternion = space === \"local\" ? this.worldQuaternion : identityQuaternion;\n\n        // Show only gizmos for current transform mode\n\n        this.gizmo[ \"translate\" ].visible = this.mode === \"translate\";\n        this.gizmo[ \"rotate\" ].visible = this.mode === \"rotate\";\n        this.gizmo[ \"scale\" ].visible = this.mode === \"scale\";\n\n        this.helper[ \"translate\" ].visible = this.mode === \"translate\";\n        this.helper[ \"rotate\" ].visible = this.mode === \"rotate\";\n        this.helper[ \"scale\" ].visible = this.mode === \"scale\";\n\n\n        var handles = [];\n        handles = handles.concat( this.picker[ this.mode ].children );\n        handles = handles.concat( this.gizmo[ this.mode ].children );\n        handles = handles.concat( this.helper[ this.mode ].children );\n\n        for ( var i = 0; i < handles.length; i++ ) {\n\n            var handle = handles[i];\n\n            // hide aligned to camera\n\n            handle.visible = true;\n            handle.rotation.set( 0, 0, 0 );\n            handle.position.copy( this.worldPosition );\n\n            var eyeDistance = this.worldPosition.distanceTo( this.cameraPosition);\n            handle.scale.set( 1, 1, 1 ).multiplyScalar( eyeDistance * this.size / 7 );\n\n            // TODO: simplify helpers and consider decoupling from gizmo\n\n            if ( handle.tag === 'helper' ) {\n\n                handle.visible = false;\n\n                if ( handle.name === 'AXIS' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.visible = !!this.axis;\n\n                    if ( this.axis === 'X' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, 0, 0 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'Y' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, 0, Math.PI / 2 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'Z' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n                        handle.quaternion.copy( quaternion ).multiply( tempQuaternion );\n\n                        if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n                            handle.visible = false;\n                        }\n\n                    }\n\n                    if ( this.axis === 'XYZE' ) {\n\n                        tempQuaternion.setFromEuler( tempEuler.set( 0, Math.PI / 2, 0 ) );\n                        alignVector.copy( this.rotationAxis );\n                        handle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( zeroVector, alignVector, unitY ) );\n                        handle.quaternion.multiply( tempQuaternion );\n                        handle.visible = this.dragging;\n\n                    }\n\n                    if ( this.axis === 'E' ) {\n\n                        handle.visible = false;\n\n                    }\n\n\n                } else if ( handle.name === 'START' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.visible = this.dragging;\n\n                } else if ( handle.name === 'END' ) {\n\n                    handle.position.copy( this.worldPosition );\n                    handle.visible = this.dragging;\n\n                } else if ( handle.name === 'DELTA' ) {\n\n                    handle.position.copy( this.worldPositionStart );\n                    handle.quaternion.copy( this.worldQuaternionStart );\n                    tempVector.set( 1e-10, 1e-10, 1e-10 ).add( this.worldPositionStart ).sub( this.worldPosition ).multiplyScalar( -1 );\n                    tempVector.applyQuaternion( this.worldQuaternionStart.clone().inverse() );\n                    handle.scale.copy( tempVector );\n                    handle.visible = this.dragging;\n\n                } else {\n\n                    handle.quaternion.copy( quaternion );\n\n                    if ( this.dragging ) {\n\n                        handle.position.copy( this.worldPositionStart );\n\n                    } else {\n\n                        handle.position.copy( this.worldPosition );\n\n                    }\n\n                    if ( this.axis ) {\n\n                        handle.visible = this.axis.search( handle.name ) !== -1;\n\n                    }\n\n                }\n\n                // If updating helper, skip rest of the loop\n                continue;\n\n            }\n\n            // Align handles to current local or world rotation\n\n            handle.quaternion.copy( quaternion );\n\n            if ( this.mode === 'translate' || this.mode === 'scale' ) {\n\n                // Hide translate and scale axis facing the camera\n\n                var AXIS_HIDE_TRESHOLD = 0.99;\n                var PLANE_HIDE_TRESHOLD = 0.2;\n                var AXIS_FLIP_TRESHOLD = -0.4;\n\n\n                if ( handle.name === 'X' || handle.name === 'XYZX' ) {\n                    if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'Y' || handle.name === 'XYZY' ) {\n                    if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'Z' || handle.name === 'XYZZ' ) {\n                    if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'XY' ) {\n                    if ( Math.abs( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'YZ' ) {\n                    if ( Math.abs( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n                if ( handle.name === 'XZ' ) {\n                    if ( Math.abs( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n                        handle.scale.set( 1e-10, 1e-10, 1e-10 );\n                        handle.visible = false;\n                    }\n                }\n\n                // Flip translate and scale axis ocluded behind another axis\n\n                if ( handle.name.search( 'X' ) !== -1 ) {\n                    if ( alignVector.copy( unitX ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.x *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n                if ( handle.name.search( 'Y' ) !== -1 ) {\n                    if ( alignVector.copy( unitY ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.y *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n                if ( handle.name.search( 'Z' ) !== -1 ) {\n                    if ( alignVector.copy( unitZ ).applyQuaternion( quaternion ).dot( this.eye ) < AXIS_FLIP_TRESHOLD ) {\n                        if ( handle.tag === 'fwd' ) {\n                            handle.visible = false;\n                        } else {\n                            handle.scale.z *= -1;\n                        }\n                    } else if ( handle.tag === 'bwd' ) {\n                        handle.visible = false;\n                    }\n                }\n\n            } else if ( this.mode === 'rotate' ) {\n\n                // Align handles to current local or world rotation\n\n                tempQuaternion2.copy( quaternion );\n                alignVector.copy( this.eye ).applyQuaternion( tempQuaternion.copy( quaternion ).inverse() );\n\n                if ( handle.name.search( \"E\" ) !== - 1 ) {\n\n                    handle.quaternion.setFromRotationMatrix( lookAtMatrix.lookAt( this.eye, zeroVector, unitY ) );\n\n                }\n\n                if ( handle.name === 'X' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitX, Math.atan2( -alignVector.y, alignVector.z ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n                if ( handle.name === 'Y' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitY, Math.atan2( alignVector.x, alignVector.z ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n                if ( handle.name === 'Z' ) {\n\n                    tempQuaternion.setFromAxisAngle( unitZ, Math.atan2( alignVector.y, alignVector.x ) );\n                    tempQuaternion.multiplyQuaternions( tempQuaternion2, tempQuaternion );\n                    handle.quaternion.copy( tempQuaternion );\n\n                }\n\n            }\n\n            // Hide disabled axes\n            handle.visible = handle.visible && ( handle.name.indexOf( \"X\" ) === -1 || this.showX );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"Y\" ) === -1 || this.showY );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"Z\" ) === -1 || this.showZ );\n            handle.visible = handle.visible && ( handle.name.indexOf( \"E\" ) === -1 || ( this.showX && this.showY && this.showZ ) );\n\n            // highlight selected axis\n\n            handle.material._opacity = handle.material._opacity || handle.material.opacity;\n            handle.material._color = handle.material._color || handle.material.color.clone();\n\n            handle.material.color.copy( handle.material._color );\n            handle.material.opacity = handle.material._opacity;\n\n            if ( !this.enabled ) {\n\n                handle.material.opacity *= 0.5;\n                handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n            } else if ( this.axis ) {\n\n                if ( handle.name === this.axis ) {\n\n                    handle.material.opacity = 1.0;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                } else if ( this.axis.split('').some( function( a ) { return handle.name === a; } ) ) {\n\n                    handle.material.opacity = 1.0;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                } else {\n\n                    handle.material.opacity *= 0.25;\n                    handle.material.color.lerp( new THREE.Color( 1, 1, 1 ), 0.5 );\n\n                }\n\n            }\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n};\n\nTransformControlsGizmo.prototype = Object.assign( Object.create( THREE.Object3D.prototype ), {\n\n    constructor: TransformControlsGizmo,\n\n    isTransformControlsGizmo: true\n\n} );\n\n\nconst TransformControlsPlane = function () {\n\n\n    THREE.Mesh.call( this,\n        new THREE.PlaneBufferGeometry( 100000, 100000, 2, 2 ),\n        new THREE.MeshBasicMaterial( { visible: false, wireframe: true, side: THREE.DoubleSide, transparent: true, opacity: 0.1 } )\n    );\n\n    this.type = 'TransformControlsPlane';\n\n    var unitX = new THREE.Vector3( 1, 0, 0 );\n    var unitY = new THREE.Vector3( 0, 1, 0 );\n    var unitZ = new THREE.Vector3( 0, 0, 1 );\n\n    var tempVector = new THREE.Vector3();\n    var dirVector = new THREE.Vector3();\n    var alignVector = new THREE.Vector3();\n    var tempMatrix = new THREE.Matrix4();\n    var identityQuaternion = new THREE.Quaternion();\n\n    this.updateMatrixWorld = function() {\n\n        var space = this.space;\n\n        this.position.copy( this.worldPosition );\n\n        if ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n        unitX.set( 1, 0, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n        unitY.set( 0, 1, 0 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n        unitZ.set( 0, 0, 1 ).applyQuaternion( space === \"local\" ? this.worldQuaternion : identityQuaternion );\n\n        // Align the plane for current transform mode, axis and space.\n\n        alignVector.copy( unitY );\n\n        switch ( this.mode ) {\n            case 'translate':\n            case 'scale':\n                switch ( this.axis ) {\n                    case 'X':\n                        alignVector.copy( this.eye ).cross( unitX );\n                        dirVector.copy( unitX ).cross( alignVector );\n                        break;\n                    case 'Y':\n                        alignVector.copy( this.eye ).cross( unitY );\n                        dirVector.copy( unitY ).cross( alignVector );\n                        break;\n                    case 'Z':\n                        alignVector.copy( this.eye ).cross( unitZ );\n                        dirVector.copy( unitZ ).cross( alignVector );\n                        break;\n                    case 'XY':\n                        dirVector.copy( unitZ );\n                        break;\n                    case 'YZ':\n                        dirVector.copy( unitX );\n                        break;\n                    case 'XZ':\n                        alignVector.copy( unitZ );\n                        dirVector.copy( unitY );\n                        break;\n                    case 'XYZ':\n                    case 'E':\n                        dirVector.set( 0, 0, 0 );\n                        break;\n                    default:\n                        break;\n                }\n                break;\n            case 'rotate':\n            default:\n                // special case for rotate\n                dirVector.set( 0, 0, 0 );\n        }\n\n        if ( dirVector.length() === 0 ) {\n\n            // If in rotate mode, make the plane parallel to camera\n            this.quaternion.copy( this.cameraQuaternion );\n\n        } else {\n\n            tempMatrix.lookAt( tempVector.set( 0, 0, 0 ), dirVector, alignVector );\n\n            this.quaternion.setFromRotationMatrix( tempMatrix );\n\n        }\n\n        THREE.Object3D.prototype.updateMatrixWorld.call( this );\n\n    };\n\n};\n\nTransformControlsPlane.prototype = Object.assign( Object.create( THREE.Mesh.prototype ), {\n\n    constructor: TransformControlsPlane,\n\n    isTransformControlsPlane: true\n\n} );\n\nexport default TransformControls\n","import {createGraphObjectFromObject, fetchGraphObject} from \"../../syncgraph/utils\";\nimport * as THREE from \"three\";\nimport {PROP_DEFS} from '../Common'\n\nlet COUNTER = 0\n\nexport default class SceneDef {\n    make(graph, root) {\n        if(!root.id) throw new Error(\"can't create scene w/ missing parent\")\n        return fetchGraphObject(graph,createGraphObjectFromObject(graph,{\n            type:'scene',\n            title:'Scene '+COUNTER++,\n            defaultFloor: true,\n            parent:root.id,\n            children:graph.createArray()\n        }))\n    }\n    makeNode(obj) {\n        const scene = new THREE.Group()\n        scene.name = obj.title\n        this.setDefaultFloor(scene,obj.defaultFloor)\n        return scene\n    }\n\n    updateProperty(node, obj, op, provider) {\n        console.log(\"update property\",node.name,op.name,op.value)\n        if(op.name === PROP_DEFS.defaultFloor.key) {\n            console.log('setting the floor too',op.value)\n            this.setDefaultFloor(node,op.value)\n        }\n    }\n\n    setDefaultFloor(scene,val) {\n        if (val === true) {\n            const floor = new THREE.Mesh(\n                new THREE.PlaneBufferGeometry(100, 100, 10, 10),\n                new THREE.MeshLambertMaterial({color: 'blue'})\n            )\n            floor.name = 'defaultFloor'\n            floor.rotation.x = -90 * Math.PI / 180\n            scene.parts = {}\n            scene.parts.floor = floor\n            scene.add(floor)\n        } else {\n            if (scene.parts && scene.parts.floor) {\n                scene.remove(scene.parts.floor)\n                delete scene.parts.floor\n            }\n        }\n    }\n\n    getFloorPart(node) {\n        if(!node) return null\n        if(!node.parts) return null\n        return node.parts.floor\n    }\n\n}\n","import React, {Component} from 'react'\nimport * as ToasterManager from './ToasterManager'\n\nexport class ToasterNotification extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            notification:'saved',\n            visible:false\n        }\n    }\n\n    add = (payload) => {\n        this.setState({notification:payload, visible:true})\n        setTimeout(this.hide,2000)\n    }\n\n    hide = () => this.setState({visible:false})\n\n    componentWillMount() {\n        ToasterManager.onAdd(this.add)\n    }\n\n    render() {\n        return <div style={{\n            position:'absolute',\n            bottom:'10px',\n            left:'10px',\n            backgroundColor:'rgba(0,0,0,0.6)',\n            borderRadius:'1em',\n            color:'white',\n            fontSize:'24pt',\n            padding:'1em',\n            display:this.state.visible?'block':'none'\n        }}>{this.state.notification}</div>\n    }\n}\n","export class SceneGraphProvider {\n    //return the current scene. provider is in charge of tracking which scene is considered 'current'\n    //including the default scene when the project loads\n    getCurrentScene() { throw new Error(\"getCurrentScene not implemented\")}\n    getSceneObjects(scene) { throw new Error(\"getSceneObjects not implemented\")}\n    getBehaviorsForObject(obj) { throw new Error(\"getBehaviorsForObject(obj) not implemented\")}\n    getThreeObject(id) { throw new Error(\"getThreeObject(id) not implemented\")}\n    getParsedBehaviorAsset(beh) { throw new Error(\"getParsedBehaviorAsset(behavior) not implemented\")}\n    getAllBehaviors() { throw new Error(\"getAllBehaviors() not implemented\")}\n\n    //navigate to the specified scene\n    navigateScene(id) { throw new Error(\"navigateScene(id) not implemented\")}\n\n    playMediaAsset(id) { throw new Error(\"playMediaAsset(id) not implemented\")}\n    stopMediaAsset(id) { throw new Error(\"stopMediaAsset(id) not implemented\")}\n    getGraphObjectByName(name) { throw new Error(\"getGraphObjectByName(name) not implemented\")}\n    getGraphObjectById(id) { throw new Error(\"getGraphObjectById(id) not implemented\")}\n    getCamera() { throw new Error(\"getCamera() not implemented\")}\n    getTweenManager() { throw new Error(\"getTweenManager() not implemented\")}\n    startImageRecognizer(info) { throw new Error(\"startImageRecognizer not implemented\")}\n    startGeoRecognizer(info) { throw new Error(\"startGeoRecognizer not implemented\")}\n}\n\nexport default class ScriptManager {\n    constructor(sceneGraphProvider) {\n        this.sgp = sceneGraphProvider\n        this.running = false\n        this.storage = {}\n    }\n\n    makeSystemFacade(evt) {\n        const manager = this\n        const sgp = this.sgp\n        return {\n            getCurrentScene() {\n                return sgp.getCurrentScene()\n            },\n            getScene(name) {\n                return null\n            },\n            getObject(name) {\n                const obj = sgp.getGraphObjectByName(name)\n                if(!obj) throw new Error(`object '${name}' not found`)\n                return new ThreeObjectFacade(manager,obj)\n            },\n            getAsset(name) {\n                const obj = sgp.getGraphObjectByName(name)\n                if(!obj) throw new Error(`asset '${name}' not found`)\n                return new AssetFacade(manager,obj)\n            },\n            getObjectById(id) {\n                return sgp.getGraphObjectById(id)\n            },\n            navigateScene(id) {\n                manager.fireSceneExit(this.getCurrentScene())\n                sgp.navigateScene(id)\n                manager.fireSceneEnter(this.getCurrentScene())\n            },\n            playSound(id) {\n                const asset = sgp.getGraphObjectById(id)\n                manager.playAudioAsset(asset)\n            },\n            getCamera() {\n                return sgp.getCamera()\n            },\n            setKeyValue(key, value) {\n                manager.storage[key] = value\n            },\n            getKeyValue(key, defaultValue) {\n                return manager.storage[key]\n            },\n            hasKeyValue(key) {\n                return typeof manager.storage[key] !== 'undefined'\n            },\n            isAR() {\n                return false\n            },\n            sendMessage(name,payload) {\n                const target = evt.graphTarget\n                if(target) {\n                    manager.fireMessageAtTarget(name,payload,target)\n                }\n            },\n            getTweenManager() {\n                return sgp.getTweenManager()\n            },\n            on(target,type,cb) {\n                manager.on(target,type,cb)\n            },\n            fireEvent(target,type, payload) {\n                manager.fireEventFromTarget(target,type,payload)\n            },\n            startImageRecognizer(info) {\n                return sgp.startImageRecognizer(info)\n            }\n        }\n    }\n\n    performClickAction(target) {\n        if(!this.running) return\n        try {\n            if (!target || !target.exists || !target.exists()) return\n            const evt = {\n                type: 'click',\n                target: target,\n            }\n            evt.system = this.makeSystemFacade(evt)\n            const behaviors = this.sgp.getBehaviorsForObject(target)\n            for (let i in behaviors) {\n                let b = behaviors[i]\n                evt.props = b.props()\n                const asset = this.sgp.getParsedBehaviorAsset(b)\n                if (asset.onClick) asset.onClick(evt)\n            }\n        } catch (error) {\n            console.error(\"error in script\",error.message)\n            console.info(error)\n            this.stopRunning()\n        }\n    }\n\n    fireSceneExit(scene) {\n        if(!scene) console.error(\"firing exit for a scene that is null\")\n        const evt = {\n            type:'exit',\n            target:scene,\n        }\n        evt.system = this.makeSystemFacade(evt)\n        const behaviors = this.sgp.getBehaviorsForObject(scene)\n        behaviors.forEach(b => {\n            const asset = this.sgp.getParsedBehaviorAsset(b)\n            if(asset.onExit) asset.onExit(evt)\n        })\n    }\n    fireSceneEnter(scene) {\n        const evt = {\n            type:'enter',\n            target:scene,\n        }\n        evt.system = this.makeSystemFacade(evt)\n        const behaviors = this.sgp.getBehaviorsForObject(scene)\n        behaviors.forEach(b => {\n            const asset = this.sgp.getParsedBehaviorAsset(b)\n            if(asset.onEnter) asset.onEnter(evt)\n        })\n    }\n\n    tick(time) {\n        if(!this.running) return\n        if(this.startTime ===0) this.startTime = time\n        try {\n            const scene = this.sgp.getCurrentScene()\n            if (!scene) return console.log(\"no current scene?!\")\n            const evt = {\n                type:'tick',\n                time:time-this.startTime\n            }\n            evt.system = this.makeSystemFacade(evt)\n            const behaviors = this.sgp.getBehaviorsForObject(scene)\n            behaviors.forEach(b => {\n                evt.target = new ThreeObjectFacade(this,b.parent)\n                const asset = this.sgp.getParsedBehaviorAsset(b)\n                evt.props = b.props()\n                if(asset.onTick) asset.onTick(evt)\n            })\n            this.sgp.getSceneObjects(scene).forEach(child => {\n                const behaviors = this.sgp.getBehaviorsForObject(child)\n                behaviors.forEach(b => {\n                    evt.target = new ThreeObjectFacade(this,b.parent)\n                    evt.graphTarget = child\n                    const asset = this.sgp.getParsedBehaviorAsset(b)\n                    evt.props = b.props()\n                    if(asset.onTick) asset.onTick(evt)\n                })\n                const obj3 = this.sgp.getThreeObject(child.id)\n                if(obj3 && obj3.update) obj3.update(time,evt)\n            })\n        } catch (err) {\n            console.error(\"error in script\",err.message)\n            console.info(err)\n            this.stopRunning()\n        }\n    }\n\n\n    startRunning() {\n        this.running = true\n        this.startTime = 0\n        this.storage = {}\n        console.log(\"script manager starting\")\n        try {\n            this.sgp.getAllBehaviors().forEach(ref => {\n                const evt = {\n                    type:'init',\n                }\n                evt.system = this.makeSystemFacade(evt)\n                evt.target = new ThreeObjectFacade(this,ref.parent)\n                evt.props = ref.props()\n                const asset = this.sgp.getParsedBehaviorAsset(ref)\n                if (asset.init) asset.init(evt)\n            })\n            const scene = this.sgp.getCurrentScene()\n            if(scene) {\n                this.sgp.getSceneObjects(scene).forEach(child => {\n                    const evt = {\n                        type: 'init',\n                    }\n                    evt.system = this.makeSystemFacade(evt)\n                    const node = this.sgp.getThreeObject(child.id)\n                    if (node.init) node.init(evt)\n                })\n            }\n        } catch(err) {\n            console.error(\"error in script\",err.message)\n            console.info(err)\n            this.stopRunning()\n        }\n    }\n    stopRunning() {\n        try {\n            this.running = false\n            this.storage = {}\n            this.destroyListeners()\n            const scene = this.sgp.getCurrentScene()\n            if(scene) {\n                this.sgp.getSceneObjects(scene).forEach(child => {\n                    const node = this.sgp.getThreeObject(child.id)\n                    if (node.stop) node.stop()\n                })\n            }\n        } catch(err) {\n            console.log(\"error stopping scripts\", err.message)\n            console.info(err)\n        }\n\n        console.log(\"script manager stopping\")\n    }\n    isRunning() {\n        return this.running\n    }\n\n    fireMessageAtTarget(name, payload, target) {\n        const evt = {\n            type:'message',\n            name:name,\n            message:payload,\n            time:Date.now(),\n            target: new ThreeObjectFacade(this,target),\n            graphTarget:target,\n        }\n        evt.system = this.makeSystemFacade(evt)\n        const behaviors = this.sgp.getBehaviorsForObject(target)\n        behaviors.forEach(b => {\n            evt.props = b.props()\n            const asset = this.sgp.getParsedBehaviorAsset(b)\n            if(asset.onMessage) asset.onMessage(evt)\n        })\n    }\n\n    destroyListeners() {\n        this.listeners = {}\n    }\n    on(target,type,cb) {\n        if(!this.listeners) this.listeners = {}\n        if(!this.listeners[target.id]) this.listeners[target.id] = {}\n        if(!this.listeners[target.id][type]) this.listeners[target.id][type] = []\n        this.listeners[target.id][type].push(cb)\n    }\n\n    fireEventFromTarget(target, type, payload) {\n        if(!this.listeners) return\n        if(!this.listeners[target.id]) return\n        if(!this.listeners[target.id][type]) return\n        this.listeners[target.id][type].forEach(cb => cb(payload))\n    }\n}\n\n\nclass AssetFacade {\n    constructor(manager,obj) {\n        this.manager = manager\n        this.obj = obj\n    }\n    play() {\n        this.manager.sgp.playMediaAsset(this.obj)\n    }\n    stop() {\n        this.manager.sgp.stopMediaAsset(this.obj)\n    }\n}\nclass ThreeObjectFacade {\n    constructor(manager,obj) {\n        this.manager = manager\n        this._TYPE = 'ThreeObjectFacade'\n        this.obj = obj\n    }\n    get position() {\n        return this.manager.sgp.getThreeObject(this.obj).position\n    }\n    set position(val) {\n        this.manager.sgp.getThreeObject(this.obj).position.copy(val)\n    }\n\n    get rotation() {\n        return this.manager.sgp.getThreeObject(this.obj).rotation\n    }\n    get visible() {\n        return this.manager.sgp.getThreeObject(this.obj).visible\n    }\n    set visible(val) {\n        return this.manager.sgp.getThreeObject(this.obj).visible = val\n    }\n    lookAt(vec) {\n        return this.manager.sgp.getThreeObject(this.obj).lookAt(vec)\n    }\n}\n","import * as THREE from 'three'\n\nclass Tween {\n    constructor() {\n        this.running = false\n    }\n    update(time) {\n        throw new Error(\"update not implemented\")\n    }\n    start() {\n        this.running = true\n    }\n    isAlive() {\n        return this.running\n    }\n    kill() {\n        this.running = false\n    }\n}\n\nclass WaitTween extends Tween {\n    constructor(dur) {\n        super()\n        this.type = 'wait'\n        this.duration = dur\n    }\n    update(time) {\n        time = time/1000\n        if(!this.startTime) this.startTime = time\n        const diff = time - this.startTime\n        let t = diff/this.duration\n        if(t >= 1) {\n            this.running = false\n        }\n    }\n}\n\nclass ActionTween extends Tween {\n    constructor(fn) {\n        super()\n        this.type = 'action'\n        this.fn = fn\n    }\n    start() {\n        const res = this.fn()\n        this.running = false\n        return res\n    }\n}\n\nclass ForeverTween extends Tween {\n    constructor(fn) {\n        super()\n        this.type = 'forever'\n        this.fn = fn\n    }\n    start() {\n        this.running = true\n        this.startTime = Date.now()/1000\n    }\n    update(time) {\n        const diff = time/1000 - this.startTime\n        this.fn(diff)\n    }\n}\n\nexport const PROP_TYPES = {\n    SINGLE:'single',\n    COMPOUND:'compound',\n}\nexport const LERP_TYPES = {\n    LINEAR:'linear',\n    ELASTIC:'elastic'\n}\n\nfunction easeOutElastic(t) {\n    var p = 0.3;\n    return Math.pow(2,-10*t) * Math.sin((t-p/4)*(2*Math.PI)/p) + 1;\n}\nfunction easeLinear(from,to,t) {\n    return (to - from) * t + from\n}\nclass PropTween extends Tween {\n    constructor(opts) {\n        super()\n        this.type = 'prop'\n        this.target = opts.target\n        this.duration = opts.duration\n        if(typeof this.duration === 'undefined') throw new Error(\"duration is missing\")\n        this.property = opts.property\n        if(typeof this.property === 'undefined') throw new Error(\"property is missing\")\n        this.propertyType = opts.propertyType || PROP_TYPES.SINGLE\n        this.from = opts.from\n        this.to = opts.to\n        this.lerp_type = opts.lerpType || LERP_TYPES.LINEAR\n\n        this.loop = opts.loop\n        if(typeof this.loop === 'undefined') this.loop = 1\n        this.loopCount = 0\n        this.reversed = false\n        this.autoReverse = opts.autoReverse\n        if(typeof this.autoReverse === 'undefined') this.autoReverse = false\n    }\n    update(time) {\n        time = time/1000\n        if(!this.startTime) this.startTime = time\n        const diff = time - this.startTime\n\n        let t = diff/this.duration\n        if(t > 1.0) {\n            t = 1.0\n        }\n        this.setPropertyValue(this.from,this.to,t)\n        if(t === 1.0) {\n            this.loopCount++\n            if(this.autoReverse) {\n                this.reversed = !this.reversed\n            }\n            if(this.loop !== -1) {\n                if(this.loopCount >= this.loop) {\n                    this.running = false\n                    return\n                }\n            }\n            this.startTime = time\n        }\n    }\n\n    setPropertyValue(from,to,t,target,name) {\n        if(this.propertyType === PROP_TYPES.SINGLE) {\n            this.target[this.property] = this.lerp(this.from, this.to, this.reversed ? (1 - t) : t)\n        }\n        if(this.propertyType === PROP_TYPES.COMPOUND) {\n            Object.keys(this.from).forEach(name => {\n                this.target[this.property][name] = this.lerp(this.from[name], this.to[name], this.reversed ? (1 - t) : t)\n            })\n        }\n    }\n\n    lerp(from,to,t) {\n        if(this.lerp_type === LERP_TYPES.LINEAR)  return easeLinear(from,to,t)\n        if(this.lerp_type === LERP_TYPES.ELASTIC) return easeLinear(from,to,easeOutElastic(t))\n        console.log(\"invalid LERP_TYPE\")\n        return from\n    }\n}\n\nclass ClipTween extends Tween {\n    constructor(opts) {\n        super()\n        this.type = 'clip'\n        this.target = opts.target\n        this.name = opts.name\n        this.loop = opts.loop\n        this.autoReverse = opts.autoReverse\n        if(typeof this.autoReverse === 'undefined') this.autoReverse = false\n        if(typeof this.loop === 'undefined') this.loop = 1\n        if(typeof this.name === 'undefined') throw new Error(\"name is missing\")\n        this.speed = opts.speed\n        if(typeof this.speed === 'undefined') this.speed = 1\n    }\n    start() {\n        this.running = true\n        this.mixer = new THREE.AnimationMixer(this.target.scene)\n        this.action = this.mixer.clipAction(THREE.AnimationClip.findByName(this.target.animations,this.name))\n        if(this.loop === 1) {\n            this.action.setLoop(THREE.LoopOnce, 1)\n        }\n        if(this.loop === -1) {\n            this.action.setLoop(this.autoReverse?THREE.LoopPingPong:THREE.LoopRepeat, Infinity)\n        }\n        if(this.loop > 1) {\n            this.action.setLoop(THREE.LoopRepeat, this.loop)\n        }\n        this.action.play()\n        this.action.setEffectiveTimeScale(this.speed)\n        this.startTime = Date.now()/1000\n        this.prevTime = this.startTime\n    }\n    update(time) {\n        const diff = time/1000 - this.prevTime\n        this.mixer.update(diff)\n        this.prevTime = time/1000\n    }\n    kill() {\n        this.action.stop()\n        this.running = false\n    }\n}\n\nclass ParallelTween extends Tween {\n    constructor() {\n        super()\n        this.subs = []\n    }\n    and(obj) {\n        if(obj instanceof Tween) {\n            this.subs.push(obj)\n        } else {\n            this.subs.push(new ActionTween(obj))\n        }\n        return this\n    }\n    start() {\n        // console.log(\"starting parallel\")\n        this.running = true\n        this.subs.forEach(s=>s.start())\n        // console.log('started')\n        // console.log(this.subs)\n        return this\n    }\n    update(time) {\n        this.subs.forEach(s => {\n            if(s.isAlive()) s.update(time)\n        })\n    }\n    isAlive() {\n        const first = this.subs.find(s => s.isAlive() === true)\n        // console.log(\"first alive is\",first)\n        return first !== undefined\n    }\n}\n\nclass SequentialTween extends Tween {\n    constructor() {\n        super()\n        this.subs = []\n        this.n = -1\n    }\n    then(obj) {\n        if(obj instanceof Tween) {\n            this.subs.push(obj)\n        } else {\n            this.subs.push(new ActionTween(obj))\n        }\n        return this\n    }\n    wait(dur) {\n        this.subs.push(new WaitTween(dur))\n        return this\n    }\n    start() {\n        this.running = true\n        this._startNext()\n        return this\n    }\n    _startNext() {\n        this.n = this.n + 1\n\n        //if at the end of everything\n        if(this.n > this.subs.length-1) {\n            this.running = false\n            this.n = -1\n            return null\n        }\n\n\n        const cur = this.subs[this.n]\n        const res = cur.start()\n        if(!cur.isAlive()) {\n            if(res) {\n                console.log(\"the next swapped itself\", res)\n                //swap in the result\n                this.subs[this.n] = res\n                //backup\n                this.n = this.n -1\n                //recurse\n                return this._startNext()\n            } else {\n                // console.log(\"the next didn't swap. just move on\")\n                return this._startNext()\n            }\n        }\n        return cur\n    }\n    update(time) {\n        // console.log('updating')\n        const cur = this.subs[this.n]\n        cur.update(time)\n        // console.log(\"updated cur\",cur, cur.isAlive())\n        if(!cur.isAlive()) this._startNext()\n\n    }\n    isAlive() {\n        const first = this.subs.find(s => s.isAlive() === true)\n        // console.log(\"first alive is\",first)\n        // console.log(this.subs)\n        return first !== undefined\n    }\n}\n\nexport class TweenManager {\n    constructor() {\n        this.subs = []\n    }\n    parallel() {\n        const t = new ParallelTween()\n        this.subs.push(t)\n        return t\n    }\n    sequence() {\n        const t =  new SequentialTween()\n        this.subs.push(t)\n        return t\n    }\n    action(fn) {\n        const t = new ActionTween(fn)\n        this.subs.push(t)\n        return t\n    }\n    prop(opts) {\n        const t = new PropTween(opts)\n        this.subs.push(t)\n        return t\n    }\n    isAlive() {\n        return this.subs.find((s => s.isAlive() === true))\n    }\n    update(time) {\n        const now = Date.now()\n        this.subs.forEach(s => {\n            if(s.isAlive()) s.update(now)\n        })\n    }\n    forever(fn) {\n        const t = new ForeverTween(fn)\n        this.subs.push(t)\n        return t\n    }\n    clip(opts) {\n        const t = new ClipTween(opts)\n        this.subs.push(t)\n        return t\n    }\n    wait(dur) {\n        const t = new WaitTween(dur)\n        this.subs.push(t)\n        return t\n    }\n}\n\n/*\n\nconst obj = { x: -1, y: -1, z: 0, w: 0}\n\nconst para = t2.parallel()\n    .and(t2.prop({ target:obj, property:'x', from:10, to:0, duration: 1}))\n    .and(()=>console.log(\"inside the parallel action\"))\n    .start()\n\nconst seq = t2.sequence()\n    .then(()=>console.log(\"first is an action\"))\n    .then(t2.prop({ target:obj, property:'y', from:10, to:0, duration: 1}))\n    .then(()=> console.log(\"inside the sequential action\"))\n    .then(t2.prop({target:obj, property:'y', from:0, to:10, duration:1 }))\n    .then(()=>{\n        console.log(\"done with part 1. calculating part 2\")\n        return t2.prop({target:obj, property:'x', from: 0, to:-8, duration:1})\n    })\n    .then(() => {\n        console.log(\"now we're going to insert a new parallel tween\")\n        return t2.parallel()\n            .and(t2.prop({target:obj, property:'z', from:-1,to:1, duration:1}))\n            .and(t2.prop({target:obj, property:'w', from:-1,to:1, duration:1}))\n    })\n    .start()\n\nfunction update() {\n    console.log(\"tick\")\n    t2.update()\n    console.log(obj)\n    if(t2.isAlive()) {\n        setTimeout(update,250)\n    } else {\n        console.log(\"done with everything. check it out!\")\n        console.log(obj.z === 1)\n    }\n}\nupdate()\n*/\n","import React, {Component} from 'react'\nimport * as THREE from 'three'\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport TransformControls from './TransformControls.js'\nimport {fetchGraphObject} from '../syncgraph/utils'\nimport SceneDef from \"./defs/SceneDef\"\nimport {ASSET_TYPES, get3DObjectDef, is3DObjectType, OBJ_TYPES, TOTAL_OBJ_TYPES} from './Common'\nimport {ToasterNotification} from './ToasterNotification'\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {TweenManager} from '../common/tween'\n\nconst {SET_PROPERTY, INSERT_ELEMENT, DELETE_ELEMENT} = require(\"syncing_protocol\");\n\n\n\n\nclass XRSupport {\n\n    static supportsARKit() {\n        if(navigator.xr && navigator.xr._mozillaXRViewer) {\n            console.error(\"found mozilla xr viewer\")\n            return true\n        }\n        if(typeof window.webkit === 'undefined' || !navigator.xr) return false\n        return true\n    }\n\n    getContext(canvas=0) {\n        this.device = 0\n        this.session = 0\n        this.xrCanvas = 0\n        this.xrContext = 0\n        this.canvas = canvas\n        this.context = 0\n        this.xrCanvas = document.createElement('canvas')\n        this.xrContext = this.xrCanvas.getContext('xrpresent')\n        let p = new Promise((resolve, reject) => {\n            // document.body.insertBefore(this.xrCanvas, document.body.firstChild) <- not needed?\n            navigator.xr.requestDevice().then((xrDevice)=>{\n                this.device = xrDevice\n                this.device.requestSession({ outputContext: this.xrContext }).then((xrSession)=>{\n                    this.session = xrSession\n                    if(!this.canvas) this.canvas = document.createElement('canvas')\n                    if(!this.context) this.context = this.canvas.getContext('webgl', { compatibleXRDevice: this.device })\n                    this.session.baseLayer = new window.XRWebGLLayer(this.session, this.context)\n                    resolve(this.context)\n                }).catch(err => {\n                    console.error('Session setup error', err)\n                    reject()\n                })\n            }).catch(err => {\n                console.error('Error', err)\n                reject()\n            })\n        })\n        return p\n    }\n\n    setAnimationLoop(userAnimationCallback) {\n        this.userAnimationCallback = userAnimationCallback\n        this.__handleAnimationFrame = this._handleAnimationFrame.bind(this)\n\n        // head-model is the coordinate system that tracks the position of the display\n        this.session.requestFrameOfReference('head-model').then(frameOfReference =>{\n            this.headFrameOfReference = frameOfReference\n\n            // get eye level which is somehow different from head level?\n            this.session.requestFrameOfReference('eye-level').then(frameOfReference => {\n                this.eyeLevelFrameOfReference = frameOfReference\n                this.session.requestAnimationFrame(this.__handleAnimationFrame)\n            }).catch(err => {\n                console.error('Error finding eye frame of reference', err)\n            })\n\n        }).catch(err => {\n            console.error('Error finding head frame of reference', err)\n        })\n\n    }\n\n    _handleAnimationFrame(time=0, frame=0){\n\n        if(!this.session || this.session.ended) return\n\n        this.session.requestAnimationFrame(this.__handleAnimationFrame)\n\n        let pose = frame.getDevicePose(this.eyeLevelFrameOfReference)\n        if(!pose){\n            console.log('No pose')\n            return\n        }\n\n        for (let view of frame.views) {\n            this.userAnimationCallback(\n                this.session.baseLayer.getViewport(view),\n                view.projectionMatrix,\n                pose.getViewMatrix(view),\n            )\n            break\n        }\n    }\n\n    getAnchor(xyz) {\n        // returns a promise\n        return this.session.addAnchor(xyz, this.headFrameOfReference)\n    }\n\n}\n\n\n// ================  SGP implementation =====================\nclass Adapter extends SceneGraphProvider {\n    constructor(canvas) {\n        super()\n        this.canvas = canvas\n    }\n\n    getAllBehaviors() {\n        return this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot())\n            .find((obj)=> obj.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n\n    getParsedBehaviorAsset(beh) {\n        const prov = this.canvas.props.provider\n        const asset = prov.accessObject(beh.behavior)\n        return prov.getCachedBehaviorAsset(asset.id)\n    }\n    getGraphObjectById(id) {\n        return this.canvas.props.provider.accessObject(id)\n    }\n    getGraphObjectByName(title) {\n        const list = this.canvas.props.provider.accessObject(this.canvas.props.provider.getSceneRoot()).find((o)=>o.title === title)\n        if(!list || list.length<1) return null\n        return list[0]\n    }\n    navigateScene(id) {\n        SelectionManager.setSelection(id)\n    }\n    getCurrentScene() {\n        return this.canvas.props.provider.getSelectedSceneObject()\n    }\n    getSceneObjects(scene) {\n        return scene.getChildren().filter(ch => is3DObjectType(ch.type))\n    }\n    getThreeObject(obj) {\n        if(obj.id) return this.canvas.findNode(obj.id)\n        return this.canvas.findNode(obj)\n    }\n    getBehaviorsForObject(scene) {\n        return scene.getChildren().filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getCamera() {\n        return this.canvas.camera\n    }\n    playMediaAsset(asset) {\n        if(asset.subtype === ASSET_TYPES.AUDIO) {\n            const sound = new THREE.Audio(this.canvas.audioListener)\n            const audioLoader = new THREE.AudioLoader()\n            audioLoader.load(asset.src, function (buffer) {\n                sound.setBuffer(buffer);\n                sound.setLoop(false);\n                sound.setVolume(0.5);\n                sound.play();\n            });\n            this.canvas.playing_audio[asset.id] = sound\n        }\n        if(asset.subtype === ASSET_TYPES.VIDEO) {\n            const cache = this.canvas.props.provider.videocache\n            if(cache[asset.src]) cache[asset.src].play()\n        }\n    }\n\n    stopAudioAsset(audio) {\n        if(this.canvas.playing_audio[audio.id]) {\n            this.canvas.playing_audio[audio.id].stop()\n            delete this.canvas.playing_audio[audio.id]\n        }\n    }\n    getTweenManager() {\n        return this.canvas.tweenManager\n    }\n    startImageRecognizer(info) {\n        return this.canvas.startImageRecognizer(info)\n    }\n    startGeoRecognizer(info) {\n        return this.canvas.startGeoRecognizer(info)\n    }\n}\n\n\nexport class VRCanvas extends Component {\n    moveCameraForward = () => {\n        this.camera.position.z += -0.5\n    }\n    moveCameraBackward = () => {\n        this.camera.position.z += 0.5\n    }\n    handleKeyPress = (e) => {\n        if(e.key === 'ArrowUp') {\n            this.camera.position.z -= 0.5\n        }\n        if(e.key === 'ArrowDown') {\n            this.camera.position.z += 0.5\n        }\n        if(e.key === 'a') {\n            this.camera.position.x -= 0.5\n        }\n        if(e.key === 'd') {\n            this.camera.position.x += 0.5\n        }\n        if(e.key === 'ArrowLeft') {\n            this.camera.rotation.y += 0.1\n        }\n        if(e.key === 'ArrowRight') {\n            this.camera.rotation.y -= 0.1\n        }\n    }\n\n    constructor(props) {\n        super(props)\n        console.info(\"CREATED VR Canvas\")\n        this.obj_node_map = {}\n        this.previewUpdateNodes = []\n        this.scenes = []\n        this.state = {\n            scene: -1,\n            running:props.running\n        }\n        this.playing_audio = []\n        this.scriptManager = new ScriptManager(new Adapter(this))\n    }\n\n    pauseQueue = (e) => {\n        this.props.provider.pauseQueue()\n    }\n    unpauseQueue = (e) => {\n        this.props.provider.unpauseQueue()\n    }\n    transformChanged = (e) => {\n        const sel = SelectionManager.getSelection()\n        if(sel) {\n            const obj = fetchGraphObject(this.props.provider.getDataGraph(),sel)\n            if(!is3DObjectType(obj.type)) return\n            if(obj.type === OBJ_TYPES.bg360) return\n            const node = this.findNode(sel)\n            if(!node) return\n            const prov = this.props.provider\n            prov.quick_setPropertyValue(sel,'tx',node.position.x)\n            prov.quick_setPropertyValue(sel,'ty',node.position.y)\n            prov.quick_setPropertyValue(sel,'tz',node.position.z)\n        }\n    }\n    docSwapped = (e) => {\n        //nuke all the old stuff\n        this.scenes.forEach(sc => this.scene.remove(sc))\n        this.scenes = []\n        this.obj_node_map = {}\n        this.setState({scene: -1})\n        //make new stuff\n        const hist = this.props.provider.getDocHistory()\n        hist.forEach(op => this.updateScene(op))\n    }\n    selectionChanged = () => {\n        this.controls.detach()\n        const sel = SelectionManager.getSelection()\n        if(!sel) return\n        const obj = this.props.provider.accessObject(sel)\n\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) return this.setCurrentSceneWrapper(this.findNode(sel))\n\n        if(is3DObjectType(obj.type)) {\n            const sc = this.props.provider.findSceneObjectParent(obj)\n            this.setCurrentSceneWrapper(this.findNode(sc.id))\n            const node = this.findNode(sel)\n            if (!node) return\n            this.controls.attach(node)\n            return\n        }\n        console.log(\"selected something not an object or scene\")\n    }\n    windowResized = () => {\n        if(this.canvas) {\n            this.camera.aspect = this.canvas.width / this.canvas.height;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize(this.canvas.width, this.canvas.height);\n        }\n    }\n\n    componentDidMount() {\n        const canvas = this.canvas\n        if(XRSupport.supportsARKit()) {\n            this.xr = new XRSupport()\n            this.xr.getContext(canvas).then((context) => {\n                this.setupRenderer(canvas,context)\n                this.xr.setAnimationLoop( this.animationLoopWithCamera.bind(this) )\n            }).catch(err => {\n                console.error('Error', err)\n            })\n        } else {\n            this.setupRenderer(canvas,0)\n            this.renderer.setAnimationLoop( this.animationLoop.bind(this) )\n        }\n    }\n\n    componentWillUnmount() {\n        this.controls.removeEventListener('change',this.transformChanged)\n        this.controls.removeEventListener('mouseDown',this.pauseQueue)\n        this.controls.removeEventListener('mouseUp',this.unpauseQueue)\n        this.props.provider.off(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED,this.docSwapped)\n        SelectionManager.off(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n        window.removeEventListener('resize',this.windowResized)\n    }\n\n    setupRenderer(canvas,context) {\n\n        this.scene = new THREE.Scene();\n        this.camera = new THREE.PerspectiveCamera(70, canvas.width / canvas.height, 0.1, 50);\n        this.renderer = new THREE.WebGLRenderer({antialias: false, canvas: canvas, context:context});\n        // this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize(canvas.width, canvas.height);\n        this.renderer.gammaOutput = true\n        this.audioListener = new THREE.AudioListener()\n        this.camera.add(this.audioListener)\n        //only set a background if there is no XR active\n        if(!this.xr) this.scene.background = new THREE.Color(0x000000);\n        this.camera.position.y = 1.5\n        this.camera.position.x = 0\n        this.camera.position.z = 0\n        this.camera.matrixAutoUpdate = false\n        this.scene.add(this.camera)\n\n        this.controls = new TransformControls(this.camera, this.renderer.domElement)\n        this.controls.addEventListener('change',this.transformChanged)\n        this.controls.addEventListener('mouseDown',this.pauseQueue)\n        this.controls.addEventListener('mouseUp',this.unpauseQueue)\n        this.scene.add(this.controls)\n        this.raycaster = new THREE.Raycaster();\n\n        const light = new THREE.DirectionalLight(0xffffff, 1.0);\n        light.position.set(1, 1, 1).normalize();\n        this.scene.add(light);\n\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.4))\n\n        this.tweenManager = new TweenManager()\n\n        this.props.provider.onRawChange(op => this.updateScene(op))\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.docSwapped)\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged)\n\n        window.addEventListener('resize', this.windowResized,false)\n        this.props.provider.getDocHistory().forEach(op => this.updateScene(op))\n    }\n\n    animationLoop(time) {\n        if(this.state.running) this.scriptManager.tick(time)\n        if(this.tweenManager) this.tweenManager.update(time)\n        this.previewUpdateNodes.forEach(n => n.previewUpdate())\n        this.renderer.render(this.scene, this.camera)\n    }\n\n    animationLoopWithCamera(bounds,projectionMatrix,viewMatrix) {\n        if(!this.scene || !this.camera) return\n        this.camera.matrix.fromArray(viewMatrix)\n        this.camera.matrixWorldNeedsUpdate = true\n        this.camera.updateMatrixWorld()\n        this.camera.projectionMatrix.fromArray(projectionMatrix)\n        this.animationLoop()\n    }\n\n    insertNodeMapping(id, node) {\n        if (typeof id !== 'string') throw new Error(\"cannot map an object to an object. invalid call in insertNodeMapping\")\n        this.obj_node_map[id] = node\n        node.userData.graphid = id\n        if(node.previewUpdate) this.previewUpdateNodes.push(node)\n    }\n    removeNodeMapping(id,node) {\n        delete this.obj_node_map[id]\n        delete node.userData.graphid\n        this.previewUpdateNodes = this.previewUpdateNodes.filter(n => n !== node)\n    }\n\n\n    findNode(id) {\n        if (!this.obj_node_map[id]) console.warn(\"could not find node for id\", id)\n        return this.obj_node_map[id]\n    }\n\n    updateScene(op) {\n        const graph = this.props.provider.getDataGraph()\n        if (op.type === INSERT_ELEMENT) {\n            const objid = op.value\n            const obj = fetchGraphObject(graph, objid)\n            if(obj.type === TOTAL_OBJ_TYPES.SCENE) return this.populateNode(objid)\n            if (is3DObjectType(obj.type)) return this.populateNode(objid)\n            if(obj.type === TOTAL_OBJ_TYPES.ASSET) return\n            if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return\n            console.warn(\"unknown object type\", obj)\n            return\n        }\n        if (op.type === SET_PROPERTY) {\n            //skip setting parents. done through insert_element\n            if(op.name === 'parent') return\n            // console.log('setting property', op.object, op.name, '=',op.value)\n            // console.log('real graph', fetchGraphObject(graph,op.object))\n            const node = this.findNode(op.object)\n            if (node) {\n                const obj = fetchGraphObject(graph, op.object)\n                if(obj.type === 'scene') {\n                    new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                    return\n                }\n                if(is3DObjectType(obj.type)) return get3DObjectDef(obj.type).updateProperty(node,obj,op, this.props.provider)\n            } else {\n                console.log(\"could not find the node for object id:\", op)\n            }\n            return\n        }\n        if (op.type === DELETE_ELEMENT) {\n            this.controls.detach()\n            console.log(\"doing delete for object\", op.value)\n            const node = this.findNode(op.value)\n            console.log(\"removing the node\",node)\n            if(node) {\n                this.removeNodeMapping(op.value,node)\n                const obj = fetchGraphObject(graph,op.value)\n                if(is3DObjectType(obj.type)) {\n                    node.parent.remove(node)\n                    // this.dumpScenes()\n                }\n            }\n            return\n        }\n        // console.log('skipping', op.type)\n    }\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        if('running' in nextProps) {\n            if(nextProps.running !== this.props.running) {\n                this.setState({running:nextProps.running})\n                if(nextProps.running === false) {\n                    this.scriptManager.stopRunning()\n                    this.resetSceneGraph()\n                    this.stopRecognizer()\n                } else {\n                    //start the script manager\n                    this.startRecognizer()\n                    this.scriptManager.startRunning()\n                }\n                return false\n            }\n        }\n        return false\n    }\n\n    render() {\n        return <div>\n            <canvas ref={c => this.canvas = c} width={600} height={400} onClick={this.clickedCanvas}\n                    className=\"editable-canvas\"\n                    onKeyDown={this.handleKeyPress}\n                    tabIndex={0}\n            ></canvas>\n            <br/>\n            <button onClick={this.moveCameraForward}>forward</button>\n            <button onClick={this.moveCameraBackward}>backward</button>\n            <ToasterNotification/>\n        </div>\n    }\n\n    populateNode(nodeid) {\n        const graph = this.props.provider.getDataGraph()\n        const obj = fetchGraphObject(graph, nodeid)\n        if (is3DObjectType(obj.type)) {\n            const obj3d = get3DObjectDef(obj.type).makeNode(obj)\n            this.insertNodeMapping(nodeid, obj3d)\n            const parent = this.findNode(obj.parent)\n            parent.add(obj3d)\n            return obj3d\n        }\n        if (obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            const scene = new SceneDef().makeNode(obj)\n            this.insertNodeMapping(nodeid, scene)\n            this.addSceneWrapper(scene)\n            this.setCurrentSceneWrapper(scene)\n            return scene\n        }\n\n        console.warn(\"cannot populate node for type\", obj.type)\n    }\n\n\n    addSceneWrapper(scene) {\n        this.scenes.push(scene)\n        this.scene.add(scene)\n    }\n\n    setCurrentSceneWrapper(scene) {\n        this.scenes.forEach(sc => {\n            if(sc === scene) {\n                sc.visible = true\n            } else {\n                sc.visible = false\n            }\n        })\n        // this.dumpScenes()\n    }\n\n    dumpScenes() {\n        this.scenes.forEach(sc => {\n            console.log(\"scene\")\n            this.dump(sc,'')\n        })\n    }\n    dump(sc,inset) {\n        console.log(inset+\"\",sc.type,sc.id,  'vis', sc.visible)\n        if(sc.type === 'Mesh') console.log(inset+'  ',sc.geometry.type)\n        // console.log(sc)\n        if(sc.children) {\n            sc.children.forEach((ch) => this.dump(ch, inset + '  '))\n        }\n    }\n\n    getCurrentSceneWrapper() {\n        return this.scenes.find(sc => sc.visible)\n    }\n\n    clickedCanvas = (e) => {\n        console.log(\"clicked on the canvas\")\n        this.canvas.focus()\n        const rect = this.canvas.getBoundingClientRect();\n        const pointer = {\n            x: ( e.clientX - rect.left ) / rect.width * 2 - 1,\n            y: - ( e.clientY - rect.top ) / rect.height * 2 + 1,\n        }\n\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const intersect = this.raycaster.intersectObjects(this.getCurrentSceneWrapper().children, true)\n        if(intersect && intersect.length >= 1) {\n            const obj = intersect[0].object\n            if(this.state.running) {\n                this.scriptManager.performClickAction(this.props.provider.accessObject(obj.userData.graphid))\n            } else {\n                SelectionManager.setSelection(obj.userData.graphid)\n            }\n        } else {\n            SelectionManager.clearSelection()\n        }\n    }\n\n\n    resetSceneGraph() {\n        Object.keys(this.obj_node_map).forEach(id => {\n            const graphObj = fetchGraphObject(this.props.provider.getDataGraph(),id)\n            const threeObj = this.obj_node_map[id]\n            if(graphObj.type === 'scene') {\n                // new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                return\n            }\n            if(is3DObjectType(graphObj.type)) {\n                const def = get3DObjectDef(graphObj.type)\n                if(def.reset) {\n                    def.reset(threeObj,graphObj,this.props.provider.getDataGraph())\n                }\n            }\n        })\n    }\n\n\n    startRecognizer() {\n        //called when script running is started\n    }\n\n    startImageRecognizer(info) {\n\n        //called when an anchor is started that wants to recognize an image\n\n        // WebXR loaded?\n        if(!this.xr || !this.xr.session) {\n            console.error(\"XR is not active?\")\n            return\n        }\n\n        //info contains\n        // * callback: to call when the image is found\n        // * image: info about the image to recognize. src is at image.src\n        // * imageRealworldWidth: width of the image in meters\n        // * object: the anchor object\n        // * node: the ThreeJS group which represents the anchor. It should be updated as the scene changes\n        // * recType: current set to SCENE_START, meaning we should recognize as soon as the scene starts up\n\n        let session = this.xr.session\n\n        let callback = info.callback\n        let image = info.image\n        let imageRealworldWidth = 0 // unused\n        let object = info.object // anchor object?\n        let node = info.node\n        let recType = 0 // unused. currently set to SCENE_START -> meaning we should recognize as soon as the scene starts up\n\n        if(!image || !node) {\n            console.error(\"Missing image or threejs node\")\n            return\n        }\n\n        // random name from https://gist.github.com/6174/6062387\n        let name = [...Array(10)].map(i=>(~~(Math.random()*36)).toString(36)).join('')\n\n        // Get ImageData\n        let canvas = document.createElement('canvas')\n        let context = canvas.getContext('2d')\n        canvas.width = image.width\n        canvas.height = image.height\n        context.drawImage(image,0,0)\n        image.data = context.getImageData(0,0,image.width,image.height)\n\n        // Attach image observer handler\n        session.nonStandard_createDetectionImage(name, image.data, image.width, image.height, 0.2).then(() => {\n            session.nonStandard_activateDetectionImage(name).then(anchor => {\n                // this gets invoked after the image is seen for the first time\n                if(callback) {\n                    callback(info)\n                }\n                node.matrixAutoUpdate = false\n                node.anchor = anchor\n                node.anchorName = name\n                anchor.node = node\n                node.anchor.addEventListener(\"remove\", (args) => {\n                    // this is not quite supported yet\n                })\n                node.anchor.addEventListener(\"update\", (args) => {\n                    // this is not called every frame\n                })\n            }).catch(error => {\n                console.error(`error activating detection image: ${error}`)\n            })\n        }).catch(error => {\n            console.error(`error creating detection image: ${error}`)\n        })\n    }\n\n    refreshNodeWithAnchor(node) {\n        if(node.anchor) {\n            node.matrix.fromArray(node.anchor.modelMatrix)\n            node.matrixWorldNeedsUpdate = true\n            node.updateMatrixWorld(true)\n        }\n    }\n\n    stopRecognizer() {\n\n    }\n\n\n    startGeoRecognizer(info) {\n        console.log(\"starting the geo recognizer\")\n        /*\n        info contains\n         location:  a geo location asset, has properties for latitude, longitude, altitude, useAltitude\n         recType: the recognition type. for now always SCENE_START\n         object: the anchor object. It reresents the anchor in the 3D scene. has tx,ty,tz, rotation, etc.\n         node: the actual ThreeJS object that mirrors the propertites of the `object` above\n         callback: a function to be called once the geo anchor is recognized. By default this callback will fire a 'recognized' event and make the anchor visible in the scene\n         */\n    }\n}\n","import * as THREE from 'three'\nimport {POINTER_ENTER, POINTER_EXIT, POINTER_MOVE, POINTER_PRESS, POINTER_RELEASE} from 'webxr-boilerplate'\n\n\n\nconst on = (elem,type,cb) => elem.addEventListener(type,cb)\nconst off = (elem,type,cb) => elem.removeEventListener(type,cb)\nconst toRad = (degrees) => degrees*Math.PI/180\n\nexport default class TranslationArrow extends THREE.Group {\n    constructor(axis, control) {\n        super()\n        this.axis = axis\n        this.control = control\n        this.makePlane()\n        this.makeArrow()\n        this.makeInputGrabber()\n    }\n\n    makePlane() {\n        this.plane = new THREE.Mesh(\n            new THREE.PlaneBufferGeometry(100, 100, 100, 100),\n            new THREE.MeshBasicMaterial({visible: true, wireframe: true, side: THREE.DoubleSide})\n        )\n        if (this.axis === 'Z') this.plane.rotation.y = toRad(90)\n        this.plane.userData.draggable = true\n        this.plane.visible = false\n        this.add(this.plane)\n    }\n\n    makeArrow() {\n        this.arrow = new THREE.Mesh(\n            new THREE.CylinderBufferGeometry(0.02, 0.02, 4),\n            new THREE.MeshLambertMaterial({color: 'yellow'})\n        )\n        if (this.axis === 'X') this.arrow.rotation.z = toRad(90)\n        if (this.axis === 'Y') this.arrow.rotation.z = toRad(180)\n        if (this.axis === 'Z') this.arrow.rotation.x = toRad(90)\n        this.add(this.arrow)\n    }\n\n    makeInputGrabber() {\n        this.input = new THREE.Mesh(\n            new THREE.CylinderBufferGeometry(0.1, 0.1, 4),\n            new THREE.MeshLambertMaterial({color: 'green', visible: false})\n        )\n        if (this.axis === 'X') this.input.rotation.z = toRad(90)\n        if (this.axis === 'Y') this.input.rotation.z = toRad(180)\n        if (this.axis === 'Z') this.input.rotation.x = toRad(90)\n        this.input.userData.clickable = true\n        this.add(this.input)\n    }\n\n    attach() {\n        on(this.input, POINTER_ENTER, this.startHover)\n        on(this.input, POINTER_EXIT, this.endHover)\n        on(this.input, POINTER_PRESS, this.beginDrag)\n    }\n\n    detach() {\n        off(this.input, POINTER_ENTER, this.startHover)\n        off(this.input, POINTER_EXIT, this.endHover)\n        off(this.input, POINTER_PRESS, this.beginDrag)\n    }\n\n    startHover = () => this.arrow.material.color.set(0xffffff)\n    endHover = () => this.arrow.material.color.set(0xffff00)\n\n    beginDrag = (e) => {\n        this.startPoint = this.parent.position.clone()\n        this.startPoint.copy(e.intersection.point)\n        this.parent.target.parent.worldToLocal(this.startPoint)\n        this.oldFilter = this.parent.pointer.intersectionFilter\n        this.parent.pointer.intersectionFilter = (obj) => obj.userData.draggable\n        this.startPosition = this.parent.target.position.clone()\n        this.plane.visible = true\n        on(this.plane, POINTER_MOVE, this.updateDrag)\n        on(this.plane, POINTER_RELEASE, this.endDrag)\n    }\n    updateDrag = (e) => {\n        this.endPoint = e.intersection.point.clone()\n        this.parent.target.parent.worldToLocal(this.endPoint)\n        //neutralize y and z\n        if (this.axis === 'X') {\n            this.endPoint.y = this.startPoint.y\n            this.endPoint.z = this.startPoint.z\n        }\n        if (this.axis === 'Y') {\n            this.endPoint.x = this.startPoint.x\n            this.endPoint.z = this.startPoint.z\n        }\n        if (this.axis === 'Z') {\n            this.endPoint.x = this.startPoint.x\n            this.endPoint.y = this.startPoint.y\n        }\n        const diff = this.endPoint.clone().sub(this.startPoint)\n        const finalPoint = this.startPosition.clone().add(diff)\n        this.parent.target.position.copy(finalPoint)\n        this.parent.position.copy(finalPoint)\n    }\n    endDrag = (e) => {\n        off(this.plane, POINTER_MOVE, this.updateDrag)\n        off(this.plane, POINTER_RELEASE, this.endDrag)\n        this.parent.pointer.intersectionFilter = this.oldFilter\n        this.plane.visible = false\n        this.parent.dispatchEvent({\n            type: 'change',\n            start: this.startPosition.clone(),\n            end: this.parent.position.clone()\n        })\n    }\n}\n","import * as THREE from 'three'\nimport TranslationArrow from './TranslationArrow'\n\nexport class TranslateControl extends THREE.Group {\n    constructor() {\n        super()\n        this.handles = []\n        this.handles.push(new TranslationArrow('X', this))\n        this.handles.push(new TranslationArrow('Y', this))\n        this.handles.push(new TranslationArrow('Z', this))\n        this.handles.forEach(h => this.add(h))\n        this.visible = false\n    }\n\n    attach(target, pointer) {\n        this.target = target\n        this.pointer = pointer\n        this.position.copy(target.position)\n        this.visible = true\n        this.handles.forEach(h => h.attach())\n    }\n\n    detach() {\n        this.target = null\n        this.pointer = null\n        this.visible = false\n        this.handles.forEach(h => h.attach())\n    }\n}\n","import * as THREE from 'three'\n\nimport {POINTER_RELEASE, POINTER_CLICK, POINTER_ENTER, POINTER_EXIT, POINTER_PRESS, POINTER_MOVE} from 'webxr-boilerplate'\n\n// const $ = (sel) => document.querySelector(sel)\nconst on = (elem, type, cb) => elem.addEventListener(type,cb)\n// const toRad = (deg) => deg * Math.PI/180\n\nexport default class Panel2D extends THREE.Object3D {\n    constructor(scene,camera) {\n        super()\n\n        if(!scene) throw new Error(\"cannot pass empty scene to Panel2D()\")\n        if(!camera) throw new Error(\"cannot pass empty camera to Panel2D()\")\n        this.type = 'panel2d'\n        this.listeners = {}\n        this.scene = scene\n        this.camera = camera\n        this.canvas = document.createElement('canvas')\n        this.canvas.width = 256\n        this.canvas.height = 512\n        this.canvasTexture = new THREE.CanvasTexture(this.canvas)\n        this.redrawHandler = (e) => this.redraw()\n\n        const c = this.canvas.getContext('2d')\n        c.fillStyle = 'red'\n        c.fillRect(0,0,this.canvas.width,this.canvas.height)\n\n        this.mesh = new THREE.Mesh(\n            new THREE.PlaneGeometry(1,2),\n            new THREE.MeshBasicMaterial({color:'white',map:this.canvasTexture})\n        )\n        this.mesh.userData.clickable = true\n        this.comps = []\n\n        this.add(this.mesh)\n\n        let inside = null\n        on(this.mesh,POINTER_MOVE,(e)=>{\n            const uv = e.intersection.uv\n            const fpt = new THREE.Vector2(uv.x*256, 512-uv.y*512)\n            if(inside && !inside.contains(fpt)) {\n                inside.fire(POINTER_EXIT)\n                inside = null\n            }\n            const comp = this.findAt(fpt)\n            // for(let i=0; i<this.comps.length; i++) {\n            //     const comp = this.comps[i]\n            //     if(comp.contains(fpt)) {\n            if(inside !== comp){\n                if(inside) inside.fire(POINTER_EXIT)\n                inside = null\n            }\n            if(comp) comp.fire(POINTER_ENTER)\n            inside = comp\n            // }\n            // }\n        })\n        on(this.mesh,POINTER_CLICK,(e)=>{\n            const uv = e.intersection.uv\n            const fpt = new THREE.Vector2(uv.x*256, 512-uv.y*512)\n            const comp = this.findAt(fpt)\n            if(comp) comp.fire(POINTER_CLICK)\n            // for(let i=0; i<this.comps.length; i++) {\n            //     const comp = this.comps[i]\n            //     if(comp.contains(fpt)) {\n            //         comp.fire(POINTER_CLICK)\n            //     }\n            // }\n        })\n\n        this.header = new THREE.Mesh(\n            new THREE.BoxGeometry(1.0,0.1,0.1),\n            new THREE.MeshBasicMaterial({color:'goldenrod'})\n        )\n        this.header.userData.clickable = true\n        this.header.position.set(0,1.1,0)\n        this.add(this.header)\n\n        on(this.header,POINTER_ENTER, e => this.header.material.color.set('yellow'))\n        on(this.header,POINTER_EXIT,  e => this.header.material.color.set('goldenrod'))\n        on(this.header,POINTER_PRESS, e => this.startDrag())\n    }\n\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n    findAt(pt) {\n        for(let i=0; i<this.comps.length; i++) {\n            const comp = this.comps[i]\n            const res = comp.findAt({x:pt.x-comp.x,y:pt.y-comp.y})\n            if(res) return res\n        }\n        return null\n    }\n\n    add(comp) {\n        if(comp instanceof THREE.Object3D) {\n            super.add(comp)\n        } else {\n            this.comps.push(comp)\n            on(comp, 'changed', this.redrawHandler)\n        }\n    }\n\n    redraw() {\n        const ctx = this.canvas.getContext('2d')\n        ctx.fillStyle = 'white'\n        ctx.fillRect(0,0,this.canvas.width,this.canvas.height)\n        this.comps.forEach(comp => comp.draw(ctx))\n        this.canvasTexture.needsUpdate = true\n    }\n\n    startDrag() {\n        this.header.userData.clickable = false\n        this.mesh.userData.clickable = false\n\n        this.dragSphere = new THREE.Mesh(\n            new THREE.SphereGeometry(4,32,32),\n            new THREE.MeshLambertMaterial({\n                color:'green',\n                wireframe:true,\n                side: THREE.BackSide\n            })\n        )\n        this.dragSphere.userData.clickable = true\n        this.scene.add(this.dragSphere)\n\n        on(this.dragSphere,POINTER_MOVE,(e)=> this.moveDrag(e))\n        on(this.dragSphere,POINTER_RELEASE,(e)=> this.endDrag(e))\n\n    }\n    endDrag() {\n        this.scene.remove(this.dragSphere)\n        this.dragSphere.userData.clickable = false\n        this.header.userData.clickable = true\n        this.mesh.userData.clickable = true\n    }\n\n\n    moveDrag(e) {\n        this.position.copy(e.point)\n        this.position.add(new THREE.Vector3(0,-1,0))\n        this.lookAt(this.camera.position)\n    }\n}\n","export default class Component2D {\n    constructor() {\n        this.listeners = {}\n    }\n    set(key,value) {\n        this[key] = value\n        this.fire('changed',{type:'changed',target:this})\n        return this\n    }\n    get(key) {\n        return this[key]\n    }\n    addEventListener(type,cb) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n        return this\n    }\n    on(type,cb) {\n        this.addEventListener(type,cb)\n        return this\n    }\n    setAll(props) {\n        Object.keys(props).forEach(key => this.set(key, props[key]))\n        return this\n    }\n    fire(type,payload) {\n        if(!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n}","import {POINTER_ENTER, POINTER_EXIT} from 'webxr-boilerplate'\nimport Component2D from \"./component2d\";\n\n\nexport default class Button2D extends Component2D {\n    constructor() {\n        super()\n        this.type = 'button'\n        this.text = 'foo'\n        this.x = 0\n        this.y = 0\n        this.fsize = 20\n        this.w = this.text.length * this.fsize\n        this.h = 20\n        this.normalBg = 'white'\n        this.hoverBg = 'red'\n        this.bg = this.normalBg\n        this.on(POINTER_ENTER, () => {\n            this.bg = this.hoverBg\n            this.fire('changed', {type: 'changed', target: this})\n        })\n        this.on(POINTER_EXIT, () => {\n            this.bg = this.normalBg\n            this.fire('changed', {type: 'changed', target: this})\n        })\n    }\n\n    draw(ctx) {\n        ctx.font = `${this.fsize}px sans-serif`\n        const metrics = ctx.measureText(this.text)\n        this.w = 5 + metrics.width + 5\n        this.h = 0 + this.fsize + 4\n        ctx.fillStyle = this.bg\n        ctx.fillRect(this.x, this.y, this.w, this.h)\n        ctx.fillStyle = 'black'\n        ctx.fillText(this.text, this.x + 3, this.y + this.fsize - 2)\n        ctx.strokeStyle = 'black'\n        ctx.strokeRect(this.x, this.y, this.w, this.h)\n    }\n\n    contains(pt) {\n        if (pt.x < this.x) return false\n        if (pt.x > this.x + this.w) return false\n        if (pt.y < this.y) return false\n        if (pt.y > this.y + this.h) return false\n        return true\n    }\n\n    findAt(pt) {\n        if (pt.x < 0) return null\n        if (pt.x > 0 + this.w) return null\n        if (pt.y < 0) return null\n        if (pt.y > 0 + this.h) return null\n        return this\n    }\n\n    set(key, value) {\n        super.set(key, value)\n        if (key === 'normalBg') this.bg = this.normalBg\n    }\n}\n","import Component2D from \"./component2d\";\n\nexport default class Group2D extends Component2D {\n    constructor() {\n        super()\n        this.type = 'group'\n        this.x = 0\n        this.y = 0\n        this.w = 100\n        this.h = 100\n        this.bg = 'gray'\n        this.visible = true\n        this.comps = []\n        this.padding = 5\n        this.border = 1\n\n        this.layout = (comp) => {\n            console.log(\"not laying out anything\")\n        }\n    }\n    draw(ctx) {\n        if(!this.visible) return\n        this.layout(this)\n        ctx.fillStyle = this.bg\n        ctx.fillRect(this.x,this.y,this.w,this.h)\n        if(this.border > 0) {\n            ctx.strokeStyle = 'black'\n            ctx.strokeRect(this.x, this.y, this.w, this.h)\n        }\n        ctx.save()\n        ctx.translate(this.x+this.padding,this.y+this.padding)\n        this.comps.forEach(comp => comp.draw(ctx))\n        ctx.restore()\n    }\n\n    contains(pt) {\n        if(pt.x < this.x) return false\n        if(pt.x > this.x + this.w) return false\n        if(pt.y < this.y) return false\n        if(pt.y > this.y + this.h) return false\n        return true\n    }\n    findAt(pt) {\n        if(!this.visible) return null\n        for(let i=0; i<this.comps.length; i++) {\n            const comp = this.comps[i]\n            const res = comp.findAt({x:pt.x-comp.x-5,y:pt.y-comp.y-5})\n            if(res) return res\n        }\n        return null\n    }\n\n    childSet(key,value) {\n        this.childProps[key] = value\n        this.comps.forEach(ch=>ch.set(key,value))\n        return this\n    }\n\n    add(comp) {\n        this.comps.push(comp)\n        this.fire('changed',{type:'changed',target:this})\n        return this\n    }\n}\n","import * as THREE from 'three'\n\nconst toRad = (deg) => Math.PI/180*deg\nconst YAXIS = new THREE.Vector3(0,1,0)\n\n\nexport default class ThreeDOFController {\n\n\n    constructor(stagePos, stageRot) {\n        this.stagePos = stagePos\n        this.stageRot = stageRot\n        this.states = { touchpad: false}\n        this.listeners = {}\n        this.keystates = {\n            ArrowLeft:{current:false, previous:false},\n            ArrowRight:{current:false, previous:false},\n            ArrowUp:{current:false, previous:false},\n            ArrowDown:{current:false, previous:false}\n        }\n        this.dir = new THREE.Vector3(0,0,1)\n\n\n        document.addEventListener('keydown',(e)=>{\n            if(this.keystates[e.key]) {\n                this.keystates[e.key].current = true\n            }\n        })\n        document.addEventListener('keyup',(e)=>{\n            if(this.keystates[e.key]) {\n                this.keystates[e.key].current = false\n            }\n        })\n\n    }\n\n    addEventListener(type, cb) {\n        if (!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].push(cb)\n    }\n\n    _fire(type,payload) {\n        if (!this.listeners[type]) this.listeners[type] = []\n        this.listeners[type].forEach(cb => cb(payload))\n    }\n\n\n\n\n    updateKeys() {\n        if(this.keystates.ArrowLeft.current === false && this.keystates.ArrowLeft.previous === true) {\n            this.rotateLeft()\n        }\n        if(this.keystates.ArrowRight.current === false && this.keystates.ArrowRight.previous === true) {\n            this.rotateRight()\n        }\n        if(this.keystates.ArrowUp.current === false && this.keystates.ArrowUp.previous === true) {\n            this.moveForward()\n        }\n        if(this.keystates.ArrowDown.current === false && this.keystates.ArrowDown.previous === true) {\n            this.moveBackward()\n        }\n\n        Object.keys(this.keystates).forEach(key => {\n            this.keystates[key].previous = this.keystates[key].current\n        })\n    }\n\n    rotateLeft() {\n        this.dir.applyAxisAngle(YAXIS,toRad(30))\n        this.stageRot.rotation.y -= toRad(30)\n    }\n\n    rotateRight() {\n        this.dir.applyAxisAngle(YAXIS,-toRad(30))\n        this.stageRot.rotation.y += toRad(30)\n    }\n\n    moveForward() {\n        this.stagePos.position.add(this.dir)\n        this._fire('move',this.stagePos.position)\n    }\n\n    moveBackward() {\n        this.stagePos.position.sub(this.dir)\n        this._fire('move',this.stagePos.position)\n    }\n\n    update() {\n        this.scanGamepads()\n        this.updateKeys()\n    }\n\n    scanGamepads() {\n        // console.log(\"gamepads\",navigator.getGamepads())\n        const gamepads = navigator.getGamepads()\n        for(let i=0; i<gamepads.length; i++) {\n            const gamepad = gamepads[i]\n            if ( gamepad && ( gamepad.id === 'Daydream Controller' ||\n                gamepad.id === 'Gear VR Controller' || gamepad.id === 'Oculus Go Controller' ||\n                gamepad.id === 'OpenVR Gamepad' || gamepad.id.startsWith( 'Oculus Touch' ) ||\n                gamepad.id.startsWith( 'Spatial Controller' ) ) ) {\n                //we should have at least two buttons\n                if(gamepad.buttons.length < 2) return\n\n                const touchpad = gamepad.buttons[0]\n                if(touchpad.pressed && gamepad.axes && gamepad.axes.length === 2) {\n                    const left = gamepad.axes[0] < -0.5\n                    const right = gamepad.axes[0] > 0.5\n                    const down = gamepad.axes[1] < -0.5\n                    const up = (gamepad.axes[1] > 0.5)\n\n\n                    if (down && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.moveForward()\n                    }\n                    if (up && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.moveBackward()\n                    }\n                    if (left && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.rotateLeft()\n                    }\n                    if (right && this.states.touchpad === false && touchpad.pressed === true) {\n                        this.rotateRight()\n                    }\n                }\n\n                const trigger = gamepad.buttons[1]\n                if(trigger.pressed) console.log(\"trigger\")\n                if(this.states.touchpad === false && touchpad.pressed === true) {\n                    console.log(\"pressed\")\n                }\n                if(this.states.touchpad === true && touchpad.pressed === false) {\n                    console.log(\"released\")\n                }\n                this.states.touchpad = touchpad.pressed\n            }\n\n        }\n    }\n\n}\n","import SceneDef from './defs/SceneDef'\nimport SelectionManager from '../SelectionManager'\nimport {toQueryString} from '../utils'\nimport {ITEM_ICONS, OBJ_TYPES} from './Common'\nimport {PopupManager} from 'appy-comps'\nimport {MenuPopup} from '../common/GridEditorApp'\nimport React from 'react'\nimport {AuthModule} from './AuthModule'\n\nexport function addScene(provider) {\n    const root = provider.accessObject(provider.getSceneRoot())\n    const scene = new SceneDef().make(provider.getDataGraph(),root)\n    root.insertFirstChild(scene)\n    SelectionManager.setSelection(scene.id)\n}\n\n\nexport function deleteObject(provider) {\n    if(SelectionManager.isEmpty()) return\n    provider.accessObject(SelectionManager.getSelection()).removeFromParent()\n    SelectionManager.clearSelection()\n}\n\nexport function newDoc(provider) {\n    const opts = Object.assign({},provider.options,\n        {mode:'edit', switcher:false, doc:provider.genID('doc')})\n    window.open(`./?${toQueryString(opts)}`)\n}\n\n\nexport function showAddPopup (e, provider) {\n    let item = provider.getSelectedScene()\n    const acts = Object.keys(OBJ_TYPES).map(type => {\n        return {\n            title: type,\n            icon: ITEM_ICONS[type],\n            fun: () => provider.add3DObject(type,item)\n        }\n    })\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n\n\nexport function showAddAssetPopup(e, provider) {\n    let acts = []\n    // console.log(\"Auth mod\",AuthModule.supportsAssetUpload())\n    if(AuthModule.supportsAssetUpload()) {\n        acts = acts.concat([\n            {\n                title: 'image',\n                icon: ITEM_ICONS.image,\n                fun: () => provider.showAddImageAssetDialog()\n            },\n            {\n                title: 'server image',\n                icon: ITEM_ICONS.image,\n                fun: () => provider.showAddServerImageDialog()\n            },\n            {divider: true},\n            {\n                title: 'GLTF model',\n                icon: ITEM_ICONS.model,\n                fun: () => provider.showAddGLTFAssetDialog()\n            },\n            {\n                title: 'GLB model',\n                icon: ITEM_ICONS.model,\n                fun: () => provider.showAddGLBAssetDialog()\n            },\n            {divider: true},\n            {\n                title: 'audio file',\n                icon: ITEM_ICONS.audio,\n                fun: () => provider.showAddAudioAssetDialog()\n            },\n            {\n                title:'geo location',\n                icon: ITEM_ICONS.geoanchor,\n                fun: () => provider.showAddGeoLocationAssetDialog()\n            }\n        ])\n    }\n\n    acts.push({\n        title: 'existing asset on server',\n        icon: ITEM_ICONS.assets,\n        fun: () => provider.showOpenAssetDialog()\n    })\n\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n\nexport function showAddActionPopup (e, provider) {\n    const acts = [\n        {\n            title:'behavior from template',\n            icon: ITEM_ICONS.behavior_script,\n            fun: () => provider.showOpenBehaviorDialog()\n        },\n    ]\n    if(AuthModule.supportsScriptEdit()) {\n        acts.push({\n            title: 'custom behavior',\n            icon: ITEM_ICONS.behavior_script,\n            fun: () => provider.addCustomBehaviorAsset()\n        })\n    }\n    PopupManager.show(<MenuPopup actions={acts}/>, e.target)\n}\n","import React, {Component} from 'react'\nimport {\n    AmbientLight,\n    Audio,\n    AudioLoader,\n    Color,\n    CylinderBufferGeometry,\n    DirectionalLight,\n    Group,\n    Mesh,\n    MeshLambertMaterial,\n    PerspectiveCamera,\n    Scene,\n    WebGLRenderer\n} from 'three'\n\nimport './VREditor.css'\n\nimport {Pointer, POINTER_CLICK, VR_DETECTED, VRManager, VRStats} from \"webxr-boilerplate\"\n\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {TranslateControl} from './TranslateControl'\nimport panel2d from \"./panel2d/panel2d\"\nimport button2d from \"./panel2d/button2d\"\nimport group2d from \"./panel2d/group2d\"\nimport SceneDef from \"./defs/SceneDef\"\nimport {on} from \"../utils\"\nimport {TweenManager} from \"../common/tween\"\nimport {get3DObjectDef, is3DObjectType, OBJ_TYPES, SIMPLE_COLORS, toRad, TOTAL_OBJ_TYPES} from './Common'\n//use the oculus go controller\nimport ThreeDOFController from \"./3dof.js\"\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {deleteObject} from './Actions'\nimport {DialogContainer} from 'appy-comps'\n\nconst {SET_PROPERTY, CREATE_OBJECT, INSERT_ELEMENT, DELETE_ELEMENT} = require(\"syncing_protocol\");\n\nclass Adapter extends SceneGraphProvider {\n    constructor(editor, provider) {\n        super()\n        this.editor = editor\n        this.provider = provider\n    }\n    getCurrentScene ()  {\n        return this.provider.accessObject(this.editor.currentScene)\n    }\n    getSceneObjects (scene)  {\n        return scene.getChildren().filter(ch => is3DObjectType(ch.type))\n    }\n    getBehaviorsForObject (obj)  {\n        return obj.getChildren().filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getThreeObject(id) {\n        return this.editor.findNode(id)\n    }\n    getParsedBehaviorAsset (beh) {\n        const asset = this.provider.accessObject(beh.behavior)\n        return this.provider.getCachedBehaviorAsset(asset.id)\n    }\n    getAllBehaviors ()  {\n        return this.provider.accessObject(this.provider.getSceneRoot())\n            .find((obj)=> obj.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getGraphObjectByName(title) {\n        const list = this.provider.accessObject(this.provider.getSceneRoot()).find((o)=>o.title === title)\n        if(!list || list.length<1) return null\n        return list[0]\n    }\n    navigateScene(id) {\n        return this.editor.swapScene(id)\n    }\n    playAudioAsset(audio) {\n        const sound = new Audio(this.editor.audioListener)\n        const audioLoader = new AudioLoader()\n        audioLoader.load(audio.src, function( buffer ) {\n            sound.setBuffer( buffer );\n            sound.setLoop( false );\n            sound.setVolume( 0.5 );\n            sound.play();\n        });\n        this.editor.playing_audio[audio.id] = sound\n    }\n\n    stopAudioAsset(audio) {\n        if(this.editor.playing_audio[audio.id]) {\n            this.editor.playing_audio[audio.id].stop()\n            delete this.editor.playing_audio[audio.id]\n        }\n    }\n\n    getGraphObjectById(id) {\n        return this.provider.accessObject(id)\n    }\n}\n\nexport default class ImmersiveVREditor extends Component {\n    constructor(props) {\n        super(props)\n        this.obj_node_map = {}\n        this.playing_audio = []\n        this.scriptManager = new ScriptManager(new Adapter(this, this.props.provider))\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        return false\n    }\n\n\n    render() {\n        return <div>\n            <div id=\"overlay\">\n                <div id=\"inner\">\n                    <h1>Application Name</h1>\n                    <div id=\"loading-indicator\">\n                        <label>loading</label>\n                        <progress max=\"100\" value=\"0\" id=\"progress\"></progress>\n                    </div>\n                    <button id=\"enter-button\" disabled>VR not supported, play anyway</button>\n                </div>\n            </div>\n            <div ref={c => this.wrapper = c}></div>\n            <DialogContainer/>\n        </div>\n    }\n\n\n    componentDidMount() {\n        this.sceneWrappers = {}\n        this.initScene()\n        this.renderer.setAnimationLoop(this.render3.bind(this))\n    }\n\n    render3(time) {\n        //update the pointer and stats, if configured\n        if(this.tweenManager) this.tweenManager.update(time)\n        if(this.pointer) this.pointer.tick(time)\n        if(this.stats) this.stats.update(time)\n        if(this.controller) this.controller.update(time)\n        if(this.scriptManager.isRunning()) this.scriptManager.tick(time)\n        this.renderer.render( this.scene, this.camera );\n    }\n\n    initScene() {\n\n        const $ = (sel) => document.querySelector(sel)\n        const on = (elem, type, cb) => elem.addEventListener(type,cb)\n\n        const container = this.wrapper\n        this.tweenManager = new TweenManager()\n        this.scene = new Scene();\n        this.stageRot = new Group()\n        this.scene.add(this.stageRot)\n        this.stagePos = new Group()\n        this.stageRot.add(this.stagePos)\n        this.camera = new PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new WebGLRenderer( { antialias: true } );\n        const renderer = this.renderer\n        renderer.setPixelRatio( window.devicePixelRatio );\n        renderer.setSize( window.innerWidth, window.innerHeight );\n        renderer.gammaOutput = true\n        renderer.vr.enabled = true;\n        container.appendChild( renderer.domElement );\n        this.vrmanager = new VRManager(renderer)\n\n        this.audioListener = new AudioListener()\n        this.camera.add(this.audioListener)\n\n        this.initContent()\n\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n\n\n        on($(\"#enter-button\"),'click',()=>{\n            $(\"#overlay\").style.display = 'none'\n            //we can start playing sound now\n        })\n\n        this.vrmanager.addEventListener(VR_DETECTED,()=>{\n            console.log(\"VR detected\")\n            $(\"#enter-button\").removeAttribute('disabled',false)\n            $(\"#enter-button\").innerText = \"enter vr\"\n            on($(\"#enter-button\"),'click',()=> this.vrmanager.enterVR())\n        })\n\n        const WAIT_FOR_LOAD = false\n\n        if(!WAIT_FOR_LOAD) {\n            $(\"#loading-indicator\").style.display = 'none'\n            $(\"#enter-button\").style.display = 'block'\n            $(\"#enter-button\").removeAttribute('disabled')\n        }\n\n        this.props.provider.onRawChange(this.updateSceneOp.bind(this))\n        this.props.provider.on(TREE_ITEM_PROVIDER.DOCUMENT_SWAPPED, this.documentSwapped.bind(this))\n        SelectionManager.on(SELECTION_MANAGER.CHANGED, this.selectionChanged.bind(this))\n        //clear selection when click on the bg\n        on(this.pointer,POINTER_CLICK,()=> SelectionManager.clearSelection())\n\n        this.controller = new ThreeDOFController(this.stagePos, this.stageRot)\n        // on(this.controller,'move', this.standardProximityHandler)\n\n        this.loadScene()\n    }\n\n    selectionChanged() {\n        const sel = SelectionManager.getSelection()\n        if (sel === null && this.controls) return this.controls.detach(this.selectedNode)\n        const node = this.findNode(sel)\n        if(this.selectedNode !== node && this.controls) this.controls.detach(this.selectedNode)\n        this.selectedNode = node\n        if (this.selectedNode && this.controls) this.controls.attach(this.selectedNode, this.pointer)\n    }\n\n    standardViewClickHandler = (e)  => {\n        if(this.scriptManager.isRunning()) {\n            this.scriptManager.performClickAction(this.props.provider.accessObject(e.target.userData.graphid))\n        } else {\n            SelectionManager.setSelection(e.target.userData.graphid)\n        }\n    }\n\n\n    initContent() {\n        this.scene.background = new Color( 0xcccccc );\n        const light = new DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new AmbientLight(0xffffff,0.2))\n\n        // enable stats visible inside VR\n        this.stats = new VRStats({renderer:this.renderer})\n        if(this.props.editable) {\n            this.camera.add(this.stats)\n        }\n        this.scene.add(this.camera)\n\n        //class which handles mouse and VR controller \n        this.pointer = new Pointer(this, {\n            intersectionFilter: ((o) => o.userData.clickable),\n            cameraFollowMouse:false,\n            mouseSimulatesController:false,\n            enableLaser: true,\n            laserLength: 20,\n        })\n\n\n        const STICK_HEIGHT = 1.0\n        const stick = new Mesh(\n            new CylinderBufferGeometry(0.1,0.1,STICK_HEIGHT),\n            new MeshLambertMaterial({color:'aqua'})\n        )\n        stick.position.z = -STICK_HEIGHT/2;\n        stick.rotation.x = toRad(-90)\n        this.pointer.controller1.add(stick)\n\n\n        if(this.props.editable) {\n            this.controls = new TranslateControl()\n            this.controls.name = 'Controls'\n            on(this.controls, 'change', (e) => {\n                const sel = SelectionManager.getSelection()\n                if (sel) {\n                    const node = this.findNode(sel)\n                    const prov = this.props.provider\n                    prov.quick_setPropertyValue(sel, 'tx', node.position.x)\n                    prov.quick_setPropertyValue(sel, 'ty', node.position.y)\n                    prov.quick_setPropertyValue(sel, 'tz', node.position.z)\n                }\n            })\n        }\n\n        if(this.props.editable) {\n            this.tools = new panel2d(this.scene, this.camera)\n            this.tools.position.set(-1, 1, -3)\n            this.scene.add(this.tools)\n\n\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5, text: 'add box'})\n                .on(POINTER_CLICK, () => {\n                    const scene = this.props.provider.accessObject(this.currentScene)\n                    this.props.provider.add3DObject(OBJ_TYPES.cube,scene)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30, text: 'add sphere'})\n                .on(POINTER_CLICK, () => {\n                    const scene = this.props.provider.accessObject(this.currentScene)\n                    this.props.provider.add3DObject(OBJ_TYPES.sphere,scene)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30 + 30, text: 'delete'})\n                .on(POINTER_CLICK, ()=>{\n                    deleteObject(this.props.provider)\n                }))\n            this.tools.add(new button2d()\n                .setAll({x: 5, y: 5 + 30 + 30 + 30, text: 'save'})\n                .on(POINTER_CLICK, this.props.provider.save))\n            const runButton = new button2d()\n                .setAll({x:5, y: 5+30*4, text:'run'})\n                .on(POINTER_CLICK,() => {\n                    if(this.scriptManager.isRunning()) {\n                        runButton.set('text','run')\n                        this.scriptManager.stopRunning()\n                    } else {\n                        runButton.set('text','stop')\n                        this.scriptManager.startRunning()\n                    }\n                })\n            this.tools.add(runButton)\n\n            const rowLayout = (panel) => {\n                let x = 0\n                panel.comps.forEach((c) => {\n                    c.x = x\n                    c.y = 0\n                    x += c.w + panel.padding\n                })\n            }\n\n            const color_group = new group2d().setAll({x: 5, y: 5 + 30 * 5, w: 235, h: 35, layout: rowLayout})\n            SIMPLE_COLORS.forEach(c => {\n                color_group.add(new button2d()\n                    .setAll({text: ' ', normalBg: c})\n                    .on(POINTER_CLICK, () => this.props.provider.setColor(c))\n                )\n            })\n\n            this.tools.add(color_group)\n\n            this.tools.redraw()\n        }\n\n    }\n\n\n    updateSceneOp(op) {\n        //only do scenes with create_object\n        if (op.type === CREATE_OBJECT) {\n            if(op.defaults) {\n                //console.log(\"creating object with defaults\",op.defaults)\n                if(op.defaults.type === 'scene') {\n                    let node =  this.findNode(op.id)\n                    if(node) {\n                        // console.log(\"scene already exists. skipping\", node.name)\n                    } else {\n                        // console.log(\"Making a real scene\", op)\n                        const obj = this.props.provider.accessObject(op.id)\n                        node = new SceneDef().makeNode(obj)\n                        this.insertNodeMapping(op.id,node)\n                        this.sceneWrappers[op.id] = node\n                        this.stagePos.add(node)\n                        // this.scene.add(node)\n                        this.swapScene(op.id)\n                    }\n                }\n            }\n        }\n        // other objects are done with insert_element\n        if (op.type === INSERT_ELEMENT) {\n            const obj = this.props.provider.accessObject(op.value)\n            if (obj.type === 'scene') return // console.log(\"skipping insert scene\")\n            if(is3DObjectType(obj.type)) {\n                const nodeObj = get3DObjectDef(obj.type).makeNode(obj)\n                on(nodeObj, POINTER_CLICK, this.standardViewClickHandler)\n                this.insertNodeMapping(obj.id, nodeObj)\n                this.findNode(obj.parent).add(nodeObj)\n                return\n            }\n            if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.ASSET) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return\n            if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return\n            console.warn(\"unknown object type\", obj)\n            return\n        }\n        if (op.type === SET_PROPERTY) {\n            const obj = this.props.provider.accessObject(op.object)\n            if(obj.type === 'asset') return\n            if(obj.type === 'assets') return\n            const node = this.findNode(op.object)\n            if (node) {\n                if(op.name === 'parent') return\n                if(obj.type === 'scene') return new SceneDef().updateProperty(node,obj,op,this.props.provider)\n                if(is3DObjectType(obj.type)) return get3DObjectDef(obj.type).updateProperty(node,obj,op, this.props.provider)\n            } else {\n                console.log(\"could not find the node for object id:\", op)\n                console.log(\"objects are\",this.obj_node_map)\n            }\n            return\n        }\n        if(op.type === DELETE_ELEMENT) {\n            const obj = this.props.provider.accessObject(op.value)\n            if(is3DObjectType(obj.type)) {\n                const node = this.findNode(obj.id)\n                this.findNode(obj.parent).remove(node)\n            }\n            return\n        }\n        // console.log('skipping', op.type)\n    }\n    documentSwapped() {\n        console.log(\"totally new document!\")\n        //nuke all the old stuff\n        Object.keys(this.sceneWrappers).forEach(key => {\n            const scene = this.sceneWrappers[key]\n            if(this.controls) scene.remove(this.controls)\n            this.stagePos.remove(scene)\n        })\n        this.sceneWrappers = {}\n        this.obj_node_map = {}\n        // this.setState({scene: -1})\n        //make new stuff\n        const hist = this.props.provider.getDocHistory()\n        hist.forEach(op => this.updateSceneOp(op))\n    }\n\n    swapScene(id) {\n        this.currentScene = id\n        console.log(\"swapping to the scene\",id)\n        //make all scenes invisible except the right one\n        Object.keys(this.sceneWrappers).forEach(key => {\n            const scene = this.sceneWrappers[key]\n            scene.visible = (key === id)\n            if(this.controls) scene.remove(this.controls)\n        })\n        if(this.controls) this.sceneWrappers[id].add(this.controls)\n        this.sceneWrappers[id].position.x = 0\n        this.sceneWrappers[id].position.z = 0\n    }\n\n\n    loadScene() {\n    }\n\n    insertNodeMapping(id, node) {\n        if (typeof id !== 'string') throw new Error(\"cannot map an object to an object. invalid call in insertNodeMapping\")\n        this.obj_node_map[id] = node\n        node.userData.graphid = id\n    }\n\n    findNode(id) {\n        if (!this.obj_node_map[id]) console.warn(\"could not find node for id\", id)\n        return this.obj_node_map[id]\n    }\n\n\n}\n\n\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\n\nexport class AddGLTFAssetDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        listToArray(this.fileinput.files).forEach(file => {\n            console.log(\"got the file\", file)\n        })\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox>\n                <h3>add GLTF file assets</h3>\n                <p>\n                    chose <b>the directory</b> containing the GLTF file\n                </p>\n                <input type=\"file\" ref={(obj) => this.fileinput = obj} onChange={this.selectedFile} multiple={true}\n                       webkitdirectory=\"true\"/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {addGLBAssetFromFile} from '../AssetActions'\n\nexport class AddGLBAssetDialog extends Component {\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        listToArray(this.fileinput.files).forEach(file => {\n            addGLBAssetFromFile(file, this.props.provider)\n        })\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox>\n                <h3>add GLB to assets</h3>\n                <p>\n                    choose a GLB file\n                </p>\n                <input type=\"file\" ref={(obj) => this.fileinput = obj} onChange={this.selectedFile} multiple={true}/>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {listToArray} from '../../syncgraph/utils'\nimport {ToggleButton, Toolbar} from '../../common/GridEditorApp'\nimport {addAudioAssetFromFile, addAudioAssetFromURL} from '../AssetActions'\n\nexport class AddAudioAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            view:'local',\n            url:\"\",\n        }\n        this.fileInput = React.createRef();\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n        if(this.state.view === 'remote') {\n            console.log(\"adding the url\",this.state.url)\n            addAudioAssetFromURL(this.state.url, this.props.provider)\n        } else {\n            console.log(\"the file input is\",this.fileInput)\n            listToArray(this.fileInput.current.files).forEach(file => {\n                addAudioAssetFromFile(file, this.props.provider)\n            })\n        }\n    }\n    switchLocal = () => this.setState({view:'local'})\n    switchRemote = () => this.setState({view:'remote'})\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>add image to assets</h3>\n                <VBox grow>\n                    <Toolbar>\n                        <ToggleButton onClick={this.switchLocal} selected={this.state.view==='local'}>local</ToggleButton>\n                        <ToggleButton onClick={this.switchRemote} selected={this.state.view==='remote'}>remote</ToggleButton>\n                    </Toolbar>\n                    {this.renderSelectedPanel()}\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    selectedFile = (e) => {\n        console.log(\"selected a file\", e.target)\n        this.setState({fileInput:e.target.value})\n    }\n\n    typedURL = (e) => {\n        this.setState({url:e.target.value})\n    }\n\n    renderSelectedPanel() {\n        if(this.state.view === 'local') {\n            return <HBox>\n                <label>File\n                    <input key=\"f1\" type=\"file\" onChange={this.selectedFile} ref={this.fileInput}/>\n                </label>\n            </HBox>\n        } else {\n            return <HBox>\n                <label>URL\n                    <input key=\"f2\" value={this.state.url} type=\"input\" onChange={this.typedURL}/>\n                </label>\n            </HBox>\n        }\n    }\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\n\nexport class MakeEmbedDialog extends Component {\n\n    okay = () => {\n        DialogManager.hide()\n    }\n\n    generateEmbedURL() {\n        return `http://localhost:3000/?mode=embed-view&doctype=${this.props.provider.getDocType()}&doc=${this.props.provider.getDocId()}&switcher=false`\n    }\n\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>add image to assets</h3>\n                <VBox grow>\n                    <label>URL</label>\n                    <input type=\"text\" value={this.generateEmbedURL()}/>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {toQueryString} from '../../utils'\nimport {AuthModule} from '../AuthModule'\n\nexport class OpenFileDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            docList:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadDocList().then((docs) => this.setState({docList:docs}))\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    openDoc(info) {\n        DialogManager.hide()\n        const opts = Object.assign({},this.props.provider.options,{\n            mode:'edit',\n            switcher:false,\n            doc:info.id\n        })\n        window.open(`./?${toQueryString(opts)}`)\n    }\n    deleteDoc(info) {\n        return this.props.provider.removeDoc(info).then((res)=>{\n            console.log('removed?',res)\n            this.refreshList()\n        })\n    }\n\n    cancel = () => {\n        DialogManager.hide()\n    }\n    okay = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Open document</h3>\n                <VBox scroll style={{ maxHeight:'60vh'}}>\n                    <ul>{this.state.docList.map((doc, i) => {\n                        return <li key={i}>\n                            <b>{doc.title}</b>\n                            <button onClick={()=>this.openDoc(doc)}>open</button>\n                            {this.renderDeleteButton(doc)}\n                        </li>\n                    })}\n                    </ul>\n                </VBox>\n                <HBox>\n                    <button onClick={this.cancel}>cancel</button>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsDocDelete()) return \"\"\n        return <button onClick={()=>this.deleteDoc(doc)}>delete</button>\n\n    }\n\n}\n","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {getAssetsURL} from '../../TreeItemProvider'\nimport {isAudioType, isGLTFType, isImageType, isVideoType} from '../Common'\nimport {AuthModule} from '../AuthModule'\nimport {\n    addAudioAssetFromURL,\n    addGLBAssetFromURL,\n    addImageAssetFromExpandedURL,\n    addVideoAssetFromURL\n} from '../AssetActions'\n\nexport class OpenAssetDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            assetList:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadAssetList()\n            .then((assets) => {\n                if(this.props.filter) assets = assets.filter(this.props.filter)\n                this.setState({assetList:assets})\n            })\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    addAsset(info) {\n        DialogManager.hide()\n        if(isImageType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addImageAssetFromExpandedURL(info.url,info.mimeType, info.title, this.props.provider)\n        }\n        if(isAudioType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addAudioAssetFromURL(info.url, info.mimeType, info.title, this.props.provider)\n        }\n        if(isVideoType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addVideoAssetFromURL(info.url, info.mimeType, info.title, this.props.provider)\n        }\n        if(isGLTFType(info.mimeType)) {\n            if(!info.url) info.url = `${getAssetsURL()}${info.id}`\n            return addGLBAssetFromURL(info.url, info.mimeType, info.title, this.props.provider)\n        }\n        console.log(\"can't add this type\")\n    }\n    deleteAsset(info) {\n        return this.props.provider.removeAssetSource(info).then((res)=>{\n            console.log('removed?',res)\n            this.refreshList()\n        })\n    }\n\n    okay = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Add Asset</h3>\n                <VBox scroll style={{ maxHeight:'60vh'}}>\n                    <ul>{this.state.assetList.map((doc, i) => {\n                        return <li key={i}>\n                            <b>{doc.title} </b>\n                            <i> {doc.mimeType}</i>\n                            <button onClick={()=>this.addAsset(doc)}>add</button>\n                            {this.renderDeleteButton(doc)}\n                        </li>\n                    })}\n                    </ul>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>close</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsAssetUpload()) return \"\"\n        return <button onClick={()=>this.deleteAsset(doc)}>delete</button>\n\n    }\n}\n","import React, {Component} from \"react\"\nimport {TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport selMan, {SELECTION_MANAGER} from '../SelectionManager'\nimport {TOTAL_OBJ_TYPES} from './Common'\nimport AceEditor from 'react-ace'\nimport 'brace/mode/javascript'\nimport 'brace/theme/github'\n\nexport default class ScriptEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.refresh = () => {\n            const id = selMan.getSelection()\n            const obj = this.props.provider.accessObject(id)\n            console.log('id',id,obj.exists(), obj.type)\n            if(obj.exists() && obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                this.props.provider.fetchBehaviorAssetContents(id).then(text => {\n                    this.setState({id:id, text:text})\n                })\n            } else {\n            }\n        }\n        this.state = {\n            id:null,\n            text:'empty',\n        }\n    }\n    componentDidMount() {\n        this.refresh()\n        this.props.provider.on(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.refresh)\n        selMan.on(SELECTION_MANAGER.CHANGED,this.swap)\n    }\n\n    componentWillUnmount() {\n        this.props.provider.off(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,this.refresh)\n        selMan.off(SELECTION_MANAGER.CHANGED,this.swap)\n    }\n    swap = () => {\n        const obj = this.props.provider.accessObject(selMan.getSelection())\n        if(obj.exists()  && obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n            this.refresh()\n        }\n    }\n    changeText = (value) => this.setState({text:value})\n    save = (e) => {\n        this.props.provider.updateBehaviorAssetContents(this.state.id,this.state.text)\n    }\n    render() {\n        if(this.state.id === null) return <div>loading</div>\n        return <AceEditor mode=\"javascript\"\n                          theme=\"github\"\n                          name=\"UNIQUE_ID_OF_DIV\"\n                          value={this.state.text}\n                          onChange={this.changeText}\n                          onBlur={this.save}\n                          showGutter={true}\n                          width={'100%'}\n                          height={'100%'}\n        />\n    }\n\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport {getScriptsURL} from '../../TreeItemProvider'\nimport {Spacer} from '../../common/GridEditorApp'\nimport {AuthModule} from '../AuthModule'\n\nexport class OpenScriptDialog extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            scripts:[]\n        }\n    }\n    refreshList = () => {\n        this.props.provider.loadScriptList()\n            .then((scripts) => {\n                this.setState({scripts:scripts})\n            })\n    }\n    componentDidMount() {\n        this.refreshList()\n    }\n    addScript(info) {\n        DialogManager.hide()\n        if(!info.url) info.url = `${getScriptsURL()}${info.name}`\n        return this.props.provider.addBehaviorAssetFromURL(info)\n    }\n    deleteScript(info) {\n        return this.props.provider.removeBehaviorAssetSource(info.name).then((res)=>{\n            console.log(\"removed?\",res)\n            this.refreshList()\n        })\n    }\n\n    okay = () => {\n        DialogManager.hide()\n    }\n    render() {\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Choose Behavior Script</h3>\n                <VBox scroll style={{ maxHeight:'60vh'}}>\n                    <ul className=\"behaviors-list\">{this.state.scripts.map((doc, i) => {\n                        return <HBox key={doc.name}>\n                            <VBox>\n                                <div>\n                                    <i>{doc.name}</i> -  <b>{doc.title}</b>\n                                </div>\n\n                                <p>{doc.description}</p>\n                            </VBox>\n                            <Spacer/>\n                            <button onClick={()=>this.addScript(doc)}>add</button>\n                            {this.renderDeleteButton(doc)}\n                        </HBox>\n                    })}\n                    </ul>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>close</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n    renderDeleteButton(doc) {\n        if(!AuthModule.supportsScriptEdit()) return \"\"\n        return <button onClick={()=>this.deleteScript(doc)}>delete</button>\n    }\n\n}\n","export const CUSTOM_BEHAVIOR_SCRIPT = `\n/*\n #title untitled behavior\n #description does something\n*/\n({\n  // defines a target property. must be a scene\n    properties: {\n        scene: { \n            type:'enum', \n            title: 'target scene', \n            value:null, \n            hints: {\n                type:'node',\n                nodeType:'scene'\n            }\n        },\n    },\n    init: function() {\n        //called when the program starts\n    },\n    onClick: function(e) {\n        //called when object is clicked on\n        //e.system.navigateScene(e.props.scene)\n    }\n})\n`\n\n\n\nexport const CUSTOM_SCENE_SCRIPT = `\n/*\n #title scene script\n #description does something\n*/\n({\n    // defines a target property. must be a scene\n    properties: {\n        scene: { \n            type:'enum', \n            title: 'target scene', \n            value:null, \n            hints: {\n                type:'node',\n                nodeType:'scene'\n            }\n        },\n    },\n    init: function() {\n        //called when the program starts\n    },\n    onEnter: function() {\n        //called when entering a scene\n    },\n    onExit: function() {\n        //called when exiting a scene\n    },\n})\n`","import React, {Component} from 'react'\nimport QRCode from 'qrcode'\n\nexport default class QRCanvas extends Component {\n    componentDidMount() {\n        if (this.canvas) this.redraw()\n    }\n\n    componentWillReceiveProps(newProps) {\n        if (this.canvas) this.redraw()\n    }\n\n    redraw() {\n        QRCode.toCanvas(this.canvas, this.props.url, {width: this.props.width, height: this.props.height})\n    }\n\n    render() {\n        let style = {}\n        if (this.props.style) Object.assign(style, this.props.style)\n        return <canvas width={this.props.width} height={this.props.height} ref={(canvas) => this.canvas = canvas} style={style}/>\n    }\n}","import React, {Component} from 'react'\nimport {Dialog, DialogManager, HBox, VBox} from 'appy-comps'\nimport QRCanvas from '../../common/QRCanvas'\n\nexport class QRDialog extends Component {\n\n    okay = () => {\n        DialogManager.hide()\n    }\n\n    render() {\n        const url = document.documentURI\n        return <Dialog visible={true}>\n            <VBox grow>\n                <h3>Scan</h3>\n                <VBox grow>\n                    <label>{url}</label>\n                    <QRCanvas url={url} width={160} height={160}/>\n                </VBox>\n                <HBox>\n                    <button onClick={this.okay}>okay</button>\n                </HBox>\n            </VBox>\n        </Dialog>\n    }\n\n}\n","import SyncGraphProvider from '../syncgraph/SyncGraphProvider'\nimport React, {Component} from 'react'\nimport GridEditorApp, {Panel, Spacer, Toolbar} from '../common/GridEditorApp'\nimport TreeTable from '../common/TreeTable'\nimport PropSheet, {TYPES} from '../common/PropSheet'\nimport SelectionManager, {SELECTION_MANAGER} from '../SelectionManager'\nimport {VRCanvas} from './VRCanvas'\nimport {getAssetsURL, getDocsURL, getInfoURL, getScriptsURL, TREE_ITEM_PROVIDER} from '../TreeItemProvider'\nimport ImmersiveVREditor from './ImmersiveVREditor'\nimport {fetchGraphObject, insertAsFirstChild, insertAsLastChild, listToArray} from '../syncgraph/utils'\nimport CubeDef from \"./defs/CubeDef\"\nimport SceneDef from \"./defs/SceneDef\"\nimport InputManager from \"../common/InputManager\"\nimport {DialogContainer, DialogManager, HBox, PopupContainer} from \"appy-comps\"\nimport {\n    ASSET_TYPES,\n    canHaveBehavior,\n    canHaveScene,\n    canHaveShape,\n    get3DObjectDef,\n    HORIZONTAL_ALIGNMENT,\n    is3DObjectType,\n    isGLTFFile,\n    isImageType,\n    ITEM_ICONS,\n    OBJ_TYPES,\n    parseBehaviorScript,\n    PROP_DEFS,\n    REC_TYPES,\n    SIMPLE_COLORS,\n    TOTAL_OBJ_TYPES\n} from './Common'\nimport {AddImageAssetDialog} from './dialogs/AddImageAssetDialog'\nimport {AddGLTFAssetDialog} from './dialogs/AddGLTFAssetDialog'\nimport {AddGLBAssetDialog} from './dialogs/AddGLBAssetDialog'\nimport {AddAudioAssetDialog} from './dialogs/AddAudioAssetDialog'\nimport AssetView from '../metadoc/AssetView'\nimport * as ToasterMananager from './ToasterManager'\nimport GraphAccessor from \"../syncgraph/GraphAccessor\"\nimport {MakeEmbedDialog} from './dialogs/MakeEmbedDialog'\nimport {toQueryString} from '../utils'\nimport {OpenFileDialog} from './dialogs/OpenFileDialog'\nimport {AuthModule, USER_CHANGE} from './AuthModule'\nimport {OpenAssetDialog} from './dialogs/OpenAssetDialog'\nimport ScriptEditor from './ScriptEditor'\nimport {OpenScriptDialog} from './dialogs/OpenScriptDialog'\nimport {CUSTOM_BEHAVIOR_SCRIPT, CUSTOM_SCENE_SCRIPT} from './Templates'\nimport {addScene, deleteObject, newDoc, showAddActionPopup, showAddAssetPopup, showAddPopup} from './Actions'\nimport {addGeoAnchorAsset, addGLBAssetFromFile, addImageAssetFromFile} from './AssetActions'\nimport {QRDialog} from './dialogs/QRDialog'\n\n\nexport default class VREditor extends SyncGraphProvider {\n    constructor(options) {\n        super(options)\n        this.imagecache = {}\n        this.videocache = {}\n        this.behaviorCache = {}\n    }\n    getDocType() { return \"vr\" }\n    getApp = () => {\n        if(this.mode === 'edit') return <VREditorApp provider={this}/>\n        if(this.mode === 'vredit') return <ImmersiveVREditor provider={this} editable={true}/>\n        if(this.mode === 'embed-view') return <ImmersiveVREditor provider={this} editable={false}/>\n        if(this.mode === 'vrview') return <ImmersiveVREditor provider={this} editable={false}/>\n        console.log(\"no mode!\")\n    }\n    getTitle = () => \"MrEd\"\n    getDocTitle = () => this.accessObject(this.getSceneRoot()).title\n    makeEmptyRoot(doc) {\n        //make root\n        const root = fetchGraphObject(doc,doc.createObject({ type:TOTAL_OBJ_TYPES.ROOT, title:'Untitled Project', defaultScene:0, children:doc.createArray() }))\n        //make scene\n        const scene1 = new SceneDef().make(doc,root)\n        //make cube\n        const obj = new CubeDef().make(doc,scene1)\n        //make assets\n        const assets = fetchGraphObject(doc,doc.createObject({type:TOTAL_OBJ_TYPES.ASSETS_LIST,\n            title:'Assets', children: doc.createArray(), parent:0}))\n        //make behaviors\n        const behaviors = fetchGraphObject(doc,doc.createObject({type:TOTAL_OBJ_TYPES.BEHAVIORS_LIST,\n            title:'Behaviors', children: doc.createArray(), parent:0}))\n        //tie it all together\n        insertAsFirstChild(doc,root,scene1)\n        insertAsFirstChild(doc,scene1,obj)\n        insertAsLastChild(doc,root,behaviors)\n        insertAsLastChild(doc,root,assets)\n    }\n    docLoaded = () => {\n        this.accessObject(this.getBehaviorsObject()).getChildren()\n            .filter(a => a.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT)\n            .forEach((b)=>{\n                this.fetchBehaviorAssetContents(b.id).then((contents)=> {\n                    try {\n                        const info = parseBehaviorScript(contents)\n                        info.text = contents\n                        this.setCachedBehaviorAsset(b.id, info)\n                    } catch (e) {\n                        console.error(e)\n                    }\n                })\n            })\n    }\n\n    getRendererForItem = (item) => {\n        const obj = this.accessObject(item)\n        if(!obj.exists()) return <div>???</div>\n        if(obj.type === TOTAL_OBJ_TYPES.ASSET) return <div><i className={`fa fa-${ITEM_ICONS[obj.subtype]}`}/> {obj.title}</div>\n        if(ITEM_ICONS[obj.type]) return <div><i className={`fa fa-${ITEM_ICONS[obj.type]}`}/> {obj.title}</div>\n        return <div>{obj.title}</div>\n    }\n\n    getProperties(item) {\n        function copyPropDef(def,value) {\n            const out = {};\n            Object.keys(def).forEach((key) => out[key] = def[key])\n            out.value = value\n            return out;\n        }\n        let defs = []\n        if(!item) return defs\n\n        //show the ID for all objects\n        defs.push({\n            key:'id',\n            name:\"ID\",\n            type:TYPES.STRING,\n            value:item,\n            locked:true\n        })\n\n        const obj = this.accessObject(item)\n        //if a behavior object is selected, get the defs from the root behavior asset\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            const behaviorProps = this.getCachedBehaviorPropDefs(obj.behavior)\n            if(behaviorProps) {\n                Object.keys(behaviorProps).forEach(pname => {\n                    const propdef = behaviorProps[pname]\n                    const ndef = {\n                        key: pname,\n                        name: pname,\n                        type: propdef.type,\n                        value: obj[pname]\n                    }\n                    if(propdef.hints) ndef.hints = propdef.hints\n                    defs.push(ndef)\n                })\n            } else {\n                console.warn(\"Missing prop defs for behavior object\")\n            }\n            defs.push({\n                key:'behavior',\n                name:\"Script\",\n                type:TYPES.STRING,\n                value:obj.behavior,\n                locked:true,\n                custom:true,\n            })\n        }\n\n        const props = this.syncdoc.getPropertiesForObject(item)\n        if(props) {\n            props.forEach(key => {\n                if(key === 'type') return\n                if(key === 'children') return\n                if(key === 'parent') return\n                const value = this.syncdoc.getPropertyValue(item,key)\n                if(PROP_DEFS[key]) {\n                    const def = copyPropDef(PROP_DEFS[key],value)\n                    if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                        if(key === 'title' || key === 'description') def.locked = true\n                    }\n                    return defs.push(def)\n                }\n                // console.log(\"unknown property\",key)\n            })\n        }\n\n\n\n        if(is3DObjectType(obj.type)) {\n            defs.push({\n                key: 'scale',\n                name: 'Scale',\n                type: TYPES.GROUP,\n                group: ['sx','sy','sz'],\n                custom:true,\n            })\n        }\n\n        return defs\n    }\n    setPropertyValue(item, def, value) {\n        if(def.key === 'scale') {\n            super.setPropertyValue(item,{key:'sx'},value.sx)\n            super.setPropertyValue(item,{key:'sy'},value.sy)\n            super.setPropertyValue(item,{key:'sz'},value.sz)\n            return\n        }\n        super.setPropertyValue(item,def,value)\n        //size the plane to match the aspect ratio of the asset\n        if(def.key === PROP_DEFS.asset.key) {\n            const asset = this.accessObject(value)\n            if(asset.subtype === ASSET_TYPES.IMAGE) {\n                let height = (asset.height / asset.width) * this.accessObject(item).width\n                super.setPropertyValue(item, {key: 'height'}, height)\n            }\n            if(asset.subtype === ASSET_TYPES.GLTF) {\n                console.log(\"adjusting to a gtlf\")\n            }\n        }\n    }\n    getValuesForEnum(key,obj,def) {\n        const realobj = this.accessObject(obj)\n        //if this is a property on a behavior, then use the hints to generate a target list\n        if(realobj.exists() && realobj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            if(def.hasHints()) {\n                const hints = def.getHints()\n                if(hints.type === 'node') {\n                    return this.accessObject(this.getSceneRoot())\n                        .find(obj => obj.type === hints.nodeType)\n                        .map(ch => ch.id)\n                }\n                if(hints.type === 'audio') {\n                    return this.accessObject(this.getAssetsObject()).getChildren().filter(a => a.subtype === ASSET_TYPES.AUDIO).map(a => a.id)\n                }\n                if(hints.type === 'video') {\n                    return this.accessObject(this.getAssetsObject()).getChildren().filter(a => a.subtype === ASSET_TYPES.VIDEO).map(a => a.id)\n                }\n            }\n        }\n        if (key === PROP_DEFS.asset.key) {\n            const assets = this.accessObject(this.getAssetsObject()).getChildren()\n            if(acceptsImageAsset(realobj.type) && acceptsVideoAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.VIDEO || a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            if(acceptsVideoAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.VIDEO).map(a => a.id)\n            if(acceptsModelAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.GLTF).map(a => a.id)\n            if(acceptsImageAsset(realobj.type)) return assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n        }\n        if(key === PROP_DEFS.horizontalAlign.key) {\n            return Object.keys(HORIZONTAL_ALIGNMENT).map(key => HORIZONTAL_ALIGNMENT[key])\n        }\n        if(key === PROP_DEFS.defaultScene.key) {\n            return this.accessObject(this.getSceneRoot()).getChildren()\n                .filter(ch => ch.type === TOTAL_OBJ_TYPES.SCENE)\n                .map(ch => ch.id)\n        }\n        if(key === PROP_DEFS.texture.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.targetImage.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.IMAGE).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.targetGeoLocation.key) {\n            let assets = this.accessObject(this.getAssetsObject()).getChildren()\n            assets = assets.filter(a => a.subtype === ASSET_TYPES.GEOLOCATION).map(a => a.id)\n            return assets\n        }\n        if(key === PROP_DEFS.recType.key) {\n            return Object.keys(REC_TYPES)\n        }\n    }\n    getRendererForEnum(key,obj) {\n        const realobj = this.accessObject(obj)\n        if(realobj.exists() && realobj.type === TOTAL_OBJ_TYPES.BEHAVIOR) return EnumTitleRenderer\n        switch(key) {\n            case PROP_DEFS.asset.key: return EnumTitleRenderer\n            case PROP_DEFS.defaultScene.key: return EnumTitleRenderer\n            case PROP_DEFS.texture.key: return EnumTitleRenderer\n            case PROP_DEFS.targetImage.key: return EnumTitleRenderer\n            case PROP_DEFS.targetGeoLocation.key: return EnumTitleRenderer\n            default: return null\n        }\n    }\n\n    getSelectedSceneObject() {\n        const sel = SelectionManager.getSelection()\n        if(sel === null) return this.getFirstSceneObject()\n        const selected = this.accessObject(sel)\n        if(selected.type === TOTAL_OBJ_TYPES.SCENE) return selected\n        if(is3DObjectType(selected.type))  return this.findSceneObjectParent(selected)\n        if(selected.type === TOTAL_OBJ_TYPES.BEHAVIOR) return this.findSceneObjectParent(selected)\n        return null\n    }\n    getFirstSceneObject() {\n        return this.accessObject(this.getSceneRoot()).getChildren()[0]\n    }\n    findSceneObjectParent(obj) {\n        if(obj === null) return null\n        if(!obj.exists()) return null\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) return obj\n        obj = this.accessObject(obj.parent)\n        return this.findSceneObjectParent(obj)\n    }\n\n    getAssetsObject = () => this.getDataGraph().getObjectByProperty('type',TOTAL_OBJ_TYPES.ASSETS_LIST)\n    getBehaviorsObject = () => this.getDataGraph().getObjectByProperty('type',TOTAL_OBJ_TYPES.BEHAVIORS_LIST)\n\n    quick_setPropertyValue(item, key, value) {\n        const ov = this.getDataGraph().getPropertyValue(item,key)\n        const op = this.cmd.setProperty(item,key,value)\n        op.prevValue = ov\n        if(op.value === op.prevValue) return\n        this.getRawGraph().process(op)\n        //TODO: this should be fired through the graph already. I shouldn't need to fire this\n        this.fire(TREE_ITEM_PROVIDER.PROPERTY_CHANGED,{\n            provider: this,\n            child:item,\n            propKey:key,\n            oldValue:ov,\n            newValue:value\n        })\n    }\n\n    editInVR = () => {\n        this.save().then(()=>{\n        const opts = Object.assign({},this.options,{mode:'vredit', switcher:false})\n        window.open(`./?${toQueryString(opts)}`)\n        })\n    }\n\n    viewInVR = () => {\n        this.save().then(()=>{\n        const opts = Object.assign({}, this.options, {mode: 'play', switcher: false})\n        window.open(`./?${toQueryString(opts)}`)\n        })\n    }\n\n    showQRCode = () => {\n        DialogManager.show(<QRDialog/>)\n    }\n\n    embedView = () => {\n        DialogManager.show(<MakeEmbedDialog provider={this}/>)\n    }\n\n    add3DObject = (type, parent) => {\n        const obj = get3DObjectDef(type).make(this.getDataGraph(),parent)\n        parent.insertFirstChild(obj)\n        SelectionManager.setSelection(obj.id)\n        ToasterMananager.add('added '+type)\n    }\n\n    calculateContextMenu(item) {\n        const cmds = []\n        cmds.push({ title:'delete', icon:ITEM_ICONS.delete, fun: ()=>deleteObject(this) });\n        const obj = this.accessObject(item)\n        if(canHaveShape(obj.type)) {\n            cmds.push({ divider:true })\n            Object.keys(OBJ_TYPES).forEach(type => cmds.push({\n                title: type,\n                icon: ITEM_ICONS[type],\n                fun: () => this.add3DObject(type,obj)\n            }))\n        }\n        if(canHaveScene(obj.type)) {\n            cmds.push({title: 'scene', icon: ITEM_ICONS.scene, fun: ()=>addScene(this)})\n        }\n\n        if(canHaveBehavior(obj.type)) {\n            cmds.push({ divider:true })\n            this.accessObject(this.getBehaviorsObject()).getChildren()\n                .filter(a => a.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT)\n                .forEach((b) => {\n                    cmds.push({\n                        title: b.title,\n                        icon: ITEM_ICONS.behavior_script,\n                        fun: () => this.addBehaviorToObject(b, item)\n                    })\n                })\n        }\n        if(obj.type === TOTAL_OBJ_TYPES.SCENE) {\n            cmds.push({ divider:true })\n            cmds.push({title:'Add Scene script', icon:ITEM_ICONS.behavior, fun: ()=>this.addSceneScript(item)})\n        }\n\n\n        if(obj.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n            cmds.push({ divider:true })\n            cmds.push({title:'view code', icon: ITEM_ICONS.behavior, fun: ()=>SelectionManager.setSelection(obj.behavior)})\n        }\n\n        if(obj.type !== TOTAL_OBJ_TYPES.ROOT) {\n            cmds.push({divider: true})\n            cmds.push({title: 'cut', icon: ITEM_ICONS.cut, fun: this.cutSelection})\n            cmds.push({title: 'copy', icon: ITEM_ICONS.copy, fun: this.copySelection})\n            cmds.push({title: 'paste', icon: ITEM_ICONS.paste, fun: this.pasteSelection})\n        }\n        return cmds\n    }\n\n    cutSelection = (e) => {\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        if(SelectionManager.isEmpty()) return\n        const obj = this.accessObject(SelectionManager.getSelection())\n        SelectionManager.setClipboard(obj.id)\n        obj.removeFromParent()\n        SelectionManager.clearSelection()\n    }\n    copySelection = (e) => {\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        if(SelectionManager.isEmpty()) return\n        const obj = this.accessObject(SelectionManager.getSelection())\n        SelectionManager.setClipboard(obj.id)\n    }\n    pasteSelection = (e) => {\n        //don't intercept if this is a paste into a text field\n        if(e && e.target) {\n            if (e.target.getAttribute('type') === 'input') return\n            if (e.target.nodeName === 'INPUT') return\n            if (e.target.nodeName === 'TEXTAREA') return\n        }\n        const obj1 = this.accessObject(SelectionManager.getClipboard())\n        let parent = null\n        if(is3DObjectType(obj1.type)) parent = this.getSelectedSceneObject().id\n        if(obj1.type === 'scene') parent = this.accessObject(this.getSceneRoot())\n        if (!parent) return console.error(\"no parent to ad too! bad obj type?\",obj1.type)\n        parent.insertChildLast(obj1.clone())\n    }\n\n    // ============ drag and drop ============\n    canBeMoved(node) {\n        const p = this.accessObject(node)\n        if(p.type === TOTAL_OBJ_TYPES.ROOT) return false\n        if(p.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return false\n        if(p.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return false\n        return true\n    }\n    canAddChild(parent,child) {\n        const p = this.accessObject(parent)\n        const c = this.accessObject(child)\n        if(p.type === TOTAL_OBJ_TYPES.ROOT && c.type === TOTAL_OBJ_TYPES.SCENE) return true\n        if(p.type === TOTAL_OBJ_TYPES.SCENE && is3DObjectType(c.type)) return true\n        if(canHaveShape(p.type) && is3DObjectType(c.type)) return true\n        return false\n    }\n    canBeSibling(src,tgt) {\n        const s = this.accessObject(src)\n        const t = this.accessObject(tgt)\n        if(s.type === TOTAL_OBJ_TYPES.SCENE && t.type === TOTAL_OBJ_TYPES.SCENE) return true\n        if(is3DObjectType(s.type) && is3DObjectType(t.type)) return true\n        return false\n    }\n    canAddExternalChild(parent,child) {\n        const obj = this.accessObject(parent)\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return true\n        return false\n    }\n    acceptDrop(e,tgt) {\n        const obj = this.accessObject(tgt)\n        if(obj.type === TOTAL_OBJ_TYPES.ASSETS_LIST) {\n            listToArray(e.dataTransfer.files).forEach(file => {\n                if(isImageType(file.type)) return addImageAssetFromFile(file,this)\n                if(isGLTFFile(file)) return addGLBAssetFromFile(file,this)\n            })\n        }\n    }\n    requestImageCache(src) {\n        const img = new Image()\n        this.imagecache[src] = img\n        return new Promise((res,rej) => {\n            img.src = src\n            img.onload = () => {\n                this.fire(TREE_ITEM_PROVIDER.STRUCTURE_CHANGED,{ provider: this })\n                res(img)\n            }\n        })\n    }\n\n    createCustomEditor(item,def,provider, value, onChange) {\n        if(def.key === PROP_DEFS.color.key\n            || def.key === PROP_DEFS.backgroundColor.key\n            || def.key === PROP_DEFS.borderColor.key\n            || def.key === PROP_DEFS.textColor.key\n            || def.key === PROP_DEFS.startColor.key\n            || def.key === PROP_DEFS.endColor.key\n        ) return <HBox>\n            {\n                SIMPLE_COLORS\n                    .map(c => <button\n                        key={c}\n                        onClick={()=>onChange(c)}\n                        style={{color:c, padding:'1px', margin:0, borderWidth:0,}}\n                        className={\"fa fa-square\"}/> )\n            }\n        </HBox>\n\n        if(def.key === 'scale') return <ScaleEditor def={def} item={item} onChange={onChange} provider={this}/>\n        if(def.key === 'behavior') return <button onClick={()=>SelectionManager.setSelection(value)}>view code</button>\n        return <i>no custom editor for {def.key}</i>\n    }\n\n    setColor = (color) => {\n        if(SelectionManager.isEmpty()) return\n        this.accessObject(SelectionManager.getSelection()).set('color',color)\n    }\n\n    showAddImageAssetDialog = () => DialogManager.show(<AddImageAssetDialog provider={this}/>)\n    showAddAudioAssetDialog = () => DialogManager.show(<AddAudioAssetDialog provider={this}/>)\n    showAddGLTFAssetDialog  = () => DialogManager.show(<AddGLTFAssetDialog provider={this}/>)\n    showAddGLBAssetDialog   = () => DialogManager.show(<AddGLBAssetDialog provider={this}/>)\n    showOpenDocumentDialog  = () => DialogManager.show(<OpenFileDialog provider={this}/>)\n    showOpenAssetDialog     = () => DialogManager.show(<OpenAssetDialog provider={this}/>)\n    showAddServerImageDialog= () => DialogManager.show(<OpenAssetDialog provider={this} filter={a => isImageType(a.mimeType)}/>)\n    showOpenBehaviorDialog  = () => DialogManager.show(<OpenScriptDialog provider={this}/>)\n    showAddGeoLocationAssetDialog = () => {\n        addGeoAnchorAsset({\n            latitude:0,\n            longitude:0,\n            altitude:0,\n            useAltitude:false,\n        },\"new geo location\",this)\n    }\n\n    accessObject = (id) => {\n        return new GraphAccessor(this.getDataGraph()).object(id)\n    }\n\n    loadDocList() {\n        return fetch(`${getDocsURL()}list`,{\n            method:'GET',\n            mode: \"cors\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        })\n            .then(res=>res.json())\n    }\n    removeDoc(doc) {\n        return fetch(`${getDocsURL()}delete/${doc.id}`,{\n            method:'POST',\n            mode:'cors',\n            cache:'no-cache',\n            body:doc.id,\n            headers: {\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        }).then(res => res.json())\n    }\n    loadAssetList() {\n        return fetch(`${getAssetsURL()}list`,{\n            method:'GET',\n            mode: \"cors\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        })\n            .then(res=>res.json())\n    }\n    removeAssetSource(info) {\n        console.log(\"removing\",info)\n        return fetch(`${getAssetsURL()}delete/${info.id}`,{\n            method:'POST',\n            mode:'cors',\n            cache: 'no-cache',\n            body:info.id,\n            headers: {\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        }).then(res => res.json())\n    }\n    loadScriptList() {\n        return fetch(`${getScriptsURL()}list`,{\n            method:'GET',\n            mode: \"cors\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        })\n            .then(res=>res.json())\n    }\n\n\n    // ======== behaviors ===============\n    addBehaviorAssetFromURL = (info) => {\n        const graph = this.getDataGraph()\n        const behavior = fetchGraphObject(graph,graph.createObject({\n            type:TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT,\n            title:info.title,\n            description:info.description,\n            src:info.url,\n            parent:0\n        }))\n        this.accessObject(this.getBehaviorsObject()).insertChildLast(behavior)\n        SelectionManager.setSelection(behavior.id)\n    }\n    removeBehaviorAssetSource(name) {\n        const url = `${getScriptsURL()}delete/${name}`\n        console.log(\"removing\",url)\n        return fetch(url,{\n            method:'POST',\n            mode:'cors',\n            cache: 'no-cache',\n            body:name,\n            headers: {\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        }).then(res => res.json())\n            .then(res => {\n                return res\n            })\n    }\n    addCustomBehaviorAsset = (TEMPLATE) => {\n        const randi = (Math.floor(Math.random()*100000000))\n        const fname =`behavior_${randi}.js`\n        const url = `${getScriptsURL()}${fname}`;\n        const contents = TEMPLATE?TEMPLATE:CUSTOM_BEHAVIOR_SCRIPT\n        console.log(\"posting it to\",url)\n        return fetch(url,{\n            method:'POST',\n            mode:'cors',\n            cache: 'no-cache',\n            body:contents,\n            headers: {\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        })\n            .then(res => res.json())\n            .then(ans => {\n                console.log(\"got back the answer\",ans)\n                const graph = this.getDataGraph()\n                const behavior = fetchGraphObject(graph,graph.createObject({\n                    type:TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT,\n                    title:ans.script.title,\n                    description:ans.script.description,\n                    src:url,\n                    parent:0\n                }))\n                this.accessObject(this.getBehaviorsObject()).insertChildLast(behavior)\n                SelectionManager.setSelection(behavior.id)\n                return behavior\n\n            })\n            .catch(err => console.error(err))\n    }\n    addSceneScript = (obj) => {\n        this.addCustomBehaviorAsset(CUSTOM_SCENE_SCRIPT)\n            .then((b)=>this.addBehaviorToObject(b,obj))\n    }\n    addBehaviorToObject = (b,item) => {\n        return this.fetchBehaviorAssetContents(b.id).then((contents)=>{\n            try {\n                const def = {\n                    type: TOTAL_OBJ_TYPES.BEHAVIOR,\n                    title: b.title,\n                    description: b.description,\n                    parent: 0,\n                    behavior:b.id,\n                }\n                const obj = parseBehaviorScript(contents)\n                this.setCachedBehaviorAsset(b.id,obj)\n                //copy properties to the behavior def\n                if(obj.properties) {\n                    Object.keys(obj.properties).forEach(name => {\n                        def[name] = obj.properties[name].value\n                    })\n                }\n                const graph = this.getDataGraph()\n                const behavior = fetchGraphObject(graph, graph.createObject(def))\n                this.accessObject(item).insertChildLast(behavior)\n                return behavior\n            } catch (e) {\n                console.error(e)\n            }\n        })\n    }\n    fetchBehaviorAssetContents(id) {\n        const obj = this.accessObject(id)\n        return fetch(obj.src,{\n            method:'GET',\n            mode: \"cors\",\n            headers: {\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        }).then(res => res.text())\n    }\n    updateBehaviorAssetContents(id,text) {\n        if(!AuthModule.supportsScriptEdit()) return\n        //update the cache first\n        const info = parseBehaviorScript(text)\n        info.text = text\n        this.setCachedBehaviorAsset(id, info)\n\n        const obj = this.accessObject(id)\n        return fetch(obj.src,{\n            method:'POST',\n            mode:'cors',\n            cache: 'no-cache',\n            body:text,\n            headers: {\n                \"access-key\": AuthModule.getAccessToken()\n            }\n        }).then(res => res.json())\n            .then(ans => {\n                obj.set('title',ans.script.title)\n                obj.set('description',ans.script.description)\n\n\n            })\n    }\n    getCachedBehaviorPropDefs(behavior) {\n        if(!this.behaviorCache[behavior]) {\n            console.error(\"no parsed behavior in the cache\",behavior)\n            return null\n        }\n        return this.behaviorCache[behavior].properties;\n    }\n    getCachedBehaviorAsset(id) {\n        return this.behaviorCache[id]\n    }\n    setCachedBehaviorAsset(id, asset) {\n        this.behaviorCache[id] = asset\n    }\n}\n\nclass VREditorApp extends Component {\n\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            mode:'canvas',\n            user:null,\n            running:false,\n        }\n\n        this.im = new InputManager()\n        this.im.addKeyBinding({id: 'save', key: InputManager.KEYS.S, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'undo', key: InputManager.KEYS.Z, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({\n            id: 'redo',\n            key: InputManager.KEYS.Z,\n            modifiers: [InputManager.MODIFIERS.COMMAND, InputManager.MODIFIERS.SHIFT]\n        })\n        this.im.addListener('save', this.props.provider.save)\n        this.im.addListener('undo', this.props.provider.performUndo)\n        this.im.addListener('redo', this.props.provider.performRedo)\n\n        this.im.addKeyBinding({id: 'cut', key: InputManager.KEYS.X, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'copy', key: InputManager.KEYS.C, modifiers: [InputManager.MODIFIERS.COMMAND]})\n        this.im.addKeyBinding({id: 'paste', key: InputManager.KEYS.V, modifiers: [InputManager.MODIFIERS.COMMAND]})\n\n        this.im.addListener('cut', this.props.provider.cutSelection)\n        this.im.addListener('copy', this.props.provider.copySelection)\n        this.im.addListener('paste', this.props.provider.pasteSelection)\n\n    }\n\n    componentDidMount() {\n        this.im.attachKeyEvents(document)\n        SelectionManager.on(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n        AuthModule.on(USER_CHANGE,()=>this.setState({user:AuthModule.getUsername()}))\n    }\n    componentWillUnmount() {\n        SelectionManager.off(SELECTION_MANAGER.CHANGED,this.selectionChanged)\n    }\n\n    selectionChanged = () => {\n        if(!SelectionManager.isEmpty()) {\n            const item = this.props.provider.accessObject(SelectionManager.getSelection())\n            if(item.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) return this.setState({mode:'script'})\n            if(item.type === PROP_DEFS.asset.key) return this.setState({mode:'asset'})\n        }\n        this.setState({mode:'canvas'})\n    }\n\n    toggleRunning = () => {\n        this.setState({running:!this.state.running})\n    }\n\n    render() {\n        const prov = this.props.provider\n        const bot = <div>\n            <a href={getInfoURL()}>{getInfoURL()}</a>\n            <br/>\n            doc id: <b>{prov.getDocId()}</b>\n        </div>\n\n        return <GridEditorApp bottomText={bot}>\n            <Toolbar left top><label>{prov.getTitle()}</label></Toolbar>\n            <Panel scroll left middle><TreeTable root={prov.getSceneRoot()} provider={prov}/></Panel>\n\n            <Toolbar left bottom>\n                <button className=\"fa fa-cube\"        onClick={(e)=>showAddPopup(e,prov)}/>\n                <button className=\"fa fa-globe\"       onClick={(e)=>addScene(prov)}/>\n                <button className=\"fa fa-archive\"     onClick={(e)=>showAddAssetPopup(e,prov)}/>\n                <button className=\"fa fa-superpowers\" onClick={(e)=>showAddActionPopup(e,prov)}/>\n            </Toolbar>\n\n\n            <Toolbar center top>\n                <button className=\"fa fa-file\" onClick={() => newDoc(prov)} title={'new project'}></button>\n                <button className=\"fa fa-save\" onClick={() => prov.save()} title={'save project'}></button>\n                <button onClick={() => prov.editInVR()}>VR Edit</button>\n                <button onClick={() => prov.viewInVR()}>VR View</button>\n                <button onClick={() => prov.showQRCode()}>QR</button>\n                {/*<button onClick={()=>prov.embedView()}>Embed</button>*/}\n                <Spacer/>\n                <RunButton onClick={this.toggleRunning} active={this.state.running}/>\n                <Spacer/>\n                <button className=\"fa fa-cut\" onClick={prov.cutSelection}/>\n                <button className=\"fa fa-copy\" onClick={prov.copySelection}/>\n                <button className=\"fa fa-paste\" onClick={prov.pasteSelection}/>\n                <button className=\"fa fa-undo\" onClick={prov.performUndo}/>\n                <button className=\"fa fa-repeat\" onClick={prov.performRedo}/>\n            </Toolbar>\n\n\n            <Panel center middle scroll transparent>\n                {this.renderCenterPane(this.state.mode)}\n            </Panel>\n\n            <Panel scroll right><PropSheet provider={prov}/></Panel>\n\n\n            <Toolbar right top>\n                {this.renderLoginButton()}\n            </Toolbar>\n            <Toolbar right bottom>\n            </Toolbar>\n            <DialogContainer/>\n            <PopupContainer/>\n\n        </GridEditorApp>\n    }\n    renderCenterPane(mode) {\n        if (mode === 'script') return <ScriptEditor provider={this.props.provider}/>\n        if (mode === 'canvas') return <VRCanvas provider={this.props.provider} running={this.state.running}/>\n        return <AssetView provider={this.props.provider} asset={SelectionManager.getSelection()}/>\n    }\n\n    renderLoginButton() {\n        const buttons = []\n\n        if(AuthModule.supportsAuth()) {\n            if(AuthModule.isLoggedIn()) {\n                buttons.push(<button key=\"logout\" className=\"fa fa-user\" onClick={AuthModule.logout} title={'logout'}>logout</button>)\n            } else {\n                buttons.push(<button key=\"login\" className=\"fa fa-user\" onClick={AuthModule.login} title={'login'}/>)\n            }\n        }\n        if(AuthModule.supportsDocList()) {\n            buttons.push(<button key=\"open\" className=\"fa fa-folder-open\" onClick={this.props.provider.showOpenDocumentDialog} title={\"open\"}/>)\n        }\n        return buttons\n    }\n}\nconst EnumTitleRenderer = (props) => {\n    let value = \"---\"\n    if(props.value && props.provider) {\n        value = props.provider.accessObject(props.value).title\n    }\n    return <b>{value}</b>\n}\n\nclass ScaleEditor extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            sync:false,\n        }\n    }\n    syncChanged = (e) => this.setState({sync: !this.state.sync})\n    changed = (e, key) =>{\n        const obj = this.props.provider.accessObject(this.props.item)\n        const newvals = {\n            sx:obj.sx,\n            sy:obj.sy,\n            sz:obj.sz\n        }\n        const val = parseFloat(e.target.value)\n        newvals[key] = val\n        if(this.state.sync) {\n            newvals.sx = val\n            newvals.sy = val\n            newvals.sz = val\n        }\n        this.props.onChange(newvals)\n    }\n    render() {\n        const obj = this.props.provider.accessObject(this.props.item)\n        return <HBox className=\"scale-editor\">\n            <input type=\"checkbox\" checked={this.state.sync} onChange={this.syncChanged}/>\n            <input type=\"number\" value={obj.sx} onChange={(e)=>this.changed(e,'sx')} step={0.1}/>\n            <input type=\"number\" value={obj.sy} onChange={(e)=>this.changed(e,'sy')} step={0.1}/>\n            <input type=\"number\" value={obj.sz} onChange={(e)=>this.changed(e,'sz')} step={0.1}/>\n        </HBox>\n    }\n}\n\n\nfunction acceptsModelAsset(type) {\n    if(type=== OBJ_TYPES.model) return true\n    return false\n}\nfunction acceptsImageAsset(type) {\n    if(type === OBJ_TYPES.plane\n        || type === OBJ_TYPES.bg360\n        || type === OBJ_TYPES.img2d\n    ) return true\n    return false\n}\nfunction acceptsVideoAsset(type) {\n    if(type === OBJ_TYPES.plane\n        || type === OBJ_TYPES.bg360\n        || type === OBJ_TYPES.img2d\n    ) return true\n    return false\n}\n\nconst RunButton = (props) => {\n    const clss = props.active?\"run-button active fa fa-stop\":\"run-button fa fa-play\"\n    return <button onClick={props.onClick} className={clss}/>\n}","import React, {Component} from 'react'\nimport ScriptManager, {SceneGraphProvider} from './ScriptManager'\nimport {getDocsURL} from '../TreeItemProvider'\nimport {GET_JSON, on, parseOptions} from '../utils'\nimport {TweenManager} from '../common/tween'\nimport * as THREE from 'three'\nimport {Group} from \"three\"\nimport {VRManager, VR_DETECTED, Pointer} from 'webxr-boilerplate'\nimport SceneDef from './defs/SceneDef'\nimport {get3DObjectDef, is3DObjectType, parseBehaviorScript, TOTAL_OBJ_TYPES} from './Common'\n\n\nexport class ImmersivePlayer extends Component {\n    constructor(props) {\n        super(props)\n        this.obj_map = {}\n        this.three_map = {}\n        this.title_map = {}\n        this.current_scene = null\n        this.root = null\n        this.behavior_map = {}\n        this.behavior_assets = {}\n        this.pendingAssets = []\n        this.scriptManager = new ScriptManager(new Adapter(this))\n    }\n\n    componentDidMount() {\n        this.initThreeJS()\n        const opts = parseOptions({})\n        GET_JSON(getDocsURL()+opts.doc).then((payload)=>{\n            this.root = payload.graph\n            this.buildRoot(this.root)\n            console.log(\"root is\",this.root)\n            if(this.root.defaultScene) {\n                const sc = this.root.children.find(ch => ch.id  === this.root.defaultScene)\n                this.setCurrentScene(sc)\n            } else {\n                const sc = this.root.children[0]\n                this.setCurrentScene(sc)\n            }\n            Promise.all(this.pendingAssets).then(() => {\n                console.log(\"all assets loaded now\")\n                this.scriptManager.startRunning()\n            })\n        })\n    }\n\n    render() {\n        return <div>\n            <div id=\"overlay\">\n                <div id=\"inner\">\n                    <h1>Application Name</h1>\n                    <div id=\"loading-indicator\">\n                        <label>loading</label>\n                        <progress max=\"100\" value=\"0\" id=\"progress\"></progress>\n                    </div>\n                    <button id=\"enter-button\" disabled>VR not supported, play anyway</button>\n                </div>\n            </div>\n            <div ref={c => this.sceneContainer = c}></div>\n        </div>\n    }\n\n    buildRoot(graph) {\n        graph.children.forEach(ch => {\n            if(ch.type === TOTAL_OBJ_TYPES.SCENE) return this.initScene(ch)\n            if(ch.type === TOTAL_OBJ_TYPES.ASSETS_LIST) return this.initAssets(ch)\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIORS_LIST) return this.initBehaviors(ch)\n        })\n    }\n\n    initScene(def) {\n        // console.log(\"making a scene\",def)\n        this.obj_map[def.id] = def\n        const scene = new SceneDef().makeNode(def)\n        this.three_map[def.id] = scene\n        this.scenes.add(scene)\n        this.title_map[def.title] = def\n        def.children.forEach(ch => {\n            this.obj_map[ch.id] = ch\n            this.title_map[ch.title] = ch\n            ch.props = () => {\n                return ch\n            }\n            if(is3DObjectType(ch.type)) {\n                const child = get3DObjectDef(ch.type).makeNode(ch)\n                this.three_map[ch.id] = child\n                on(child, 'click', () => {\n                    this.scriptManager.performClickAction(ch)\n                })\n                scene.add(child)\n                //TODO: Make this recursive\n                if(ch.children) {\n                    ch.children.forEach(cch => {\n                        if(cch.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n                            this.behavior_map[cch.id] = cch\n                            cch.props = () => {\n                                return cch\n                            }\n                        }\n                    })\n                }\n            }\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIOR) {\n                this.behavior_map[ch.id] = ch\n            }\n        })\n        scene.visible = false\n    }\n\n    initThreeJS() {\n        this.tweenManager = new TweenManager()\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color( 0x000000 );\n        this.camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 50 );\n        this.renderer = new THREE.WebGLRenderer( { antialias: true } );\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.renderer.gammaOutput = true\n        this.renderer.vr.enabled = true;\n        this.sceneContainer.appendChild( this.renderer.domElement );\n        this.vrmanager = new VRManager(this.renderer)\n        this.audioListener = new THREE.AudioListener()\n        this.camera.add(this.audioListener)\n        window.addEventListener( 'resize', ()=>{\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize( window.innerWidth, window.innerHeight );\n        }, false );\n        this.renderer.setAnimationLoop(this.renderThree)\n        const light = new THREE.DirectionalLight( 0xffffff, 1.0 );\n        light.position.set( 1, 1, 1 ).normalize();\n        this.scene.add( light );\n        this.scene.add(new THREE.AmbientLight(0xffffff,0.2))\n\n\n        this.scenes = new Group()\n        this.scene.add(this.scenes)\n\n        const $ = (sel) => document.querySelector(sel)\n        const on = (elem, type, cb) => elem.addEventListener(type,cb)\n\n        on($(\"#enter-button\"),'click',()=>{\n            $(\"#overlay\").style.display = 'none'\n            //we can start playing sound now\n        })\n\n        this.vrmanager.addEventListener(VR_DETECTED,()=>{\n            console.log(\"VR detected\")\n            $(\"#enter-button\").removeAttribute('disabled',false)\n            $(\"#enter-button\").innerText = \"enter vr\"\n            on($(\"#enter-button\"),'click',()=> this.vrmanager.enterVR())\n        })\n\n        const WAIT_FOR_LOAD = false\n        if(!WAIT_FOR_LOAD) {\n            $(\"#loading-indicator\").style.display = 'none'\n            $(\"#enter-button\").style.display = 'block'\n            $(\"#enter-button\").removeAttribute('disabled')\n        }\n\n\n        //class which handles mouse and VR controller\n        this.pointer = new Pointer(this, {\n            intersectionFilter: ((o) => o.userData.clickable),\n            cameraFollowMouse:false,\n            mouseSimulatesController:false,\n            enableLaser: true,\n            laserLength: 20,\n        })\n\n    }\n\n    renderThree = (time) => {\n        if(this.tweenManager) this.tweenManager.update(time)\n        if(this.pointer) this.pointer.tick(time)\n        if(this.stats) this.stats.update(time)\n        if(this.controller) this.controller.update(time)\n        this.scriptManager.tick(time)\n        this.renderer.render( this.scene, this.camera );\n    }\n\n    initAssets(assets) {\n        console.log(\"loading assets\",assets.children)\n        assets.children.forEach(ch => {\n            console.log(\"loading asset\",ch)\n            this.obj_map[ch.id] =  ch\n        })\n    }\n\n    initBehaviors(behaviors) {\n        console.log(\"loading behaviors\",behaviors.children)\n        behaviors.children.forEach(ch => {\n            this.obj_map[ch.id] =  ch\n            if(ch.type === TOTAL_OBJ_TYPES.BEHAVIOR_SCRIPT) {\n                console.log(\"loading behavior\",ch)\n                const prom = fetch(ch.src)\n                    .then(res => res.text())\n                    .then(text => {\n                        const info = parseBehaviorScript(text)\n                        info.text = text\n                        this.behavior_assets[ch.id] = info\n                        return text\n                    })\n                this.pendingAssets.push(prom)\n            }\n        })\n    }\n\n    setCurrentScene(scene) {\n        // console.log('setting the current scene to',scene)\n        this.scenes.children.forEach(sc => sc.visible = false)\n        if(this.three_map[scene.id]) this.three_map[scene.id].visible = true\n        this.current_scene = scene\n    }\n\n}\n\n// ================  SGP implementation =====================\n\nclass Adapter extends SceneGraphProvider {\n    constructor(player) {\n        super()\n        this.player = player\n    }\n\n    getCurrentScene() {\n        return this.player.current_scene\n    }\n    getBehaviorsForObject (obj) {\n        if(!obj.children) return []\n        return obj.children.filter(ch => ch.type === TOTAL_OBJ_TYPES.BEHAVIOR)\n    }\n    getSceneObjects(sc) {\n        return sc.children.filter(ch => is3DObjectType(ch.type))\n    }\n    getThreeObject (id)  {\n        return this.player.three_map[id]\n    }\n    getParsedBehaviorAsset (b) {\n        return this.player.behavior_assets[b.behavior]\n    }\n    getAllBehaviors () {\n        return Object.keys(this.player.behavior_map).map(key => this.player.behavior_map[key])\n    }\n    navigateScene (sceneid) {\n        console.log(\"navigating to \",sceneid)\n        const scene = this.obj_map[sceneid]\n        if(!scene) return console.warn(\"couldn't find scene for\",sceneid)\n        this.setCurrentScene(scene)\n    }\n    playAudioAsset (audio)  {\n        console.log(\"trying to play\",audio)\n        const sound = new THREE.Audio(this.player.audioListener)\n        const audioLoader = new THREE.AudioLoader()\n        audioLoader.load(audio.src, function( buffer ) {\n            sound.setBuffer( buffer );\n            sound.setLoop( false );\n            sound.setVolume( 0.5 );\n            sound.play();\n        });\n    }\n    getGraphObjectByName(title) {\n        return this.player.title_map[title]\n    }\n    getGraphObjectById (id) {\n        return this.player.obj_map[id]\n    }\n}\n","import React, {Component} from 'react'\nimport './App.css'\nimport {DialogContainer, PopupContainer, PopupManager, VBox} from \"appy-comps\"\n\nimport MetadocEditor from \"./metadoc/Editor1\"\nimport VREditor from './vr/VREditor'\nimport {ImmersivePlayer} from './vr/ImmersivePlayer'\n\nexport default class App extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            switcher:false,\n        }\n        this.providers = ['vr','metadoc']\n        const sw = this.props.options.switcher\n        if(typeof sw !== 'undefined' && (sw === true || sw === 'true')) {\n            this.state.switcher = true\n        }\n    }\n\n    getApp() {\n        const doctype = this.props.options.doctype || \"vr\"\n        if(doctype === 'vr') {\n            if(this.props.options.mode === 'play') {\n                console.log(\"doing play instead\")\n                return <ImmersivePlayer/>\n            }\n            this.provider = new VREditor(this.props.options)\n            return this.provider.getApp()\n        }\n        if(doctype === 'metadoc') {\n            this.provider = new MetadocEditor(this.props.options)\n            return this.provider.getApp()\n        }\n    }\n\n\n//        provider.loadDoc(this.props.options.doc)\n\n    openNewProvider(name){\n        PopupManager.hide()\n        window.open(`./?mode=edit&doctype=${name}`)\n    }\n\n    showProviderList = (e) => {\n        PopupManager.show(\n            <VBox>\n                {this.providers.map((name)=>{\n                    return <button key={name} onClick={()=>this.openNewProvider(name)}>{name}</button>\n                })}\n            </VBox>,\n            e.target\n        )\n    }\n    render() {\n        if(!this.state.switcher) return this.getApp()\n        return (\n            <VBox fill>\n                <button\n                    style={{position:'absolute',zIndex: 10,}}\n                    onClick={this.showProviderList}\n                    >\n                    <img src=\"icon.png\" alt=\"switch apps\" height=\"20\" style={{padding:'0em'}}/>\n                </button>\n                <div style={{position: 'relative', flex: '1'}}>{this.getApp()}</div>\n                <DialogContainer/>\n                <PopupContainer/>\n            </VBox>\n        );\n    }\n}\n\n\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport 'font-awesome/css/font-awesome.css'\nimport App from './App';\nimport {parseOptions} from './utils'\n\nconst default_options = {\n    mode: 'edit',\n}\nconst options = parseOptions(default_options)\nconsole.log(\"options is\",options);\n\nfunction init() {\n    return <App options={options}/>;\n}\n\nReactDOM.render(init(), document.getElementById(\"root\"));\n\n"],"sourceRoot":""}